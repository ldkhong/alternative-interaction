!function(){function e(e){return a(e)||o(e)||u(e)||r()}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){return a(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(u){s=!0,a=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}(e,t)||u(e,t)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e){if(Array.isArray(e))return e}function i(e){return function(e){if(Array.isArray(e))return c(e)}(e)||o(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){throw e}),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){s=!0,i=e}),f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,k(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,e)})(e)}function h(e,t,n){return(h=b()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&v(a,n.prototype),a}).apply(null,arguments)}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=f(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}}).apply(this,arguments)}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=b();return function(){var n,r=k(e);if(t){var a=k(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return g(this,n)}}function g(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),e}(self.webpackChunkat_alternative_interaction_solution=self.webpackChunkat_alternative_interaction_solution||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},4901:function(e,t,n){var r=n(3366),a=n(9678),i=n(5278),o=n(5457),s=n(7594),u=n(9035),c=n(8507);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},3366:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0!==(r=(function(){return u}).call(t,n,t,a))&&(a.exports=r):this.alea=u}(0,e=n.nmd(e))},9035:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0!==(r=(function(){return u}).call(t,n,t,a))&&(a.exports=r):this.tychei=u}(0,e=n.nmd(e))},9678:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0!==(r=(function(){return u}).call(t,n,t,a))&&(a.exports=r):this.xor128=u}(0,e=n.nmd(e))},7594:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n=a[i]=(n^=n>>>15)^(e^=e>>>12),t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=0==(n=s[127&i]^=r+(o=o+1640531527|0))?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,s[a]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0!==(r=(function(){return u}).call(t,n,t,a))&&(a.exports=r):this.xor4096=u}(0,e=n.nmd(e))},5457:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],r[a]=n^=(e^=e<<13)^e<<9,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0!==(r=(function(){return u}).call(t,n,t,a))&&(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e))},5278:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0!==(r=(function(){return u}).call(t,n,t,a))&&(a.exports=r):this.xorwow=u}(0,e=n.nmd(e))},8507:function(e,t,n){var r;!function(a,i){var o,s=this,u=256,c=i.pow(u,6),l=i.pow(2,52),h=2*l,p=255;function f(e,t,n){var r=[],p=g(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(u):(e=new Uint8Array(u),(s.crypto||s.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,y(a)]}}():e,3),r),f=new d(r),b=function(){for(var e=f.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=f.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|f.g(4)},b.quick=function(){return f.g(4)/4294967296},b.double=b,g(y(f.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&v(r,f),e.state=function(){return v(f,{})}),n?(i.random=e,t):e})(b,p,"global"in t?t.global:this==i,t.state)}function d(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=p&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=p&a+1],n=n*u+o[p&(o[a]=o[i=p&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function v(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[p&a]=p&(n^=19*t[p&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(i.seedrandom=f,g(i.random(),a),e.exports){e.exports=f;try{o=n(5042)}catch(b){}}else void 0!==(r=(function(){return f}).call(t,n,t,e))&&(e.exports=r)}([],Math)},4066:function(r,a,o){"use strict";var u={};o.r(u),o.d(u,{assertParamsValid:function(){return nb},computeFlatOffset:function(){return vb},computeOutShape:function(){return ab},getNormalizedAxes:function(){return ub},isSliceContinous:function(){return db},maskToAxes:function(){return rb},parseSliceParams:function(){return mb},sliceInfo:function(){return gb},startForAxis:function(){return pb},startIndicesWithElidedDims:function(){return cb},stopForAxis:function(){return fb},stopIndicesWithElidedDims:function(){return lb},stridesForAxis:function(){return hb},stridesWithElidedDims:function(){return ib}});var c={};o.r(c),o.d(c,{collectGatherOpShapeInfo:function(){return zI},computeOutShape:function(){return PI},segOpComputeOptimalWindowSize:function(){return LI}});var f={};o.r(f),o.d(f,{ERF_A1:function(){return kI},ERF_A2:function(){return xI},ERF_A3:function(){return wI},ERF_A4:function(){return II},ERF_A5:function(){return NI},ERF_P:function(){return bI},PARALLELIZE_THRESHOLD:function(){return iI},SELU_SCALE:function(){return yI},SELU_SCALEALPHA:function(){return gI},applyActivation:function(){return Jx},assertAndGetBroadcastShape:function(){return kk},assertAxesAreInnerMostDims:function(){return Yk},assertParamsConsistent:function(){return rI},assignToTypedArray:function(){return DI},axesAreInnerMostDims:function(){return Gk},calculateShapes:function(){return mI},combineLocations:function(){return qk},complexWithEvenIndex:function(){return _I},complexWithOddIndex:function(){return RI},computeConv2DInfo:function(){return Bb},computeConv3DInfo:function(){return Vb},computeDefaultPad:function(){return Wb},computeDilation2DInfo:function(){return Lb},computeOptimalWindowSize:function(){return oI},computeOutAndReduceShapes:function(){return Kk},computeOutShape:function(){return aI},computePool2DInfo:function(){return Pb},computePool3DInfo:function(){return zb},convertConv2DDataFormat:function(){return Xb},eitherStridesOrDilationsAreOne:function(){return Kb},expandShapeToKeepDim:function(){return Xk},exponent:function(){return OI},exponents:function(){return FI},fromStringArrayToUint8:function(){return VI},fromUint8ToStringArray:function(){return BI},getAxesPermutation:function(){return Zk},getBroadcastDims:function(){return yk},getComplexWithIndex:function(){return AI},getFusedBiasGradient:function(){return Zx},getFusedDyActivation:function(){return Yx},getImageCenter:function(){return sI},getInnerMostAxes:function(){return Qk},getPermuted:function(){return cI},getReductionAxes:function(){return bk},getReshaped:function(){return uI},getReshapedPermuted:function(){return lI},getSliceBeginCoords:function(){return hI},getSliceSize:function(){return pI},getUndoAxesPermutation:function(){return Jk},log:function(){return CI},mergeRealAndImagArrays:function(){return TI},prepareAndValidate:function(){return fI},prepareSplitSize:function(){return MI},segment_util:function(){return c},shouldFuse:function(){return Qx},slice_util:function(){return u},splitRealAndImagArrays:function(){return EI},tupleValuesAreOne:function(){return qb},upcastType:function(){return zg},validateInput:function(){return vI},validateUpdateShape:function(){return dI},warn:function(){return SI}});var v={};o.r(v),o.d(v,{json:function(){return BR}});var b={};o.r(b),o.d(b,{json:function(){return VR}});var w={};o.r(w),o.d(w,{json:function(){return WR}});var N={};o.r(N),o.d(N,{json:function(){return UR}});var S={};o.r(S),o.d(S,{json:function(){return HR}});var C={};o.r(C),o.d(C,{json:function(){return jR}});var T={};o.r(T),o.d(T,{json:function(){return GR}});var E={};o.r(E),o.d(E,{json:function(){return qR}});var _={};o.r(_),o.d(_,{json:function(){return KR}});var R={};o.r(R),o.d(R,{json:function(){return XR}});var A={};o.r(A),o.d(A,{json:function(){return YR}});var D={};o.r(D),o.d(D,{json:function(){return ZR}});var F={};o.r(F),o.d(F,{json:function(){return JR}});var O={};o.r(O),o.d(O,{json:function(){return QR}});var M={};o.r(M),o.d(M,{json:function(){return $R}});var L={};o.r(L),o.d(L,{json:function(){return eA}});var P={};o.r(P),o.d(P,{json:function(){return tA}});var z={};function B(e){return"function"==typeof e}o.r(z),o.d(z,{addImpl:function(){return DD},bincountImpl:function(){return NF},bincountReduceImpl:function(){return SF},ceilImpl:function(){return EF},concatImpl:function(){return OF},expImpl:function(){return kO},expm1Impl:function(){return SO},floorImpl:function(){return qO},gatherV2Impl:function(){return tM},greaterImpl:function(){return rM},lessImpl:function(){return mM},linSpaceImpl:function(){return wM},logImpl:function(){return NM},maxImpl:function(){return BM},maximumImpl:function(){return UM},minimumImpl:function(){return eL},multiplyImpl:function(){return EO},negImpl:function(){return lL},notEqualImpl:function(){return yL},prodImpl:function(){return AL},rangeImpl:function(){return FL},rsqrtImpl:function(){return GL},simpleAbsImpl:function(){return WD},sliceImpl:function(){return kF},squaredDifferenceImpl:function(){return yP},stridedSliceImpl:function(){return IP},subImpl:function(){return MO},tileImpl:function(){return EP},topKImpl:function(){return _P},transposeImpl:function(){return XD},uniqueImpl:function(){return OP}});var V=!1,W={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else V&&console.log("RxJS: Back to a better error behavior. Thank you. <3");V=e},get useDeprecatedSynchronousErrorHandling(){return V}};function U(e){setTimeout(function(){throw e},0)}var H={closed:!0,next:function(e){},error:function(e){if(W.useDeprecatedSynchronousErrorHandling)throw e;U(e)},complete:function(){}},j=Array.isArray||function(e){return e&&"number"==typeof e.length};function G(e){return null!==e&&"object"==typeof e}var q,K=function(){function e(e){return Error.call(this),this.message=e?"".concat(e.length," errors occurred during unsubscription:\n").concat(e.map(function(e,t){return"".concat(t+1,") ").concat(e.toString())}).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),X=function(){function e(t){x(this,e),this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return I(e,[{key:"unsubscribe",value:function(){var t;if(!this.closed){var n=this._parentOrParents,r=this._ctorUnsubscribe,a=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var o=0;o<n.length;++o)n[o].remove(this);if(B(a)){r&&(this._unsubscribe=void 0);try{a.call(this)}catch(o){t=o instanceof K?Y(o.errors):[o]}}if(j(i))for(var s=-1,u=i.length;++s<u;){var c=i[s];if(G(c))try{c.unsubscribe()}catch(l){t=t||[],l instanceof K?t=t.concat(Y(l.errors)):t.push(l)}}if(t)throw new K(t)}}},{key:"add",value:function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}},{key:"remove",value:function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}]),e}();function Y(e){return e.reduce(function(e,t){return e.concat(t instanceof K?t.errors:t)},[])}X.EMPTY=((q=new X).closed=!0,q);var Z="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),J=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;switch(x(this,n),(i=t.call(this)).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=H;break;case 1:if(!e){i.destination=H;break}if("object"==typeof e){e instanceof n?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(y(i))):(i.syncErrorThrowable=!0,i.destination=new Q(y(i),e));break}default:i.syncErrorThrowable=!0,i.destination=new Q(y(i),e,r,a)}return i}return I(n,[{key:Z,value:function(){return this}},{key:"next",value:function(e){this.isStopped||this._next(e)}},{key:"error",value:function(e){this.isStopped||(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,p(k(n.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}],[{key:"create",value:function(e,t,r){var a=new n(e,t,r);return a.syncErrorThrowable=!1,a}}]),n}(X),Q=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;x(this,n),(o=t.call(this))._parentSubscriber=e;var s,u=y(o);return B(r)?s=r:r&&(s=r.next,a=r.error,i=r.complete,r!==H&&(B((u=Object.create(r)).unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(y(o)))),o._context=u,o._next=s,o._error=a,o._complete=i,o}return I(n,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;W.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber,n=W.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):U(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;U(e)}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};W.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),W.useDeprecatedSynchronousErrorHandling)throw n;U(n)}}},{key:"__tryOrSetError",value:function(e,t,n){if(!W.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return W.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(U(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),n}(J),$="function"==typeof Symbol&&Symbol.observable||"@@observable";function ee(e){return e}var te=function(){var e=function(){function e(t){x(this,e),this._isScalar=!1,t&&(this._subscribe=t)}return I(e,[{key:"lift",value:function(t){var n=new e;return n.source=this,n.operator=t,n}},{key:"subscribe",value:function(e,t,n){var r=this.operator,a=function(e,t,n){if(e){if(e instanceof J)return e;if(e[Z])return e[Z]()}return e||t||n?new J(e,t,n):new J(H)}(e,t,n);if(a.add(r?r.call(a,this.source):this.source||W.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),W.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){W.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,a=t.isStopped;if(n||a)return!1;e=r&&r instanceof J?r:null}return!0}(e)?e.error(t):console.warn(t)}}},{key:"forEach",value:function(e,t){var n=this;return new(t=ne(t))(function(t,r){var a;a=n.subscribe(function(t){try{e(t)}catch(n){r(n),a&&a.unsubscribe()}},r,t)})}},{key:"_subscribe",value:function(e){var t=this.source;return t&&t.subscribe(e)}},{key:$,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?this:function(e){return 0===e.length?ee:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}(t)(this)}},{key:"toPromise",value:function(e){var t=this;return new(e=ne(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})}}]),e}();return e.create=function(t){return new e(t)},e}();function ne(e){if(e||(e=W.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var re=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),ae=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this)).subject=e,a.subscriber=r,a.closed=!1,a}return I(n,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}}}]),n}(X),ie=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).destination=e,r}return n}(J),oe=function(){var e=function(e){d(n,e);var t=m(n);function n(){var e;return x(this,n),(e=t.call(this)).observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return I(n,[{key:Z,value:function(){return new ie(this)}},{key:"lift",value:function(e){var t=new se(this,this);return t.operator=e,t}},{key:"next",value:function(e){if(this.closed)throw new re;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].next(e)}},{key:"error",value:function(e){if(this.closed)throw new re;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].error(e);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new re;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(e){if(this.closed)throw new re;return p(k(n.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){if(this.closed)throw new re;return this.hasError?(e.error(this.thrownError),X.EMPTY):this.isStopped?(e.complete(),X.EMPTY):(this.observers.push(e),new ae(this,e))}},{key:"asObservable",value:function(){var e=new te;return e.source=this,e}}]),n}(te);return e.create=function(e,t){return new se(e,t)},e}(),se=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this)).destination=e,a.source=r,a}return I(n,[{key:"next",value:function(e){var t=this.destination;t&&t.next&&t.next(e)}},{key:"error",value:function(e){var t=this.destination;t&&t.error&&this.destination.error(e)}},{key:"complete",value:function(){var e=this.destination;e&&e.complete&&this.destination.complete()}},{key:"_subscribe",value:function(e){return this.source?this.source.subscribe(e):X.EMPTY}}]),n}(oe);function ue(e){return e&&"function"==typeof e.schedule}function ce(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new le(e,t))}}var le=function(){function e(t,n){x(this,e),this.project=t,this.thisArg=n}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new he(e,this.project,this.thisArg))}}]),e}(),he=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this,e)).project=r,i.count=0,i.thisArg=a||y(i),i}return I(n,[{key:"_next",value:function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(J),pe=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},fe="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",de=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ve(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var me=function(e){if(e&&"function"==typeof e[$])return function(e){return function(t){var n=e[$]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}}(e);if(de(e))return pe(e);if(ve(e))return function(e){return function(t){return e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,U),t}}(e);if(e&&"function"==typeof e[fe])return function(e){return function(t){for(var n=e[fe]();;){var r=void 0;try{r=n.next()}catch(a){return t.error(a),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t}}(e);var t="You provided ".concat(G(e)?"an invalid object":"'".concat(e,"'")," where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.");throw new TypeError(t)};function ge(e,t){return new te(function(n){var r=new X,a=0;return r.add(t.schedule(function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function ye(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[$]}(e))return function(e,t){return new te(function(n){var r=new X;return r.add(t.schedule(function(){var a=e[$]();r.add(a.subscribe({next:function(e){r.add(t.schedule(function(){return n.next(e)}))},error:function(e){r.add(t.schedule(function(){return n.error(e)}))},complete:function(){r.add(t.schedule(function(){return n.complete()}))}}))})),r})}(e,t);if(ve(e))return function(e,t){return new te(function(n){var r=new X;return r.add(t.schedule(function(){return e.then(function(e){r.add(t.schedule(function(){n.next(e),r.add(t.schedule(function(){return n.complete()}))}))},function(e){r.add(t.schedule(function(){return n.error(e)}))})})),r})}(e,t);if(de(e))return ge(e,t);if(function(e){return e&&"function"==typeof e[fe]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new te(function(n){var r,a=new X;return a.add(function(){r&&"function"==typeof r.return&&r.return()}),a.add(t.schedule(function(){r=e[fe](),a.add(t.schedule(function(){if(!n.closed){var e,t;try{var a=r.next();e=a.value,t=a.done}catch(a){return void n.error(a)}t?n.complete():(n.next(e),this.schedule())}}))})),a})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof te?e:new te(me(e))}var be=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).parent=e,r}return I(n,[{key:"_next",value:function(e){this.parent.notifyNext(e)}},{key:"_error",value:function(e){this.parent.notifyError(e),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(),this.unsubscribe()}}]),n}(J),ke=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"notifyNext",value:function(e){this.destination.next(e)}},{key:"notifyError",value:function(e){this.destination.error(e)}},{key:"notifyComplete",value:function(){this.destination.complete()}}]),n}(J);function xe(e,t){if(!t.closed){if(e instanceof te)return e.subscribe(t);var n;try{n=me(e)(t)}catch(r){t.error(r)}return n}}function we(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof t?function(r){return r.pipe(we(function(n,r){return ye(e(n,r)).pipe(ce(function(e,a){return t(n,e,r,a)}))},n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Ie(e,n))})}var Ie=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;x(this,e),this.project=t,this.concurrent=n}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new Ne(e,this.project,this.concurrent))}}]),e}(),Ne=function(e){d(n,e);var t=m(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return x(this,n),(a=t.call(this,e)).project=r,a.concurrent=i,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return I(n,[{key:"_next",value:function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)}},{key:"_innerSub",value:function(e){var t=new be(this),n=this.destination;n.add(t);var r=xe(e,t);r!==t&&n.add(r)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(e){this.destination.next(e)}},{key:"notifyComplete",value:function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),n}(ke);function Se(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return we(ee,e)}function Ce(e,t){return t?ge(e,t):new te(pe(e))}function Te(){return function(e){return e.lift(new Ee(e))}}var Ee=function(){function e(t){x(this,e),this.connectable=t}return I(e,[{key:"call",value:function(e,t){var n=this.connectable;n._refCount++;var r=new _e(e,n),a=t.subscribe(r);return r.closed||(r.connection=n.connect()),a}}]),e}(),_e=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).connectable=r,a}return I(n,[{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,r&&(!n||r===n)&&r.unsubscribe()}}else this.connection=null}}]),n}(J),Re=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this)).source=e,a.subjectFactory=r,a._refCount=0,a._isComplete=!1,a}return I(n,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new X).add(this.source.subscribe(new De(this.getSubject(),this))),e.closed&&(this._connection=null,e=X.EMPTY)),e}},{key:"refCount",value:function(){return Te()(this)}}]),n}(te),Ae=function(){var e=Re.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),De=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).connectable=r,a}return I(n,[{key:"_error",value:function(e){this._unsubscribe(),p(k(n.prototype),"_error",this).call(this,e)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),p(k(n.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}]),n}(ie);function Fe(){return new oe}function Oe(e){for(var t in e)if(e[t]===Oe)return t;throw Error("Could not find renamed property on target object.")}function Me(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Me).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return"".concat(e.overriddenName);if(e.name)return"".concat(e.name);var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Le(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}var Pe=Oe({__forward_ref__:Oe});function ze(e){return e.__forward_ref__=ze,e.toString=function(){return Me(this())},e}function Be(e){return function(e){return"function"==typeof e&&e.hasOwnProperty(Pe)&&e.__forward_ref__===ze}(e)?e():e}var Ve=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,function(e,t){return"".concat(e?"NG0".concat(e,": "):"").concat(t)}(e,r))).code=e,a}return n}(l(Error));function We(e){return"string"==typeof e?e:null==e?"":String(e)}function Ue(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():We(e)}function He(e,t){var n=t?" in ".concat(t):"";throw new Ve("201","No provider for ".concat(Ue(e)," found").concat(n))}function je(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ge(e){return{providers:e.providers||[],imports:e.imports||[]}}function qe(e){return Ke(e,Ze)||Ke(e,Qe)}function Ke(e,t){return e.hasOwnProperty(t)?e[t]:null}function Xe(e){return e&&(e.hasOwnProperty(Je)||e.hasOwnProperty($e))?e[Je]:null}var Ye,Ze=Oe({"\u0275prov":Oe}),Je=Oe({"\u0275inj":Oe}),Qe=Oe({ngInjectableDef:Oe}),$e=Oe({ngInjectorDef:Oe}),et=((et=et||{})[et.Default=0]="Default",et[et.Host=1]="Host",et[et.Self=2]="Self",et[et.SkipSelf=4]="SkipSelf",et[et.Optional=8]="Optional",et);function tt(e){var t=Ye;return Ye=e,t}function nt(e,t,n){var r=qe(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&et.Optional?null:void 0!==t?t:void He(Me(e),"Injector")}function rt(e){return{toString:e}.toString()}var at=((at=at||{})[at.OnPush=0]="OnPush",at[at.Default=1]="Default",at),it=((it=it||{})[it.Emulated=0]="Emulated",it[it.None=2]="None",it[it.ShadowDom=3]="ShadowDom",it),ot="undefined"!=typeof globalThis&&globalThis,st="undefined"!=typeof window&&window,ut="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ct=ot||"undefined"!=typeof global&&global||st||ut,lt={},ht=[],pt=Oe({"\u0275cmp":Oe}),ft=Oe({"\u0275dir":Oe}),dt=Oe({"\u0275pipe":Oe}),vt=Oe({"\u0275mod":Oe}),mt=Oe({"\u0275loc":Oe}),gt=Oe({"\u0275fac":Oe}),yt=Oe({__NG_ELEMENT_ID__:Oe}),bt=0;function kt(e){return rt(function(){var t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===at.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||ht,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||it.Emulated,id:"c",styles:e.styles||ht,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,a=e.features,i=e.pipes;return n.id+=bt++,n.inputs=St(e.inputs,t),n.outputs=St(e.outputs),a&&a.forEach(function(e){return e(n)}),n.directiveDefs=r?function(){return("function"==typeof r?r():r).map(xt)}:null,n.pipeDefs=i?function(){return("function"==typeof i?i():i).map(wt)}:null,n})}function xt(e){return Tt(e)||function(e){return e[ft]||null}(e)}function wt(e){return function(e){return e[dt]||null}(e)}var It={};function Nt(e){return rt(function(){var t={type:e.type,bootstrap:e.bootstrap||ht,declarations:e.declarations||ht,imports:e.imports||ht,exports:e.exports||ht,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(It[e.id]=e.type),t})}function St(e,t){if(null==e)return lt;var n={};for(var r in e)if(e.hasOwnProperty(r)){var a=e[r],i=a;Array.isArray(a)&&(i=a[1],a=a[0]),n[a]=r,t&&(t[a]=i)}return n}var Ct=kt;function Tt(e){return e[pt]||null}function Et(e,t){var n=e[vt]||null;if(!n&&!0===t)throw new Error("Type ".concat(Me(e)," does not have '\u0275mod' property."));return n}function _t(e){return Array.isArray(e)&&"object"==typeof e[1]}function Rt(e){return Array.isArray(e)&&!0===e[1]}function At(e){return 0!=(8&e.flags)}function Dt(e){return 2==(2&e.flags)}function Ft(e){return 1==(1&e.flags)}function Ot(e){return null!==e.template}function Mt(e){return 0!=(512&e[2])}function Lt(e,t){return e.hasOwnProperty(gt)?e[gt]:null}var Pt=function(){function e(t,n,r){x(this,e),this.previousValue=t,this.currentValue=n,this.firstChange=r}return I(e,[{key:"isFirstChange",value:function(){return this.firstChange}}]),e}();function zt(){var e=Ut(this),t=null==e?void 0:e.current;if(t){var n=e.previous;if(n===lt)e.previous=t;else for(var r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function Bt(e,t,n,r){var a=Ut(e)||function(e,t){return e[Wt]=t}(e,{previous:lt,current:null}),i=a.current||(a.current={}),o=a.previous,s=this.declaredInputs[n],u=o[s];i[s]=new Pt(u&&u.currentValue,t,o===lt),e[r]=t}var Vt,Wt="__ngSimpleChanges__";function Ut(e){return e[Wt]||null}function Ht(){return void 0!==Vt?Vt:"undefined"!=typeof document?document:void 0}function jt(e){return!!e.listen}var Gt={createRenderer:function(e,t){return Ht()}};function qt(e){for(;Array.isArray(e);)e=e[0];return e}function Kt(e,t){return qt(t[e.index])}function Xt(e,t){return e.data[t]}function Yt(e,t){var n=t[e];return _t(n)?n:n[0]}function Zt(e){return 4==(4&e[2])}function Jt(e){return 128==(128&e[2])}function Qt(e,t){return null==t?null:e[t]}function $t(e){e[18]=0}function en(e,t){e[5]+=t;for(var n=e,r=e[3];null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}var tn={lFrame:kn(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function nn(){return tn.bindingsEnabled}function rn(){return tn.lFrame.lView}function an(){return tn.lFrame.tView}function on(){for(var e=sn();null!==e&&64===e.type;)e=e.parent;return e}function sn(){return tn.lFrame.currentTNode}function un(e,t){var n=tn.lFrame;n.currentTNode=e,n.isParent=t}function cn(){return tn.lFrame.isParent}function ln(){return tn.isInCheckNoChangesMode}function hn(e){tn.isInCheckNoChangesMode=e}function pn(e,t){var n=tn.lFrame;n.bindingIndex=n.bindingRootIndex=e,fn(t)}function fn(e){tn.lFrame.currentDirectiveIndex=e}function dn(){return tn.lFrame.currentQueryIndex}function vn(e){tn.lFrame.currentQueryIndex=e}function mn(e){var t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function gn(e,t,n){if(n&et.SkipSelf){for(var r=t,a=e;!(null!==(r=r.parent)||n&et.Host||(r=mn(a),null===r||(a=a[15],10&r.type))););if(null===r)return!1;t=r,e=a}var i=tn.lFrame=bn();return i.currentTNode=t,i.lView=e,!0}function yn(e){var t=bn(),n=e[1];tn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function bn(){var e=tn.lFrame,t=null===e?null:e.child;return null===t?kn(e):t}function kn(e){var t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function xn(){var e=tn.lFrame;return tn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}var wn=xn;function In(){var e=xn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Nn(){return tn.lFrame.selectedIndex}function Sn(e){tn.lFrame.selectedIndex=e}function Cn(e,t){for(var n=t.directiveStart,r=t.directiveEnd;n<r;n++){var a=e.data[n].type.prototype,i=a.ngAfterContentInit,o=a.ngAfterContentChecked,s=a.ngAfterViewInit,u=a.ngAfterViewChecked,c=a.ngOnDestroy;i&&(e.contentHooks||(e.contentHooks=[])).push(-n,i),o&&((e.contentHooks||(e.contentHooks=[])).push(n,o),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,o)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),u&&((e.viewHooks||(e.viewHooks=[])).push(n,u),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,u)),null!=c&&(e.destroyHooks||(e.destroyHooks=[])).push(n,c)}}function Tn(e,t,n){Rn(e,t,3,n)}function En(e,t,n,r){(3&e[2])===n&&Rn(e,t,n,r)}function _n(e,t){var n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Rn(e,t,n,r){for(var a=null!=r?r:-1,i=t.length-1,o=0,s=void 0!==r?65535&e[18]:0;s<i;s++)if("number"==typeof t[s+1]){if(o=t[s],null!=r&&o>=r)break}else t[s]<0&&(e[18]+=65536),(o<a||-1==a)&&(An(e,n,t,s),e[18]=(4294901760&e[18])+s+2),s++}function An(e,t,n,r){var a=n[r]<0,i=n[r+1],o=e[a?-n[r]:n[r]];if(a){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{i.call(o)}finally{}}}else try{i.call(o)}finally{}}var Dn=function e(t,n,r){x(this,e),this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r};function Fn(e,t,n){for(var r=jt(e),a=0;a<n.length;){var i=n[a];if("number"==typeof i){if(0!==i)break;a++;var o=n[a++],s=n[a++],u=n[a++];r?e.setAttribute(t,s,u,o):t.setAttributeNS(o,s,u)}else{var c=i,l=n[++a];Mn(c)?r&&e.setProperty(t,c,l):r?e.setAttribute(t,c,l):t.setAttribute(c,l),a++}}return a}function On(e){return 3===e||4===e||6===e}function Mn(e){return 64===e.charCodeAt(0)}function Ln(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else for(var n=-1,r=0;r<t.length;r++){var a=t[r];"number"==typeof a?n=a:0===n||Pn(e,n,a,null,-1===n||2===n?t[++r]:null)}return e}function Pn(e,t,n,r,a){var i=0,o=e.length;if(-1===t)o=-1;else for(;i<e.length;){var s=e[i++];if("number"==typeof s){if(s===t){o=-1;break}if(s>t){o=i-1;break}}}for(;i<e.length;){var u=e[i];if("number"==typeof u)break;if(u===n){if(null===r)return void(null!==a&&(e[i+1]=a));if(r===e[i+1])return void(e[i+2]=a)}i++,null!==r&&i++,null!==a&&i++}-1!==o&&(e.splice(o,0,t),i=o+1),e.splice(i++,0,n),null!==r&&e.splice(i++,0,r),null!==a&&e.splice(i++,0,a)}function zn(e){return-1!==e}function Bn(e){return 32767&e}function Vn(e,t){for(var n=function(e){return e>>16}(e),r=t;n>0;)r=r[15],n--;return r}var Wn=!0;function Un(e){var t=Wn;return Wn=e,t}var Hn=0;function jn(e,t){var n=qn(e,t);if(-1!==n)return n;var r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Gn(r.data,e),Gn(t,null),Gn(r.blueprint,null));var a=Kn(e,t),i=e.injectorIndex;if(zn(a))for(var o=Bn(a),s=Vn(a,t),u=s[1].data,c=0;c<8;c++)t[i+c]=s[o+c]|u[o+c];return t[i+8]=a,i}function Gn(e,t){e.push(0,0,0,0,0,0,0,0,t)}function qn(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Kn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;for(var n=0,r=null,a=t;null!==a;){var i=a[1],o=i.type;if(null===(r=2===o?i.declTNode:1===o?a[6]:null))return-1;if(n++,a=a[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Xn(e,t,n){!function(e,t,n){var r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(yt)&&(r=n[yt]),null==r&&(r=n[yt]=Hn++);var a=255&r;t.data[e+(a>>5)]|=1<<a}(e,t,n)}function Yn(e,t,n){if(n&et.Optional)return e;He(t,"NodeInjector")}function Zn(e,t,n,r){if(n&et.Optional&&void 0===r&&(r=null),0==(n&(et.Self|et.Host))){var a=e[9],i=tt(void 0);try{return a?a.get(t,r,n&et.Optional):nt(t,r,n&et.Optional)}finally{tt(i)}}return Yn(r,t,n)}function Jn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:et.Default,a=arguments.length>4?arguments[4]:void 0;if(null!==e){var i=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;var t=e.hasOwnProperty(yt)?e[yt]:void 0;return"number"==typeof t?t>=0?255&t:$n:t}(n);if("function"==typeof i){if(!gn(t,e,r))return r&et.Host?Yn(a,n,r):Zn(t,n,r,a);try{var o=i(r);if(null!=o||r&et.Optional)return o;He(n)}finally{wn()}}else if("number"==typeof i){var s=null,u=qn(e,t),c=-1,l=r&et.Host?t[16][6]:null;for((-1===u||r&et.SkipSelf)&&(-1!==(c=-1===u?Kn(e,t):t[u+8])&&ar(r,!1)?(s=t[1],u=Bn(c),t=Vn(c,t)):u=-1);-1!==u;){var h=t[1];if(rr(i,u,h.data)){var p=er(u,t,n,s,r,l);if(p!==Qn)return p}-1!==(c=t[u+8])&&ar(r,t[1].data[u+8]===l)&&rr(i,u,t)?(s=h,u=Bn(c),t=Vn(c,t)):u=-1}}}return Zn(t,n,r,a)}var Qn={};function $n(){return new ir(on(),rn())}function er(e,t,n,r,a,i){var o=t[1],s=o.data[e+8],u=tr(s,o,n,null==r?Dt(s)&&Wn:r!=o&&0!=(3&s.type),a&et.Host&&i===s);return null!==u?nr(t,o,u,s):Qn}function tr(e,t,n,r,a){for(var i=e.providerIndexes,o=t.data,s=1048575&i,u=e.directiveStart,c=i>>20,l=a?s+c:e.directiveEnd,h=r?s:s+c;h<l;h++){var p=o[h];if(h<u&&n===p||h>=u&&p.type===n)return h}if(a){var f=o[u];if(f&&Ot(f)&&f.type===n)return u}return null}function nr(e,t,n,r){var a=e[n],i=t.data;if(function(e){return e instanceof Dn}(a)){var o=a;o.resolving&&function(e,t){throw new Ve("200","Circular dependency in DI detected for ".concat(e))}(Ue(i[n]));var s=Un(o.canSeeViewProviders);o.resolving=!0;var u=o.injectImpl?tt(o.injectImpl):null;gn(e,r,et.Default);try{a=e[n]=o.factory(void 0,i,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){var r=t.type.prototype,a=r.ngOnChanges,i=r.ngOnInit,o=r.ngDoCheck;if(a){var s=function(e){return e.type.prototype.ngOnChanges&&(e.setInput=Bt),zt}(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),o&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,o),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,o))}(n,i[n],t)}finally{null!==u&&tt(u),Un(s),o.resolving=!1,wn()}}return a}function rr(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function ar(e,t){return!(e&et.Self||e&et.Host&&t)}var ir=function(){function e(t,n){x(this,e),this._tNode=t,this._lView=n}return I(e,[{key:"get",value:function(e,t,n){return Jn(this._tNode,this._lView,e,n,t)}}]),e}(),or="__parameters__";function sr(e,t,n){return rt(function(){var r=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var n in t)this[n]=t[n]}}}(t);function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this instanceof a)return r.apply(this,t),this;var i=h(a,t);return o.annotation=i,o;function o(e,t,n){for(var r=e.hasOwnProperty(or)?e[or]:Object.defineProperty(e,or,{value:[]})[or];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(i),e}}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a})}var ur=function(){function e(t,n){x(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=je({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return I(e,[{key:"toString",value:function(){return"InjectionToken ".concat(this._desc)}}]),e}(),cr=new ur("AnalyzeForEntryComponents"),lr=Function;function hr(e,t){void 0===t&&(t=e);for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),hr(r,t)):t!==e&&t.push(r)}return t}function pr(e,t){e.forEach(function(e){return Array.isArray(e)?pr(e,t):t(e)})}function fr(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function dr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}var vr,mr={},gr="__NG_DI_FLAG__",yr="ngTempTokenPath",br=/\n/gm,kr="__source",xr=Oe({provide:String,useValue:Oe});function wr(e){var t=vr;return vr=e,t}function Ir(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:et.Default;if(void 0===vr)throw new Error("inject() must be called from an injection context");return null===vr?nt(e,void 0,t):vr.get(e,t&et.Optional?null:void 0,t)}function Nr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:et.Default;return(Ye||Ir)(Be(e),t)}function Sr(e){for(var t=[],n=0;n<e.length;n++){var r=Be(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");for(var a=void 0,i=et.Default,o=0;o<r.length;o++){var s=r[o],u=Tr(s);"number"==typeof u?-1===u?a=s.token:i|=u:a=s}t.push(Nr(a,i))}else t.push(Nr(r))}return t}function Cr(e,t){return e[gr]=t,e.prototype[gr]=t,e}function Tr(e){return e[gr]}function Er(e,t,n,r){var a=e[yr];throw t[kr]&&a.unshift(t[kr]),e.message=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;var a=Me(t);if(Array.isArray(t))a=t.map(Me).join(" -> ");else if("object"==typeof t){var i=[];for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];i.push(o+":"+("string"==typeof s?JSON.stringify(s):Me(s)))}a="{".concat(i.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(a,"]: ").concat(e.replace(br,"\n  "))}("\n"+e.message,a,n,r),e.ngTokenPath=a,e[yr]=null,e}var _r,Rr,Ar=Cr(sr("Inject",function(e){return{token:e}}),-1),Dr=Cr(sr("Optional"),8),Fr=Cr(sr("SkipSelf"),4);function Or(e){var t;return(null===(t=function(){if(void 0===_r&&(_r=null,ct.trustedTypes))try{_r=ct.trustedTypes.createPolicy("angular",{createHTML:function(e){return e},createScript:function(e){return e},createScriptURL:function(e){return e}})}catch(e){}return _r}())||void 0===t?void 0:t.createHTML(e))||e}function Mr(e){var t;return(null===(t=function(){if(void 0===Rr&&(Rr=null,ct.trustedTypes))try{Rr=ct.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:function(e){return e},createScript:function(e){return e},createScriptURL:function(e){return e}})}catch(e){}return Rr}())||void 0===t?void 0:t.createHTML(e))||e}var Lr=function(){function e(t){x(this,e),this.changingThisBreaksApplicationSecurity=t}return I(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: ".concat(this.changingThisBreaksApplicationSecurity," (see https://g.co/ng/security#xss)")}}]),e}();var Pr=function(){function e(t){x(this,e),this.inertDocumentHelper=t}return I(e,[{key:"getInertBodyElement",value:function(e){e="<body><remove></remove>"+e;try{var t=(new window.DOMParser).parseFromString(Or(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch(t){return null}}}]),e}(),zr=function(){function e(t){if(x(this,e),this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){var n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n);var r=this.inertDocument.createElement("body");n.appendChild(r)}}return I(e,[{key:"getInertBodyElement",value:function(e){var t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Or(e),t;var n=this.inertDocument.createElement("body");return n.innerHTML=Or(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}},{key:"stripCustomNsAttrs",value:function(e){for(var t=e.attributes,n=t.length-1;0<n;n--){var r=t.item(n).name;("xmlns:ns1"===r||0===r.indexOf("ns1:"))&&e.removeAttribute(r)}for(var a=e.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}]),e}(),Br=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Vr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Wr(e){return(e=String(e)).match(Br)||e.match(Vr)?e:"unsafe:"+e}function Ur(e){return(e=String(e)).split(",").map(function(e){return Wr(e.trim())}).join(", ")}function Hr(e){var t,n={},r=s(e.split(","));try{for(r.s();!(t=r.n()).done;){n[t.value]=!0}}catch(a){r.e(a)}finally{r.f()}return n}function jr(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];for(var s in o)o.hasOwnProperty(s)&&(e[s]=!0)}return e}var Gr,qr=Hr("area,br,col,hr,img,wbr"),Kr=Hr("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Xr=Hr("rp,rt"),Yr=jr(qr,jr(Kr,Hr("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),jr(Xr,Hr("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),jr(Xr,Kr)),Zr=Hr("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Jr=Hr("srcset"),Qr=jr(Zr,Jr,Hr("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Hr("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),$r=Hr("script,style,template"),ea=function(){function e(){x(this,e),this.sanitizedSomething=!1,this.buf=[]}return I(e,[{key:"sanitizeChildren",value:function(e){for(var t=e.firstChild,n=!0;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);var r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}},{key:"startElement",value:function(e){var t=e.nodeName.toLowerCase();if(!Yr.hasOwnProperty(t))return this.sanitizedSomething=!0,!$r.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);for(var n=e.attributes,r=0;r<n.length;r++){var a=n.item(r),i=a.name,o=i.toLowerCase();if(Qr.hasOwnProperty(o)){var s=a.value;Zr[o]&&(s=Wr(s)),Jr[o]&&(s=Ur(s)),this.buf.push(" ",i,'="',ra(s),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0}},{key:"endElement",value:function(e){var t=e.nodeName.toLowerCase();Yr.hasOwnProperty(t)&&!qr.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}},{key:"chars",value:function(e){this.buf.push(ra(e))}},{key:"checkClobberedElement",value:function(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: ".concat(e.outerHTML));return t}}]),e}(),ta=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,na=/([^\#-~ |!])/g;function ra(e){return e.replace(/&/g,"&amp;").replace(ta,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(na,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function aa(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var ia=((ia=ia||{})[ia.NONE=0]="NONE",ia[ia.HTML=1]="HTML",ia[ia.STYLE=2]="STYLE",ia[ia.SCRIPT=3]="SCRIPT",ia[ia.URL=4]="URL",ia[ia.RESOURCE_URL=5]="RESOURCE_URL",ia);function oa(e){var t=function(){var e=rn();return e&&e[12]}();return t?Mr(t.sanitize(ia.HTML,e)||""):function(e,t){var n=function(e){return e instanceof Lr&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error("Required a safe ".concat(t,", got a ").concat(n," (see https://g.co/ng/security#xss)"))}return n===t}(e,"HTML")?Mr(function(e){return e instanceof Lr?e.changingThisBreaksApplicationSecurity:e}(e)):function(e,t){var n=null;try{Gr=Gr||function(e){var t=new zr(e);return function(){try{return!!(new window.DOMParser).parseFromString(Or(""),"text/html")}catch(e){return!1}}()?new Pr(t):t}(e);var r=t?String(t):"";n=Gr.getInertBodyElement(r);var a=5,i=r;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,r=i,i=n.innerHTML,n=Gr.getInertBodyElement(r)}while(r!==i);return Or((new ea).sanitizeChildren(aa(n)||n))}finally{if(n)for(var o=aa(n)||n;o.firstChild;)o.removeChild(o.firstChild)}}(Ht(),We(e))}var sa="__ngContext__";function ua(e,t){e[sa]=t}function ca(e){var t=function(e){return e[sa]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function la(e){return e.ngOriginalError}function ha(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.error.apply(e,n)}var pa=function(){function e(){x(this,e),this._console=console}return I(e,[{key:"handleError",value:function(e){var t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e&&e.ngErrorLogger||ha}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}},{key:"_findContext",value:function(e){return e?function(e){return e.ngDebugContext}(e)||this._findContext(la(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=e&&la(e);t&&la(t);)t=la(t);return t||null}}]),e}(),fa=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ct);function da(e){return e instanceof Function?e():e}var va=((va=va||{})[va.Important=1]="Important",va[va.DashCase=2]="DashCase",va);function ma(e,t){return(void 0)(e,t)}function ga(e){var t=e[3];return Rt(t)?t[3]:t}function ya(e){return ka(e[13])}function ba(e){return ka(e[4])}function ka(e){for(;null!==e&&!Rt(e);)e=e[4];return e}function xa(e,t,n,r,a){if(null!=r){var i,o=!1;Rt(r)?i=r:_t(r)&&(o=!0,r=r[0]);var s=qt(r);0===e&&null!==n?null==a?Ea(t,n,s):Ta(t,n,s,a||null,!0):1===e&&null!==n?Ta(t,n,s,a||null,!0):2===e?function(e,t,n){var r=Ra(e,t);r&&function(e,t,n,r){jt(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,s,o):3===e&&t.destroyNode(s),null!=i&&function(e,t,n,r,a){var i=n[7];i!==qt(n)&&xa(t,e,r,i,a);for(var o=10;o<n.length;o++){var s=n[o];La(s[1],s,e,t,r,i)}}(t,e,i,n,a)}}function wa(e,t,n){return jt(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Ia(e,t){var n=e[9],r=n.indexOf(t),a=t[3];1024&t[2]&&(t[2]&=-1025,en(a,-1)),n.splice(r,1)}function Na(e,t){if(!(e.length<=10)){var n=10+t,r=e[n];if(r){var a=r[17];null!==a&&a!==e&&Ia(a,r),t>0&&(e[n-1][4]=r[4]);var i=dr(e,10+t);!function(e,t){La(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);var o=i[19];null!==o&&o.detachView(i[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}}function Sa(e,t){if(!(256&t[2])){var n=t[11];jt(n)&&n.destroyNode&&La(e,t,n,3,null,null),function(e){var t=e[13];if(!t)return Ca(e[1],e);for(;t;){var n=null;if(_t(t))n=t[13];else{var r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)_t(t)&&Ca(t[1],t),t=t[3];null===t&&(t=e),_t(t)&&Ca(t[1],t),n=t&&t[4]}t=n}}(t)}}function Ca(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){var n;if(null!=e&&null!=(n=e.destroyHooks))for(var r=0;r<n.length;r+=2){var a=t[n[r]];if(!(a instanceof Dn)){var i=n[r+1];if(Array.isArray(i))for(var o=0;o<i.length;o+=2){var s=a[i[o]],u=i[o+1];try{u.call(s)}finally{}}else try{i.call(a)}finally{}}}}(e,t),function(e,t){var n=e.cleanup,r=t[7],a=-1;if(null!==n)for(var i=0;i<n.length-1;i+=2)if("string"==typeof n[i]){var o=n[i+1],s="function"==typeof o?o(t):qt(t[o]),u=r[a=n[i+2]],c=n[i+3];"boolean"==typeof c?s.removeEventListener(n[i],u,c):c>=0?r[a=c]():r[a=-c].unsubscribe(),i+=2}else{var l=r[a=n[i+1]];n[i].call(l)}if(null!==r){for(var h=a+1;h<r.length;h++)r[h]();t[7]=null}}(e,t),1===t[1].type&&jt(t[11])&&t[11].destroy();var n=t[17];if(null!==n&&Rt(t[3])){n!==t[3]&&Ia(n,t);var r=t[19];null!==r&&r.detachView(e)}}}function Ta(e,t,n,r,a){jt(e)?e.insertBefore(t,n,r,a):t.insertBefore(n,r,a)}function Ea(e,t,n){jt(e)?e.appendChild(t,n):t.appendChild(n)}function _a(e,t,n,r,a){null!==r?Ta(e,t,n,r,a):Ea(e,t,n)}function Ra(e,t){return jt(e)?e.parentNode(t):t.parentNode}function Aa(e,t,n,r){var a=function(e,t,n){return function(e,t,n){for(var r=t;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){var a=e.data[r.directiveStart].encapsulation;if(a===it.None||a===it.Emulated)return null}return Kt(r,n)}(e,t.parent,n)}(e,r,t),i=t[11],o=function(e,t,n){return function(e,t,n){return 40&e.type?Kt(e,n):null}(e,0,n)}(r.parent||t[6],0,t);if(null!=a)if(Array.isArray(n))for(var s=0;s<n.length;s++)_a(i,a,n[s],o,!1);else _a(i,a,n,o,!1)}function Da(e,t){if(null!==t){var n=t.type;if(3&n)return Kt(t,e);if(4&n)return Oa(-1,e[t.index]);if(8&n){var r=t.child;if(null!==r)return Da(e,r);var a=e[t.index];return Rt(a)?Oa(-1,a):qt(a)}if(32&n)return ma(t,e)()||qt(e[t.index]);var i=Fa(e,t);return null!==i?Array.isArray(i)?i[0]:Da(ga(e[16]),i):Da(e,t.next)}return null}function Fa(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Oa(e,t){var n=10+e+1;if(n<t.length){var r=t[n],a=r[1].firstChild;if(null!==a)return Da(r,a)}return t[7]}function Ma(e,t,n,r,a,i,o){for(;null!=n;){var s=r[n.index],u=n.type;if(o&&0===t&&(s&&ua(qt(s),r),n.flags|=4),64!=(64&n.flags))if(8&u)Ma(e,t,n.child,r,a,i,!1),xa(t,e,a,s,i);else if(32&u){for(var c=ma(n,r),l=void 0;l=c();)xa(t,e,a,l,i);xa(t,e,a,s,i)}else 16&u?Pa(e,t,r,n,a,i):xa(t,e,a,s,i);n=o?n.projectionNext:n.next}}function La(e,t,n,r,a,i){Ma(n,r,e.firstChild,t,a,i,!1)}function Pa(e,t,n,r,a,i){var o=n[16],s=o[6].projection[r.projection];if(Array.isArray(s))for(var u=0;u<s.length;u++)xa(t,e,a,s[u],i);else Ma(e,t,s,o[3],a,i,!0)}function za(e,t,n){jt(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Ba(e,t,n){jt(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function Va(e,t,n){for(var r=e.length;;){var a=e.indexOf(t,n);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){var i=t.length;if(a+i===r||e.charCodeAt(a+i)<=32)return a}n=a+1}}var Wa="ng-template";function Ua(e,t,n){for(var r=0;r<e.length;){var a=e[r++];if(n&&"class"===a){if(-1!==Va((a=e[r]).toLowerCase(),t,0))return!0}else if(1===a){for(;r<e.length&&"string"==typeof(a=e[r++]);)if(a.toLowerCase()===t)return!0;return!1}}return!1}function Ha(e){return 4===e.type&&e.value!==Wa}function ja(e,t,n){return t===(4!==e.type||n?e.value:Wa)}function Ga(e,t,n){for(var r=4,a=e.attrs||[],i=function(e){for(var t=0;t<e.length;t++)if(On(e[t]))return t;return e.length}(a),o=!1,s=0;s<t.length;s++){var u=t[s];if("number"!=typeof u){if(!o)if(4&r){if(r=2|1&r,""!==u&&!ja(e,u,n)||""===u&&1===t.length){if(qa(r))return!1;o=!0}}else{var c=8&r?u:t[++s];if(8&r&&null!==e.attrs){if(!Ua(e.attrs,c,n)){if(qa(r))return!1;o=!0}continue}var l=Ka(8&r?"class":u,a,Ha(e),n);if(-1===l){if(qa(r))return!1;o=!0;continue}if(""!==c){var h;h=l>i?"":a[l+1].toLowerCase();var p=8&r?h:null;if(p&&-1!==Va(p,c,0)||2&r&&c!==h){if(qa(r))return!1;o=!0}}}}else{if(!o&&!qa(r)&&!qa(u))return!1;if(o&&qa(u))continue;o=!1,r=u|1&r}}return qa(r)||o}function qa(e){return 0==(1&e)}function Ka(e,t,n,r){if(null===t)return-1;var a=0;if(r||!n){for(var i=!1;a<t.length;){var o=t[a];if(o===e)return a;if(3===o||6===o)i=!0;else{if(1===o||2===o){for(var s=t[++a];"string"==typeof s;)s=t[++a];continue}if(4===o)break;if(0===o){a+=4;continue}}a+=i?1:2}return-1}return function(e,t){var n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){var r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function Xa(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<t.length;r++)if(Ga(e,t[r],n))return!0;return!1}function Ya(e,t){return e?":not("+t.trim()+")":t}function Za(e){for(var t=e[0],n=1,r=2,a="",i=!1;n<e.length;){var o=e[n];if("string"==typeof o)if(2&r){var s=e[++n];a+="["+o+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?a+="."+o:4&r&&(a+=" "+o);else""!==a&&!qa(o)&&(t+=Ya(i,a),a=""),r=o,i=i||!qa(r);n++}return""!==a&&(t+=Ya(i,a)),t}var Ja={};function Qa(e,t,n,r){if(!r)if(3==(3&t[2])){var a=e.preOrderCheckHooks;null!==a&&Tn(t,a,n)}else{var i=e.preOrderHooks;null!==i&&En(t,i,0,n)}Sn(n)}function $a(e,t){var n=e.contentQueries;if(null!==n)for(var r=0;r<n.length;r+=2){var a=n[r],i=n[r+1];if(-1!==i){var o=e.data[i];vn(a),o.contentQueries(2,t[i],i)}}}function ei(e,t,n,r,a,i,o,s,u,c){var l=t.blueprint.slice();return l[0]=a,l[2]=140|r,$t(l),l[3]=l[15]=e,l[8]=n,l[10]=o||e&&e[10],l[11]=s||e&&e[11],l[12]=u||e&&e[12]||null,l[9]=c||e&&e[9]||null,l[6]=i,l[16]=2==t.type?e[16]:l,l}function ti(e,t,n,r,a){var i=e.data[t];if(null===i)i=function(e,t,n,r,a){var i=sn(),o=cn(),s=e.data[t]=function(e,t,n,r,a,i){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:a,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?i:i&&i.parent,n,t,r,a);return null===e.firstChild&&(e.firstChild=s),null!==i&&(o?null==i.child&&null!==s.parent&&(i.child=s):null===i.next&&(i.next=s)),s}(e,t,n,r,a),tn.lFrame.inI18n&&(i.flags|=64);else if(64&i.type){i.type=n,i.value=r,i.attrs=a;var o=function(){var e=tn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();i.injectorIndex=null===o?-1:o.injectorIndex}return un(i,!0),i}function ni(e,t,n,r){if(0===n)return-1;for(var a=t.length,i=0;i<n;i++)t.push(r),e.blueprint.push(r),e.data.push(null);return a}function ri(e,t,n){yn(t);try{var r=e.viewQuery;null!==r&&Ti(1,r,n);var a=e.template;null!==a&&oi(e,t,a,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&$a(e,t),e.staticViewQueries&&Ti(2,e.viewQuery,n);var i=e.components;null!==i&&function(e,t){for(var n=0;n<t.length;n++)wi(e,t[n])}(t,i)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,In()}}function ai(e,t,n,r){var a=t[2];if(256!=(256&a)){yn(t);var i=ln();try{$t(t),function(e){tn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&oi(e,t,n,2,r);var o=3==(3&a);if(!i)if(o){var s=e.preOrderCheckHooks;null!==s&&Tn(t,s,null)}else{var u=e.preOrderHooks;null!==u&&En(t,u,0,null),_n(t,0)}if(function(e){for(var t=ya(e);null!==t;t=ba(t))if(t[2])for(var n=t[9],r=0;r<n.length;r++){var a=n[r],i=a[3];0==(1024&a[2])&&en(i,1),a[2]|=1024}}(t),function(e){for(var t=ya(e);null!==t;t=ba(t))for(var n=10;n<t.length;n++){var r=t[n],a=r[1];Jt(r)&&ai(a,r,a.template,r[8])}}(t),null!==e.contentQueries&&$a(e,t),!i)if(o){var c=e.contentCheckHooks;null!==c&&Tn(t,c)}else{var l=e.contentHooks;null!==l&&En(t,l,1),_n(t,1)}!function(e,t){var n=e.hostBindingOpCodes;if(null!==n)try{for(var r=0;r<n.length;r++){var a=n[r];if(a<0)Sn(~a);else{var i=a,o=n[++r],s=n[++r];pn(o,i),s(2,t[i])}}}finally{Sn(-1)}}(e,t);var h=e.components;null!==h&&function(e,t){for(var n=0;n<t.length;n++)ki(e,t[n])}(t,h);var p=e.viewQuery;if(null!==p&&Ti(2,p,r),!i)if(o){var f=e.viewCheckHooks;null!==f&&Tn(t,f)}else{var d=e.viewHooks;null!==d&&En(t,d,2),_n(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),i||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,en(t[3],-1))}finally{In()}}}function ii(e,t,n,r){var a=t[10],i=!ln(),o=Zt(t);try{i&&!o&&a.begin&&a.begin(),o&&ri(e,t,r),ai(e,t,n,r)}finally{i&&!o&&a.end&&a.end()}}function oi(e,t,n,r,a){var i=Nn(),o=2&r;try{Sn(-1),o&&t.length>20&&Qa(e,t,20,ln()),n(r,a)}finally{Sn(i)}}function si(e){var t=e.tView;return null===t||t.incompleteFirstPass?e.tView=ui(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function ui(e,t,n,r,a,i,o,s,u,c){var l=20+r,h=l+a,p=function(e,t){for(var n=[],r=0;r<t;r++)n.push(r<e?null:Ja);return n}(l,h),f="function"==typeof c?c():c;return p[1]={type:e,blueprint:p,template:n,queries:null,viewQuery:s,declTNode:t,data:p.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:u,consts:f,incompleteFirstPass:!1}}function ci(e,t,n,r){var a=_i(t);null===n?a.push(r):(a.push(n),e.firstCreatePass&&Ri(e).push(r,a.length-1))}function li(e,t,n){for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,a):n[r]=[t,a]}return n}function hi(e,t,n,r,a,i){var o=i.hostBindings;if(o){var s=e.hostBindingOpCodes;null===s&&(s=e.hostBindingOpCodes=[]);var u=~t.index;(function(e){for(var t=e.length;t>0;){var n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(s)!=u&&s.push(u),s.push(r,a,o)}}function pi(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function fi(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function di(e,t,n){if(n){if(t.exportAs)for(var r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Ot(t)&&(n[""]=e)}}function vi(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function mi(e,t,n,r,a){e.data[r]=a;var i=a.factory||(a.factory=Lt(a.type)),o=new Dn(i,Ot(a),null);e.blueprint[r]=o,n[r]=o,hi(e,t,0,r,ni(e,n,a.hostVars,Ja),a)}function gi(e,t,n){var r=Kt(t,e),a=si(n),i=e[10],o=Ii(e,ei(e,a,null,n.onPush?64:16,r,t,i,i.createRenderer(r,n),null,null));e[t.index]=o}function yi(e,t,n,r,a,i){var o=i[t];if(null!==o)for(var s=r.setInput,u=0;u<o.length;){var c=o[u++],l=o[u++],h=o[u++];null!==s?r.setInput(n,h,c,l):n[l]=h}}function bi(e,t){for(var n=null,r=0;r<t.length;){var a=t[r];if(0!==a)if(5!==a){if("number"==typeof a)break;e.hasOwnProperty(a)&&(null===n&&(n=[]),n.push(a,e[a],t[r+1])),r+=2}else r+=2;else r+=4}return n}function ki(e,t){var n=Yt(t,e);if(Jt(n)){var r=n[1];80&n[2]?ai(r,n,r.template,n[8]):n[5]>0&&xi(n)}}function xi(e){for(var t=ya(e);null!==t;t=ba(t))for(var n=10;n<t.length;n++){var r=t[n];if(1024&r[2]){var a=r[1];ai(a,r,a.template,r[8])}else r[5]>0&&xi(r)}var i=e[1].components;if(null!==i)for(var o=0;o<i.length;o++){var s=Yt(i[o],e);Jt(s)&&s[5]>0&&xi(s)}}function wi(e,t){var n=Yt(t,e),r=n[1];(function(e,t){for(var n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),ri(r,n,n[8])}function Ii(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function Ni(e){for(;e;){e[2]|=64;var t=ga(e);if(Mt(e)&&!t)return e;e=t}return null}function Si(e,t,n){var r=t[10];r.begin&&r.begin();try{ai(e,t,e.template,n)}catch(a){throw Ai(t,a),a}finally{r.end&&r.end()}}function Ci(e){!function(e){for(var t=0;t<e.components.length;t++){var n=e.components[t],r=ca(n),a=r[1];ii(a,r,a.template,n)}}(e[8])}function Ti(e,t,n){vn(0),t(e,n)}var Ei=Promise.resolve(null);function _i(e){return e[7]||(e[7]=[])}function Ri(e){return e.cleanup||(e.cleanup=[])}function Ai(e,t){var n=e[9],r=n?n.get(pa,null):null;r&&r.handleError(t)}function Di(e,t,n,r,a){for(var i=0;i<n.length;){var o=n[i++],s=n[i++],u=t[o],c=e.data[o];null!==c.setInput?c.setInput(u,a,r,s):u[s]=a}}function Fi(e,t,n){var r=n?e.styles:null,a=n?e.classes:null,i=0;if(null!==t)for(var o=0;o<t.length;o++){var s=t[o];"number"==typeof s?i=s:1==i?a=Le(a,s):2==i&&(r=Le(r,s+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=a:e.classesWithoutHost=a}var Oi,Mi=new ur("INJECTOR",-1),Li=function(){function e(){x(this,e)}return I(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr;if(t===mr){var n=new Error("NullInjectorError: No provider for ".concat(Me(e),"!"));throw n.name="NullInjectorError",n}return t}}]),e}(),Pi=new ur("Set Injector scope."),zi={},Bi={};function Vi(){return void 0===Oi&&(Oi=new Li),Oi}function Wi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return new Ui(e,n,t||Vi(),r)}var Ui=function(){function e(t,n,r){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;x(this,e),this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;var o=[];n&&pr(n,function(e){return a.processProvider(e,t,n)}),pr([t],function(e){return a.processInjectorType(e,[],o)}),this.records.set(Mi,ji(void 0,this));var s=this.records.get(Pi);this.scope=null!=s?s.value:null,this.source=i||("object"==typeof t?null:Me(t))}return I(e,[{key:"destroyed",get:function(){return this._destroyed}},{key:"destroy",value:function(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(function(e){return e.ngOnDestroy()})}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:et.Default;this.assertNotDestroyed();var r=wr(this),a=tt(void 0);try{if(!(n&et.SkipSelf)){var i=this.records.get(e);if(void 0===i){var o=function(e){return"function"==typeof e||"object"==typeof e&&e instanceof ur}(e)&&qe(e);i=o&&this.injectableDefInScope(o)?ji(Hi(e),zi):null,this.records.set(e,i)}if(null!=i)return this.hydrate(e,i)}return(n&et.Self?Vi():this.parent).get(e,t=n&et.Optional&&t===mr?null:t)}catch(s){if("NullInjectorError"===s.name){if((s[yr]=s[yr]||[]).unshift(Me(e)),r)throw s;return Er(s,e,"R3InjectorError",this.source)}throw s}finally{tt(a),wr(r)}}},{key:"_resolveInjectorDefTypes",value:function(){var e=this;this.injectorDefTypes.forEach(function(t){return e.get(t)})}},{key:"toString",value:function(){var e=[];return this.records.forEach(function(t,n){return e.push(Me(n))}),"R3Injector[".concat(e.join(", "),"]")}},{key:"assertNotDestroyed",value:function(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}},{key:"processInjectorType",value:function(e,t,n){var r=this;if(!(e=Be(e)))return!1;var a=Xe(e),i=null==a&&e.ngModule||void 0,o=void 0===i?e:i,s=-1!==n.indexOf(o);if(void 0!==i&&(a=Xe(i)),null==a)return!1;if(null!=a.imports&&!s){var u;n.push(o);try{pr(a.imports,function(e){r.processInjectorType(e,t,n)&&(void 0===u&&(u=[]),u.push(e))})}finally{}if(void 0!==u)for(var c=function(e){var t=u[e],n=t.ngModule,a=t.providers;pr(a,function(e){return r.processProvider(e,n,a||ht)})},l=0;l<u.length;l++)c(l)}this.injectorDefTypes.add(o);var h=Lt(o)||function(){return new o};this.records.set(o,ji(h,zi));var p=a.providers;if(null!=p&&!s){var f=e;pr(p,function(e){return r.processProvider(e,f,p)})}return void 0!==i&&void 0!==e.providers}},{key:"processProvider",value:function(e,t,n){var r=qi(e=Be(e))?e:Be(e&&e.provide),a=function(e,t,n){return Gi(e)?ji(void 0,e.useValue):ji(function(e,t,n){var r;if(qi(e)){var a=Be(e);return Lt(a)||Hi(a)}if(Gi(e))r=function(){return Be(e.useValue)};else if(function(e){return!(!e||!e.useFactory)}(e))r=function(){return e.useFactory.apply(e,i(Sr(e.deps||[])))};else if(function(e){return!(!e||!e.useExisting)}(e))r=function(){return Nr(Be(e.useExisting))};else{var o=Be(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return Lt(o)||Hi(o);r=function(){return h(o,i(Sr(e.deps)))}}return r}(e),zi)}(e);if(qi(e)||!0!==e.multi)this.records.get(r);else{var o=this.records.get(r);o||((o=ji(void 0,zi,!0)).factory=function(){return Sr(o.multi)},this.records.set(r,o)),r=e,o.multi.push(e)}this.records.set(r,a)}},{key:"hydrate",value:function(e,t){return t.value===zi&&(t.value=Bi,t.value=t.factory()),"object"==typeof t.value&&t.value&&function(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}},{key:"injectableDefInScope",value:function(e){if(!e.providedIn)return!1;var t=Be(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}]),e}();function Hi(e){var t=qe(e),n=null!==t?t.factory:Lt(e);if(null!==n)return n;if(e instanceof ur)throw new Error("Token ".concat(Me(e)," is missing a \u0275prov definition."));if(e instanceof Function)return function(e){var t=e.length;if(t>0){var n=function(e,t){for(var n=[],r=0;r<e;r++)n.push("?");return n}(t);throw new Error("Can't resolve all parameters for ".concat(Me(e),": (").concat(n.join(", "),")."))}var r=function(e){var t=e&&(e[Ze]||e[Qe]);if(t){var n=function(e){if(e.hasOwnProperty("name"))return e.name;var t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn('DEPRECATED: DI is instantiating a token "'.concat(n,'" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "').concat(n,'" class.')),t}return null}(e);return null!==r?function(){return r.factory(e)}:function(){return new e}}(e);throw new Error("unreachable")}function ji(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{factory:e,value:t,multi:n?[]:void 0}}function Gi(e){return null!==e&&"object"==typeof e&&xr in e}function qi(e){return"function"==typeof e}var Ki=function(e,t,n){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,a=Wi(e,t,n,r);return a._resolveInjectorDefTypes(),a}({name:n},t,e,n)},Xi=function(){var e=function(){function e(){x(this,e)}return I(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?Ki(e,t,""):Ki(e.providers,e.parent,e.name||"")}}]),e}();return e.THROW_IF_NOT_FOUND=mr,e.NULL=new Li,e.\u0275prov=je({token:e,providedIn:"any",factory:function(){return Nr(Mi)}}),e.__NG_ELEMENT_ID__=-1,e}();function Yi(e,t){Cn(ca(e)[1],on())}var Zi=null;function Ji(){if(!Zi){var e=ct.Symbol;if(e&&e.iterator)Zi=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Zi=r)}}return Zi}function Qi(e){return!!$i(e)&&(Array.isArray(e)||!(e instanceof Map)&&Ji()in e)}function $i(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function eo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:et.Default,n=rn();return null===n?Nr(e,t):Jn(on(),n,Be(e),t)}function to(e,t,n){var r=rn();return function(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}(r,tn.lFrame.bindingIndex++,t)&&function(e,t,n,r,a,i,o,s){var u,c=Kt(t,n),l=t.inputs;null!=l&&(u=l[r])?(Di(e,n,u,r,a),Dt(t)&&function(e,t){var n=Yt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),a=null!=o?o(a,t.value||"",r):a,jt(i)?i.setProperty(c,r,a):Mn(r)||(c.setProperty?c.setProperty(r,a):c[r]=a))}(an(),function(){var e=tn.lFrame;return Xt(e.tView,e.selectedIndex)}(),r,e,t,r[11],n),to}function no(e,t,n,r,a){var i=a?"class":"style";Di(e,n,t.inputs[i],i,r)}function ro(e,t,n,r){var a=rn(),i=an(),o=20+e,s=a[11],u=a[o]=wa(s,t,tn.lFrame.currentNamespace),c=i.firstCreatePass?function(e,t,n,r,a,i,o){var s=t.consts,u=ti(t,e,2,a,Qt(s,i));return function(e,t,n,r){if(nn()){var a=function(e,t,n){var r=e.directiveRegistry,a=null;if(r)for(var i=0;i<r.length;i++){var o=r[i];Xa(n,o.selectors,!1)&&(a||(a=[]),Xn(jn(n,t),e,o.type),Ot(o)?(fi(e,n),a.unshift(o)):a.push(o))}return a}(e,t,n),i=null===r?null:{"":-1};if(null!==a){!0,vi(n,e.data.length,a.length);for(var o=0;o<a.length;o++){var s=a[o];s.providersResolver&&s.providersResolver(s)}for(var u=!1,c=!1,l=ni(e,t,a.length,null),h=0;h<a.length;h++){var p=a[h];n.mergedAttrs=Ln(n.mergedAttrs,p.hostAttrs),mi(e,n,t,l,p),di(l,p,i),null!==p.contentQueries&&(n.flags|=8),(null!==p.hostBindings||null!==p.hostAttrs||0!==p.hostVars)&&(n.flags|=128);var f=p.type.prototype;!u&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),u=!0),!c&&(f.ngOnChanges||f.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),c=!0),l++}!function(e,t){for(var n=t.directiveEnd,r=e.data,a=t.attrs,i=[],o=null,s=null,u=t.directiveStart;u<n;u++){var c=r[u],l=c.inputs,h=null===a||Ha(t)?null:bi(l,a);i.push(h),o=li(l,u,o),s=li(c.outputs,u,s)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=i,t.inputs=o,t.outputs=s}(e,n)}i&&function(e,t,n){if(t)for(var r=e.localNames=[],a=0;a<t.length;a+=2){var i=n[t[a+1]];if(null==i)throw new Ve("301","Export of name '".concat(t[a+1],"' not found!"));r.push(t[a],i)}}(n,r,i)}n.mergedAttrs=Ln(n.mergedAttrs,n.attrs)}(t,n,u,Qt(s,o)),null!==u.attrs&&Fi(u,u.attrs,!1),null!==u.mergedAttrs&&Fi(u,u.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,u),u}(o,i,a,0,t,n,r):i.data[o];un(c,!0);var l=c.mergedAttrs;null!==l&&Fn(s,u,l);var h=c.classes;null!==h&&Ba(s,u,h);var p=c.styles;null!==p&&za(s,u,p),64!=(64&c.flags)&&Aa(i,a,u,c),0===tn.lFrame.elementDepthCount&&ua(u,a),tn.lFrame.elementDepthCount++,Ft(c)&&(function(e,t,n){!nn()||(function(e,t,n,r){var a=n.directiveStart,i=n.directiveEnd;e.firstCreatePass||jn(n,t),ua(r,t);for(var o=n.initialInputs,s=a;s<i;s++){var u=e.data[s],c=Ot(u);c&&gi(t,n,u);var l=nr(t,e,s,n);ua(l,t),null!==o&&yi(0,s-a,l,u,0,o),c&&(Yt(n.index,t)[8]=l)}}(e,t,n,Kt(n,t)),128==(128&n.flags)&&function(e,t,n){var r=n.directiveStart,a=n.directiveEnd,i=n.index,o=tn.lFrame.currentDirectiveIndex;try{Sn(i);for(var s=r;s<a;s++){var u=e.data[s],c=t[s];fn(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&pi(u,c)}}finally{Sn(-1),fn(o)}}(e,t,n))}(i,a,c),function(e,t,n){if(At(t))for(var r=t.directiveEnd,a=t.directiveStart;a<r;a++){var i=e.data[a];i.contentQueries&&i.contentQueries(1,n[a],a)}}(i,c,a)),null!==r&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Kt,r=t.localNames;if(null!==r)for(var a=t.index+1,i=0;i<r.length;i+=2){var o=r[i+1],s=-1===o?n(t,e):e[o];e[a++]=s}}(a,c)}function ao(){var e=on();cn()?tn.lFrame.isParent=!1:un(e=e.parent,!1);var t=e;tn.lFrame.elementDepthCount--;var n=an();n.firstCreatePass&&(Cn(n,e),At(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&no(n,t,rn(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&no(n,t,rn(),t.stylesWithoutHost,!1)}function io(e,t,n,r){ro(e,t,n,r),ao()}function oo(e){return!!e&&"function"==typeof e.then}var so=function(e){return!!e&&"function"==typeof e.subscribe};function uo(e,t,n,r){var a=rn(),i=an(),o=on();return function(e,t,n,r,a,i,o,s){var u=Ft(r),c=e.firstCreatePass&&Ri(e),l=t[8],h=_i(t),p=!0;if(3&r.type||s){var f=Kt(r,t),d=s?s(f):f,v=h.length,m=s?function(e){return s(qt(e[r.index]))}:r.index;if(jt(n)){var g=null;if(!s&&u&&(g=function(e,t,n,r){var a=e.cleanup;if(null!=a)for(var i=0;i<a.length-1;i+=2){var o=a[i];if(o===n&&a[i+1]===r){var s=t[7],u=a[i+2];return s.length>u?s[u]:null}"string"==typeof o&&(i+=2)}return null}(e,t,a,r.index)),null!==g)(g.__ngLastListenerFn__||g).__ngNextListenerFn__=i,g.__ngLastListenerFn__=i,p=!1;else{i=lo(r,t,l,i,!1);var y=n.listen(d,a,i);h.push(i,y),c&&c.push(a,m,v,v+1)}}else i=lo(r,t,l,i,!0),d.addEventListener(a,i,o),h.push(i),c&&c.push(a,m,v,o)}else i=lo(r,t,l,i,!1);var b,k=r.outputs;if(p&&null!==k&&(b=k[a])){var x=b.length;if(x)for(var w=0;w<x;w+=2){var I=t[b[w]][b[w+1]].subscribe(i),N=h.length;h.push(i,I),c&&c.push(a,r.index,N,-(N+1))}}}(i,a,a[11],o,e,t,!!n,r),uo}function co(e,t,n,r){try{return!1!==n(r)}catch(a){return Ai(e,a),!1}}function lo(e,t,n,r,a){return function n(i){if(i===Function)return r;var o=2&e.flags?Yt(e.index,t):t;0==(32&t[2])&&Ni(o);for(var s=co(t,0,r,i),u=n.__ngNextListenerFn__;u;)s=co(t,0,u,i)&&s,u=u.__ngNextListenerFn__;return a&&!1===s&&(i.preventDefault(),i.returnValue=!1),s}}function ho(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=rn(),r=an(),a=e+20,i=r.firstCreatePass?ti(r,a,1,t,null):r.data[a],o=n[a]=function(e,t){return jt(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Aa(r,n,o,i),un(i,!1)}var po=void 0,fo=["en",[["a","p"],["AM","PM"],po],[["AM","PM"],po,po],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],po,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],po,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",po,"{1} 'at' {0}",po],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}],vo={};function mo(e){return e in vo||(vo[e]=ct.ng&&ct.ng.common&&ct.ng.common.locales&&ct.ng.common.locales[e]),vo[e]}var go=((go=go||{})[go.LocaleId=0]="LocaleId",go[go.DayPeriodsFormat=1]="DayPeriodsFormat",go[go.DayPeriodsStandalone=2]="DayPeriodsStandalone",go[go.DaysFormat=3]="DaysFormat",go[go.DaysStandalone=4]="DaysStandalone",go[go.MonthsFormat=5]="MonthsFormat",go[go.MonthsStandalone=6]="MonthsStandalone",go[go.Eras=7]="Eras",go[go.FirstDayOfWeek=8]="FirstDayOfWeek",go[go.WeekendRange=9]="WeekendRange",go[go.DateFormat=10]="DateFormat",go[go.TimeFormat=11]="TimeFormat",go[go.DateTimeFormat=12]="DateTimeFormat",go[go.NumberSymbols=13]="NumberSymbols",go[go.NumberFormats=14]="NumberFormats",go[go.CurrencyCode=15]="CurrencyCode",go[go.CurrencySymbol=16]="CurrencySymbol",go[go.CurrencyName=17]="CurrencyName",go[go.Currencies=18]="Currencies",go[go.Directionality=19]="Directionality",go[go.PluralCase=20]="PluralCase",go[go.ExtraData=21]="ExtraData",go),yo="en-US";function bo(e){(function(e,t){null==e&&function(e,t,n,r){throw new Error("ASSERTION ERROR: ".concat(e)+" [Expected=> ".concat(null," ").concat("!="," ").concat(t," <=Actual]"))}(t,e)})(e,"Expected localeId to be defined"),"string"==typeof e&&e.toLowerCase().replace(/_/g,"-")}var ko=function e(){x(this,e)},xo=function(){function e(){x(this,e)}return I(e,[{key:"resolveComponentFactory",value:function(e){throw function(e){var t=Error("No component factory found for ".concat(Me(e),". Did you add it to @NgModule.entryComponents?"));return t.ngComponent=e,t}(e)}}]),e}(),wo=function(){var e=function e(){x(this,e)};return e.NULL=new xo,e}();function Io(){}function No(e,t){return new Co(Kt(e,t))}var So=function(){return No(on(),rn())},Co=function(){var e=function e(t){x(this,e),this.nativeElement=t};return e.__NG_ELEMENT_ID__=So,e}();function To(e){return e instanceof Co?e.nativeElement:e}var Eo=function e(){x(this,e)},_o=function(){var e=function e(){x(this,e)};return e.\u0275prov=je({token:e,providedIn:"root",factory:function(){return null}}),e}(),Ro=new function e(t){x(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}("12.2.13"),Ao=function(){function e(){x(this,e)}return I(e,[{key:"supports",value:function(e){return Qi(e)}},{key:"create",value:function(e){return new Fo(e)}}]),e}(),Do=function(e,t){return t},Fo=function(){function e(t){x(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Do}return I(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,n=this._removalsHead,r=0,a=null;t||n;){var i=!n||t&&t.currentIndex<Po(n,r,a)?t:n,o=Po(i,r,a),s=i.currentIndex;if(i===n)r--,n=n._nextRemoved;else if(t=t._next,null==i.previousIndex)r++;else{a||(a=[]);var u=o-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<a.length?a[l]:a[l]=0,p=h+l;c<=p&&p<u&&(a[l]=h+1)}a[i.previousIndex]=c-u}}o!==s&&e(i,o,s)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!Qi(e))throw new Error("Error trying to diff '".concat(Me(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n,r,a,i=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)r=e[s],a=this._trackByFn(s,r),null!==i&&Object.is(i.trackById,a)?(o&&(i=this._verifyReinsertion(i,r,a,s)),Object.is(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,a,s),o=!0),i=i._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var r,a=e[Ji()]();!(r=a.next()).done;)t(r.value)}(e,function(e){a=t._trackByFn(n,e),null!==i&&Object.is(i.trackById,a)?(o&&(i=t._verifyReinsertion(i,e,a,n)),Object.is(i.item,e)||t._addIdentityChange(i,e)):(i=t._mismatch(i,e,a,n),o=!0),i=i._next,n++}),this.length=n;return this._truncate(i),this.collection=e,this.isDirty}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}},{key:"_reset",value:function(){if(this.isDirty){var e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,n,r){var a;return null===e?a=this._itTail:(a=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,a,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,a,r)):e=this._addAfter(new Oo(t,n),a,r),e}},{key:"_verifyReinsertion",value:function(e,t,n,r){var a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==a?e=this._reinsertAfter(a,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var r=e._prevRemoved,a=e._nextRemoved;return null===r?this._removalsHead=a:r._nextRemoved=a,null===a?this._removalsTail=r:a._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_moveAfter",value:function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_addAfter",value:function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,n){var r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Lo),this._linkedRecords.put(e),e.currentIndex=n,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Lo),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}]),e}(),Oo=function e(t,n){x(this,e),this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},Mo=function(){function e(){x(this,e),this._head=null,this._tail=null}return I(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}},{key:"remove",value:function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}]),e}(),Lo=function(){function e(){x(this,e),this.map=new Map}return I(e,[{key:"put",value:function(e){var t=e.trackById,n=this.map.get(t);n||(n=new Mo,this.map.set(t,n)),n.add(e)}},{key:"get",value:function(e,t){var n=this.map.get(e);return n?n.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"isEmpty",get:function(){return 0===this.map.size}},{key:"clear",value:function(){this.map.clear()}}]),e}();function Po(e,t,n){var r=e.previousIndex;if(null===r)return r;var a=0;return n&&r<n.length&&(a=n[r]),r+t+a}var zo=function(){function e(){x(this,e)}return I(e,[{key:"supports",value:function(e){return e instanceof Map||$i(e)}},{key:"create",value:function(){return new Bo}}]),e}(),Bo=function(){function e(){x(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return I(e,[{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}},{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||$i(e)))throw new Error("Error trying to diff '".concat(Me(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,function(e,r){if(n&&n.key===r)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var a=t._getOrCreateRecordForKey(r,e);n=t._insertBeforeOrAppend(n,a)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var r=n._prev,a=n._next;return r&&(r._next=a),a&&(a._prev=r),n._next=null,n._prev=null,n}var i=new Vo(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(function(n){return t(e[n],n)})}}]),e}(),Vo=function e(t){x(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null};function Wo(){return new Uo([new Ao])}var Uo=function(){var e=function(){function e(t){x(this,e),this.factories=t}return I(e,[{key:"find",value:function(e){var t=this.factories.find(function(t){return t.supports(e)});if(null!=t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat(function(e){return e.name||typeof e}(e),"'"))}}],[{key:"create",value:function(t,n){if(null!=n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){return e.create(t,n||Wo())},deps:[[e,new Fr,new Dr]]}}}]),e}();return e.\u0275prov=je({token:e,providedIn:"root",factory:Wo}),e}();function Ho(){return new jo([new zo])}var jo=function(){var e=function(){function e(t){x(this,e),this.factories=t}return I(e,[{key:"find",value:function(e){var t=this.factories.find(function(t){return t.supports(e)});if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,n){if(n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){return e.create(t,n||Ho())},deps:[[e,new Fr,new Dr]]}}}]),e}();return e.\u0275prov=je({token:e,providedIn:"root",factory:Ho}),e}();function Go(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];null!==n;){var o=t[n.index];if(null!==o&&r.push(qt(o)),Rt(o))for(var s=10;s<o.length;s++){var u=o[s],c=u[1].firstChild;null!==c&&Go(u[1],u,c,r)}var l=n.type;if(8&l)Go(e,t,n.child,r);else if(32&l)for(var h=ma(n,t),p=void 0;p=h();)r.push(p);else if(16&l){var f=Fa(t,n);if(Array.isArray(f))r.push.apply(r,i(f));else{var d=ga(t[16]);Go(d[1],d,f,r,!0)}}n=a?n.projectionNext:n.next}return r}var qo=function(){function e(t,n){x(this,e),this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}return I(e,[{key:"rootNodes",get:function(){var e=this._lView,t=e[1];return Go(t,e,t.firstChild,[])}},{key:"context",get:function(){return this._lView[8]},set:function(e){this._lView[8]=e}},{key:"destroyed",get:function(){return 256==(256&this._lView[2])}},{key:"destroy",value:function(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){var e=this._lView[3];if(Rt(e)){var t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Na(e,n),dr(t,n))}this._attachedToViewContainer=!1}Sa(this._lView[1],this._lView)}},{key:"onDestroy",value:function(e){ci(this._lView[1],this._lView,null,e)}},{key:"markForCheck",value:function(){Ni(this._cdRefInjectingView||this._lView)}},{key:"detach",value:function(){this._lView[2]&=-129}},{key:"reattach",value:function(){this._lView[2]|=128}},{key:"detectChanges",value:function(){Si(this._lView[1],this._lView,this.context)}},{key:"checkNoChanges",value:function(){!function(e,t,n){hn(!0);try{Si(e,t,n)}finally{hn(!1)}}(this._lView[1],this._lView,this.context)}},{key:"attachToViewContainerRef",value:function(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}},{key:"detachFromAppRef",value:function(){this._appRef=null,function(e,t){La(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}},{key:"attachToAppRef",value:function(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}]),e}(),Ko=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e))._view=e,r}return I(n,[{key:"detectChanges",value:function(){Ci(this._view)}},{key:"checkNoChanges",value:function(){!function(e){hn(!0);try{Ci(e)}finally{hn(!1)}}(this._view)}},{key:"context",get:function(){return null}}]),n}(qo),Xo=function(e){return function(e,t,n){if(Dt(e)&&!n){var r=Yt(e.index,t);return new qo(r,r)}return 47&e.type?new qo(t[16],t):null}(on(),rn(),16==(16&e))},Yo=function(){var e=function e(){x(this,e)};return e.__NG_ELEMENT_ID__=Xo,e}(),Zo=[new zo],Jo=new Uo([new Ao]),Qo=new jo(Zo),$o=function(){return ns(on(),rn())},es=function(){var e=function e(){x(this,e)};return e.__NG_ELEMENT_ID__=$o,e}(),ts=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this))._declarationLView=e,i._declarationTContainer=r,i.elementRef=a,i}return I(n,[{key:"createEmbeddedView",value:function(e){var t=this._declarationTContainer.tViews,n=ei(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];var r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),ri(t,n,e),new qo(n)}}]),n}(es);function ns(e,t){return 4&e.type?new ts(t,e,No(e,t)):null}var rs=function e(){x(this,e)},as=function e(){x(this,e)},is=function(){return ls(on(),rn())},os=function(){var e=function e(){x(this,e)};return e.__NG_ELEMENT_ID__=is,e}(),ss=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this))._lContainer=e,i._hostTNode=r,i._hostLView=a,i}return I(n,[{key:"element",get:function(){return No(this._hostTNode,this._hostLView)}},{key:"injector",get:function(){return new ir(this._hostTNode,this._hostLView)}},{key:"parentInjector",get:function(){var e=Kn(this._hostTNode,this._hostLView);if(zn(e)){var t=Vn(e,this._hostLView),n=Bn(e);return new ir(t[1].data[n+8],t)}return new ir(null,this._hostLView)}},{key:"clear",value:function(){for(;this.length>0;)this.remove(this.length-1)}},{key:"get",value:function(e){var t=us(this._lContainer);return null!==t&&t[e]||null}},{key:"length",get:function(){return this._lContainer.length-10}},{key:"createEmbeddedView",value:function(e,t,n){var r=e.createEmbeddedView(t||{});return this.insert(r,n),r}},{key:"createComponent",value:function(e,t,n,r,a){var i=n||this.parentInjector;if(!a&&null==e.ngModule&&i){var o=i.get(rs,null);o&&(a=o)}var s=e.create(i,r,void 0,a);return this.insert(s.hostView,t),s}},{key:"insert",value:function(e,t){var r=e._lView,a=r[1];if(function(e){return Rt(e[3])}(r)){var i=this.indexOf(e);if(-1!==i)this.detach(i);else{var o=r[3],s=new n(o,o[6],o[3]);s.detach(s.indexOf(e))}}var u=this._adjustIndex(t),c=this._lContainer;!function(e,t,n,r){var a=10+r,i=n.length;r>0&&(n[a-1][4]=t),r<i-10?(t[4]=n[a],fr(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;var o=t[17];null!==o&&n!==o&&function(e,t){var n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);var s=t[19];null!==s&&s.insertView(e),t[2]|=128}(a,r,c,u);var l=Oa(u,c),h=r[11],p=Ra(h,c[7]);return null!==p&&function(e,t,n,r,a,i){r[0]=a,r[6]=t,La(e,r,n,1,a,i)}(a,c[6],h,r,p,l),e.attachToViewContainerRef(),fr(cs(c),u,e),e}},{key:"move",value:function(e,t){return this.insert(e,t)}},{key:"indexOf",value:function(e){var t=us(this._lContainer);return null!==t?t.indexOf(e):-1}},{key:"remove",value:function(e){var t=this._adjustIndex(e,-1),n=Na(this._lContainer,t);n&&(dr(cs(this._lContainer),t),Sa(n[1],n))}},{key:"detach",value:function(e){var t=this._adjustIndex(e,-1),n=Na(this._lContainer,t);return n&&null!=dr(cs(this._lContainer),t)?new qo(n):null}},{key:"_adjustIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e?this.length+t:e}}]),n}(os);function us(e){return e[8]}function cs(e){return e[8]||(e[8]=[])}function ls(e,t){var n,r=t[e.index];if(Rt(r))n=r;else{var a;if(8&e.type)a=qt(r);else{var i=t[11];a=i.createComment("");var o=Kt(e,t);Ta(i,Ra(i,o),a,function(e,t){return jt(e)?e.nextSibling(t):t.nextSibling}(i,o),!1)}t[e.index]=n=function(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}(r,t,a,e),Ii(t,n)}return new ss(n,e,t)}var hs={},ps=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).ngModule=e,r}return I(n,[{key:"resolveComponentFactory",value:function(e){var t=Tt(e);return new vs(t,this.ngModule)}}]),n}(wo);function fs(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}var ds=new ur("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return fa}}),vs=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this)).componentDef=e,a.ngModule=r,a.componentType=e.type,a.selector=function(e){return e.map(Za).join(",")}(e.selectors),a.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],a.isBoundToModule=!!r,a}return I(n,[{key:"inputs",get:function(){return fs(this.componentDef.inputs)}},{key:"outputs",get:function(){return fs(this.componentDef.outputs)}},{key:"create",value:function(e,t,n,r){var a,i,o=(r=r||this.ngModule)?function(e,t){return{get:function(n,r,a){var i=e.get(n,hs,a);return i!==hs||r===hs?i:t.get(n,r,a)}}}(e,r.injector):e,s=o.get(Eo,Gt),u=o.get(_o,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",h=n?function(e,t,n){if(jt(e))return e.selectRootElement(t,n===it.ShadowDom);var r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(c,n,this.componentDef.encapsulation):wa(s.createRenderer(null,this.componentDef),l,function(e){var t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),p=this.componentDef.onPush?576:528,f={components:[],scheduler:fa,clean:Ei,playerHandler:null,flags:0},d=ui(0,null,null,1,0,null,null,null,null,null),v=ei(null,d,f,p,null,null,s,c,u,o);yn(v);try{var m=function(e,t,n,r,a,i){var o=n[1];n[20]=e;var s=ti(o,20,2,"#host",null),u=s.mergedAttrs=t.hostAttrs;null!==u&&(Fi(s,u,!0),null!==e&&(Fn(a,e,u),null!==s.classes&&Ba(a,e,s.classes),null!==s.styles&&za(a,e,s.styles)));var c=r.createRenderer(e,t),l=ei(n,si(t),null,t.onPush?64:16,n[20],s,r,c,null,null);return o.firstCreatePass&&(Xn(jn(s,n),o,t.type),fi(o,s),vi(s,n.length,1)),Ii(n,l),n[20]=l}(h,this.componentDef,v,s,c);if(h)if(n)Fn(c,h,["ng-version",Ro.full]);else{var g=function(e){for(var t=[],n=[],r=1,a=2;r<e.length;){var i=e[r];if("string"==typeof i)2===a?""!==i&&t.push(i,e[++r]):8===a&&n.push(i);else{if(!qa(a))break;a=i}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]),y=g.attrs,b=g.classes;y&&Fn(c,h,y),b&&b.length>0&&Ba(c,h,b.join(" "))}if(i=Xt(d,20),void 0!==t)for(var k=i.projection=[],x=0;x<this.ngContentSelectors.length;x++){var w=t[x];k.push(null!=w?Array.from(w):null)}a=function(e,t,n,r,a){var i=n[1],o=function(e,t,n){var r=on();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),mi(e,r,t,ni(e,t,1,null),n));var a=nr(t,e,r.directiveStart,r);ua(a,t);var i=Kt(r,t);return i&&ua(i,t),a}(i,n,t);if(r.components.push(o),e[8]=o,a&&a.forEach(function(e){return e(o,t)}),t.contentQueries){var s=on();t.contentQueries(1,o,s.directiveStart)}var u=on();return!i.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Sn(u.index),hi(n[1],u,0,u.directiveStart,u.directiveEnd,t),pi(t,o)),o}(m,this.componentDef,v,f,[Yi]),ri(d,v,null)}finally{In()}return new ms(this.componentType,a,No(i,v),v,i)}}]),n}(ko),ms=function(e){d(n,e);var t=m(n);function n(e,r,a,i,o){var s;return x(this,n),(s=t.call(this)).location=a,s._rootLView=i,s._tNode=o,s.instance=r,s.hostView=s.changeDetectorRef=new Ko(i),s.componentType=e,s}return I(n,[{key:"injector",get:function(){return new ir(this._tNode,this._rootLView)}},{key:"destroy",value:function(){this.hostView.destroy()}},{key:"onDestroy",value:function(e){this.hostView.onDestroy(e)}}]),n}(function(){return function e(){x(this,e)}}()),gs=new Map,ys=function(e){d(n,e);var t=m(n);function n(e,r){var a;x(this,n),(a=t.call(this))._parent=r,a._bootstrapComponents=[],a.injector=y(a),a.destroyCbs=[],a.componentFactoryResolver=new ps(y(a));var i=Et(e),o=function(e){return e[mt]||null}(e);return o&&bo(o),a._bootstrapComponents=da(i.bootstrap),a._r3Injector=Wi(e,r,[{provide:rs,useValue:y(a)},{provide:wo,useValue:a.componentFactoryResolver}],Me(e)),a._r3Injector._resolveInjectorDefTypes(),a.instance=a.get(e),a}return I(n,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xi.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:et.Default;return e===Xi||e===rs||e===Mi?this:this._r3Injector.get(e,t,n)}},{key:"destroy",value:function(){var e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(function(e){return e()}),this.destroyCbs=null}},{key:"onDestroy",value:function(e){this.destroyCbs.push(e)}}]),n}(rs),bs=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).moduleType=e,null!==Et(e)&&function(e){var t=new Set;!function e(n){var r=Et(n,!0),a=r.id;null!==a&&(function(e,t,n){if(t&&t!==n)throw new Error("Duplicate module registered for ".concat(e," - ").concat(Me(t)," vs ").concat(Me(t.name)))}(a,gs.get(a),n),gs.set(a,n));var i,o=s(da(r.imports));try{for(o.s();!(i=o.n()).done;){var u=i.value;t.has(u)||(t.add(u),e(u))}}catch(c){o.e(c)}finally{o.f()}}(e)}(e),r}return I(n,[{key:"create",value:function(e){return new ys(this.moduleType,e)}}]),n}(as);function ks(e){return function(t){setTimeout(e,void 0,t)}}var xs=function(e){d(n,e);var t=m(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return x(this,n),(e=t.call(this)).__isAsync=r,e}return I(n,[{key:"emit",value:function(e){p(k(n.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,t,r){var a,i,o,s=e,u=t||function(){return null},c=r;if(e&&"object"==typeof e){var l=e;s=null===(a=l.next)||void 0===a?void 0:a.bind(l),u=null===(i=l.error)||void 0===i?void 0:i.bind(l),c=null===(o=l.complete)||void 0===o?void 0:o.bind(l)}this.__isAsync&&(u=ks(u),s&&(s=ks(s)),c&&(c=ks(c)));var h=p(k(n.prototype),"subscribe",this).call(this,{next:s,error:u,complete:c});return e instanceof X&&e.add(h),h}}]),n}(oe);function ws(){return this._results[Ji()]()}var Is=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];x(this,e),this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;var n=Ji(),r=e.prototype;r[n]||(r[n]=ws)}return I(e,[{key:"changes",get:function(){return this._changes||(this._changes=new xs)}},{key:"get",value:function(e){return this._results[e]}},{key:"map",value:function(e){return this._results.map(e)}},{key:"filter",value:function(e){return this._results.filter(e)}},{key:"find",value:function(e){return this._results.find(e)}},{key:"reduce",value:function(e,t){return this._results.reduce(e,t)}},{key:"forEach",value:function(e){this._results.forEach(e)}},{key:"some",value:function(e){return this._results.some(e)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(e,t){var n=this;n.dirty=!1;var r=hr(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var a=e[r],i=t[r];if(n&&(a=n(a),i=n(i)),i!==a)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}},{key:"notifyOnChanges",value:function(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),e}();Symbol;var Ns=function(){function e(t){x(this,e),this.queryList=t,this.matches=null}return I(e,[{key:"clone",value:function(){return new e(this.queryList)}},{key:"setDirty",value:function(){this.queryList.setDirty()}}]),e}(),Ss=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];x(this,e),this.queries=t}return I(e,[{key:"createEmbeddedView",value:function(t){var n=t.queries;if(null!==n){for(var r=null!==t.contentQueries?t.contentQueries[0]:n.length,a=[],i=0;i<r;i++){var o=n.getByIndex(i);a.push(this.queries[o.indexInDeclarationView].clone())}return new e(a)}return null}},{key:"insertView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"detachView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"dirtyQueriesWithMatches",value:function(e){for(var t=0;t<this.queries.length;t++)null!==Os(e,t).matches&&this.queries[t].setDirty()}}]),e}(),Cs=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x(this,e),this.predicate=t,this.flags=n,this.read=r},Ts=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];x(this,e),this.queries=t}return I(e,[{key:"elementStart",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}},{key:"elementEnd",value:function(e){for(var t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}},{key:"embeddedTView",value:function(t){for(var n=null,r=0;r<this.length;r++){var a=null!==n?n.length:0,i=this.getByIndex(r).embeddedTView(t,a);i&&(i.indexInDeclarationView=r,null!==n?n.push(i):n=[i])}return null!==n?new e(n):null}},{key:"template",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}},{key:"getByIndex",value:function(e){return this.queries[e]}},{key:"length",get:function(){return this.queries.length}},{key:"track",value:function(e){this.queries.push(e)}}]),e}(),Es=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;x(this,e),this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}return I(e,[{key:"elementStart",value:function(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}},{key:"elementEnd",value:function(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}},{key:"template",value:function(e,t){this.elementStart(e,t)}},{key:"embeddedTView",value:function(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new e(this.metadata)):null}},{key:"isApplyingToNode",value:function(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){for(var t=this._declarationNodeIndex,n=e.parent;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}},{key:"matchTNode",value:function(e,t){var n=this.metadata.predicate;if(Array.isArray(n))for(var r=0;r<n.length;r++){var a=n[r];this.matchTNodeWithReadOption(e,t,_s(t,a)),this.matchTNodeWithReadOption(e,t,tr(t,e,a,!1,!1))}else n===es?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,tr(t,e,n,!1,!1))}},{key:"matchTNodeWithReadOption",value:function(e,t,n){if(null!==n){var r=this.metadata.read;if(null!==r)if(r===Co||r===os||r===es&&4&t.type)this.addMatch(t.index,-2);else{var a=tr(t,e,r,!1,!1);null!==a&&this.addMatch(t.index,a)}else this.addMatch(t.index,n)}}},{key:"addMatch",value:function(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}]),e}();function _s(e,t){var n=e.localNames;if(null!==n)for(var r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function Rs(e,t,n,r){return-1===n?function(e,t){return 11&e.type?No(e,t):4&e.type?ns(e,t):null}(t,e):-2===n?function(e,t,n){return n===Co?No(t,e):n===es?ns(t,e):n===os?ls(t,e):void 0}(e,t,r):nr(e,e[1],n,t)}function As(e,t,n,r){var a=t[19].queries[r];if(null===a.matches){for(var i=e.data,o=n.matches,s=[],u=0;u<o.length;u+=2){var c=o[u];s.push(c<0?null:Rs(t,i[c],o[u+1],n.metadata.read))}a.matches=s}return a.matches}function Ds(e,t,n,r){var a=e.queries.getByIndex(n),i=a.matches;if(null!==i)for(var o=As(e,t,a,n),s=0;s<i.length;s+=2){var u=i[s];if(u>0)r.push(o[s/2]);else{for(var c=i[s+1],l=t[-u],h=10;h<l.length;h++){var p=l[h];p[17]===p[3]&&Ds(p[1],p,c,r)}if(null!==l[9])for(var f=l[9],d=0;d<f.length;d++){var v=f[d];Ds(v[1],v,c,r)}}}return r}function Fs(e){var t=rn(),n=an(),r=dn();vn(r+1);var a=Os(n,r);if(e.dirty&&Zt(t)===(2==(2&a.metadata.flags))){if(null===a.matches)e.reset([]);else{var i=a.crossesNgTemplate?Ds(n,t,r,[]):As(n,t,a,r);e.reset(i,To),e.notifyOnChanges()}return!0}return!1}function Os(e,t){return e.queries.getByIndex(t)}var Ms=new ur("Application Initializer"),Ls=function(){var e=function(){function e(t){var n=this;x(this,e),this.appInits=t,this.resolve=Io,this.reject=Io,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(e,t){n.resolve=e,n.reject=t})}return I(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var r=function(n){var r=e.appInits[n]();if(oo(r))t.push(r);else if(so(r)){var a=new Promise(function(e,t){r.subscribe({complete:e,error:t})});t.push(a)}},a=0;a<this.appInits.length;a++)r(a);Promise.all(t).then(function(){n()}).catch(function(t){e.reject(t)}),0===t.length&&n(),this.initialized=!0}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(Ms,8))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),Ps=new ur("AppId"),zs={provide:Ps,useFactory:function(){return"".concat(Bs()).concat(Bs()).concat(Bs())},deps:[]};function Bs(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Vs=new ur("Platform Initializer"),Ws=new ur("Platform ID"),Us=new ur("appBootstrapListener"),Hs=function(){var e=function(){function e(){x(this,e)}return I(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),js=new ur("LocaleId"),Gs=new ur("DefaultCurrencyCode"),qs=function e(t,n){x(this,e),this.ngModuleFactory=t,this.componentFactories=n},Ks=function(e){return new bs(e)},Xs=Ks,Ys=function(e){return Promise.resolve(Ks(e))},Zs=function(e){var t=Ks(e),n=da(Et(e).declarations).reduce(function(e,t){var n=Tt(t);return n&&e.push(new vs(n)),e},[]);return new qs(t,n)},Js=Zs,Qs=function(e){return Promise.resolve(Zs(e))},$s=function(){var e=function(){function e(){x(this,e),this.compileModuleSync=Xs,this.compileModuleAsync=Ys,this.compileModuleAndAllComponentsSync=Js,this.compileModuleAndAllComponentsAsync=Qs}return I(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),eu=Promise.resolve(0);function tu(e){"undefined"==typeof Zone?eu.then(function(){e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var nu=function(){function e(t){var n=t.enableLongStackTrace,r=void 0!==n&&n,a=t.shouldCoalesceEventChangeDetection,i=void 0!==a&&a,o=t.shouldCoalesceRunChangeDetection,s=void 0!==o&&o;if(x(this,e),this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new xs(!1),this.onMicrotaskEmpty=new xs(!1),this.onStable=new xs(!1),this.onError=new xs(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();var u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!s&&i,u.shouldCoalesceRunChangeDetection=s,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function(){var e=ct.requestAnimationFrame,t=ct.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){var n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);var r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){var t=function(){!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ct,function(){e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",function(){e.lastRequestAnimationFrameId=-1,iu(e),e.isCheckStableRunning=!0,au(e),e.isCheckStableRunning=!1},void 0,function(){},function(){})),e.fakeTopEventTask.invoke()}),iu(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(n,r,a,i,o,s){try{return ou(e),n.invokeTask(a,i,o,s)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||e.shouldCoalesceRunChangeDetection)&&t(),su(e)}},onInvoke:function(n,r,a,i,o,s,u){try{return ou(e),n.invoke(a,i,o,s,u)}finally{e.shouldCoalesceRunChangeDetection&&t(),su(e)}},onHasTask:function(t,n,r,a){t.hasTask(r,a),n===r&&("microTask"==a.change?(e._hasPendingMicrotasks=a.microTask,iu(e),au(e)):"macroTask"==a.change&&(e.hasPendingMacrotasks=a.macroTask))},onHandleError:function(t,n,r,a){return t.handleError(r,a),e.runOutsideAngular(function(){return e.onError.emit(a)}),!1}})}(u)}return I(e,[{key:"run",value:function(e,t,n){return this._inner.run(e,t,n)}},{key:"runTask",value:function(e,t,n,r){var a=this._inner,i=a.scheduleEventTask("NgZoneEvent: "+r,e,ru,Io,Io);try{return a.runTask(i,t,n)}finally{a.cancelTask(i)}}},{key:"runGuarded",value:function(e,t,n){return this._inner.runGuarded(e,t,n)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}(),ru={};function au(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(function(){return e.onStable.emit(null)})}finally{e.isStable=!0}}}function iu(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ou(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function su(e){e._nesting--,au(e)}var uu,cu=function(){function e(){x(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new xs,this.onMicrotaskEmpty=new xs,this.onStable=new xs,this.onError=new xs}return I(e,[{key:"run",value:function(e,t,n){return e.apply(t,n)}},{key:"runGuarded",value:function(e,t,n){return e.apply(t,n)}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e,t,n,r){return e.apply(t,n)}}]),e}(),lu=function(){var e=function(){function e(t){var n=this;x(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}return I(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){e._ngZone.onStable.subscribe({next:function(){nu.assertNotInAngularZone(),tu(function(){e._isZoneStable=!0,e._runCallbacksIfReady()})}})})}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())tu(function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1});else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter(function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)}),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}}):[]}},{key:"addCallback",value:function(e,t,n){var r=this,a=-1;t&&t>0&&(a=setTimeout(function(){r._callbacks=r._callbacks.filter(function(e){return e.timeoutId!==a}),e(r._didWork,r.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:a,updateCb:n})}},{key:"whenStable",value:function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,n){return[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(nu))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),hu=function(){var e=function(){function e(){x(this,e),this._applications=new Map,pu.addToWindow(this)}return I(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return pu.findTestabilityInTree(this,e,t)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),pu=new(function(){function e(){x(this,e)}return I(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,n){return null}}]),e}()),fu=!0,du=!1,vu=new ur("AllowMultipleToken"),mu=function e(t,n){x(this,e),this.name=t,this.token=n};function gu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: ".concat(t),a=new ur(r);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=yu();if(!i||i.injector.get(vu,!1))if(e)e(n.concat(t).concat({provide:a,useValue:!0}));else{var o=n.concat(t).concat({provide:a,useValue:!0},{provide:Pi,useValue:"platform"});!function(e){if(uu&&!uu.destroyed&&!uu.injector.get(vu,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");uu=e.get(bu);var t=e.get(Vs,null);t&&t.forEach(function(e){return e()})}(Xi.create({providers:o,name:r}))}return function(e){var t=yu();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(a)}}function yu(){return uu&&!uu.destroyed?uu:null}var bu=function(){var e=function(){function e(t){x(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return I(e,[{key:"bootstrapModuleFactory",value:function(e,t){var n=this,r=function(e,t){return"noop"===e?new cu:("zone.js"===e?void 0:e)||new nu({enableLongStackTrace:(du=!0,fu),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)})}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),a=[{provide:nu,useValue:r}];return r.run(function(){var i=Xi.create({providers:a,parent:n.injector,name:e.moduleType.name}),o=e.create(i),s=o.injector.get(pa,null);if(!s)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return r.runOutsideAngular(function(){var e=r.onError.subscribe({next:function(e){s.handleError(e)}});o.onDestroy(function(){wu(n._modules,o),e.unsubscribe()})}),function(e,r,a){try{var i=((s=o.injector.get(Ls)).runInitializers(),s.donePromise.then(function(){return bo(o.injector.get(js,yo)||yo),n._moduleDoBootstrap(o),o}));return oo(i)?i.catch(function(t){throw r.runOutsideAngular(function(){return e.handleError(t)}),t}):i}catch(t){throw r.runOutsideAngular(function(){return e.handleError(t)}),t}var s}(s,r)})}},{key:"bootstrapModule",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=ku({},n);return function(e,t,n){var r=new bs(n);return Promise.resolve(r)}(0,0,e).then(function(e){return t.bootstrapModuleFactory(e,r)})}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(xu);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(function(e){return t.bootstrap(e)});else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(Me(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.'));e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"injector",get:function(){return this._injector}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(e){return e.destroy()}),this._destroyListeners.forEach(function(e){return e()}),this._destroyed=!0}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(Xi))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}();function ku(e,t){return Array.isArray(t)?t.reduce(ku,e):Object.assign(Object.assign({},e),t)}var xu=function(){var e=function(){function e(t,n,r,a,i){var o=this;x(this,e),this._zone=t,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=a,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:function(){o._zone.run(function(){o.tick()})}});var s=new te(function(e){o._stable=o._zone.isStable&&!o._zone.hasPendingMacrotasks&&!o._zone.hasPendingMicrotasks,o._zone.runOutsideAngular(function(){e.next(o._stable),e.complete()})}),u=new te(function(e){var t;o._zone.runOutsideAngular(function(){t=o._zone.onStable.subscribe(function(){nu.assertNotInAngularZone(),tu(function(){!o._stable&&!o._zone.hasPendingMacrotasks&&!o._zone.hasPendingMicrotasks&&(o._stable=!0,e.next(!0))})})});var n=o._zone.onUnstable.subscribe(function(){nu.assertInAngularZone(),o._stable&&(o._stable=!1,o._zone.runOutsideAngular(function(){e.next(!1)}))});return function(){t.unsubscribe(),n.unsubscribe()}});this.isStable=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Number.POSITIVE_INFINITY,a=null,i=t[t.length-1];return ue(i)?(a=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof i&&(r=t.pop()),null===a&&1===t.length&&t[0]instanceof te?t[0]:Se(r)(Ce(t,a))}(s,u.pipe(function(e){return Te()(function(e,t){return function(t){var n;n="function"==typeof e?e:function(){return e};var r=Object.create(t,Ae);return r.source=t,r.subjectFactory=n,r}}(Fe)(e))}))}return I(e,[{key:"bootstrap",value:function(e,t){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof ko?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var a=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(rs),i=n.create(Xi.NULL,[],t||n.selector,a),o=i.location.nativeElement,s=i.injector.get(lu,null),u=s&&i.injector.get(hu);return s&&u&&u.registerApplication(o,s),i.onDestroy(function(){r.detachView(i.hostView),wu(r.components,i),u&&u.unregisterApplication(o)}),this._loadComponent(i),i}},{key:"tick",value:function(){var e=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;var t,n=s(this._views);try{for(n.s();!(t=n.n()).done;){var r;t.value.detectChanges()}}catch(a){n.e(a)}finally{n.f()}}catch(r){this._zone.runOutsideAngular(function(){return e._exceptionHandler.handleError(r)})}finally{this._runningTick=!1}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;wu(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Us,[]).concat(this._bootstrapListeners).forEach(function(t){return t(e)})}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach(function(e){return e.destroy()}),this._onMicrotaskEmptySubscription.unsubscribe()}},{key:"viewCount",get:function(){return this._views.length}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(nu),Nr(Xi),Nr(pa),Nr(wo),Nr(Ls))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}();function wu(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var Iu=function e(){x(this,e)},Nu=function e(){x(this,e)},Su={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Cu=function(){var e=function(){function e(t,n){x(this,e),this._compiler=t,this._config=n||Su}return I(e,[{key:"load",value:function(e){return this.loadAndCompile(e)}},{key:"loadAndCompile",value:function(e){var t=this,r=n(e.split("#"),2),a=r[0],i=r[1];return void 0===i&&(i="default"),o(8255)(a).then(function(e){return e[i]}).then(function(e){return Tu(e,a,i)}).then(function(e){return t._compiler.compileModuleAsync(e)})}},{key:"loadFactory",value:function(e){var t=n(e.split("#"),2),r=t[0],a=t[1],i="NgFactory";return void 0===a&&(a="default",i=""),o(8255)(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(function(e){return e[a+i]}).then(function(e){return Tu(e,r,a)})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr($s),Nr(Nu,8))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}();function Tu(e,t,n){if(!e)throw new Error("Cannot find '".concat(n,"' in '").concat(t,"'"));return e}var Eu=gu(null,"core",[{provide:Ws,useValue:"unknown"},{provide:bu,deps:[Xi]},{provide:hu,deps:[]},{provide:Hs,deps:[]}]),_u=[{provide:xu,useClass:xu,deps:[nu,Xi,pa,wo,Ls]},{provide:ds,deps:[nu],useFactory:function(e){var t=[];return e.onStable.subscribe(function(){for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Ls,useClass:Ls,deps:[[new Dr,Ms]]},{provide:$s,useClass:$s,deps:[]},zs,{provide:Uo,useFactory:function(){return Jo},deps:[]},{provide:jo,useFactory:function(){return Qo},deps:[]},{provide:js,useFactory:function(e){return bo(e=e||"undefined"!=typeof $localize&&$localize.locale||yo),e},deps:[[new Ar(js),new Dr,new Fr]]},{provide:Gs,useValue:"USD"}],Ru=function(){var e=function e(t){x(this,e)};return e.\u0275fac=function(t){return new(t||e)(Nr(xu))},e.\u0275mod=Nt({type:e}),e.\u0275inj=Ge({providers:_u}),e}(),Au=null;function Du(){return Au}var Fu=new ur("DocumentToken"),Ou=function(){var e=function(){function e(){x(this,e)}return I(e,[{key:"historyGo",value:function(e){throw new Error("Not implemented")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=je({factory:Mu,token:e,providedIn:"platform"}),e}();function Mu(){return Nr(Pu)}var Lu=new ur("Location Initialized"),Pu=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this))._doc=e,r._init(),r}return I(n,[{key:"_init",value:function(){this.location=window.location,this._history=window.history}},{key:"getBaseHrefFromDOM",value:function(){return Du().getBaseHref(this._doc)}},{key:"onPopState",value:function(e){var t=Du().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),function(){return t.removeEventListener("popstate",e)}}},{key:"onHashChange",value:function(e){var t=Du().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),function(){return t.removeEventListener("hashchange",e)}}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(e){this.location.pathname=e}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}},{key:"pushState",value:function(e,t,n){zu()?this._history.pushState(e,t,n):this.location.hash=n}},{key:"replaceState",value:function(e,t,n){zu()?this._history.replaceState(e,t,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"historyGo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._history.go(e)}},{key:"getState",value:function(){return this._history.state}}]),n}(Ou);return e.\u0275fac=function(t){return new(t||e)(Nr(Fu))},e.\u0275prov=je({factory:Bu,token:e,providedIn:"platform"}),e}();function zu(){return!!window.history.pushState}function Bu(){return new Pu(Nr(Fu))}function Vu(e,t){if(0==e.length)return t;if(0==t.length)return e;var n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function Wu(e){var t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Uu(e){return e&&"?"!==e[0]?"?"+e:e}var Hu=function(){var e=function(){function e(){x(this,e)}return I(e,[{key:"historyGo",value:function(e){throw new Error("Not implemented")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=je({factory:ju,token:e,providedIn:"root"}),e}();function ju(e){var t=Nr(Fu).location;return new qu(Nr(Ou),t&&t.origin||"")}var Gu=new ur("appBaseHref"),qu=function(){var e=function(e){d(n,e);var t=m(n);function n(e,r){var a;if(x(this,n),(a=t.call(this))._platformLocation=e,a._removeListenerFns=[],null==r&&(r=a._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return a._baseHref=r,g(a)}return I(n,[{key:"ngOnDestroy",value:function(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}},{key:"onPopState",value:function(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"prepareExternalUrl",value:function(e){return Vu(this._baseHref,e)}},{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._platformLocation.pathname+Uu(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?"".concat(t).concat(n):t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Uu(r));this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Uu(r));this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}},{key:"historyGo",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null===(t=(e=this._platformLocation).historyGo)||void 0===t||t.call(e,n)}}]),n}(Hu);return e.\u0275fac=function(t){return new(t||e)(Nr(Ou),Nr(Gu,8))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),Ku=function(){var e=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this))._platformLocation=e,a._baseHref="",a._removeListenerFns=[],null!=r&&(a._baseHref=r),a}return I(n,[{key:"ngOnDestroy",value:function(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}},{key:"onPopState",value:function(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"path",value:function(){var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}},{key:"prepareExternalUrl",value:function(e){var t=Vu(this._baseHref,e);return t.length>0?"#"+t:t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Uu(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Uu(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}},{key:"historyGo",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null===(t=(e=this._platformLocation).historyGo)||void 0===t||t.call(e,n)}}]),n}(Hu);return e.\u0275fac=function(t){return new(t||e)(Nr(Ou),Nr(Gu,8))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),Xu=function(){var e=function(){function e(t,n){var r=this;x(this,e),this._subject=new xs,this._urlChangeListeners=[],this._platformStrategy=t;var a=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=Wu(Zu(a)),this._platformStrategy.onPopState(function(e){r._subject.emit({url:r.path(!0),pop:!0,state:e.state,type:e.type})})}return I(e,[{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.normalize(this._platformStrategy.path(e))}},{key:"getState",value:function(){return this._platformLocation.getState()}},{key:"isCurrentPathEqualTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.path()==this.normalize(e+Uu(t))}},{key:"normalize",value:function(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Zu(t)))}},{key:"prepareExternalUrl",value:function(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Uu(t)),n)}},{key:"replaceState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Uu(t)),n)}},{key:"forward",value:function(){this._platformStrategy.forward()}},{key:"back",value:function(){this._platformStrategy.back()}},{key:"historyGo",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null===(t=(e=this._platformStrategy).historyGo)||void 0===t||t.call(e,n)}},{key:"onUrlChange",value:function(e){var t=this;this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(function(e){t._notifyUrlChangeListeners(e.url,e.state)}))}},{key:"_notifyUrlChangeListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._urlChangeListeners.forEach(function(n){return n(e,t)})}},{key:"subscribe",value:function(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(Hu),Nr(Ou))},e.normalizeQueryParams=Uu,e.joinWithSlash=Vu,e.stripTrailingSlash=Wu,e.\u0275prov=je({factory:Yu,token:e,providedIn:"root"}),e}();function Yu(){return new Xu(Nr(Hu),Nr(Ou))}function Zu(e){return e.replace(/\/index.html$/,"")}var Ju=((Ju=Ju||{})[Ju.Zero=0]="Zero",Ju[Ju.One=1]="One",Ju[Ju.Two=2]="Two",Ju[Ju.Few=3]="Few",Ju[Ju.Many=4]="Many",Ju[Ju.Other=5]="Other",Ju),Qu=function e(){x(this,e)},$u=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).locale=e,r}return I(n,[{key:"getPluralCategory",value:function(e,t){switch(function(e){return function(e){var t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e),n=mo(t);if(n)return n;var r=t.split("-")[0];if(n=mo(r))return n;if("en"===r)return fo;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}(e)[go.PluralCase]}(t||this.locale)(e)){case Ju.Zero:return"zero";case Ju.One:return"one";case Ju.Two:return"two";case Ju.Few:return"few";case Ju.Many:return"many";default:return"other"}}}]),n}(Qu);return e.\u0275fac=function(t){return new(t||e)(Nr(js))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),ec=function(){var e=function e(){x(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Nt({type:e}),e.\u0275inj=Ge({providers:[{provide:Qu,useClass:$u}]}),e}(),tc=function(){var e=function e(){x(this,e)};return e.\u0275prov=je({token:e,providedIn:"root",factory:function(){return new nc(Nr(Fu),window)}}),e}(),nc=function(){function e(t,n){x(this,e),this.document=t,this.window=n,this.offset=function(){return[0,0]}}return I(e,[{key:"setOffset",value:function(e){this.offset=Array.isArray(e)?function(){return e}:e}},{key:"getScrollPosition",value:function(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}},{key:"scrollToPosition",value:function(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}},{key:"scrollToAnchor",value:function(e){if(this.supportsScrolling()){var t=function(e,t){var n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow))for(var r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT),a=r.currentNode;a;){var i=a.shadowRoot;if(i){var o=i.getElementById(t)||i.querySelector('[name="'.concat(t,'"]'));if(o)return o}a=r.nextNode()}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}}},{key:"setHistoryScrollRestoration",value:function(e){if(this.supportScrollRestoration()){var t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}},{key:"scrollToElement",value:function(e){var t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(n-a[0],r-a[1])}},{key:"attemptFocus",value:function(e){return e.focus(),this.document.activeElement===e}},{key:"supportScrollRestoration",value:function(){try{if(!this.supportsScrolling())return!1;var e=rc(this.window.history)||rc(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}},{key:"supportsScrolling",value:function(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}]),e}();function rc(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}var ac,ic=function(e){d(r,e);var t=m(r);function r(){return x(this,r),t.apply(this,arguments)}return I(r,[{key:"onAndCancel",value:function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"remove",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getBaseHref",value:function(e){var t=(oc=oc||document.querySelector("base"))?oc.getAttribute("href"):null;return null==t?null:function(e){(ac=ac||document.createElement("a")).setAttribute("href",e);var t=ac.pathname;return"/"===t.charAt(0)?t:"/".concat(t)}(t)}},{key:"resetBaseElement",value:function(){oc=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"getCookie",value:function(e){return function(e,t){t=encodeURIComponent(t);var r,a=s(e.split(";"));try{for(a.s();!(r=a.n()).done;){var i=r.value,o=i.indexOf("="),u=n(-1==o?[i,""]:[i.slice(0,o),i.slice(o+1)],2),c=u[0],l=u[1];if(c.trim()===t)return decodeURIComponent(l)}}catch(h){a.e(h)}finally{a.f()}return null}(document.cookie,e)}}],[{key:"makeCurrent",value:function(){!function(e){Au||(Au=e)}(new r)}}]),r}(function(e){d(n,e);var t=m(n);function n(){var e;return x(this,n),(e=t.apply(this,arguments)).supportsDOMEvents=!0,e}return n}(function(){return function e(){x(this,e)}}())),oc=null,sc=new ur("TRANSITION_ID"),uc=[{provide:Ms,useFactory:function(e,t,n){return function(){n.get(Ls).donePromise.then(function(){for(var n=Du(),r=t.querySelectorAll('style[ng-transition="'.concat(e,'"]')),a=0;a<r.length;a++)n.remove(r[a])})}},deps:[sc,Fu,Xi],multi:!0}],cc=function(){function e(){x(this,e)}return I(e,[{key:"addToWindow",value:function(e){ct.getAngularTestability=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},ct.getAllAngularTestabilities=function(){return e.getAllTestabilities()},ct.getAllAngularRootElements=function(){return e.getAllRootElements()},ct.frameworkStabilizers||(ct.frameworkStabilizers=[]),ct.frameworkStabilizers.push(function(e){var t=ct.getAllAngularTestabilities(),n=t.length,r=!1,a=function(t){r=r||t,0==--n&&e(r)};t.forEach(function(e){e.whenStable(a)})})}},{key:"findTestabilityInTree",value:function(e,t,n){if(null==t)return null;var r=e.getTestability(t);return null!=r?r:n?Du().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}],[{key:"init",value:function(){!function(e){pu=e}(new e)}}]),e}(),lc=function(){var e=function(){function e(){x(this,e)}return I(e,[{key:"build",value:function(){return new XMLHttpRequest}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),hc=new ur("EventManagerPlugins"),pc=function(){var e=function(){function e(t,n){var r=this;x(this,e),this._zone=n,this._eventNameToPlugin=new Map,t.forEach(function(e){return e.manager=r}),this._plugins=t.slice().reverse()}return I(e,[{key:"addEventListener",value:function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}},{key:"addGlobalEventListener",value:function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,r=0;r<n.length;r++){var a=n[r];if(a.supports(e))return this._eventNameToPlugin.set(e,a),a}throw new Error("No event manager plugin found for event ".concat(e))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(hc),Nr(nu))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),fc=function(){function e(t){x(this,e),this._doc=t}return I(e,[{key:"addGlobalEventListener",value:function(e,t,n){var r=Du().getGlobalEventTarget(this._doc,e);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(t));return this.addEventListener(r,t,n)}}]),e}(),dc=function(){var e=function(){function e(){x(this,e),this._stylesSet=new Set}return I(e,[{key:"addStyles",value:function(e){var t=this,n=new Set;e.forEach(function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))}),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),vc=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this))._doc=e,r._hostNodes=new Map,r._hostNodes.set(e.head,[]),r}return I(n,[{key:"_addStylesToHost",value:function(e,t,n){var r=this;e.forEach(function(e){var a=r._doc.createElement("style");a.textContent=e,n.push(t.appendChild(a))})}},{key:"addHost",value:function(e){var t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}},{key:"removeHost",value:function(e){var t=this._hostNodes.get(e);t&&t.forEach(mc),this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach(function(n,r){t._addStylesToHost(e,r,n)})}},{key:"ngOnDestroy",value:function(){this._hostNodes.forEach(function(e){return e.forEach(mc)})}}]),n}(dc);return e.\u0275fac=function(t){return new(t||e)(Nr(Fu))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}();function mc(e){Du().remove(e)}var gc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},yc=/%COMP%/g;function bc(e,t,n){for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?bc(e,a,n):(a=a.replace(yc,e),n.push(a))}return n}function kc(e){return function(t){if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var xc=function(){var e=function(){function e(t,n,r){x(this,e),this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new wc(t)}return I(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case it.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new Ic(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case 1:case it.ShadowDom:return new Nc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var r=bc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(pc),Nr(vc),Nr(Ps))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),wc=function(){function e(t){x(this,e),this.eventManager=t,this.data=Object.create(null)}return I(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(gc[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,n){e&&e.insertBefore(t,n)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(n.textContent=""),n}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,n,r){if(r){t=r+":"+t;var a=gc[r];a?e.setAttributeNS(a,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}},{key:"removeAttribute",value:function(e,t,n){if(n){var r=gc[n];r?e.removeAttributeNS(r,t):e.removeAttribute("".concat(n,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,n,r){r&(va.DashCase|va.Important)?e.style.setProperty(t,n,r&va.Important?"important":""):e.style[t]=n}},{key:"removeStyle",value:function(e,t,n){n&va.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,kc(n)):this.eventManager.addEventListener(e,t,kc(n))}}]),e}(),Ic=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;x(this,n),(o=t.call(this,e)).component=a;var s=bc(i+"-"+a.id,a.styles,[]);return r.addStyles(s),o.contentAttr=function(e){return"_ngcontent-%COMP%".replace(yc,e)}(i+"-"+a.id),o.hostAttr=function(e){return"_nghost-%COMP%".replace(yc,e)}(i+"-"+a.id),o}return I(n,[{key:"applyToHost",value:function(e){p(k(n.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,t){var r=p(k(n.prototype),"createElement",this).call(this,e,t);return p(k(n.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),n}(wc),Nc=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;x(this,n),(o=t.call(this,e)).sharedStylesHost=r,o.hostEl=a,o.shadowRoot=a.attachShadow({mode:"open"}),o.sharedStylesHost.addHost(o.shadowRoot);for(var s=bc(i.id,i.styles,[]),u=0;u<s.length;u++){var c=document.createElement("style");c.textContent=s[u],o.shadowRoot.appendChild(c)}return o}return I(n,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,t){return p(k(n.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"insertBefore",value:function(e,t,r){return p(k(n.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),t,r)}},{key:"removeChild",value:function(e,t){return p(k(n.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(p(k(n.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),n}(wc),Sc=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,n){var r=this;return e.addEventListener(t,n,!1),function(){return r.removeEventListener(e,t,n)}}},{key:"removeEventListener",value:function(e,t,n){return e.removeEventListener(t,n)}}]),n}(fc);return e.\u0275fac=function(t){return new(t||e)(Nr(Fu))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),Cc=["alt","control","meta","shift"],Tc={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ec={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},_c={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},Rc=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"supports",value:function(e){return null!=n.parseEventName(e)}},{key:"addEventListener",value:function(e,t,r){var a=n.parseEventName(t),i=n.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return Du().onAndCancel(e,a.domEventName,i)})}}],[{key:"parseEventName",value:function(e){var t=e.toLowerCase().split("."),r=t.shift();if(0===t.length||"keydown"!==r&&"keyup"!==r)return null;var a=n._normalizeKey(t.pop()),i="";if(Cc.forEach(function(e){var n=t.indexOf(e);n>-1&&(t.splice(n,1),i+=e+".")}),i+=a,0!=t.length||0===a.length)return null;var o={};return o.domEventName=r,o.fullKey=i,o}},{key:"getEventFullKey",value:function(e){var t="",n=function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Ec.hasOwnProperty(t)&&(t=Ec[t]))}return Tc[t]||t}(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Cc.forEach(function(r){r!=n&&_c[r](e)&&(t+=r+".")}),t+=n}},{key:"eventCallback",value:function(e,t,r){return function(a){n.getEventFullKey(a)===e&&r.runGuarded(function(){return t(a)})}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),n}(fc);return e.\u0275fac=function(t){return new(t||e)(Nr(Fu))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),Ac=gu(Eu,"browser",[{provide:Ws,useValue:"browser"},{provide:Vs,useValue:function(){ic.makeCurrent(),cc.init()},multi:!0},{provide:Fu,useFactory:function(){return function(e){Vt=e}(document),document},deps:[]}]),Dc=[[],{provide:Pi,useValue:"root"},{provide:pa,useFactory:function(){return new pa},deps:[]},{provide:hc,useClass:Sc,multi:!0,deps:[Fu,nu,Ws]},{provide:hc,useClass:Rc,multi:!0,deps:[Fu]},[],{provide:xc,useClass:xc,deps:[pc,vc,Ps]},{provide:Eo,useExisting:xc},{provide:dc,useExisting:vc},{provide:vc,useClass:vc,deps:[Fu]},{provide:lu,useClass:lu,deps:[nu]},{provide:pc,useClass:pc,deps:[hc,nu]},{provide:function e(){x(this,e)},useClass:lc,deps:[]},[]],Fc=function(){var e=function(){function e(t){if(x(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return I(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:Ps,useValue:t.appId},{provide:sc,useExisting:Ps},uc]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(e,12))},e.\u0275mod=Nt({type:e}),e.\u0275inj=Ge({providers:Dc,imports:[ec,Ru]}),e}();function Oc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return ue(r)?(t.pop(),ge(t,r)):Ce(t)}"undefined"!=typeof window&&window;var Mc=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this))._value=e,r}return I(n,[{key:"value",get:function(){return this.getValue()}},{key:"_subscribe",value:function(e){var t=p(k(n.prototype),"_subscribe",this).call(this,e);return t&&!t.closed&&e.next(this._value),t}},{key:"getValue",value:function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new re;return this._value}},{key:"next",value:function(e){p(k(n.prototype),"next",this).call(this,this._value=e)}}]),n}(oe),Lc=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}},{key:"notifyError",value:function(e,t){this.destination.error(e)}},{key:"notifyComplete",value:function(e){this.destination.complete()}}]),n}(J),Pc=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this)).parent=e,i.outerValue=r,i.outerIndex=a,i.index=0,i}return I(n,[{key:"_next",value:function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}},{key:"_error",value:function(e){this.parent.notifyError(e,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),n}(J);function zc(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Pc(e,n,r);if(!a.closed)return t instanceof te?t.subscribe(a):me(t)(a)}var Bc={},Vc=function(){function e(t){x(this,e),this.resultSelector=t}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new Wc(e,this.resultSelector))}}]),e}(),Wc=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).resultSelector=r,a.active=0,a.values=[],a.observables=[],a}return I(n,[{key:"_next",value:function(e){this.values.push(Bc),this.observables.push(e)}},{key:"_complete",value:function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++)this.add(zc(this,e[n],void 0,n))}}},{key:"notifyComplete",value:function(e){0==(this.active-=1)&&this.destination.complete()}},{key:"notifyNext",value:function(e,t,n){var r=this.values,a=this.toRespond?r[n]===Bc?--this.toRespond:this.toRespond:0;r[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}},{key:"_tryResultSelector",value:function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(Lc),Uc=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}();function Hc(){return Se(1)(Oc.apply(void 0,arguments))}var jc=new te(function(e){return e.complete()});function Gc(e){return e?function(e){return new te(function(t){return e.schedule(function(){return t.complete()})})}(e):jc}function qc(e){return new te(function(t){var n;try{n=e()}catch(r){return void t.error(r)}return(n?ye(n):Gc()).subscribe(t)})}function Kc(e,t){return"function"==typeof t?function(n){return n.pipe(Kc(function(n,r){return ye(e(n,r)).pipe(ce(function(e,a){return t(n,e,r,a)}))}))}:function(t){return t.lift(new Xc(e))}}var Xc=function(){function e(t){x(this,e),this.project=t}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new Yc(e,this.project))}}]),e}(),Yc=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).project=r,a.index=0,a}return I(n,[{key:"_next",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t)}},{key:"_innerSub",value:function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new be(this),r=this.destination;r.add(n),this.innerSubscription=xe(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}},{key:"_complete",value:function(){var e=this.innerSubscription;(!e||e.closed)&&p(k(n.prototype),"_complete",this).call(this),this.unsubscribe()}},{key:"_unsubscribe",value:function(){this.innerSubscription=void 0}},{key:"notifyComplete",value:function(){this.innerSubscription=void 0,this.isStopped&&p(k(n.prototype),"_complete",this).call(this)}},{key:"notifyNext",value:function(e){this.destination.next(e)}}]),n}(ke),Zc=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}();function Jc(e){return function(t){return 0===e?Gc():t.lift(new Qc(e))}}var Qc=function(){function e(t){if(x(this,e),this.total=t,this.total<0)throw new Zc}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new $c(e,this.total))}}]),e}(),$c=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).total=r,a.count=0,a}return I(n,[{key:"_next",value:function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}]),n}(J);function el(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new tl(e,t,n))}}var tl=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];x(this,e),this.accumulator=t,this.seed=n,this.hasSeed=r}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new nl(e,this.accumulator,this.seed,this.hasSeed))}}]),e}(),nl=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;return x(this,n),(o=t.call(this,e)).accumulator=r,o._seed=a,o.hasSeed=i,o.index=0,o}return I(n,[{key:"seed",get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e}},{key:"_next",value:function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(r){this.destination.error(r)}this.seed=t,this.destination.next(t)}}]),n}(J);function rl(e,t){return function(n){return n.lift(new al(e,t))}}var al=function(){function e(t,n){x(this,e),this.predicate=t,this.thisArg=n}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new il(e,this.predicate,this.thisArg))}}]),e}(),il=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this,e)).predicate=r,i.thisArg=a,i.count=0,i}return I(n,[{key:"_next",value:function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}]),n}(J);function ol(e){return function(t){var n=new sl(e),r=t.lift(n);return n.caught=r}}var sl=function(){function e(t){x(this,e),this.selector=t}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new ul(e,this.selector,this.caught))}}]),e}(),ul=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this,e)).selector=r,i.caught=a,i}return I(n,[{key:"error",value:function(e){if(!this.isStopped){var t;try{t=this.selector(e,this.caught)}catch(i){return void p(k(n.prototype),"error",this).call(this,i)}this._unsubscribeAndRecycle();var r=new be(this);this.add(r);var a=xe(t,r);a!==r&&this.add(a)}}}]),n}(ke);function cl(e,t){return we(e,t,1)}function ll(e){return function(t){return 0===e?Gc():t.lift(new hl(e))}}var hl=function(){function e(t){if(x(this,e),this.total=t,this.total<0)throw new Zc}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new pl(e,this.total))}}]),e}(),pl=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).total=r,a.ring=new Array,a.count=0,a}return I(n,[{key:"_next",value:function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}},{key:"_complete",value:function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,a=0;a<n;a++){var i=t++%n;e.next(r[i])}e.complete()}}]),n}(J);function fl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ml;return function(t){return t.lift(new dl(e))}}var dl=function(){function e(t){x(this,e),this.errorFactory=t}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new vl(e,this.errorFactory))}}]),e}(),vl=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).errorFactory=r,a.hasValue=!1,a}return I(n,[{key:"_next",value:function(e){this.hasValue=!0,this.destination.next(e)}},{key:"_complete",value:function(){if(this.hasValue)return this.destination.complete();var e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}]),n}(J);function ml(){return new Uc}function gl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t){return t.lift(new yl(e))}}var yl=function(){function e(t){x(this,e),this.defaultValue=t}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new bl(e,this.defaultValue))}}]),e}(),bl=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).defaultValue=r,a.isEmpty=!0,a}return I(n,[{key:"_next",value:function(e){this.isEmpty=!1,this.destination.next(e)}},{key:"_complete",value:function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}]),n}(J);function kl(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?rl(function(t,n){return e(t,n,r)}):ee,Jc(1),n?gl(t):fl(function(){return new Uc}))}}function xl(){}function wl(e,t,n){return function(r){return r.lift(new Il(e,t,n))}}var Il=function(){function e(t,n,r){x(this,e),this.nextOrObserver=t,this.error=n,this.complete=r}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new Nl(e,this.nextOrObserver,this.error,this.complete))}}]),e}(),Nl=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;return x(this,n),(o=t.call(this,e))._tapNext=xl,o._tapError=xl,o._tapComplete=xl,o._tapError=a||xl,o._tapComplete=i||xl,B(r)?(o._context=y(o),o._tapNext=r):r&&(o._context=r,o._tapNext=r.next||xl,o._tapError=r.error||xl,o._tapComplete=r.complete||xl),o}return I(n,[{key:"_next",value:function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}},{key:"_error",value:function(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}]),n}(J),Sl=function(){function e(t){x(this,e),this.callback=t}return I(e,[{key:"call",value:function(e,t){return t.subscribe(new Cl(e,this.callback))}}]),e}(),Cl=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).add(new X(r)),a}return n}(J),Tl=function e(t,n){x(this,e),this.id=t,this.url=n},El=function(e){d(n,e);var t=m(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imperative",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return x(this,n),(a=t.call(this,e,r)).navigationTrigger=i,a.restoredState=o,a}return I(n,[{key:"toString",value:function(){return"NavigationStart(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(Tl),_l=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this,e,r)).urlAfterRedirects=a,i}return I(n,[{key:"toString",value:function(){return"NavigationEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"')")}}]),n}(Tl),Rl=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this,e,r)).reason=a,i}return I(n,[{key:"toString",value:function(){return"NavigationCancel(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(Tl),Al=function(e){d(n,e);var t=m(n);function n(e,r,a){var i;return x(this,n),(i=t.call(this,e,r)).error=a,i}return I(n,[{key:"toString",value:function(){return"NavigationError(id: ".concat(this.id,", url: '").concat(this.url,"', error: ").concat(this.error,")")}}]),n}(Tl),Dl=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;return x(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return I(n,[{key:"toString",value:function(){return"RoutesRecognized(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Tl),Fl=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;return x(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return I(n,[{key:"toString",value:function(){return"GuardsCheckStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Tl),Ol=function(e){d(n,e);var t=m(n);function n(e,r,a,i,o){var s;return x(this,n),(s=t.call(this,e,r)).urlAfterRedirects=a,s.state=i,s.shouldActivate=o,s}return I(n,[{key:"toString",value:function(){return"GuardsCheckEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,", shouldActivate: ").concat(this.shouldActivate,")")}}]),n}(Tl),Ml=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;return x(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return I(n,[{key:"toString",value:function(){return"ResolveStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Tl),Ll=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;return x(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return I(n,[{key:"toString",value:function(){return"ResolveEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Tl),Pl=function(){function e(t){x(this,e),this.route=t}return I(e,[{key:"toString",value:function(){return"RouteConfigLoadStart(path: ".concat(this.route.path,")")}}]),e}(),zl=function(){function e(t){x(this,e),this.route=t}return I(e,[{key:"toString",value:function(){return"RouteConfigLoadEnd(path: ".concat(this.route.path,")")}}]),e}(),Bl=function(){function e(t){x(this,e),this.snapshot=t}return I(e,[{key:"toString",value:function(){return"ChildActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),Vl=function(){function e(t){x(this,e),this.snapshot=t}return I(e,[{key:"toString",value:function(){return"ChildActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),Wl=function(){function e(t){x(this,e),this.snapshot=t}return I(e,[{key:"toString",value:function(){return"ActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),Ul=function(){function e(t){x(this,e),this.snapshot=t}return I(e,[{key:"toString",value:function(){return"ActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),Hl=function(){function e(t,n,r){x(this,e),this.routerEvent=t,this.position=n,this.anchor=r}return I(e,[{key:"toString",value:function(){return"Scroll(anchor: '".concat(this.anchor,"', position: '").concat(this.position?"".concat(this.position[0],", ").concat(this.position[1]):null,"')")}}]),e}(),jl="primary",Gl=function(){function e(t){x(this,e),this.params=t||{}}return I(e,[{key:"has",value:function(e){return Object.prototype.hasOwnProperty.call(this.params,e)}},{key:"get",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t[0]:t}return null}},{key:"getAll",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t:[t]}return[]}},{key:"keys",get:function(){return Object.keys(this.params)}}]),e}();function ql(e){return new Gl(e)}var Kl="ngNavigationCancelingError";function Xl(e){var t=Error("NavigationCancelingError: "+e);return t[Kl]=!0,t}function Yl(e,t,n){var r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;for(var a={},i=0;i<r.length;i++){var o=r[i],s=e[i];if(o.startsWith(":"))a[o.substring(1)]=s;else if(o!==s.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}function Zl(e,t){var n,r=e?Object.keys(e):void 0,a=t?Object.keys(t):void 0;if(!r||!a||r.length!=a.length)return!1;for(var i=0;i<r.length;i++)if(!Jl(e[n=r[i]],t[n]))return!1;return!0}function Jl(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;var n=i(e).sort(),r=i(t).sort();return n.every(function(e,t){return r[t]===e})}return e===t}function Ql(e){return Array.prototype.concat.apply([],e)}function $l(e){return e.length>0?e[e.length-1]:null}function eh(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function th(e){return so(e)?e:oo(e)?ye(Promise.resolve(e)):Oc(e)}var nh={exact:function e(t,n,r){if(!hh(t.segments,n.segments)||!sh(t.segments,n.segments,r)||t.numberOfChildren!==n.numberOfChildren)return!1;for(var a in n.children)if(!t.children[a]||!e(t.children[a],n.children[a],r))return!1;return!0},subset:ih},rh={exact:function(e,t){return Zl(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(function(n){return Jl(e[n],t[n])})},ignored:function(){return!0}};function ah(e,t,n){return nh[n.paths](e.root,t.root,n.matrixParams)&&rh[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function ih(e,t,n){return oh(e,t,t.segments,n)}function oh(e,t,n,r){if(e.segments.length>n.length){var a=e.segments.slice(0,n.length);return!(!hh(a,n)||t.hasChildren()||!sh(a,n,r))}if(e.segments.length===n.length){if(!hh(e.segments,n)||!sh(e.segments,n,r))return!1;for(var i in t.children)if(!e.children[i]||!ih(e.children[i],t.children[i],r))return!1;return!0}var o=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(hh(e.segments,o)&&sh(e.segments,o,r)&&e.children[jl])&&oh(e.children[jl],t,s,r)}function sh(e,t,n){return t.every(function(t,r){return rh[n](e[r].parameters,t.parameters)})}var uh=function(){function e(t,n,r){x(this,e),this.root=t,this.queryParams=n,this.fragment=r}return I(e,[{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=ql(this.queryParams)),this._queryParamMap}},{key:"toString",value:function(){return dh.serialize(this)}}]),e}(),ch=function(){function e(t,n){var r=this;x(this,e),this.segments=t,this.children=n,this.parent=null,eh(n,function(e,t){return e.parent=r})}return I(e,[{key:"hasChildren",value:function(){return this.numberOfChildren>0}},{key:"numberOfChildren",get:function(){return Object.keys(this.children).length}},{key:"toString",value:function(){return vh(this)}}]),e}(),lh=function(){function e(t,n){x(this,e),this.path=t,this.parameters=n}return I(e,[{key:"parameterMap",get:function(){return this._parameterMap||(this._parameterMap=ql(this.parameters)),this._parameterMap}},{key:"toString",value:function(){return wh(this)}}]),e}();function hh(e,t){return e.length===t.length&&e.every(function(e,n){return e.path===t[n].path})}var ph=function e(){x(this,e)},fh=function(){function e(){x(this,e)}return I(e,[{key:"parse",value:function(e){var t=new Th(e);return new uh(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}},{key:"serialize",value:function(e){return"".concat("/".concat(mh(e.root,!0)),function(e){var t=Object.keys(e).map(function(t){var n=e[t];return Array.isArray(n)?n.map(function(e){return"".concat(yh(t),"=").concat(yh(e))}).join("&"):"".concat(yh(t),"=").concat(yh(n))}).filter(function(e){return!!e});return t.length?"?".concat(t.join("&")):""}(e.queryParams)).concat("string"==typeof e.fragment?"#".concat(function(e){return encodeURI(e)}(e.fragment)):"")}}]),e}(),dh=new fh;function vh(e){return e.segments.map(function(e){return wh(e)}).join("/")}function mh(e,t){if(!e.hasChildren())return vh(e);if(t){var n=e.children[jl]?mh(e.children[jl],!1):"",r=[];return eh(e.children,function(e,t){t!==jl&&r.push("".concat(t,":").concat(mh(e,!1)))}),r.length>0?"".concat(n,"(").concat(r.join("//"),")"):n}var a=function(e,t){var n=[];return eh(e.children,function(e,r){r===jl&&(n=n.concat(t(e,r)))}),eh(e.children,function(e,r){r!==jl&&(n=n.concat(t(e,r)))}),n}(e,function(t,n){return n===jl?[mh(e.children[jl],!1)]:["".concat(n,":").concat(mh(t,!1))]});return 1===Object.keys(e.children).length&&null!=e.children[jl]?"".concat(vh(e),"/").concat(a[0]):"".concat(vh(e),"/(").concat(a.join("//"),")")}function gh(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function yh(e){return gh(e).replace(/%3B/gi,";")}function bh(e){return gh(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function kh(e){return decodeURIComponent(e)}function xh(e){return kh(e.replace(/\+/g,"%20"))}function wh(e){return"".concat(bh(e.path)).concat(function(e){return Object.keys(e).map(function(t){return";".concat(bh(t),"=").concat(bh(e[t]))}).join("")}(e.parameters))}var Ih=/^[^\/()?;=#]+/;function Nh(e){var t=e.match(Ih);return t?t[0]:""}var Sh=/^[^=?&#]+/,Ch=/^[^?&#]+/,Th=function(){function e(t){x(this,e),this.url=t,this.remaining=t}return I(e,[{key:"parseRootSegment",value:function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ch([],{}):new ch([],this.parseChildren())}},{key:"parseQueryParams",value:function(){var e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}},{key:"parseFragment",value:function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}},{key:"parseChildren",value:function(){if(""===this.remaining)return{};this.consumeOptional("/");var e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());var t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[jl]=new ch(e,t)),n}},{key:"parseSegment",value:function(){var e=Nh(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '".concat(this.remaining,"'."));return this.capture(e),new lh(kh(e),this.parseMatrixParams())}},{key:"parseMatrixParams",value:function(){for(var e={};this.consumeOptional(";");)this.parseParam(e);return e}},{key:"parseParam",value:function(e){var t=Nh(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=Nh(this.remaining);r&&(n=r,this.capture(n))}e[kh(t)]=kh(n)}}},{key:"parseQueryParam",value:function(e){var t=function(e){var t=e.match(Sh);return t?t[0]:""}(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=function(e){var t=e.match(Ch);return t?t[0]:""}(this.remaining);r&&(n=r,this.capture(n))}var a=xh(t),i=xh(n);if(e.hasOwnProperty(a)){var o=e[a];Array.isArray(o)||(o=[o],e[a]=o),o.push(i)}else e[a]=i}}},{key:"parseParens",value:function(e){var t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Nh(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '".concat(this.url,"'"));var a=void 0;n.indexOf(":")>-1?(a=n.substr(0,n.indexOf(":")),this.capture(a),this.capture(":")):e&&(a=jl);var i=this.parseChildren();t[a]=1===Object.keys(i).length?i[jl]:new ch([],i),this.consumeOptional("//")}return t}},{key:"peekStartsWith",value:function(e){return this.remaining.startsWith(e)}},{key:"consumeOptional",value:function(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}},{key:"capture",value:function(e){if(!this.consumeOptional(e))throw new Error('Expected "'.concat(e,'".'))}}]),e}(),Eh=function(){function e(t){x(this,e),this._root=t}return I(e,[{key:"root",get:function(){return this._root.value}},{key:"parent",value:function(e){var t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}},{key:"children",value:function(e){var t=_h(e,this._root);return t?t.children.map(function(e){return e.value}):[]}},{key:"firstChild",value:function(e){var t=_h(e,this._root);return t&&t.children.length>0?t.children[0].value:null}},{key:"siblings",value:function(e){var t=Rh(e,this._root);return t.length<2?[]:t[t.length-2].children.map(function(e){return e.value}).filter(function(t){return t!==e})}},{key:"pathFromRoot",value:function(e){return Rh(e,this._root).map(function(e){return e.value})}}]),e}();function _h(e,t){if(e===t.value)return t;var n,r=s(t.children);try{for(r.s();!(n=r.n()).done;){var a=_h(e,n.value);if(a)return a}}catch(i){r.e(i)}finally{r.f()}return null}function Rh(e,t){if(e===t.value)return[t];var n,r=s(t.children);try{for(r.s();!(n=r.n()).done;){var a=Rh(e,n.value);if(a.length)return a.unshift(t),a}}catch(i){r.e(i)}finally{r.f()}return[]}var Ah=function(){function e(t,n){x(this,e),this.value=t,this.children=n}return I(e,[{key:"toString",value:function(){return"TreeNode(".concat(this.value,")")}}]),e}();function Dh(e){var t={};return e&&e.children.forEach(function(e){return t[e.value.outlet]=e}),t}var Fh=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,e)).snapshot=r,Bh(y(a),e),a}return I(n,[{key:"toString",value:function(){return this.snapshot.toString()}}]),n}(Eh);function Oh(e,t){var n=function(e,t){var n=new Ph([],{},{},"",{},jl,t,null,e.root,-1,{});return new zh("",new Ah(n,[]))}(e,t),r=new Mc([new lh("",{})]),a=new Mc({}),i=new Mc({}),o=new Mc({}),s=new Mc(""),u=new Mh(r,a,o,s,i,jl,t,n.root);return u.snapshot=n.root,new Fh(new Ah(u,[]),n)}var Mh=function(){function e(t,n,r,a,i,o,s,u){x(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=u}return I(e,[{key:"routeConfig",get:function(){return this._futureSnapshot.routeConfig}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=this.params.pipe(ce(function(e){return ql(e)}))),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(ce(function(e){return ql(e)}))),this._queryParamMap}},{key:"toString",value:function(){return this.snapshot?this.snapshot.toString():"Future(".concat(this._futureSnapshot,")")}}]),e}();function Lh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emptyOnly",n=e.pathFromRoot,r=0;if("always"!==t)for(r=n.length-1;r>=1;){var a=n[r],i=n[r-1];if(a.routeConfig&&""===a.routeConfig.path)r--;else{if(i.component)break;r--}}return function(e){return e.reduce(function(e,t){return{params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}},{params:{},data:{},resolve:{}})}(n.slice(r))}var Ph=function(){function e(t,n,r,a,i,o,s,u,c,l,h){x(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=h}return I(e,[{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=ql(this.params)),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=ql(this.queryParams)),this._queryParamMap}},{key:"toString",value:function(){return"Route(url:'".concat(this.url.map(function(e){return e.toString()}).join("/"),"', path:'").concat(this.routeConfig?this.routeConfig.path:"","')")}}]),e}(),zh=function(e){d(n,e);var t=m(n);function n(e,r){var a;return x(this,n),(a=t.call(this,r)).url=e,Bh(y(a),r),a}return I(n,[{key:"toString",value:function(){return Vh(this._root)}}]),n}(Eh);function Bh(e,t){t.value._routerState=e,t.children.forEach(function(t){return Bh(e,t)})}function Vh(e){var t=e.children.length>0?" { ".concat(e.children.map(Vh).join(", ")," } "):"";return"".concat(e.value).concat(t)}function Wh(e){if(e.snapshot){var t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Zl(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Zl(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!Zl(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Zl(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Uh(e,t){return Zl(e.params,t.params)&&function(e,t){return hh(e,t)&&e.every(function(e,n){return Zl(e.parameters,t[n].parameters)})}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||Uh(e.parent,t.parent))}function Hh(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){var r=n.value;r._futureSnapshot=t.value;var a=function(e,t,n){return t.children.map(function(t){var r,a=s(n.children);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(e.shouldReuseRoute(t.value,i.value.snapshot))return Hh(e,t,i)}}catch(o){a.e(o)}finally{a.f()}return Hh(e,t)})}(e,t,n);return new Ah(r,a)}if(e.shouldAttach(t.value)){var i=e.retrieve(t.value);if(null!==i){var o=i.route;return jh(t,o),o}}var u=function(e){return new Mh(new Mc(e.url),new Mc(e.params),new Mc(e.queryParams),new Mc(e.fragment),new Mc(e.data),e.outlet,e.component,e)}(t.value),c=t.children.map(function(t){return Hh(e,t)});return new Ah(u,c)}function jh(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(var n=0;n<e.children.length;++n)jh(e.children[n],t.children[n])}function Gh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function qh(e){return"object"==typeof e&&null!=e&&e.outlets}function Kh(e,t,n,r,a){var i={};return r&&eh(r,function(e,t){i[t]=Array.isArray(e)?e.map(function(e){return"".concat(e)}):"".concat(e)}),new uh(n.root===e?t:Xh(n.root,e,t),i,a)}function Xh(e,t,n){var r={};return eh(e.children,function(e,a){r[a]=e===t?n:Xh(e,t,n)}),new ch(e.segments,r)}var Yh=function(){function e(t,n,r){if(x(this,e),this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&Gh(r[0]))throw new Error("Root segment cannot have matrix parameters");var a=r.find(qh);if(a&&a!==$l(r))throw new Error("{outlets:{}} has to be the last command")}return I(e,[{key:"toRoot",value:function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}]),e}(),Zh=function e(t,n,r){x(this,e),this.segmentGroup=t,this.processChildren=n,this.index=r};function Jh(e,t,n){if(e||(e=new ch([],{})),0===e.segments.length&&e.hasChildren())return Qh(e,t,n);var r=function(e,t,n){for(var r=0,a=t,i={match:!1,pathIndex:0,commandIndex:0};a<e.segments.length;){if(r>=n.length)return i;var o=e.segments[a],s=n[r];if(qh(s))break;var u="".concat(s),c=r<n.length-1?n[r+1]:null;if(a>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!np(u,c,o))return i;r+=2}else{if(!np(u,{},o))return i;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,t,n),a=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){var i=new ch(e.segments.slice(0,r.pathIndex),{});return i.children[jl]=new ch(e.segments.slice(r.pathIndex),e.children),Qh(i,0,a)}return r.match&&0===a.length?new ch(e.segments,{}):r.match&&!e.hasChildren()?$h(e,t,n):r.match?Qh(e,0,a):$h(e,t,n)}function Qh(e,n,r){if(0===r.length)return new ch(e.segments,{});var a=function(e){return qh(e[0])?e[0].outlets:t({},jl,e)}(r),i={};return eh(a,function(t,r){"string"==typeof t&&(t=[t]),null!==t&&(i[r]=Jh(e.children[r],n,t))}),eh(e.children,function(e,t){void 0===a[t]&&(i[t]=e)}),new ch(e.segments,i)}function $h(e,t,n){for(var r=e.segments.slice(0,t),a=0;a<n.length;){var i=n[a];if(qh(i)){var o=ep(i.outlets);return new ch(r,o)}if(0===a&&Gh(n[0]))r.push(new lh(e.segments[t].path,tp(n[0]))),a++;else{var s=qh(i)?i.outlets[jl]:"".concat(i),u=a<n.length-1?n[a+1]:null;s&&u&&Gh(u)?(r.push(new lh(s,tp(u))),a+=2):(r.push(new lh(s,{})),a++)}}return new ch(r,{})}function ep(e){var t={};return eh(e,function(e,n){"string"==typeof e&&(e=[e]),null!==e&&(t[n]=$h(new ch([],{}),0,e))}),t}function tp(e){var t={};return eh(e,function(e,n){return t[n]="".concat(e)}),t}function np(e,t,n){return e==n.path&&Zl(t,n.parameters)}var rp=function(){function e(t,n,r,a){x(this,e),this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=a}return I(e,[{key:"activate",value:function(e){var t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Wh(this.futureState.root),this.activateChildRoutes(t,n,e)}},{key:"deactivateChildRoutes",value:function(e,t,n){var r=this,a=Dh(t);e.children.forEach(function(e){var t=e.value.outlet;r.deactivateRoutes(e,a[t],n),delete a[t]}),eh(a,function(e,t){r.deactivateRouteAndItsChildren(e,n)})}},{key:"deactivateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(r===a)if(r.component){var i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else a&&this.deactivateRouteAndItsChildren(t,n)}},{key:"deactivateRouteAndItsChildren",value:function(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}},{key:"detachAndStoreRouteSubtree",value:function(e,t){var n=t.getContext(e.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:r,route:e,contexts:a})}}},{key:"deactivateRouteAndOutlet",value:function(e,t){for(var n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,a=Dh(e),i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];this.deactivateRouteAndItsChildren(a[s],r)}n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}},{key:"activateChildRoutes",value:function(e,t,n){var r=this,a=Dh(t);e.children.forEach(function(e){r.activateRoutes(e,a[e.value.outlet],n),r.forwardEvent(new Ul(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Vl(e.value.snapshot))}},{key:"activateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(Wh(r),r===a)if(r.component){var i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){var o=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){var s=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),ap(s.route)}else{var u=function(e){for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(r.snapshot),c=u?u.module.componentFactoryResolver:null;o.attachRef=null,o.route=r,o.resolver=c,o.outlet&&o.outlet.activateWith(r,c),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,n)}}]),e}();function ap(e){Wh(e.value),e.children.forEach(ap)}var ip=function e(t,n){x(this,e),this.routes=t,this.module=n};function op(e){return"function"==typeof e}function sp(e){return e instanceof uh}var up=Symbol("INITIAL_VALUE");function cp(){return Kc(function(e){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,a;return ue(t[t.length-1])&&(a=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&j(t[0])&&(t=t[0]),Ce(t,a).lift(new Vc(r))}(e.map(function(e){return e.pipe(Jc(1),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return ue(r)?(t.pop(),function(e){return Hc(t,e,r)}):function(e){return Hc(t,e)}}(up))})).pipe(el(function(e,t){var n=!1;return t.reduce(function(e,r,a){return e!==up?e:(r===up&&(n=!0),n||!1!==r&&a!==t.length-1&&!sp(r)?e:r)},e)},up),rl(function(e){return e!==up}),ce(function(e){return sp(e)?e:!0===e}),Jc(1))})}var lp=function(){var e=function e(){x(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=kt({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&io(0,"router-outlet")},directives:function(){return[af]},encapsulation:2}),e}();function hp(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=0;n<e.length;n++){var r=e[n];pp(r,fp(t,r))}}function pp(e,t){e.children&&hp(e.children,t)}function fp(e,t){return t?e||t.path?e&&!t.path?"".concat(e,"/"):!e&&t.path?t.path:"".concat(e,"/").concat(t.path):"":e}function dp(e){var t=e.children&&e.children.map(dp),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==jl&&(n.component=lp),n}function vp(e){return e.outlet||jl}function mp(e,t){var n=e.filter(function(e){return vp(e)===t});return n.push.apply(n,i(e.filter(function(e){return vp(e)!==t}))),n}var gp={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function yp(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},gp):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};var a=(t.matcher||Yl)(n,e,t);if(!a)return Object.assign({},gp);var i={};eh(a.posParams,function(e,t){i[t]=e.path});var o=a.consumed.length>0?Object.assign(Object.assign({},i),a.consumed[a.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:a.consumed,lastChild:a.consumed.length,parameters:o,positionalParamSegments:null!==(r=a.posParams)&&void 0!==r?r:{}}}function bp(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"corrected";if(n.length>0&&function(e,t,n){return n.some(function(n){return kp(e,t,n)&&vp(n)!==jl})}(e,n,r)){var i=new ch(t,function(e,t,n,r){var a={};a[jl]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;var i,o=s(n);try{for(o.s();!(i=o.n()).done;){var u=i.value;if(""===u.path&&vp(u)!==jl){var c=new ch([],{});c._sourceSegment=e,c._segmentIndexShift=t.length,a[vp(u)]=c}}}catch(l){o.e(l)}finally{o.f()}return a}(e,t,r,new ch(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(function(n){return kp(e,t,n)})}(e,n,r)){var o=new ch(e.segments,function(e,t,n,r,a,i){var o,u={},c=s(r);try{for(c.s();!(o=c.n()).done;){var l=o.value;if(kp(e,n,l)&&!a[vp(l)]){var h=new ch([],{});h._sourceSegment=e,h._segmentIndexShift="legacy"===i?e.segments.length:t.length,u[vp(l)]=h}}}catch(p){c.e(p)}finally{c.f()}return Object.assign(Object.assign({},a),u)}(e,t,n,r,e.children,a));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}var u=new ch(e.segments,e.children);return u._sourceSegment=e,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:n}}function kp(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function xp(e,t,n,r){return!!(vp(e)===r||r!==jl&&kp(t,n,e))&&("**"===e.path||yp(t,e,n).matched)}function wp(e,t,n){return 0===t.length&&!e.children[n]}var Ip=function e(t){x(this,e),this.segmentGroup=t||null},Np=function e(t){x(this,e),this.urlTree=t};function Sp(e){return new te(function(t){return t.error(new Ip(e))})}function Cp(e){return new te(function(t){return t.error(new Np(e))})}function Tp(e){return new te(function(t){return t.error(new Error("Only absolute redirects can have named outlets. redirectTo: '".concat(e,"'")))})}var Ep=function(){function e(t,n,r,a,i){x(this,e),this.configLoader=n,this.urlSerializer=r,this.urlTree=a,this.config=i,this.allowRedirects=!0,this.ngModule=t.get(rs)}return I(e,[{key:"apply",value:function(){var e=this,t=bp(this.urlTree.root,[],[],this.config).segmentGroup,n=new ch(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,n,jl).pipe(ce(function(t){return e.createUrlTree(_p(t),e.urlTree.queryParams,e.urlTree.fragment)})).pipe(ol(function(t){if(t instanceof Np)return e.allowRedirects=!1,e.match(t.urlTree);throw t instanceof Ip?e.noMatchError(t):t}))}},{key:"match",value:function(e){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,e.root,jl).pipe(ce(function(n){return t.createUrlTree(_p(n),e.queryParams,e.fragment)})).pipe(ol(function(e){throw e instanceof Ip?t.noMatchError(e):e}))}},{key:"noMatchError",value:function(e){return new Error("Cannot match any routes. URL Segment: '".concat(e.segmentGroup,"'"))}},{key:"createUrlTree",value:function(e,n,r){var a=e.segments.length>0?new ch([],t({},jl,e)):e;return new uh(a,n,r)}},{key:"expandSegmentGroup",value:function(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(ce(function(e){return new ch([],e)})):this.expandSegment(e,n,t,n.segments,r,!0)}},{key:"expandChildren",value:function(e,t,n){for(var r=this,a=[],i=0,o=Object.keys(n.children);i<o.length;i++){var s=o[i];"primary"===s?a.unshift(s):a.push(s)}return ye(a).pipe(cl(function(a){var i=n.children[a],o=mp(t,a);return r.expandSegmentGroup(e,o,i,a).pipe(ce(function(e){return{segment:e,outlet:a}}))}),el(function(e,t){return e[t.outlet]=t.segment,e},{}),function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?rl(function(t,n){return e(t,n,r)}):ee,ll(1),n?gl(t):fl(function(){return new Uc}))}}())}},{key:"expandSegment",value:function(e,t,n,r,a,i){var o=this;return ye(n).pipe(cl(function(s){return o.expandSegmentAgainstRoute(e,t,n,s,r,a,i).pipe(ol(function(e){if(e instanceof Ip)return Oc(null);throw e}))}),kl(function(e){return!!e}),ol(function(e,n){if(e instanceof Uc||"EmptyError"===e.name){if(wp(t,r,a))return Oc(new ch([],{}));throw new Ip(t)}throw e}))}},{key:"expandSegmentAgainstRoute",value:function(e,t,n,r,a,i,o){return xp(r,t,a,i)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,a,i):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i):Sp(t):Sp(t)}},{key:"expandSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,i):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i)}},{key:"expandWildCardWithParamsAgainstRouteUsingRedirect",value:function(e,t,n,r){var a=this,i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Cp(i):this.lineralizeSegments(n,i).pipe(we(function(n){var i=new ch(n,{});return a.expandSegment(e,i,t,n,r,!1)}))}},{key:"expandRegularSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){var o=this,s=yp(t,r,a),u=s.matched,c=s.consumedSegments,l=s.lastChild,h=s.positionalParamSegments;if(!u)return Sp(t);var p=this.applyRedirectCommands(c,r.redirectTo,h);return r.redirectTo.startsWith("/")?Cp(p):this.lineralizeSegments(r,p).pipe(we(function(r){return o.expandSegment(e,t,n,r.concat(a.slice(l)),i,!1)}))}},{key:"matchSegmentAgainstRoute",value:function(e,t,n,r,a){var i=this;if("**"===n.path)return n.loadChildren?(n._loadedConfig?Oc(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(ce(function(e){return n._loadedConfig=e,new ch(r,{})})):Oc(new ch(r,{}));var o=yp(t,n,r),s=o.matched,u=o.consumedSegments,c=o.lastChild;if(!s)return Sp(t);var l=r.slice(c);return this.getChildConfig(e,n,r).pipe(we(function(e){var r=e.module,o=e.routes,s=bp(t,u,l,o),c=s.segmentGroup,h=s.slicedSegments,p=new ch(c.segments,c.children);if(0===h.length&&p.hasChildren())return i.expandChildren(r,o,p).pipe(ce(function(e){return new ch(u,e)}));if(0===o.length&&0===h.length)return Oc(new ch(u,{}));var f=vp(n)===a;return i.expandSegment(r,p,o,h,f?jl:a,!0).pipe(ce(function(e){return new ch(u.concat(e.segments),e.children)}))}))}},{key:"getChildConfig",value:function(e,t,n){var r=this;return t.children?Oc(new ip(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Oc(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(we(function(n){return n?r.configLoader.load(e.injector,t).pipe(ce(function(e){return t._loadedConfig=e,e})):function(e){return new te(function(t){return t.error(Xl("Cannot load children because the guard of the route \"path: '".concat(e.path,"'\" returned false")))})}(t)})):Oc(new ip([],e))}},{key:"runCanLoadGuards",value:function(e,t,n){var r=this,a=t.canLoad;return a&&0!==a.length?Oc(a.map(function(r){var a,i=e.get(r);if(function(e){return e&&op(e.canLoad)}(i))a=i.canLoad(t,n);else{if(!op(i))throw new Error("Invalid CanLoad guard");a=i(t,n)}return th(a)})).pipe(cp(),wl(function(e){if(sp(e)){var t=Xl('Redirecting to "'.concat(r.urlSerializer.serialize(e),'"'));throw t.url=e,t}}),ce(function(e){return!0===e})):Oc(!0)}},{key:"lineralizeSegments",value:function(e,t){for(var n=[],r=t.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Oc(n);if(r.numberOfChildren>1||!r.children[jl])return Tp(e.redirectTo);r=r.children[jl]}}},{key:"applyRedirectCommands",value:function(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}},{key:"applyRedirectCreatreUrlTree",value:function(e,t,n,r){var a=this.createSegmentGroup(e,t.root,n,r);return new uh(a,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}},{key:"createQueryParams",value:function(e,t){var n={};return eh(e,function(e,r){if("string"==typeof e&&e.startsWith(":")){var a=e.substring(1);n[r]=t[a]}else n[r]=e}),n}},{key:"createSegmentGroup",value:function(e,t,n,r){var a=this,i=this.createSegments(e,t.segments,n,r),o={};return eh(t.children,function(t,i){o[i]=a.createSegmentGroup(e,t,n,r)}),new ch(i,o)}},{key:"createSegments",value:function(e,t,n,r){var a=this;return t.map(function(t){return t.path.startsWith(":")?a.findPosParam(e,t,r):a.findOrReturn(t,n)})}},{key:"findPosParam",value:function(e,t,n){var r=n[t.path.substring(1)];if(!r)throw new Error("Cannot redirect to '".concat(e,"'. Cannot find '").concat(t.path,"'."));return r}},{key:"findOrReturn",value:function(e,t){var n,r=0,a=s(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.path===e.path)return t.splice(r),i;r++}}catch(o){a.e(o)}finally{a.f()}return e}}]),e}();function _p(e){for(var t={},n=0,r=Object.keys(e.children);n<r.length;n++){var a=r[n],i=_p(e.children[a]);(i.segments.length>0||i.hasChildren())&&(t[a]=i)}return function(e){if(1===e.numberOfChildren&&e.children[jl]){var t=e.children[jl];return new ch(e.segments.concat(t.segments),t.children)}return e}(new ch(e.segments,t))}var Rp=function e(t){x(this,e),this.path=t,this.route=this.path[this.path.length-1]},Ap=function e(t,n){x(this,e),this.component=t,this.route=n};function Dp(e,t,n){var r=e._root;return Op(r,t?t._root:null,n,[r.value])}function Fp(e,t,n){var r=function(e){if(!e)return null;for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Op(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},i=Dh(t);return e.children.forEach(function(e){(function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},i=e.value,o=t?t.value:null,s=n?n.getContext(e.value.outlet):null;if(o&&i.routeConfig===o.routeConfig){var u=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!hh(e.url,t.url);case"pathParamsOrQueryParamsChange":return!hh(e.url,t.url)||!Zl(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Uh(e,t)||!Zl(e.queryParams,t.queryParams);case"paramsChange":default:return!Uh(e,t)}}(o,i,i.routeConfig.runGuardsAndResolvers);u?a.canActivateChecks.push(new Rp(r)):(i.data=o.data,i._resolvedData=o._resolvedData),Op(e,t,i.component?s?s.children:null:n,r,a),u&&s&&s.outlet&&s.outlet.isActivated&&a.canDeactivateChecks.push(new Ap(s.outlet.component,o))}else o&&Mp(t,s,a),a.canActivateChecks.push(new Rp(r)),Op(e,null,i.component?s?s.children:null:n,r,a)})(e,i[e.value.outlet],n,r.concat([e.value]),a),delete i[e.value.outlet]}),eh(i,function(e,t){return Mp(e,n.getContext(t),a)}),a}function Mp(e,t,n){var r=Dh(e),a=e.value;eh(r,function(e,r){Mp(e,a.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new Ap(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}var Lp=function e(){x(this,e)};function Pp(e){return new te(function(t){return t.error(e)})}var zp=function(){function e(t,n,r,a,i,o){x(this,e),this.rootComponentType=t,this.config=n,this.urlTree=r,this.url=a,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=o}return I(e,[{key:"recognize",value:function(){var e=bp(this.urlTree.root,[],[],this.config.filter(function(e){return void 0===e.redirectTo}),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,jl);if(null===t)return null;var n=new Ph([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},jl,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Ah(n,t),a=new zh(this.url,r);return this.inheritParamsAndData(a._root),a}},{key:"inheritParamsAndData",value:function(e){var t=this,n=e.value,r=Lh(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach(function(e){return t.inheritParamsAndData(e)})}},{key:"processSegmentGroup",value:function(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}},{key:"processChildren",value:function(e,t){for(var n=[],r=0,a=Object.keys(t.children);r<a.length;r++){var o=a[r],s=t.children[o],u=mp(e,o),c=this.processSegmentGroup(u,s,o);if(null===c)return null;n.push.apply(n,i(c))}var l=Bp(n);return function(e){e.sort(function(e,t){return e.value.outlet===jl?-1:t.value.outlet===jl?1:e.value.outlet.localeCompare(t.value.outlet)})}(l),l}},{key:"processSegment",value:function(e,t,n,r){var a,i=s(e);try{for(i.s();!(a=i.n()).done;){var o=a.value,u=this.processSegmentAgainstRoute(o,t,n,r);if(null!==u)return u}}catch(c){i.e(c)}finally{i.f()}return wp(t,n,r)?[]:null}},{key:"processSegmentAgainstRoute",value:function(e,t,n,r){if(e.redirectTo||!xp(e,t,n,r))return null;var a,i=[],o=[];if("**"===e.path){var s=n.length>0?$l(n).parameters:{};a=new Ph(n,s,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Up(e),vp(e),e.component,e,Vp(t),Wp(t)+n.length,Hp(e))}else{var u=yp(t,e,n);if(!u.matched)return null;i=u.consumedSegments,o=n.slice(u.lastChild),a=new Ph(i,u.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Up(e),vp(e),e.component,e,Vp(t),Wp(t)+i.length,Hp(e))}var c=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),l=bp(t,i,o,c.filter(function(e){return void 0===e.redirectTo}),this.relativeLinkResolution),h=l.segmentGroup,p=l.slicedSegments;if(0===p.length&&h.hasChildren()){var f=this.processChildren(c,h);return null===f?null:[new Ah(a,f)]}if(0===c.length&&0===p.length)return[new Ah(a,[])];var d=vp(e)===r,v=this.processSegment(c,h,p,d?jl:r);return null===v?null:[new Ah(a,v)]}}]),e}();function Bp(e){var t,n=[],r=new Set,a=s(e);try{var o=function(){var e,a=t.value;if(!function(e){var t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}(a))return n.push(a),"continue";var o=n.find(function(e){return a.value.routeConfig===e.value.routeConfig});void 0!==o?((e=o.children).push.apply(e,i(a.children)),r.add(o)):n.push(a)};for(a.s();!(t=a.n()).done;)o()}catch(p){a.e(p)}finally{a.f()}var u,c=s(r);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=Bp(l.children);n.push(new Ah(l.value,h))}}catch(p){c.e(p)}finally{c.f()}return n.filter(function(e){return!r.has(e)})}function Vp(e){for(var t=e;t._sourceSegment;)t=t._sourceSegment;return t}function Wp(e){for(var t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;t._sourceSegment;)n+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Up(e){return e.data||{}}function Hp(e){return e.resolve||{}}function jp(e){return Kc(function(t){var n=e(t);return n?ye(n).pipe(ce(function(){return t})):Oc(t)})}var Gp=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return n}(function(){function e(){x(this,e)}return I(e,[{key:"shouldDetach",value:function(e){return!1}},{key:"store",value:function(e,t){}},{key:"shouldAttach",value:function(e){return!1}},{key:"retrieve",value:function(e){return null}},{key:"shouldReuseRoute",value:function(e,t){return e.routeConfig===t.routeConfig}}]),e}()),qp=new ur("ROUTES"),Kp=function(){function e(t,n,r,a){x(this,e),this.loader=t,this.compiler=n,this.onLoadStartListener=r,this.onLoadEndListener=a}return I(e,[{key:"load",value:function(e,t){var n=this;if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);var r=this.loadModuleFactory(t.loadChildren).pipe(ce(function(r){n.onLoadEndListener&&n.onLoadEndListener(t);var a=r.create(e);return new ip(Ql(a.injector.get(qp,void 0,et.Self|et.Optional)).map(dp),a)}),ol(function(e){throw t._loader$=void 0,e}));return t._loader$=new Re(r,function(){return new oe}).pipe(Te()),t._loader$}},{key:"loadModuleFactory",value:function(e){var t=this;return"string"==typeof e?ye(this.loader.load(e)):th(e()).pipe(we(function(e){return e instanceof as?Oc(e):ye(t.compiler.compileModuleAsync(e))}))}}]),e}(),Xp=function e(){x(this,e),this.outlet=null,this.route=null,this.resolver=null,this.children=new Yp,this.attachRef=null},Yp=function(){function e(){x(this,e),this.contexts=new Map}return I(e,[{key:"onChildOutletCreated",value:function(e,t){var n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}},{key:"onChildOutletDestroyed",value:function(e){var t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}},{key:"onOutletDeactivated",value:function(){var e=this.contexts;return this.contexts=new Map,e}},{key:"onOutletReAttached",value:function(e){this.contexts=e}},{key:"getOrCreateContext",value:function(e){var t=this.getContext(e);return t||(t=new Xp,this.contexts.set(e,t)),t}},{key:"getContext",value:function(e){return this.contexts.get(e)||null}}]),e}(),Zp=function(){function e(){x(this,e)}return I(e,[{key:"shouldProcessUrl",value:function(e){return!0}},{key:"extract",value:function(e){return e}},{key:"merge",value:function(e,t){return e}}]),e}();function Jp(e){throw e}function Qp(e,t,n){return t.parse("/")}function $p(e,t){return Oc(null)}var ef={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},tf={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},nf=function(){var e=function(){function e(t,n,r,a,i,o,s,u){var c=this;x(this,e),this.rootComponentType=t,this.urlSerializer=n,this.rootContexts=r,this.location=a,this.config=u,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new oe,this.errorHandler=Jp,this.malformedUriErrorHandler=Qp,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:$p,afterPreactivation:$p},this.urlHandlingStrategy=new Zp,this.routeReuseStrategy=new Gp,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=i.get(rs),this.console=i.get(Hs);var l=i.get(nu);this.isNgZoneEnabled=l instanceof nu&&nu.isInAngularZone(),this.resetConfig(u),this.currentUrlTree=new uh(new ch([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Kp(o,s,function(e){return c.triggerEvent(new Pl(e))},function(e){return c.triggerEvent(new zl(e))}),this.routerState=Oh(this.currentUrlTree,this.rootComponentType),this.transitions=new Mc({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return I(e,[{key:"browserPageId",get:function(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}},{key:"setupNavigations",value:function(e){var t=this,n=this.events;return e.pipe(rl(function(e){return 0!==e.id}),ce(function(e){return Object.assign(Object.assign({},e),{extractedUrl:t.urlHandlingStrategy.extract(e.rawUrl)})}),Kc(function(e){var r=!1,a=!1;return Oc(e).pipe(wl(function(e){t.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:t.lastSuccessfulNavigation?Object.assign(Object.assign({},t.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Kc(function(e){var r=t.browserUrlTree.toString(),i=!t.navigated||e.extractedUrl.toString()!==r||r!==t.currentUrlTree.toString();if(("reload"===t.onSameUrlNavigation||i)&&t.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return rf(e.source)&&(t.browserUrlTree=e.extractedUrl),Oc(e).pipe(Kc(function(e){var r=t.transitions.getValue();return n.next(new El(e.id,t.serializeUrl(e.extractedUrl),e.source,e.restoredState)),r!==t.transitions.getValue()?jc:Promise.resolve(e)}),function(e,t,n,r){return Kc(function(a){return function(e,t,n,r,a){return new Ep(e,t,n,r,a).apply()}(e,t,n,a.extractedUrl,r).pipe(ce(function(e){return Object.assign(Object.assign({},a),{urlAfterRedirects:e})}))})}(t.ngModule.injector,t.configLoader,t.urlSerializer,t.config),wl(function(e){t.currentNavigation=Object.assign(Object.assign({},t.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,n,r,i,o){return we(function(r){return function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"emptyOnly",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"legacy";try{var s=new zp(e,t,n,r,i,o).recognize();return null===s?Pp(new Lp):Oc(s)}catch(a){return Pp(a)}}(e,n,r.urlAfterRedirects,(s=r.urlAfterRedirects,t.serializeUrl(s)),i,o).pipe(ce(function(e){return Object.assign(Object.assign({},r),{targetSnapshot:e})}));var s})}(t.rootComponentType,t.config,0,t.paramsInheritanceStrategy,t.relativeLinkResolution),wl(function(e){"eager"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(e.urlAfterRedirects,e),t.browserUrlTree=e.urlAfterRedirects);var r=new Dl(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);n.next(r)}));if(i&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){var o=e.id,s=e.extractedUrl,u=e.source,c=e.restoredState,l=e.extras,h=new El(o,t.serializeUrl(s),u,c);n.next(h);var p=Oh(s,t.rootComponentType).snapshot;return Oc(Object.assign(Object.assign({},e),{targetSnapshot:p,urlAfterRedirects:s,extras:Object.assign(Object.assign({},l),{skipLocationChange:!1,replaceUrl:!1})}))}return t.rawUrlTree=e.rawUrl,t.browserUrlTree=e.urlAfterRedirects,e.resolve(null),jc}),jp(function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.beforePreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})}),wl(function(e){var n=new Fl(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}),ce(function(e){return Object.assign(Object.assign({},e),{guards:Dp(e.targetSnapshot,e.currentSnapshot,t.rootContexts)})}),function(e,t){return we(function(n){var r=n.targetSnapshot,a=n.currentSnapshot,i=n.guards,o=i.canActivateChecks,s=i.canDeactivateChecks;return 0===s.length&&0===o.length?Oc(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ye(e).pipe(we(function(e){return function(e,t,n,r,a){var i=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return i&&0!==i.length?Oc(i.map(function(i){var o,s=Fp(i,t,a);if(function(e){return e&&op(e.canDeactivate)}(s))o=th(s.canDeactivate(e,t,n,r));else{if(!op(s))throw new Error("Invalid CanDeactivate guard");o=th(s(e,t,n,r))}return o.pipe(kl())})).pipe(cp()):Oc(!0)}(e.component,e.route,n,t,r)}),kl(function(e){return!0!==e},!0))}(s,r,a,e).pipe(we(function(n){return n&&function(e){return"boolean"==typeof e}(n)?function(e,t,n,r){return ye(t).pipe(cl(function(t){return Hc(function(e,t){return null!==e&&t&&t(new Bl(e)),Oc(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new Wl(e)),Oc(!0)}(t.route,r),function(e,t,n){var r=t[t.length-1],a=t.slice(0,t.length-1).reverse().map(function(e){return function(e){var t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)}).filter(function(e){return null!==e}).map(function(t){return qc(function(){return Oc(t.guards.map(function(a){var i,o=Fp(a,t.node,n);if(function(e){return e&&op(e.canActivateChild)}(o))i=th(o.canActivateChild(r,e));else{if(!op(o))throw new Error("Invalid CanActivateChild guard");i=th(o(r,e))}return i.pipe(kl())})).pipe(cp())})});return Oc(a).pipe(cp())}(e,t.path,n),function(e,t,n){var r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?Oc(r.map(function(r){return qc(function(){var a,i=Fp(r,t,n);if(function(e){return e&&op(e.canActivate)}(i))a=th(i.canActivate(t,e));else{if(!op(i))throw new Error("Invalid CanActivate guard");a=th(i(t,e))}return a.pipe(kl())})})).pipe(cp()):Oc(!0)}(e,t.route,n))}),kl(function(e){return!0!==e},!0))}(r,o,e,t):Oc(n)}),ce(function(e){return Object.assign(Object.assign({},n),{guardsResult:e})}))})}(t.ngModule.injector,function(e){return t.triggerEvent(e)}),wl(function(e){if(sp(e.guardsResult)){var n=Xl('Redirecting to "'.concat(t.serializeUrl(e.guardsResult),'"'));throw n.url=e.guardsResult,n}var r=new Ol(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);t.triggerEvent(r)}),rl(function(e){return!!e.guardsResult||(t.restoreHistory(e),t.cancelNavigationTransition(e,""),!1)}),jp(function(e){if(e.guards.canActivateChecks.length)return Oc(e).pipe(wl(function(e){var n=new Ml(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}),Kc(function(e){var n=!1;return Oc(e).pipe(function(e,t){return we(function(n){var r=n.targetSnapshot,a=n.guards.canActivateChecks;if(!a.length)return Oc(n);var i=0;return ye(a).pipe(cl(function(n){return function(e,t,n,r){return function(e,t,n,r){var a=Object.keys(e);if(0===a.length)return Oc({});var i={};return ye(a).pipe(we(function(a){return function(e,t,n,r){var a=Fp(e,t,r);return th(a.resolve?a.resolve(t,n):a(t,n))}(e[a],t,n,r).pipe(wl(function(e){i[a]=e}))}),ll(1),we(function(){return Object.keys(i).length===a.length?Oc(i):jc}))}(e._resolve,e,t,r).pipe(ce(function(t){return e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),Lh(e,n).resolve),null}))}(n.route,r,e,t)}),wl(function(){return i++}),ll(1),we(function(e){return i===a.length?Oc(n):jc}))})}(t.paramsInheritanceStrategy,t.ngModule.injector),wl({next:function(){return n=!0},complete:function(){n||(t.restoreHistory(e),t.cancelNavigationTransition(e,"At least one route resolver didn't emit any value."))}}))}),wl(function(e){var n=new Ll(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}))}),jp(function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.afterPreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})}),ce(function(e){var n=function(e,t,n){var r=Hh(e,t._root,n?n._root:void 0);return new Fh(r,t)}(t.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:n})}),wl(function(e){t.currentUrlTree=e.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(e.urlAfterRedirects,e.rawUrl),t.routerState=e.targetRouterState,"deferred"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,e),t.browserUrlTree=e.urlAfterRedirects)}),function(e,t,n){return ce(function(r){return new rp(t,r.targetRouterState,r.currentRouterState,n).activate(e),r})}(t.rootContexts,t.routeReuseStrategy,function(e){return t.triggerEvent(e)}),wl({next:function(){r=!0},complete:function(){r=!0}}),function(e){return function(t){return t.lift(new Sl(e))}}(function(){var n;if(!r&&!a){var i="Navigation ID ".concat(e.id," is not equal to the current navigation id ").concat(t.navigationId);"replace"===t.canceledNavigationResolution?(t.restoreHistory(e),t.cancelNavigationTransition(e,i)):t.cancelNavigationTransition(e,i)}(null===(n=t.currentNavigation)||void 0===n?void 0:n.id)===e.id&&(t.currentNavigation=null)}),ol(function(r){if(a=!0,function(e){return e&&e[Kl]}(r)){var i=sp(r.url);i||(t.navigated=!0,t.restoreHistory(e,!0));var o=new Rl(e.id,t.serializeUrl(e.extractedUrl),r.message);n.next(o),i?setTimeout(function(){var n=t.urlHandlingStrategy.merge(r.url,t.rawUrlTree),a={skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||rf(e.source)};t.scheduleNavigation(n,"imperative",null,a,{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{t.restoreHistory(e,!0);var s=new Al(e.id,t.serializeUrl(e.extractedUrl),r);n.next(s);try{e.resolve(t.errorHandler(r))}catch(o){e.reject(o)}}return jc}))}))}},{key:"resetRootComponentType",value:function(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}},{key:"getTransition",value:function(){var e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}},{key:"setTransition",value:function(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}},{key:"initialNavigation",value:function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}},{key:"setUpLocationChangeListener",value:function(){var e=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(function(t){var n=e.extractLocationChangeInfoFromEvent(t);e.shouldScheduleNavigation(e.lastLocationChangeInfo,n)&&setTimeout(function(){var t=n.source,r=n.state,a=n.urlTree,i={replaceUrl:!0};if(r){var o=Object.assign({},r);delete o.navigationId,delete o.\u0275routerPageId,0!==Object.keys(o).length&&(i.state=o)}e.scheduleNavigation(a,t,r,i)},0),e.lastLocationChangeInfo=n}))}},{key:"extractLocationChangeInfoFromEvent",value:function(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}},{key:"shouldScheduleNavigation",value:function(e,t){if(!e)return!0;var n=t.urlTree.toString()===e.urlTree.toString();return t.transitionId!==e.transitionId||!n||!("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source)}},{key:"url",get:function(){return this.serializeUrl(this.currentUrlTree)}},{key:"getCurrentNavigation",value:function(){return this.currentNavigation}},{key:"triggerEvent",value:function(e){this.events.next(e)}},{key:"resetConfig",value:function(e){hp(e),this.config=e.map(dp),this.navigated=!1,this.lastSuccessfulId=-1}},{key:"ngOnDestroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}},{key:"createUrlTree",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.relativeTo,r=t.queryParams,a=t.fragment,o=t.queryParamsHandling,s=t.preserveFragment,u=n||this.routerState.root,c=s?this.currentUrlTree.fragment:a,l=null;switch(o){case"merge":l=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,a){if(0===n.length)return Kh(t.root,t.root,t,r,a);var o=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Yh(!0,0,e);var t=0,n=!1,r=e.reduce(function(e,r,a){if("object"==typeof r&&null!=r){if(r.outlets){var o={};return eh(r.outlets,function(e,t){o[t]="string"==typeof e?e.split("/"):e}),[].concat(i(e),[{outlets:o}])}if(r.segmentPath)return[].concat(i(e),[r.segmentPath])}return"string"!=typeof r?[].concat(i(e),[r]):0===a?(r.split("/").forEach(function(r,a){0==a&&"."===r||(0==a&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[].concat(i(e),[r])},[]);return new Yh(n,t,r)}(n);if(o.toRoot())return Kh(t.root,new ch([],{}),t,r,a);var s=function(e,t,n){if(e.isAbsolute)return new Zh(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){var r=n.snapshot._urlSegment;return new Zh(r,r===t.root,0)}var a=Gh(e.commands[0])?0:1;return function(e,t,n){for(var r=e,a=t,i=n;i>a;){if(i-=a,!(r=r.parent))throw new Error("Invalid number of '../'");a=r.segments.length}return new Zh(r,!1,a-i)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+a,e.numberOfDoubleDots)}(o,t,e),u=s.processChildren?Qh(s.segmentGroup,s.index,o.commands):Jh(s.segmentGroup,s.index,o.commands);return Kh(s.segmentGroup,u,t,r,a)}(u,this.currentUrlTree,e,l,null!=c?c:null)}},{key:"navigateByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1},n=sp(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}},{key:"navigate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};return function(e){for(var t=0;t<e.length;t++){var n=e[t];if(null==n)throw new Error("The requested path contains ".concat(n," segment at index ").concat(t))}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}},{key:"serializeUrl",value:function(e){return this.urlSerializer.serialize(e)}},{key:"parseUrl",value:function(e){var t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}},{key:"isActive",value:function(e,t){var n;if(n=!0===t?Object.assign({},ef):!1===t?Object.assign({},tf):t,sp(e))return ah(this.currentUrlTree,e,n);var r=this.parseUrl(e);return ah(this.currentUrlTree,r,n)}},{key:"removeEmptyProps",value:function(e){return Object.keys(e).reduce(function(t,n){var r=e[n];return null!=r&&(t[n]=r),t},{})}},{key:"processNavigations",value:function(){var e=this;this.navigations.subscribe(function(t){e.navigated=!0,e.lastSuccessfulId=t.id,e.currentPageId=t.targetPageId,e.events.next(new _l(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(e.currentUrlTree))),e.lastSuccessfulNavigation=e.currentNavigation,t.resolve(!0)},function(t){e.console.warn("Unhandled Navigation Error: ".concat(t))})}},{key:"scheduleNavigation",value:function(e,t,n,r,a){var i,o;if(this.disposed)return Promise.resolve(!1);var s,u,c,l=this.getTransition(),h=rf(t)&&l&&!rf(l.source),p=(this.lastSuccessfulId===l.id||this.currentNavigation?l.rawUrl:l.urlAfterRedirects).toString()===e.toString();if(h&&p)return Promise.resolve(!0);a?(s=a.resolve,u=a.reject,c=a.promise):c=new Promise(function(e,t){s=e,u=t});var f,d=++this.navigationId;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),f=n&&n.\u0275routerPageId?n.\u0275routerPageId:r.replaceUrl||r.skipLocationChange?null!==(i=this.browserPageId)&&void 0!==i?i:0:(null!==(o=this.browserPageId)&&void 0!==o?o:0)+1):f=0,this.setTransition({id:d,targetPageId:f,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(function(e){return Promise.reject(e)})}},{key:"setBrowserUrl",value:function(e,t){var n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}},{key:"restoreHistory",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("computed"===this.canceledNavigationResolution){var a=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(t=this.currentNavigation)||void 0===t?void 0:t.finalUrl)||0===a?this.currentUrlTree===(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)&&0===a&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(a)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}},{key:"resetState",value:function(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}},{key:"resetUrlToCurrentUrlTree",value:function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}},{key:"cancelNavigationTransition",value:function(e,t){var n=new Rl(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}},{key:"generateNgRouterState",value:function(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(lr),Nr(ph),Nr(Yp),Nr(Xu),Nr(Xi),Nr(Iu),Nr($s),Nr(void 0))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}();function rf(e){return"imperative"!==e}var af=function(){var e=function(){function e(t,n,r,a,i){x(this,e),this.parentContexts=t,this.location=n,this.resolver=r,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new xs,this.deactivateEvents=new xs,this.name=a||jl,t.onChildOutletCreated(this.name,this)}return I(e,[{key:"ngOnDestroy",value:function(){this.parentContexts.onChildOutletDestroyed(this.name)}},{key:"ngOnInit",value:function(){if(!this.activated){var e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}},{key:"isActivated",get:function(){return!!this.activated}},{key:"component",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}},{key:"activatedRoute",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}},{key:"activatedRouteData",get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}},{key:"detach",value:function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var e=this.activated;return this.activated=null,this._activatedRoute=null,e}},{key:"attach",value:function(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}},{key:"deactivate",value:function(){if(this.activated){var e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}},{key:"activateWith",value:function(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;var n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,a=new of(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,a),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(eo(Yp),eo(os),eo(wo),function(e,t){var n=e.attrs;if(n)for(var r=n.length,a=0;a<r;){var i=n[a];if(On(i))break;if(0===i)a+=2;else if("number"==typeof i)for(a++;a<r&&"string"==typeof n[a];)a++;else{if(i===t)return n[a+1];a+=2}}return null}(on(),"name"),eo(Yo))},e.\u0275dir=Ct({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e}(),of=function(){function e(t,n,r){x(this,e),this.route=t,this.childContexts=n,this.parent=r}return I(e,[{key:"get",value:function(e,t){return e===Mh?this.route:e===Yp?this.childContexts:this.parent.get(e,t)}}]),e}(),sf=function e(){x(this,e)},uf=function(){function e(){x(this,e)}return I(e,[{key:"preload",value:function(e,t){return Oc(null)}}]),e}(),cf=function(){var e=function(){function e(t,n,r,a,i){x(this,e),this.router=t,this.injector=a,this.preloadingStrategy=i,this.loader=new Kp(n,r,function(e){return t.triggerEvent(new Pl(e))},function(e){return t.triggerEvent(new zl(e))})}return I(e,[{key:"setUpPreloading",value:function(){var e=this;this.subscription=this.router.events.pipe(rl(function(e){return e instanceof _l}),cl(function(){return e.preload()})).subscribe(function(){})}},{key:"preload",value:function(){var e=this.injector.get(rs);return this.processRoutes(e,this.router.config)}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"processRoutes",value:function(e,t){var n,r=[],a=s(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.loadChildren&&!i.canLoad&&i._loadedConfig){var o=i._loadedConfig;r.push(this.processRoutes(o.module,o.routes))}else i.loadChildren&&!i.canLoad?r.push(this.preloadConfig(e,i)):i.children&&r.push(this.processRoutes(e,i.children))}}catch(u){a.e(u)}finally{a.f()}return ye(r).pipe(Se(),ce(function(e){}))}},{key:"preloadConfig",value:function(e,t){var n=this;return this.preloadingStrategy.preload(t,function(){return(t._loadedConfig?Oc(t._loadedConfig):n.loader.load(e.injector,t)).pipe(we(function(e){return t._loadedConfig=e,n.processRoutes(e.module,e.routes)}))})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(nf),Nr(Iu),Nr($s),Nr(Xi),Nr(sf))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),lf=function(){var e=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};x(this,e),this.router=t,this.viewportScroller=n,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}return I(e,[{key:"init",value:function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}},{key:"createScrollEvents",value:function(){var e=this;return this.router.events.subscribe(function(t){t instanceof El?(e.store[e.lastId]=e.viewportScroller.getScrollPosition(),e.lastSource=t.navigationTrigger,e.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof _l&&(e.lastId=t.id,e.scheduleScrollEvent(t,e.router.parseUrl(t.urlAfterRedirects).fragment))})}},{key:"consumeScrollEvents",value:function(){var e=this;return this.router.events.subscribe(function(t){t instanceof Hl&&(t.position?"top"===e.options.scrollPositionRestoration?e.viewportScroller.scrollToPosition([0,0]):"enabled"===e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===e.options.anchorScrolling?e.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition([0,0]))})}},{key:"scheduleScrollEvent",value:function(e,t){this.router.triggerEvent(new Hl(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}},{key:"ngOnDestroy",value:function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(nf),Nr(tc),Nr(void 0))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}(),hf=new ur("ROUTER_CONFIGURATION"),pf=new ur("ROUTER_FORROOT_GUARD"),ff=[Xu,{provide:ph,useClass:fh},{provide:nf,useFactory:function(e,t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,l=new nf(null,e,t,n,r,a,i,Ql(o));return u&&(l.urlHandlingStrategy=u),c&&(l.routeReuseStrategy=c),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(s,l),s.enableTracing&&l.events.subscribe(function(e){var t,n;null===(t=console.group)||void 0===t||t.call(console,"Router Event: ".concat(e.constructor.name)),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),l},deps:[ph,Yp,Xu,Xi,Iu,$s,qp,hf,[function(){return function e(){x(this,e)}}(),new Dr],[function(){return function e(){x(this,e)}}(),new Dr]]},Yp,{provide:Mh,useFactory:function(e){return e.routerState.root},deps:[nf]},{provide:Iu,useClass:Cu},cf,uf,function(){function e(){x(this,e)}return I(e,[{key:"preload",value:function(e,t){return t().pipe(ol(function(){return Oc(null)}))}}]),e}(),{provide:hf,useValue:{enableTracing:!1}}];function df(){return new mu("Router",nf)}var vf=function(){var e=function(){function e(t,n){x(this,e)}return I(e,null,[{key:"forRoot",value:function(t,n){return{ngModule:e,providers:[ff,bf(t),{provide:pf,useFactory:yf,deps:[[nf,new Dr,new Fr]]},{provide:hf,useValue:n||{}},{provide:Hu,useFactory:gf,deps:[Ou,[new Ar(Gu),new Dr],hf]},{provide:lf,useFactory:mf,deps:[nf,tc,hf]},{provide:sf,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:uf},{provide:mu,multi:!0,useFactory:df},[kf,{provide:Ms,multi:!0,useFactory:xf,deps:[kf]},{provide:If,useFactory:wf,deps:[kf]},{provide:Us,multi:!0,useExisting:If}]]}}},{key:"forChild",value:function(t){return{ngModule:e,providers:[bf(t)]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(pf,8),Nr(nf,8))},e.\u0275mod=Nt({type:e}),e.\u0275inj=Ge({}),e}();function mf(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new lf(e,t,n)}function gf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.useHash?new Ku(e,t):new qu(e,t)}function yf(e){return"guarded"}function bf(e){return[{provide:cr,multi:!0,useValue:e},{provide:qp,multi:!0,useValue:e}]}var kf=function(){var e=function(){function e(t){x(this,e),this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new oe}return I(e,[{key:"appInitializer",value:function(){var e=this;return this.injector.get(Lu,Promise.resolve(null)).then(function(){if(e.destroyed)return Promise.resolve(!0);var t=null,n=new Promise(function(e){return t=e}),r=e.injector.get(nf),a=e.injector.get(hf);return"disabled"===a.initialNavigation?(r.setUpLocationChangeListener(),t(!0)):"enabled"===a.initialNavigation||"enabledBlocking"===a.initialNavigation?(r.hooks.afterPreactivation=function(){return e.initNavigation?Oc(null):(e.initNavigation=!0,t(!0),e.resultOfPreactivationDone)},r.initialNavigation()):t(!0),n})}},{key:"bootstrapListener",value:function(e){var t=this.injector.get(hf),n=this.injector.get(cf),r=this.injector.get(lf),a=this.injector.get(nf),i=this.injector.get(xu);e===i.components[0]&&(("enabledNonBlocking"===t.initialNavigation||void 0===t.initialNavigation)&&a.initialNavigation(),n.setUpPreloading(),r.init(),a.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}},{key:"ngOnDestroy",value:function(){this.destroyed=!0}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Nr(Xi))},e.\u0275prov=je({token:e,factory:e.\u0275fac}),e}();function xf(e){return e.appInitializer.bind(e)}function wf(e){return e.bootstrapListener.bind(e)}var If=new ur("Router Initializer");function Nf(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function Sf(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){Nf(i,r,a,o,s,"next",e)}function s(e){Nf(i,r,a,o,s,"throw",e)}o(void 0)})}}var Cf=function(){function e(t,n){x(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return I(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),Tf=function(){function e(){x(this,e)}return I(e,[{key:"refCount",value:function(e){return Ef("refCount")}},{key:"incRef",value:function(e){return Ef("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return Ef("time")}},{key:"read",value:function(e){return Ef("read")}},{key:"readSync",value:function(e){return Ef("readSync")}},{key:"numDataIds",value:function(){return Ef("numDataIds")}},{key:"disposeData",value:function(e,t){return Ef("disposeData")}},{key:"write",value:function(e,t,n){return Ef("write")}},{key:"move",value:function(e,t,n,r,a){return Ef("move")}},{key:"memory",value:function(){return Ef("memory")}},{key:"floatPrecision",value:function(){return Ef("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return Ef("dispose")}}]),e}();function Ef(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function _f(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function Rf(e,t,n){return Math.max(e,Math.min(t,n))}function Af(e){return e%2==0?e:e+1}function Df(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Ff(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Df(Pf(e,t),function(){return n+" Shapes ".concat(e," and ").concat(t," must match")})}function Of(e){Df(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function Mf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||Xf(e)&&!n)for(var r=0;r<e.length;++r)Mf(e[r],t,n);else t.push(e);return t}function Lf(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Pf(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function zf(e){return e%1==0}function Bf(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Vf(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Wf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise(function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()})}function Uf(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function Hf(e,t){var n=t.length;return Df((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)}),Df(e.every(function(e){return zf(e)}),function(){return"All values in axis param must be integers but got axis ".concat(e)}),e.map(function(e){return e<0?n+e:e})}function jf(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:Hf(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Gf(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function qf(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Kf(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Xf(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Yf(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Zf(e){return"string"==typeof e||e instanceof String}function Jf(e){return"number"==typeof e}function Qf(e){return Array.isArray(e)?Qf(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Jf(e)?"float32":Zf(e)?"string":function(e){return"boolean"==typeof e}(e)?"bool":"float32"}function $f(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ed(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function td(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function nd(e,t,n){var r=new Array;if(1===t.length)for(var a=t[0],i=0;i<a;i++)r[i]=n[e+i];else for(var o=t[0],s=t.slice(1),u=s.reduce(function(e,t){return e*t}),c=0;c<o;c++)r[c]=nd(e+c*u,s,n);return r}function rd(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return nd(0,e,t)}function ad(e,t){for(var n=id(e,t),r=0;r<n.length;r++)n[r]=1;return n}function id(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function od(e,t){var n=e.reduce(function(e,t){return e*t},1);if(null==t||"float32"===t)return rd(e,new Float32Array(n));if("int32"===t)return rd(e,new Int32Array(n));if("bool"===t)return rd(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function sd(e){e.forEach(function(t){Df(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")})})}function ud(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function cd(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function ld(e){return e&&e.then&&"function"==typeof e.then}var hd="tfjsflags",pd=function(){function e(t){x(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return I(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e in t.flags,n.t0){n.next=5;break}return n.next=4,t.evaluateFlag(e);case 4:t.flags[e]=n.sent;case 5:return n.abrupt("return",t.flags[e]);case 6:case"end":return n.stop()}},n)}))()}},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(ld(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")}),t}(this.global.location.search);hd in t&&t[hd].split(",").forEach(function(t){var r=n(t.split(":"),2),a=r[0],i=r[1];e.urlFlags[a]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(a,i)})}}}]),e}();function fd(){return vd}var dd,vd=null;function md(){if(null==dd){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}dd=e}return dd}function gd(e,t){var n=function(){var e=md();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var yd="Abs",bd="Acos",kd="Acosh",xd="Add",wd="AddN",Id="ArgMax",Nd="ArgMin",Sd="Asin",Cd="Asinh",Td="Atan",Ed="Atanh",_d="Atan2",Rd="AvgPool",Ad="AvgPoolGrad",Dd="AvgPool3D",Fd="AvgPool3DGrad",Od="BatchMatMul",Md="BatchToSpaceND",Ld="Bincount",Pd="Cast",zd="Ceil",Bd="ClipByValue",Vd="Complex",Wd="ComplexAbs",Ud="Concat",Hd="Conv2D",jd="Conv2DBackpropFilter",Gd="Conv2DBackpropInput",qd="Conv3D",Kd="Conv3DBackpropFilterV2",Xd="Conv3DBackpropInputV2",Yd="Cos",Zd="Cosh",Jd="Cumsum",Qd="CropAndResize",$d="DenseBincount",ev="DepthToSpace",tv="DepthwiseConv2dNative",nv="DepthwiseConv2dNativeBackpropFilter",rv="DepthwiseConv2dNativeBackpropInput",av="Dilation2D",iv="Dilation2DBackpropInput",ov="Dilation2DBackpropFilter",sv="RealDiv",uv="Elu",cv="EluGrad",lv="Erf",hv="Equal",pv="Exp",fv="ExpandDims",dv="Expm1",vv="Fill",mv="FlipLeftRight",gv="Floor",yv="FloorDiv",bv="FusedBatchNorm",kv="GatherV2",xv="GatherNd",wv="Greater",Iv="GreaterEqual",Nv="Identity",Sv="IFFT",Cv="Imag",Tv="IsFinite",Ev="IsInf",_v="IsNan",Rv="LeakyRelu",Av="Less",Dv="LessEqual",Fv="LinSpace",Ov="Log",Mv="Log1p",Lv="LogicalAnd",Pv="LogicalNot",zv="LogicalOr",Bv="LRN",Vv="LRNGrad",Wv="Max",Uv="Maximum",Hv="MaxPool",jv="MaxPoolGrad",Gv="MaxPool3D",qv="MaxPool3DGrad",Kv="MaxPoolWithArgmax",Xv="Mean",Yv="Min",Zv="Minimum",Jv="MirrorPad",Qv="Mod",$v="Multinomial",em="Multiply",tm="Neg",nm="NotEqual",rm="NonMaxSuppressionV3",am="NonMaxSuppressionV4",im="NonMaxSuppressionV5",om="OnesLike",sm="OneHot",um="Pack",cm="PadV2",lm="Pow",hm="Prelu",pm="Prod",fm="Range",dm="Real",vm="Reciprocal",mm="Relu",gm="Reshape",ym="ResizeNearestNeighbor",bm="ResizeNearestNeighborGrad",km="ResizeBilinear",xm="ResizeBilinearGrad",wm="Relu6",Im="Reverse",Nm="Round",Sm="Rsqrt",Cm="ScatterNd",Tm="Select",Em="Selu",_m="Slice",Rm="Sin",Am="Sinh",Dm="Sign",Fm="Sigmoid",Om="Softplus",Mm="Sqrt",Lm="Sum",Pm="SpaceToBatchND",zm="SplitV",Bm="Softmax",Vm="SquaredDifference",Wm="Square",Um="Sub",Hm="SparseToDense",jm="StridedSlice",Gm="Tan",qm="Tanh",Km="Tile",Xm="TopK",Ym="Transform",Zm="Transpose",Jm="Unique",Qm="Unpack",$m="UnsortedSegmentSum",eg="ZerosLike",tg="Step",ng="FromPixels",rg="RotateWithOffset",ag="_FusedMatMul",ig="FusedConv2D",og="FusedDepthwiseConv2D",sg=gd("kernelRegistry",function(){return new Map}),ug=gd("gradRegistry",function(){return new Map});function cg(e,t){var n=dg(e,t);return sg.get(n)}function lg(e){return ug.get(e)}function hg(e){for(var t=sg.entries(),r=[];;){var a=t.next(),i=a.done,o=a.value;if(i)break;var s=n(o,2),u=s[0],c=s[1];n(u.split("_"),1)[0]===e&&r.push(c)}return r}function pg(e){var t=e.kernelName,n=e.backendName,r=dg(t,n);sg.has(r)&&console.warn("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),sg.set(r,e)}function fg(e){var t=e.kernelName;ug.has(t)&&fd().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),ug.set(t,e)}function dg(e,t){return"".concat(t,"_").concat(e)}function vg(e,t){return"string"===t?yg(e):mg([e],t)}function mg(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Mf(e)),fd().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function gg(){return fd().platform.now()}function yg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",fd().platform.encode(e,t)}function bg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",fd().platform.decode(e,t)}var kg=function(){function e(t,n){x(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new xg)}return I(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=gg();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var u,c=s(r);try{for(c.s();!(u=c.n()).done;){u.value.dataSync()}}catch(p){c.e(p)}finally{c.f()}a=Promise.resolve({kernelMs:gg()-o})}if(fd().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var l=function(t){var n=r[t];n.data().then(function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)})},h=0;h<r.length;h++)l(h);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then(function(e){return e.kernelMs}),extraInfo:a.then(function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""})}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach(function(e){Promise.all([e.data(),a,o]).then(function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])})})}}]),e}();var xg=function(){function e(){x(this,e)}return I(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?Vf("".concat(r,"ms"),9):r.error,s=Vf(e,25),u=t.rank,c=t.size,l=Vf(t.shape.toString(),14),h="";for(var p in a){var f=a[p];if(null!=f){var d=f.shape||t.shape,v=d.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?d:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function wg(e,t,n,r){var a=td(t),i=function(e,t,n,r){var a=Lf(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?Cg(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],Ig(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=Sg(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}function Ig(e,t,n){return Vf(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ").concat(parseFloat(e[1].toFixed(7)),"j"):Zf(e)?"'".concat(e,"'"):"bool"===n?Ng(e):parseFloat(e.toFixed(7)).toString(),t)}function Ng(e){return 0===e?"false":"true"}function Sg(e,t,n,r,a){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===n?2:1,u=t[0],c=t.length;if(0===c)return"complex64"===n?[Ig(Cg(e)[0],0,n)]:"bool"===n?[Ng(e[0])]:[e[0].toString()];if(1===c){if(u>20){var l=Array.from(e.slice(0,3*s)),h=Array.from(e.slice((u-3)*s,u*s));return"complex64"===n&&(l=Cg(l),h=Cg(h)),["["+l.map(function(e,t){return Ig(e,a[t],n)}).join(", ")+", ..., "+h.map(function(e,t){return Ig(e,a[u-3+t],n)}).join(", ")+"]"]}return["["+("complex64"===n?Cg(e):Array.from(e)).map(function(e,t){return Ig(e,a[t],n)}).join(", ")+"]"]}var p=t.slice(1),f=r.slice(1),d=r[0]*s,v=[];if(u>20){for(var m=0;m<3;m++){var g=m*d;v.push.apply(v,i(Sg(e.slice(g,g+d),p,n,f,a,!1)))}v.push("...");for(var y=u-3;y<u;y++){var b=y*d;v.push.apply(v,i(Sg(e.slice(b,b+d),p,n,f,a,y===u-1)))}}else for(var k=0;k<u;k++){var x=k*d;v.push.apply(v,i(Sg(e.slice(x,x+d),p,n,f,a,k===u-1)))}var w=2===c?",":"";v[0]="["+v[0]+w;for(var I=1;I<v.length-1;I++)v[I]=" "+v[I]+w;for(var N=",\n",S=2;S<c;S++)N+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(o?"":N),v}function Cg(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Tg=function(){function e(t,n,r){var a=this;if(x(this,e),this.dtype=n,this.shape=t.slice(),this.size=Lf(t),null!=r){var i=r.length;Df(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")})}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||qf(n,this.size),this.strides=td(t)}return I(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),Df(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r])throw new Error("Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape));r++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return Eg().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),Eg=null,_g=null,Rg=function(){function e(t,n,r,a){x(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=Lf(t),this.strides=td(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return I(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.data();case 2:return n=t.sent,t.abrupt("return",_g.buffer(e.shape,e.dtype,n));case 4:case"end":return t.stop()}},t)}))()}},{key:"bufferSync",value:function(){return _g.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.data();case 2:return n=t.sent,t.abrupt("return",rd(e.shape,n));case 4:case"end":return t.stop()}},t)}))()}},{key:"arraySync",value:function(){return rd(this.shape,this.dataSync())}},{key:"data",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.throwIfDisposed(),n=Eg().read(e.dataId),"string"!==e.dtype){t.next=13;break}return t.next=5,n;case 5:return r=t.sent,t.prev=6,t.abrupt("return",r.map(function(e){return bg(e)}));case 10:throw t.prev=10,t.t0=t.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return t.abrupt("return",n);case 14:case"end":return t.stop()}},t,null,[[6,10]])}))()}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=Eg().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return bg(e)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.throwIfDisposed(),t.next=3,Eg().read(e.dataId);case 3:return n=t.sent,t.abrupt("return","string"===e.dtype?n:new Uint8Array(n.buffer));case 5:case"end":return t.stop()}},t)}))()}},{key:"dispose",value:function(){this.isDisposed||(Eg().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _g.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),_g.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return wg(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),_g.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Eg().makeVariable(this,e,t,n)}}]),e}();function Ag(){return gd("Tensor",function(){return Rg})}Object.defineProperty(Rg,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),Ag();var Dg=function(e){d(n,e);var t=m(n);function n(e,r,a,i){var o;return x(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return I(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!Pf(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));Eg().disposeTensor(this),this.dataId=e.dataId,Eg().incRef(this,null)}},{key:"dispose",value:function(){Eg().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(Rg);Object.defineProperty(Dg,Symbol.hasInstance,{value:function(e){return e instanceof Rg&&null!=e.assign&&e.assign instanceof Function}});var Fg=(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Fg||(Fg={})),Fg),Og=(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Og||(Og={})),Og),Mg=(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Mg||(Mg={})),Mg),Lg=(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Lg||(Lg={})),Lg),Pg={float32:Mg,int32:Fg,bool:Og,complex64:Lg};function zg(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Pg[e][t]}function Bg(e){return zg(e,"int32")}function Vg(e,t){if(e.dtype===t.dtype)return[e,t];var n=zg(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Wg(e){var t=[];return Ug(e,t,new Set),t}function Ug(e,t,n){if(null!=e)if(e instanceof Rg)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var a in r){var i=r[a];n.has(i)||(n.add(i),Ug(i,t,n))}}}function Hg(e){return null!=e.kernelName}var jg=function(){function e(){x(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return I(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Gg=function(){var e=function(){function e(t){x(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new jg}return I(e,[{key:"ready",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n,r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e.pendingBackendInit){t.next=2;break}return t.abrupt("return",e.pendingBackendInit.then(function(){}));case 2:if(null==e.backendInstance){t.next=4;break}return t.abrupt("return");case 4:n=e.getSortedBackends(),r=0;case 6:if(!(r<n.length)){t.next=17;break}return a=n[r],t.next=10,e.initializeBackend(a).success;case 10:if(!t.sent){t.next=14;break}return t.next=13,e.setBackend(a);case 13:return t.abrupt("return",void t.sent);case 14:r++,t.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return t.stop()}},t)}))()}},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t.registryFactory[e]){n.next=2;break}throw new Error("Backend name '".concat(e,"' not found in registry"));case 2:if(t.backendName=e,null!=t.registry[e]){n.next=14;break}if(t.backendInstance=null,r=t.initializeBackend(e),a=r.success,!r.asyncInit){n.next=11;break}return n.next=8,a;case 8:n.t0=n.sent,n.next=12;break;case 11:n.t0=a;case 12:if(n.t0){n.next=14;break}return n.abrupt("return",!1);case 14:return n.abrupt("return",(t.backendInstance=t.registry[e],t.setupRegisteredKernels(),t.profiler=new kg(t.backendInstance),!0));case 15:case"end":return n.stop()}},n)}))()}},{key:"setupRegisteredKernels",value:function(){var e=this;hg(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})}},{key:"disposeRegisteredKernels",value:function(e){var t=this;hg(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof Tf||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then(function(n){return!(a<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))}).catch(function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(r){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(r.stack||r.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(r){throw t(),r}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Kg.runKernel(Nv,{x:e});return this.addTapeNode(this.state.activeScope.name,{x:e},[t],function(e){return{x:function(){return Kg.runKernel(Pd,{x:e},{dtype:"float32"})}}},[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==cg(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach(function(e){a+="complex64"===e.dtype?3:1});var i=r-t-a-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(i>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(i," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var c=Hg(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Hg(e)){var l=e.kernelName,h=e.inputs,p=e.attrs,f=cg(l,this.backendName);Df(null!=f,function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")}),n=function(){var e=a.backend.numDataIds();r=f.kernelFunc({inputs:h,attrs:p,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map(function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return a.makeTensorFromDataId(t,n,r)});if(o){var s=a.getTensorsForGradient(l,h,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var d=e.forwardFunc,v=function(e){!o||(i=e.map(function(e){return a.keep(a.clone(e))}))};n=function(){var e=a.backend.numDataIds();r=a.tidy(function(){return d(a.backend,v)});var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var m,g=e.inputs,y=e.attrs,b=Hg(e)?null:e.backwardsFunc;return this.scopedRun(function(){return a.state.kernelDepth++},function(){return a.state.kernelDepth--},function(){a.ENV.getBool("DEBUG")||a.state.profiling?(m=a.profiler.profileKernel(c,g,function(){return n()}),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(m),t=m.outputs):t=n()}),o&&this.addTapeNode(c,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(e){return null!=g[e]?g[e].shape:null}),outputShapes:t.map(function(e){return e.shape}),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map(function(e){return t.keep(t.clone(e))})}},{key:"getTensorsForGradient",value:function(e,t,n){var r=lg(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(Df(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),a=Object.keys(t).map(function(e){return t[e]})):a=i.map(function(e){return t[e]});var s=n.filter(function(e,t){return o[t]});return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var a=e;"string"===(n=n||"float32")&&Zf(e[0])&&(a=e.map(function(e){return yg(e)}));var i=r.write(a,t,n),o=new Rg(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new Rg(t,n=n||"float32",e,this.nextTensorId());return this.trackTensor(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Dg(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Yf(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Dg||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*Yf(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,o,u,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.state.profiling=!0,r=t.state.numBytes,a=t.state.numTensors,t.state.activeProfile.kernels=[],n.next=5,e();case 5:t.state.activeProfile.result=n.sent,t.state.profiling=!1,t.state.activeProfile.peakBytes=Math.max.apply(Math,i(t.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot}))),t.state.activeProfile.newBytes=t.state.numBytes-r,t.state.activeProfile.newTensors=t.state.numTensors-a,o=s(t.state.activeProfile.kernels),n.prev=11,o.s();case 13:if((u=o.n()).done){n.next=23;break}return c=u.value,n.next=17,c.kernelTimeMs;case 17:return c.kernelTimeMs=n.sent,n.next=20,c.extraInfo;case 20:c.extraInfo=n.sent;case 21:n.next=13;break;case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(11),o.e(n.t0);case 28:return n.prev=28,o.f(),n.finish(28);case 31:return n.abrupt("return",t.state.activeProfile);case 32:case"end":return n.stop()}},n,null,[[11,25,28,31]])}))()}},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=lg(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],a=id(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Wg(e),r=new Set(n.map(function(e){return e.id})),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){!e.kept&&e.scopeId===o.id&&t.track(e)})}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Df(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun(function(){return r.startTape()},function(){return r.endTape()},function(){return r.tidy("forward",e)});Df(i instanceof Rg,function(){return"The result y returned by f() must be a tensor."});var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,p=0;p<t.length;p++)if(r[l.id]){s.outputs.forEach(function(e){return r[e.id]=!0}),h=!0,a[s.id]=!0;break}if(h)break}}var f={};f[n.id]=!0;for(var d={},v=e.length-1;v>=0;v--)for(var m=e[v],g=m.inputs,y=0;y<m.outputs.length;y++)if(f[m.outputs[y].id]){for(var b in g)f[g[b].id]=!0,d[m.id]=!0;break}for(var k=[],x=0;x<e.length;x++){var w=e[x];if(a[w.id]&&d[w.id]){var I={};for(var N in w.inputs){var S=w.inputs[N];r[S.id]&&(I[N]=S)}var C=Object.assign({},w);C.inputs=I,C.outputs=w.outputs,k.push(C)}}return k}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e={};e[i.id]=null==n?function(e){var t=ad(Lf(e),"float32");return Kg.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,a){for(var i=function(n){var i=t[n],o=[];if(i.outputs.forEach(function(t){var n=e[t.id];o.push(null!=n?n:null)}),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var n=function(e){return r.tidy(e)}(function(){return s[t]()});if("float32"!==n.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(n.dtype,"'"));var o=i.inputs[t];if(!Pf(n.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(n.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=n;else{var u=e[o.id];e[o.id]=a(u,n),u.dispose()}};for(var c in i.inputs)u(c)},o=t.length-1;o>=0;o--)i(o)}(e,o,0,Xg);var a=t.map(function(t){return e[t.id]});return 0===r.state.gradientDepth&&(r.state.activeTape.forEach(function(e){var t,n=s(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}}),r.state.activeTape=null),{value:i,grads:a}})}},{key:"customGrad",value:function(e){var t=this;return Df($f(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;Df(r.every(function(e){return e instanceof Rg}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return r.forEach(function(e,t){o[t]=e}),t.runKernelFunc({forwardFunc:function(t,n){return Df((i=e.apply(void 0,r.concat([n]))).value instanceof Rg,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Df($f(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];Df(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Df(a.every(function(e){return e instanceof Rg}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var o={};return a.forEach(function(e,t){o[t]=function(){return e}}),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=gg(),n.next=3,t.backend.time(e);case 3:return a=n.sent,n.abrupt("return",(a.wallMs=gg()-r,a));case 5:case"end":return n.stop()}},n)}))()}},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new jg,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();return e.nextTensorId=0,e.nextVariableId=0,e}();function qg(){var e=md();if(null==e._tfengine){var t=new pd(e);e._tfengine=new Gg(t)}return function(e){vd=e}(e._tfengine.ENV),function(e){Eg=e}(function(){return e._tfengine}),e._tfengine}var Kg=qg();function Xg(e,t){return Kg.runKernel(xd,{a:e,b:t})}function Yg(){if("undefined"!=typeof navigator&&null!=navigator){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Zg(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Jg=fd();function Qg(e,t){var n=e;if(Xf(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Xf(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&fd().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&$g(e,r,[]),r}function $g(e,t,n){if(n=n||[],Array.isArray(e)||Xf(e)){Df(t.length>0,function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")}),Df(e.length===t[0],function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")});for(var r=t.slice(1),a=0;a<e.length;++a)$g(e[a],r,n.concat(a))}else Df(0===t.length,function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")})}function ey(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function ty(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof Rg)return ey(r,e.dtype,t,n),e;var a=Qf(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),ey(r,a,t,n),null==e||!Xf(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(null==e?"null":e.constructor.name,"'"));var i=Qg(e,a);!Xf(e)&&!Array.isArray(e)&&(e=[e]);var o="string"!==a?mg(e,a):Mf(e,[],!0);return Kg.makeTensor(o,i,a)}function ny(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map(function(e,a){return ty(e,"".concat(t,"[").concat(a,"]"),n,r)})}function ry(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){Kg.startScope(n);try{var e=r.apply(void 0,arguments);return ld(e)&&console.error("Cannot return a Promise inside of tidy."),Kg.endScope(e),e}catch(e){throw Kg.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}Jg.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Jg.registerFlag("IS_BROWSER",function(){return Zg()}),Jg.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Jg.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Jg.registerFlag("PROD",function(){return!1}),Jg.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Jg.getBool("DEBUG")}),Jg.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Jg.registerFlag("IS_TEST",function(){return!1}),Jg.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0}),Jg.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});var ay=ry({complex_:function(e,t){var n=ty(e,"real","complex"),r=ty(t,"imag","complex");return Ff(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex().")),Kg.runKernel(Vd,{real:n,imag:r})}});function iy(e,t,n,r){if(null==r&&(r=Qf(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Xf(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){sd(t);var a=Lf(t),i=Lf(n);Df(a===i,function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)});for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==Lf(t.slice(o));Df(n[o]===t[o]||!u,function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")})}}return!Xf(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?mg(e,r):Mf(e,[],!0),Kg.makeTensor(e,t,r)}function oy(e,t,n){return iy(e,t,Qg(e,n),n)}var sy={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function uy(e,t){return cy.apply(this,arguments)}function cy(){return(cy=Sf(regeneratorRuntime.mark(function e(t,n){var r,a,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map(function(e){return e.name}):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u,c={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var l=new Promise((u=Sf(regeneratorRuntime.mark(function e(t){var n,r,a,i,o,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce(function(e,t){return e+t.length},0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)}));a.push(l)}else a.push(s.data());null!=n&&(c.group=n),r.push(c)},s=0;s<i.length;++s)o(s);return e.t0=ly,e.next=6,Promise.all(a);case 6:return e.t1=e.sent,e.t2=(0,e.t0)(e.t1),e.t3=r,e.abrupt("return",{data:e.t2,specs:e.t3});case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ly(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))});var r=new Uint8Array(t),a=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength}),r.buffer}var hy="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function py(e){return hy?Buffer.byteLength(e):new Blob([e]).size}function fy(e){if(1===e.length)return e[0];var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function dy(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:py(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:py(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function vy(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0==(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o];i[o]=e[n[s>>10]+(1023&s)]+t[s>>10]}return new Float32Array(a)}}var my=function(){function e(){x(this,e),this.saveRouters=[],this.loadRouters=[]}return I(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&a.push(n)}),a}}]),e}(),gy=function(e){return my.getSaveHandlers(e)},yy="tensorflowjs",by="models_store",ky="model_info_store";function xy(){if(!fd().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function wy(e){var t=e.result;t.createObjectStore(by,{keyPath:"modelPath"}),t.createObjectStore(ky,{keyPath:"modelPath"})}var Iy=function(){var e=function(){function e(t){if(x(this,e),this.indexedDB=xy(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return I(e,[{key:"save",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){n.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n.abrupt("return",t.databaseAction(t.modelPath,e));case 3:case"end":return n.stop()}},n)}))()}},{key:"load",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.databaseAction(e.modelPath));case 1:case"end":return t.stop()}},t)}))()}},{key:"databaseAction",value:function(e,t){var n=this;return new Promise(function(e,r){var a=n.indexedDB.open(yy,1);a.onupgradeneeded=function(){return wy(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(by,"readonly"),s=o.objectStore(by).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=dy(t),l=i.transaction(ky,"readwrite"),h=l.objectStore(ky),p=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});p.onsuccess=function(){var a=(u=i.transaction(by,"readwrite")).objectStore(by).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore(ky)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},p.onerror=function(e){return i.close(),r(p.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}})}}]),e}();return e.URL_SCHEME="indexeddb://",e}(),Ny=function(e){return fd().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Iy.URL_SCHEME)?function(e){return new Iy(e)}(e.slice(Iy.URL_SCHEME.length)):null};my.registerSaveRouter(Ny),my.registerLoadRouter(Ny);var Sy=function(){function e(){x(this,e),this.indexedDB=xy()}return I(e,[{key:"listModels",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){var r=e.indexedDB.open(yy,1);r.onupgradeneeded=function(){return wy(r)},r.onsuccess=function(){var e=r.result,a=e.transaction(ky,"readonly"),i=a.objectStore(ky).getAll();i.onsuccess=function(){var e,n={},r=s(i.result);try{for(r.s();!(e=r.n()).done;){var a=e.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}t(n)},i.onerror=function(t){return e.close(),n(i.error)},a.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}));case 1:case"end":return t.stop()}},t)}))()}},{key:"removeModel",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(e=function(e){return e.startsWith(Iy.URL_SCHEME)?e.slice(Iy.URL_SCHEME.length):e}(e),new Promise(function(n,r){var a=t.indexedDB.open(yy,1);a.onupgradeneeded=function(){return wy(a)},a.onsuccess=function(){var t,i=a.result,o=i.transaction(ky,"readwrite"),s=o.objectStore(ky),u=s.get(e);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(e,"' in IndexedDB.")));var a=s.delete(e),o=function(){var a=(t=i.transaction(by,"readwrite")).objectStore(by).delete(e);a.onsuccess=function(){return n(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==t?i.close():t.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 1:case"end":return n.stop()}},n)}))()}}]),e}(),Cy="/",Ty="tensorflowjs_models",Ey="info",_y="model_topology",Ry="weight_specs",Ay="weight_data",Dy="model_metadata";function Fy(e){return{info:[Ty,e,Ey].join(Cy),topology:[Ty,e,_y].join(Cy),weightSpecs:[Ty,e,Ry].join(Cy),weightData:[Ty,e,Ay].join(Cy),modelMetadata:[Ty,e,Dy].join(Cy)}}function Oy(e){var t=e.split(Cy);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(Cy)}var My=function(){var e=function(){function e(t){if(x(this,e),!fd().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Fy(this.modelPath)}return I(e,[{key:"save",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,i,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){n.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return r=JSON.stringify(e.modelTopology),a=JSON.stringify(e.weightSpecs),i=dy(e),n.prev=3,t.LS.setItem(t.keys.info,JSON.stringify(i)),t.LS.setItem(t.keys.topology,r),t.LS.setItem(t.keys.weightSpecs,a),t.LS.setItem(t.keys.weightData,function(e){if(hy)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy},n.abrupt("return",(null!=e.signature&&(o.signature=e.signature),null!=e.userDefinedMetadata&&(o.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(o.modelInitializer=e.modelInitializer),t.LS.setItem(t.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:i}));case 9:throw n.prev=9,n.t0=n.catch(3),t.LS.removeItem(t.keys.info),t.LS.removeItem(t.keys.topology),t.LS.removeItem(t.keys.weightSpecs),t.LS.removeItem(t.keys.weightData),t.LS.removeItem(t.keys.modelMetadata),new Error("Failed to save model '".concat(t.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(i.modelTopologyBytes,", weightSpecsBytes=").concat(i.weightSpecsBytes,", weightDataBytes=").concat(i.weightDataBytes,"."));case 12:case"end":return n.stop()}},n,null,[[3,9]])}))()}},{key:"load",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n,r,a,i,o,s,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(n=JSON.parse(e.LS.getItem(e.keys.info)))){t.next=3;break}throw new Error("In local storage, there is no model with name '".concat(e.modelPath,"'"));case 3:if("JSON"===n.modelTopologyType){t.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(r={},null!=(a=JSON.parse(e.LS.getItem(e.keys.topology)))){t.next=8;break}throw new Error("In local storage, the topology of model '".concat(e.modelPath,"' is missing."));case 8:if(r.modelTopology=a,null!=(i=JSON.parse(e.LS.getItem(e.keys.weightSpecs)))){t.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(e.modelPath,"' are missing."));case 12:if(r.weightSpecs=i,null!=(o=e.LS.getItem(e.keys.modelMetadata))&&(s=JSON.parse(o),r.format=s.format,r.generatedBy=s.generatedBy,r.convertedBy=s.convertedBy,null!=s.signature&&(r.signature=s.signature),null!=s.userDefinedMetadata&&(r.userDefinedMetadata=s.userDefinedMetadata),null!=s.modelInitializer&&(r.modelInitializer=s.modelInitializer)),null!=(u=e.LS.getItem(e.keys.weightData))){t.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(e.modelPath,"' are missing."));case 18:return t.abrupt("return",(r.weightData=function(e){if(hy){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(u),r));case 19:case"end":return t.stop()}},t)}))()}}]),e}();return e.URL_SCHEME="localstorage://",e}(),Ly=function(e){return fd().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(My.URL_SCHEME)?function(e){return new My(e)}(e.slice(My.URL_SCHEME.length)):null};my.registerSaveRouter(Ly),my.registerLoadRouter(Ly);var Py,zy=function(){function e(){x(this,e),Df(fd().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Df("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return I(e,[{key:"listModels",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n,r,a,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n={},r=Ty+Cy,a=Cy+Ey,i=0;i<e.LS.length;++i)(o=e.LS.key(i)).startsWith(r)&&o.endsWith(a)&&(n[Oy(o)]=JSON.parse(e.LS.getItem(o)));return t.abrupt("return",n);case 3:case"end":return t.stop()}},t)}))()}},{key:"removeModel",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Fy(e=function(e){return e.startsWith(My.URL_SCHEME)?e.slice(My.URL_SCHEME.length):e}(e)),null!=t.LS.getItem(r.info)){n.next=3;break}throw new Error("Cannot find model at path '".concat(e,"'"));case 3:return a=JSON.parse(t.LS.getItem(r.info)),n.abrupt("return",(t.LS.removeItem(r.info),t.LS.removeItem(r.topology),t.LS.removeItem(r.weightSpecs),t.LS.removeItem(r.weightData),a));case 5:case"end":return n.stop()}},n)}))()}}]),e}(),By=function(){function e(){x(this,e),this.managers={}}return I(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){Df(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),Df(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();Df(null==r.managers[t],function(){return"A model store manager is already registered for scheme '".concat(t,"'.")}),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}(),Vy=function(){function e(){x(this,e)}return I(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){return fetch(e,t)})},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(fd().get("IS_BROWSER")){fd().setPlatform("browser",new Vy);try{By.registerManager(My.URL_SCHEME,new zy)}catch(q){}try{By.registerManager(Iy.URL_SCHEME,new Sy)}catch(q){}}function Wy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",sd(e),new Tg(e,t,n)}fd().get("IS_NODE")&&fd().setPlatform("node",new(function(){function e(){x(this,e),this.util=o(8628),this.textEncoder=new this.util.TextEncoder}return I(e,[{key:"fetch",value:function(e,t){return null!=fd().global.fetch?fd().global.fetch(e,t):(null==Py&&(Py=o(5410)),Py(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}()));var Uy=ry({cast_:function(e,t){var n=ty(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Kg.runKernel(Pd,{x:n},{dtype:t})}}),Hy=ry({clone_:function(e){var t={x:ty(e,"x","clone","string_or_numeric")};return Kg.runKernel(Nv,t)}});function jy(e){return new Promise(function(e){return setTimeout(e)}).then(e)}qg(),function(e){_g=e}({buffer:Wy,cast:Uy,clone:Hy,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}});var Gy=function(){var e=function(){function e(t){if(x(this,e),!fd().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),(null==t||0===t.length)&&(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return I(e,[{key:"save",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,i,o,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("undefined"!=typeof document){n.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer)){n.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return a={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+t.weightDataFileName],weights:e.weightSpecs}]},null!=e.signature&&(a.signature=e.signature),null!=e.userDefinedMetadata&&(a.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(a.modelInitializer=e.modelInitializer),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==t.jsonAnchor?document.createElement("a"):t.jsonAnchor).download=t.modelTopologyFileName,o.href=i,n.next=12,jy(function(){return o.dispatchEvent(new MouseEvent("click"))});case 12:if(null==e.weightData){n.next=18;break}return(s=null==t.weightDataAnchor?document.createElement("a"):t.weightDataAnchor).download=t.weightDataFileName,s.href=r,n.next=18,jy(function(){return s.dispatchEvent(new MouseEvent("click"))});case 18:return n.abrupt("return",{modelArtifactsInfo:dy(e)});case 19:case"end":return n.stop()}},n)}))()}}]),e}();return e.URL_SCHEME="downloads://",e}();function qy(e,t,n,r){var a;Df(null!=(a=e)&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"}),function(e,t){Df(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)}),Df(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)}),Df(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)})}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map(function(a){return a.then(function(a){var o=n+ ++i/e.length*(r-n);return t(o),a}),a}))}function Ky(e,t){return Xy.apply(this,arguments)}function Xy(){return(Xy=Sf(regeneratorRuntime.mark(function e(t,n){var r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?fd().platform.fetch:n.fetchFunc,a=t.map(function(e){return r(e,n.requestInit,{isBinary:!0})}),null!=n.onProgress){e.next=9;break}return e.next=6,Promise.all(a);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,qy(a,n.onProgress,0,.5);case 11:e.t0=e.sent;case 12:if(i=e.t0.map(function(e){return e.arrayBuffer()}),null!=n.onProgress){e.next=19;break}return e.next=16,Promise.all(i);case 16:e.t1=e.sent,e.next=22;break;case 19:return e.next=21,qy(i,n.onProgress,.5,1);case 21:e.t1=e.sent;case 22:return e.abrupt("return",e.t1);case 23:case"end":return e.stop()}},e)}))).apply(this,arguments)}my.registerSaveRouter(function(e){return fd().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Gy.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Gy(e)}(e.slice(Gy.URL_SCHEME.length)):null});var Yy=function(){var e=function(){function e(t,n){if(x(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(Df("function"==typeof n.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=fd().platform.fetch,Df(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&Df(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")}),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return I(e,[{key:"save",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){n.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(r=Object.assign({method:t.DEFAULT_METHOD},t.requestInit)).body=new FormData,a={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]},null!=e.signature&&(a.signature=e.signature),null!=e.userDefinedMetadata&&(a.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(a.modelInitializer=e.modelInitializer),r.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=e.weightData&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),n.next=8,t.fetch(t.path,r);case 8:if(!(i=n.sent).ok){n.next=11;break}return n.abrupt("return",{modelArtifactsInfo:dy(e),responses:[i]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(i.status,"."));case 12:case"end":return n.stop()}},n)}))()}},{key:"load",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var r,a,i,o,s,u,c,l,h,p,f,d,v,m,g,y;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetch(e.path,e.requestInit);case 2:if((i=t.sent).ok){t.next=5;break}throw new Error("Request to ".concat(e.path," failed with status code ").concat(i.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return t.prev=5,t.next=8,i.json();case 8:o=t.sent,t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(5),s="Failed to parse model JSON of response from ".concat(e.path,"."),e.path.endsWith(".pb")?s+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":s+=" Please make sure the server is serving valid JSON for this request.",new Error(s);case 15:if(u=o.modelTopology,c=o.weightsManifest,l=o.generatedBy,h=o.convertedBy,p=o.format,f=o.signature,d=o.userDefinedMetadata,null!=u||null!=c){t.next=18;break}throw new Error("The JSON from HTTP path ".concat(e.path," contains neither model topology or manifest for weights."));case 18:if(t.t1=null!=c,!t.t1){t.next=27;break}return t.next=22,e.loadWeights(c);case 22:r=t.sent,a=n(r,2),v=a[0],m=a[1];case 27:return g={modelTopology:u,weightSpecs:v,weightData:m,generatedBy:l,convertedBy:h,format:p},null!=f&&(g.signature=f),null!=d&&(g.userDefinedMetadata=d),y=o.modelInitializer,t.abrupt("return",(y&&(g.modelInitializer=y),g));case 31:case"end":return t.stop()}},t,null,[[5,11]])}))()}},{key:"loadWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function r(){var a,o,u,c,l,h,p,f,d,v,m,g,y,b,k,x,w,I;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:a=Array.isArray(t.path)?t.path[1]:t.path,o=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(a),u=n(o,2),c=u[0],l=u[1],h=t.weightPathPrefix||c,p=[],f=s(e);try{for(f.s();!(d=f.n()).done;)v=d.value,p.push.apply(p,i(v.weights))}catch(N){f.e(N)}finally{f.f()}m=[],g=[],y=s(e);try{for(y.s();!(b=y.n()).done;){k=b.value,x=s(k.paths);try{for(x.s();!(w=x.n()).done;)I=w.value,null!=t.weightUrlConverter?g.push(t.weightUrlConverter(I)):m.push(h+I+l)}catch(N){x.e(N)}finally{x.f()}}}catch(N){y.e(N)}finally{y.f()}if(r.t0=t.weightUrlConverter,!r.t0){r.next=16;break}return r.t1=m.push,r.t2=m,r.t3=i,r.next=13,Promise.all(g);case 13:r.t4=r.sent,r.t5=(0,r.t3)(r.t4),r.t1.apply.call(r.t1,r.t2,r.t5);case 16:return r.t6=p,r.t7=fy,r.next=20,Ky(m,{requestInit:t.requestInit,fetchFunc:t.fetch,onProgress:t.onProgress});case 20:return r.t8=r.sent,r.t9=(0,r.t7)(r.t8),r.abrupt("return",[r.t6,r.t9]);case 23:case"end":return r.stop()}},r)}))()}}]),e}();return e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Zy(e){return null!=e.match(Yy.URL_SCHEME_REGEX)}var Jy,Qy=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every(function(e){return Zy(e)}):Zy(e))?$y(e,t):null};function $y(e,t){return new Yy(e,t)}function eb(e,t){return $y(e,t)}my.registerSaveRouter(Qy),my.registerLoadRouter(Qy);var tb=ry({fromPixels_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=!1,a=!1,i=!1,o=!1,s=!1,u=!1;if(e.data instanceof Uint8Array)r=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)a=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)o=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));u=!0}if(i){var c=2;if(i&&e.readyState<c)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=cg(ng,Kg.backendName))return Kg.runKernel(ng,{pixels:e},{numChannels:t});var l,h,p=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],f=n(p,2),d=f[0],v=f[1];if(s?l=e.getContext("2d").getImageData(0,0,d,v).data:a||r?l=e.data:(o||i||u)&&(null==Jy&&(Jy=document.createElement("canvas").getContext("2d")),Jy.canvas.width=d,Jy.canvas.height=v,Jy.drawImage(e,0,0,d,v),l=Jy.getImageData(0,0,d,v).data),4===t)h=new Int32Array(l);else{var m=d*v;h=new Int32Array(m*t);for(var g=0;g<m;g++)for(var y=0;y<t;++y)h[g*t+y]=l[4*g+y]}return function(e,t,n){if(Of(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Qg(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return iy(e,t,r,n)}(h,[v,d,t],"int32")}});function nb(e,t,n){var r=e.shape.length;Df(r===t.length,function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")}),Df(r===n.length,function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")});for(var a=function(a){Df(t[a]+n[a]<=e.shape[a],function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")})},i=0;i<r;++i)a(i)}function rb(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function ab(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function ib(e,t,n,r){for(var a=i(e),o=a.length;o<r.length;o++)a.push(1);for(var s=0;s<n;s++)0===s?a[t]=1:(a.splice(t,0,1),a.pop());return a}function ob(e,t,n){return n<=e?n:n-(t-1)}function sb(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function ub(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),h=new Array(c),p=new Array(c);if(t.length&&n>0){var f=t[0],d=n+1;l=cb(o,f,d,r,e),h=lb(s,f,d,a,e),p=ib(i,f,d,e)}else for(var v=0;v<c;v++)l[v]=pb(o,r,i,e,v,u),h[v]=fb(s,a,i,e,v,u),p[v]=hb(i,v,u);return{begin:l,end:h,strides:p}}function cb(e,t,n,r,a){for(var o=i(a),s=sb(n,t),u=0;u<o.length;u++)if(s.indexOf(u)>-1)o[u]=0;else{var c=ob(t,n,u),l=r[c];e&1<<c&&(l=0),o[u]=l}return o}function lb(e,t,n,r,a){for(var o=i(a),s=sb(n,t),u=0;u<o.length;u++)if(s.indexOf(u)>-1)o[u]=Number.MAX_SAFE_INTEGER;else{var c=ob(t,n,u),l=r[c];e&1<<c&&(l=Number.MAX_SAFE_INTEGER),o[u]=l}for(var h=0;h<o.length;h++){var p=a[h];o[h]<0&&(o[h]+=p),o[h]=Rf(0,o[h],a[h])}return o}function hb(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function pb(e,t,n,r,a,i){var o=t[a];(e&1<<a||i&1<<a||null==o)&&(o=(n[a]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return o<0&&(o+=s),o=Rf(0,o,s-1)}function fb(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?Rf(0,o,u):Rf(-1,o,u-1)}function db(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function vb(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function mb(e,t,n){var r,a,o=e.shape.length;return(r="number"==typeof t?[t].concat(i(new Array(o-1).fill(0))):t.length<o?t.concat(new Array(o-t.length).fill(0)):t.slice()).forEach(function(e){Df(-1!==e,function(){return"slice() does not support negative begin indexing."})}),a=(a=null==n?new Array(o).fill(-1):"number"==typeof n?[n].concat(i(new Array(o-1).fill(-1))):n.length<o?n.concat(new Array(o-n.length).fill(-1)):n).map(function(t,n){return t>=0?t:(Df(-1===t,function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")}),e.shape[n]-r[n])}),[r,a]}function gb(e,t,n,r,a,i,o,s,u){var c=t.slice(),l=n.slice(),h=r;null==r&&(h=new Array(c.length));var p=rb(o);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var f=e.length-c.length,d=rb(s),v=e.slice();d.forEach(function(e){c[e]=0,l[e]=1,v.splice(e,0,1)});var m=ub(v,p,f,c,l,h,a,i,o),g=m.begin,y=m.end,b=m.strides;c=g,l=y,h=b;var k=rb(u);k.forEach(function(e){l[e]=c[e]+1,h[e]=1});var x=ab(c,l,h),w=x.filter(function(e,t){return-1===k.indexOf(t)});return{nonStrided:h.every(function(e){return 1===e}),$begin:c,$end:l,$strides:h,size:x,newShape:v,outShape:w}}var yb=function(){function e(){x(this,e)}return I(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),bb=function(){function e(){x(this,e),this.classNameMap={}}return I(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function kb(e){Df(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),Df("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),Df(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),bb.register(e)}function xb(){return Kg}function wb(){return Kg.memory()}function Ib(e,t){return Kg.tidy(e,t)}function Nb(e){Wg(e).forEach(function(e){return e.dispose()})}function Sb(e){return Kg.keep(e)}function Cb(e){return Kg.setBackend(e)}function Tb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Kg.registerBackend(e,t,n)}function Eb(e){return Kg.customGrad(e)}function _b(e,t){if((Xf(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Xf(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return iy(e,[],[],t)}var Rb=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map(function(e){return{name:e.name,tensor:i[e.name]}});this.applyGradients(o)}else this.applyGradients(i);return Nb(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return function(e,t){Df($f(e),function(){return"The f passed in variableGrads(f) must be a function"}),Df(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof Dg}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],Kg.registeredVariables)t.push(Kg.registeredVariables[r]);var a=n?t.filter(function(e){return!e.trainable}):null,i=t.length;Df((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")});var o=Kg.gradients(e,t,null,!0),s=o.value,u=o.grads;Df(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Df(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")});var c={};return t.forEach(function(e,t){null!=u[t]&&(c[e.name]=u[t])}),null!=a&&a.forEach(function(e){return c[e.name]=null}),{value:s,grads:c}}(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Nb(this.iterations_)}},{key:"saveIterations",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null==e.iterations_&&(e.iterations_=0),{name:"iter",tensor:_b(e.iterations_,"int32")}));case 1:case"end":return t.stop()}},t)}))()}},{key:"getWeights",value:function(){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}},e)}))()}},{key:"setWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class ".concat(t.getClassName()));case 1:case"end":return e.stop()}},e)}))()}},{key:"extractIterations",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e[0].tensor.data();case 2:return t.iterations_=n.sent[0],n.abrupt("return",e.slice(1));case 4:case"end":return n.stop()}},n)}))()}}]),n}(yb);Object.defineProperty(Rb,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Ab=ry({abs_:function(e){var t=ty(e,"x","abs");return Kg.runKernel("complex64"===t.dtype?Wd:yd,{x:t})}}),Db=ry({add_:function(e,t){var r,a=ty(e,"a","add"),i=ty(t,"b","add");return a=(r=n(Vg(a,i),2))[0],i=r[1],Kg.runKernel(xd,{a:a,b:i})}}),Fb=ry({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:ty(e,"x","all","bool")};return Kg.runKernel("All",r,{axis:t,keepDims:n})}}),Ob=ry({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:ty(e,"x","any","bool")};return Kg.runKernel("Any",r,{axis:t,keepDims:n})}}),Mb=ry({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:ty(e,"x","argMax")};return Kg.runKernel(Id,n,{axis:t})}});function Lb(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5?arguments[5]:void 0;return Bb(e,[].concat(i(t),[e[3]]),n,o,r,null,null,Xb(a))}function Pb(e,t,r,a,i,o){var s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",c=Ub(t),l=n(c,2),h=l[0],p=l[1];if("channelsLast"===u)s=[h,p,e[3],e[3]];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));s=[h,p,e[1],e[1]]}return Bb(e,s,r,a,i,o,!1,u)}function zb(e,t,r,a,i,o){var s,u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",l=Hb(t),h=n(l,3),p=h[0],f=h[1],d=h[2];if("NDHWC"===c)u="channelsLast",s=[p,f,d,e[4],e[4]];else{if("NCDHW"!==c)throw new Error("Unknown dataFormat ".concat(c));u="channelsFirst",s=[p,f,d,e[1],e[1]]}return Vb(e,s,r,a,i,!1,u,o)}function Bb(e,t,r,a,i,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",c=-1,l=-1,h=-1,p=-1;if("channelsLast"===u){var f=n(e,4);c=f[0],l=f[1],h=f[2],p=f[3]}else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));var d=n(e,4);c=d[0],p=d[1],l=d[2],h=d[3]}var v,m=n(t,4),g=m[0],y=m[1],b=m[3],k=Ub(r),x=n(k,2),w=x[0],I=x[1],N=Ub(a),S=n(N,2),C=S[0],T=S[1],E=jb(g,C),_=jb(y,T),R=function(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var p=function(e,t,n,r,a){null==r&&(r=Wb(e,t,n));var i=e[1];return[Gb((e[0]-t+2*r)/n+1,a),Gb((i-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=p[0],h=p[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var f=Math.max(0,(l-1)*r+i-t),d=Math.max(0,(h-1)*a+o-n),v=Math.floor(f/2),m=f-v,g=Math.floor(d/2);c={top:v,bottom:m,left:g,right:d-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],k="channelsLast"===u?e[2][0]:e[3][0],x="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:k,right:x,type:0===y&&0===b&&0===k&&0===x?"VALID":"EXPLICIT"},l=Gb((t-i+y+b)/r+1,s),h=Gb((n-o+k+x)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}(i,l,h,w,I,E,_,o,u),A=R.padInfo,D=R.outHeight,F=R.outWidth,O=s?b*p:b;return"channelsFirst"===u?v=[c,O,D,F]:"channelsLast"===u&&(v=[c,D,F,O]),{batchSize:c,dataFormat:u,inHeight:l,inWidth:h,inChannels:p,outHeight:D,outWidth:F,outChannels:O,padInfo:A,strideHeight:w,strideWidth:I,filterHeight:g,filterWidth:y,effectiveFilterHeight:E,effectiveFilterWidth:_,dilationHeight:C,dilationWidth:T,inShape:e,outShape:v,filterShape:t}}function Vb(e,t,r,a,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=arguments.length>7?arguments[7]:void 0,c=-1,l=-1,h=-1,p=-1,f=-1;if("channelsLast"===s){var d=n(e,5);c=d[0],l=d[1],h=d[2],p=d[3],f=d[4]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var v=n(e,5);c=v[0],f=v[1],l=v[2],h=v[3],p=v[4]}var m,g=n(t,5),y=g[0],b=g[1],k=g[2],x=g[4],w=Hb(r),I=n(w,3),N=I[0],S=I[1],C=I[2],T=Hb(a),E=n(T,3),_=E[0],R=E[1],A=E[2],D=jb(y,_),F=jb(b,R),O=jb(k,A),M=function(e,t,n,r,a,i,o,s,u,c,l){var h,p,f,d;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=Wb(e,t,r));var o=e[1],s=e[2];return[Gb((e[0]-t+2*a)/r+1,i),Gb((o-t+2*a)/r+1,i),Gb((s-t+2*a)/r+1,i),1]}([t,n,r,1],s,0,a,e,l);p=v[0],f=v[1],d=v[2]}else if("same"===e){var m=((p=Math.ceil(t/a))-1)*a+s-t,g=((f=Math.ceil(n/i))-1)*i+u-n,y=((d=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(m/2),k=m-b,x=Math.floor(g/2),w=g-x,I=Math.floor(y/2);h={top:x,bottom:w,left:I,right:y-I,front:b,back:k,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-s+1)/a),f=Math.ceil((n-u+1)/i),d=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:p,outHeight:f,outWidth:d}}(i,l,h,p,N,S,C,D,F,O,u),L=M.padInfo,P=M.outDepth,z=M.outHeight,B=M.outWidth,V=o?x*f:x;return"channelsFirst"===s?m=[c,V,P,z,B]:"channelsLast"===s&&(m=[c,P,z,B,V]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:h,inWidth:p,inChannels:f,outDepth:P,outHeight:z,outWidth:B,outChannels:V,padInfo:L,strideDepth:N,strideHeight:S,strideWidth:C,filterDepth:y,filterHeight:b,filterWidth:k,effectiveFilterDepth:D,effectiveFilterHeight:F,effectiveFilterWidth:O,dilationDepth:_,dilationHeight:R,dilationWidth:A,inShape:e,outShape:m,filterShape:t}}function Wb(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=jb(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Ub(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Hb(e){return"number"==typeof e?[e,e,e]:e}function jb(e,t){return t<=1?e:e+(e-1)*(t-1)}function Gb(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function qb(e){var t=n(Ub(e),3),r=t[0],a=t[1],i=t[2];return 1===r&&1===a&&1===i}function Kb(e,t){return qb(e)||qb(t)}function Xb(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}var Yb=ry({reshape_:function(e,t){var n={x:ty(e,"x","reshape","string_or_numeric")};return Kg.runKernel(gm,n,{shape:t})}}),Zb=ry({avgPool_:function(e,t,n,r,a){var i=ty(e,"x","avgPool","float32");Df(Kb(n,1),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")});var o=i,s=!1;3===i.rank&&(s=!0,o=Yb(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Df(4===o.rank,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")}),null!=a&&Df(zf(r),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")});var u=Kg.runKernel(Rd,{x:o},{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return u=Uy(u,i.dtype),s?Yb(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Jb=ry({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=ty(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=Yb(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Df(5===s.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),Df("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)}),null!=a&&Df(zf(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")});var c=Kg.runKernel(Dd,{x:s},{filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i});return c=Uy(c,s.dtype),u?Yb(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}});function Qb(e){return 0===e.rank||1===e.rank?Yb(e,[1,1,1,e.size]):2===e.rank?Yb(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Yb(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var $b=ry({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=ty(e,"x","batchNorm"),c=ty(t,"mean","batchNorm"),l=ty(n,"variance","batchNorm");null!=a&&(o=ty(a,"scale","batchNorm")),null!=r&&(s=ty(r,"offset","batchNorm")),Df(c.rank===l.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Df(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Df(null==o||c.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var h={x:Qb(u),scale:o,offset:s,mean:c,variance:l},p=Kg.runKernel(bv,h,{varianceEpsilon:i});return Yb(p,u.shape)}}),ek=ry({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=ty(e,"x","batchNorm"),c=ty(t,"mean","batchNorm"),l=ty(n,"variance","batchNorm");return null!=a&&(o=ty(a,"scale","batchNorm")),null!=r&&(s=ty(r,"offset","batchNorm")),Df(2===u.rank,function(){return"Error in batchNorm2D: x must be rank 2 but got rank ".concat(u.rank,".")}),Df(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")}),Df(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")}),null!=o&&Df(2===o.rank||1===o.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")}),null!=s&&Df(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")}),$b(u,c,l,s,o,i)}}),tk=ry({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=ty(e,"x","batchNorm"),c=ty(t,"mean","batchNorm"),l=ty(n,"variance","batchNorm");return null!=a&&(o=ty(a,"scale","batchNorm")),null!=r&&(s=ty(r,"offset","batchNorm")),Df(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank ".concat(u.rank,".")}),Df(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")}),Df(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")}),null!=o&&Df(3===o.rank||1===o.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")}),null!=s&&Df(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")}),$b(u,c,l,s,o,i)}}),nk=ry({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=ty(e,"x","batchNorm"),c=ty(t,"mean","batchNorm"),l=ty(n,"variance","batchNorm");return null!=a&&(o=ty(a,"scale","batchNorm")),null!=r&&(s=ty(r,"offset","batchNorm")),Df(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank ".concat(u.rank,".")}),Df(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")}),Df(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")}),null!=o&&Df(4===o.rank||1===o.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")}),null!=s&&Df(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")}),$b(u,c,l,s,o,i)}}),rk=ry({clipByValue_:function(e,t,n){var r=ty(e,"x","clipByValue");return Df(t<=n,function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")}),Kg.runKernel(Bd,{x:r},{clipValueMin:t,clipValueMax:n})}}),ak=ry({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Df(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=ny(e,"tensors","concat","string_or_numeric");return"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))}),1===n.length?Hy(n[0]):Kg.runKernel(Ud,n,{axis:t})}}),ik=ry({concat1d_:function(e){return ak(e,0)}}),ok=ry({concat2d_:function(e,t){return ak(e,t)}}),sk=ry({concat3d_:function(e,t){return ak(e,t)}}),uk=ry({concat4d_:function(e,t){return ak(e,t)}}),ck=ry({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=ty(e,"x","conv2d"),u=ty(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=Yb(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Df(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Df(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}),null!=o&&Df(zf(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")});var h="NHWC"===a?c.shape[3]:c.shape[1];Df(h===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(h,") must match input depth for filter ").concat(u.shape[2],".")}),Df(Kb(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")});var p=Kg.runKernel(Hd,{x:c,filter:u},{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?Yb(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),lk=ry({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=ty(e,"x","conv1d"),u=ty(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=Yb(s,[1,s.shape[0],s.shape[1]])),Df(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),Df(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")}),null!=o&&Df(zf(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")}),Df(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")}),Df(Kb(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")}),Df("NWC"===a,function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var h=Yb(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=Yb(c,[c.shape[0],1,c.shape[1],c.shape[2]]),f=ck(p,h,[1,n],r,"NHWC",[1,i],o);return Yb(f,l?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}}),hk=ry({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;Df(e.length===t.rank,function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")});var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=Yb(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),Df(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")}),Df(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)}),Df(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)});var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];Df(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")}),Df(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must match output depth for filter ").concat(n.shape[3],".")}),null!=o&&Df(zf(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")});var p=Kg.runKernel(Gd,{dy:u,filter:n},{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s});return c?Yb(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),pk=ry({conv2dTranspose_:function(e,t,n,r,a,i){var o=ty(e,"x","conv2dTranspose"),s=ty(t,"filter","conv2dTranspose");return hk(n,o,s,r,a,"NHWC",i)}}),fk=ry({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=ty(e,"x","conv3d"),s=ty(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=Yb(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Df(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),Df(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,".")}),Df(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")}),Df(Kb(n,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}),Df("NDHWC"===a,function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")});var l=Kg.runKernel(qd,{x:u,filter:s},{strides:n,pad:r,dataFormat:a,dilations:i});return c?Yb(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),dk=ry({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=ty(e,"x","depthwiseConv2d"),u=ty(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=Yb(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Df(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Df(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}),Df(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(u.shape[2],".")}),null!=o&&Df(zf(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")});var h=Kg.runKernel(tv,{x:c,filter:u},{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?Yb(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),vk=ry({floorDiv_:function(e,t){var r,a=ty(e,"a","floorDiv"),i=ty(t,"b","floorDiv");return a=(r=n(Vg(a,i),2))[0],i=r[1],Kg.runKernel(yv,{a:a,b:i})}}),mk=ry({div_:function(e,t){var r,a=ty(e,"a","div"),i=ty(t,"b","div");return a=(r=n(Vg(a,i),2))[0],i=r[1],"int32"===a.dtype&&"int32"===i.dtype?vk(a,i):Kg.runKernel(sv,{a:a,b:i},{})}}),gk=ry({elu_:function(e){var t={x:ty(e,"x","elu")};return Kg.runKernel(uv,t)}});function yk(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function bk(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function kk(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,"."));n.unshift(i)}}return n}var xk=ry({equal_:function(e,t){var r,a=ty(e,"a","equal"),i=ty(t,"b","equal");return a=(r=n(Vg(a,i),2))[0],i=r[1],kk(a.shape,i.shape),Kg.runKernel(hv,{a:a,b:i})}}),wk=ry({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ty(e,"x","expandDims","string_or_numeric");return Df(t<=n.rank,function(){return"Axis must be <= rank of the tensor"}),Kg.runKernel(fv,{input:n},{dim:t})}}),Ik=ry({tile_:function(e,t){var n=ty(e,"x","tile","string_or_numeric");return Df(n.rank===t.length,function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}),Kg.runKernel(Km,{x:n},{reps:t})}}),Nk=ry({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=Wy([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=Yb(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return Ik(wk(s,0),[n[0],1,1]);if(2===n.length)return Ik(wk(wk(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Ik(wk(wk(wk(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});function Sk(e,t,n){return Kg.runKernel(vv,{},{shape:e,value:t,dtype:n})}var Ck=ry({floor_:function(e){var t={x:ty(e,"x","floor")};return Kg.runKernel(gv,t)}}),Tk=ry({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=ty(e,"x","gather"),i=ty(t,"indices","gather","int32");return Kg.runKernel(kv,{x:a,indices:i},{axis:n,batchDims:r})}}),Ek=ry({greater_:function(e,t){var r,a=ty(e,"a","greater"),i=ty(t,"b","greater");return a=(r=n(Vg(a,i),2))[0],i=r[1],kk(a.shape,i.shape),Kg.runKernel(wv,{a:a,b:i})}}),_k=ry({greaterEqual_:function(e,t){var r,a=ty(e,"a","greaterEqual"),i=ty(t,"b","greaterEqual");return a=(r=n(Vg(a,i),2))[0],i=r[1],kk(a.shape,i.shape),Kg.runKernel(Iv,{a:a,b:i})}}),Rk=ry({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:ty(e,"x","leakyRelu")};return Kg.runKernel(Rv,n,{alpha:t})}}),Ak=ry({log_:function(e){var t={x:ty(e,"x","log")};return Kg.runKernel(Ov,t)}}),Dk=ry({exp_:function(e){var t={x:ty(e,"x","exp")};return Kg.runKernel(pv,t)}}),Fk=ry({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:ty(e,"x","max")};return Kg.runKernel(Wv,r,{reductionIndices:t,keepDims:n})}}),Ok=ry({mul_:function(e,t){var r,a=ty(e,"a","mul"),i=ty(t,"b","mul");return a=(r=n(Vg(a,i),2))[0],i=r[1],Kg.runKernel(em,{a:a,b:i})}}),Mk=ry({sub_:function(e,t){var r,a=ty(e,"a","sub"),i=ty(t,"b","sub");return a=(r=n(Vg(a,i),2))[0],i=r[1],Kg.runKernel(Um,{a:a,b:i})}}),Lk=ry({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=ty(e,"x","sum");return"bool"===r.dtype&&(r=Uy(r,"int32")),Kg.runKernel(Lm,{x:r},{axis:t,keepDims:n})}}),Pk=ry({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=ty(e,"logits","logSoftmax");if(-1===t&&(t=r.rank-1),t!==r.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(r.rank," and axis was ").concat(t));return Eb(function(e,r){var a=Fk(e,t,!0),i=Mk(e,a),o=Mk(Uy(i,"float32"),Ak(Lk(Dk(i),t,!0)));return r([o]),{value:o,gradFunc:function(e,r){var a=n(r,1)[0],i=Dk(a);return Mk(e,Ok(Lk(e,t,!0),i))}}})(r)}}),zk=ry({logicalAnd_:function(e,t){var n=ty(e,"a","logicalAnd","bool"),r=ty(t,"b","logicalAnd","bool");return kk(n.shape,r.shape),Kg.runKernel(Lv,{a:n,b:r})}}),Bk=ry({maxPool_:function(e,t,n,r,a){var i=ty(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=Yb(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Df(4===o.rank,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")}),Df(Kb(n,1),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")}),null!=a&&Df(zf(r),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")});var u=Kg.runKernel(Hv,{x:o},{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return s?Yb(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Vk=ry({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=ty(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=Yb(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Df(5===s.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),Df("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)}),null!=a&&Df(zf(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")});var c=Kg.runKernel(Gv,{x:s},{filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i});return u?Yb(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),Wk=ry({maximum_:function(e,t){var r,a=ty(e,"a","maximum"),i=ty(t,"b","maximum");return a=(r=n(Vg(a,i),2))[0],i=r[1],"bool"===a.dtype&&(a=Uy(a,"int32"),i=Uy(i,"int32")),kk(a.shape,i.shape),Kg.runKernel(Uv,{a:a,b:i})}}),Uk=ry({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:ty(e,"x","mean")};return Kg.runKernel(Xv,r,{axis:t,keepDims:n})}}),Hk=ry({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:ty(e,"x","min")};return Kg.runKernel(Yv,r,{axis:t,keepDims:n})}}),jk=ry({minimum_:function(e,t){var r,a=ty(e,"a","minimum"),i=ty(t,"b","minimum");return a=(r=n(Vg(a,i),2))[0],i=r[1],"bool"===a.dtype&&(a=Uy(a,"int32"),i=Uy(i,"int32")),kk(a.shape,i.shape),Kg.runKernel(Zv,{a:a,b:i})}});function Gk(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function qk(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function Kk(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map(function(t){return e[t]})]}function Xk(e,t){return qk(e,t.map(function(e){return 1}),t)}function Yk(e,t,n){Df(Gk(t,n),function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")})}function Zk(e,t){if(Gk(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function Jk(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Qk(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var $k=ry({square_:function(e){var t=ty(e,"x","square");return Kg.runKernel("Square",{x:t},{})}}),ex=ry({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Hf(t,(e=ty(e,"x","moments")).shape),a=Uk(e,r,n),i=a.shape;n||(i=Xk(a.shape,r));var o=$k(Mk(Uy(e,"float32"),Yb(a,i)));return{mean:a,variance:Uk(o,r,n)}}}),tx=ry({neg_:function(e){var t={x:ty(e,"x","neg")};return Kg.runKernel(tm,t)}}),nx=ry({notEqual_:function(e,t){var r,a=ty(e,"a","notEqual"),i=ty(t,"b","notEqual");return a=(r=n(Vg(a,i),2))[0],i=r[1],kk(a.shape,i.shape),Kg.runKernel(nm,{a:a,b:i})}}),rx=ry({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a={indices:ty(e,"indices","oneHot","int32")};return Kg.runKernel(sm,a,{depth:t,onValue:n,offValue:r})}});function ax(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=ax(e,"float32"),r=ax(e,"float32");return ay(n,r)}var a=id(Lf(e),t);return Kg.makeTensor(a,e,t)}function ix(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=ix(e,"float32"),r=ax(e,"float32");return ay(n,r)}var a=ad(Lf(e),t);return Kg.makeTensor(a,e,t)}var ox=ry({onesLike_:function(e){var t={x:ty(e,"x","onesLike")};return Kg.runKernel(om,t)}}),sx=ry({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=ty(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Kg.runKernel(cm,{x:r},{paddings:t,constantValue:n})}}),ux=ry({prelu_:function(e,t){var n=ty(e,"x","prelu"),r=ty(t,"alpha","prelu");return Kg.runKernel(hm,{x:n,alpha:r})}}),cx=o(4901),lx=function(){function e(t,n,r,a,i){x(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=cx.alea(o.toString())}return I(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),hx=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(x(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=cx.alea(i)}return I(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}(),px=ry({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new lx(t,n,r,!1,a),o=Wy(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),fx=ry({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=Wy(e,r),o=new hx(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),dx=ry({relu_:function(e){var t={x:ty(e,"x","relu")};return Kg.runKernel(mm,t)}}),vx=ry({reverse_:function(e,t){var n={x:ty(e,"x","reverse")};return Kg.runKernel(Im,n,{dims:t})}}),mx=ry({selu_:function(e){var t={x:ty(e,"x","selu")};return Kg.runKernel(Em,t)}}),gx=ry({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=ty(e,"x","separableConv2d"),u=ty(t,"depthwiseFilter","separableConv2d"),c=ty(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=Yb(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Df(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")}),Df(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")}),Df(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")}),Df(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")}),Df(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")});var p=u.shape[2],f=u.shape[3];Df(c.shape[2]===p*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(p*f,", but got ").concat(c.shape[2],".")});var d=dk(l,u,r,a,o,i),v=ck(d,c,1,"valid",o);return h?Yb(v,[v.shape[1],v.shape[2],v.shape[3]]):v}}),yx=ry({sigmoid_:function(e){var t={x:ty(e,"x","sigmoid")};return Kg.runKernel(Fm,t)}}),bx=ry({slice_:function(e,t,n){var r=ty(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");return Kg.runKernel(_m,{x:r},{begin:t,size:n})}}),kx=ry({slice1d_:function(e,t,n){var r=ty(e,"x","slice1d");return Df(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")}),bx(r,[t],[n])}}),xx=ry({slice2d_:function(e,t,n){var r=ty(e,"x","slice2d");return Df(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")}),bx(r,t,n)}}),wx=ry({slice3d_:function(e,t,n){var r=ty(e,"x","slice3d");return Df(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")}),bx(r,t,n)}}),Ix=ry({slice4d_:function(e,t,n){var r=ty(e,"x","slice4d");return Df(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")}),bx(r,t,n)}}),Nx=ry({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=ty(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));return Kg.runKernel(Bm,{logits:n},{dim:t})}}),Sx=ry({softplus_:function(e){var t={x:ty(e,"x","softplus")};return Kg.runKernel(Om,t)}}),Cx=ry({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:ty(e,"x","split")};return Kg.runKernel(zm,r,{numOrSizeSplits:t,axis:n})}}),Tx=ry({sqrt_:function(e){var t={x:ty(e,"x","sqrt")};return Kg.runKernel(Mm,t)}}),Ex=ry({squeeze_:function(e,t){var n=ty(e,"x","squeeze");return Yb(n,jf(n.shape,t).newShape)}}),_x=ry({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ny(e,"tensors","stack","string_or_numeric");return Df(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length>0&&Df(t<=n[0].rank,function(){return"Axis must be <= rank of the tensor"}),Kg.runKernel(um,n,{axis:t})}}),Rx=ry({tanh_:function(e){var t={x:ty(e,"x","tanh")};return Kg.runKernel(qm,t)}});function Ax(e,t){Of(e);var n=Qg(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return iy(e,null,n,t)}function Dx(e,t,n){if(Of(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Qg(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return iy(e,t,r,n)}var Fx=ry({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new lx(t,n,r,!0,a),o=Wy(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Ox=ry({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ty(e,"x","unstack","string_or_numeric");return Df(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}),Kg.runKernel(Qm,{value:n},{axis:t})}}),Mx=ry({broadcastTo_:function(e,t){var n=ty(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=Yb(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));return 0===o.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0}).length?Hy(n):Kg.runKernel(Km,{x:n},{reps:o})}}),Lx=ry({where_:function(e,t,n){var r=ty(t,"a","where"),a=ty(n,"b","where"),i=ty(e,"condition","where","bool"),o=kk(r.shape,a.shape),s=Mx(r,o),u=Mx(a,o);return 1===i.rank&&Df(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}),1!==i.rank&&Ff(i.shape,u.shape,"Error in where: "),Kg.runKernel(Tm,{condition:i,t:s,e:u})}}),Px=ry({zerosLike_:function(e){var t={x:ty(e,"x","zerosLike")};return Kg.runKernel(eg,t)}}),zx=ry({transpose_:function(e,t){var n=ty(e,"x","transpose");return null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),Df(n.rank===t.length,function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of perm ").concat(t,".")}),t.forEach(function(e){Df(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1," but got ").concat(t)})}),n.rank<=1?n.clone():Kg.runKernel(Zm,{x:n},{perm:t})}}),Bx=ry({dropout_:function(e,t,n,r){var a=ty(e,"x","dropout");if(Df("float32"===a.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")}),Df(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")}),0===t)return e instanceof Rg?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(Pf(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(a,n),o=1-t,s=mk(Ck(Db(fx(i,0,1,"float32",r),o)),o);return Ok(a,s)}}),Vx=ry({imag_:function(e){var t={input:ty(e,"input","imag")};return Kg.runKernel(Cv,t)}}),Wx=ry({real_:function(e){var t={input:ty(e,"input","real")};return Kg.runKernel(dm,t)}}),Ux=ry({fft_:function(e){return Df("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}),Kg.runKernel("FFT",{input:e})}}),Hx=ry({rfft_:function(e,t){Df("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)});var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map(function(e){return 0}),o=e.shape.map(function(e){return e});o[e.shape.length-1]=t,n=bx(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=ak([e,ax(s)],e.shape.length-1),r=t}else n=e;var u=Px(n),c=Yb(ay(n,u),[a,r]),l=Ux(c),h=Math.floor(r/2)+1,p=Wx(l),f=Vx(l),d=Cx(p,[h,r-h],p.shape.length-1),v=Cx(f,[h,r-h],f.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,Yb(ay(d[0],v[0]),m)}}),jx=ry({ifft_:function(e){return Df("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}),Kg.runKernel(Sv,{input:e})}}),Gx=ry({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=Yb(e,[r,n]);t=jx(a)}else{var i=[r,2*(n-1)],o=Yb(Wx(e),[r,n]),s=Yb(Vx(e),[r,n]),u=vx(bx(o,[0,1],[r,n-2]),1),c=Ok(vx(bx(s,[0,1],[r,n-2]),1),_b(-1)),l=ak([o,u],1),h=ak([s,c],1),p=Yb(ay(l,h),[i[0],i[1]]);t=jx(p)}if(t=Wx(t),3===e.rank&&0!==e.shape[0]){var f=t,d=e.shape[0];t=Yb(t,[d,t.shape[0]/d,t.shape[1]]),f.dispose()}return t}}),qx=ry({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Yb(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Yb(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Df(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")}),Df(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")}),Df(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];return Df(c===n[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")}),Df(l===n[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")}),null!=o&&Df(zf(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")}),Kg.runKernel(jd,{x:s,dy:u},{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n})}}),Kx=ry({relu6_:function(e){var t={x:ty(e,"x","relu6")};return Kg.runKernel(wm,t)}}),Xx=ry({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:ty(e,"x","step")};return Kg.runKernel(tg,n,{alpha:t})}});function Yx(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Ok(e,Xx(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function Zx(e,t){var n=t,r=bk(e.shape,t.shape);return r.length>0&&(n=Lk(n,r)),Yb(n,e.shape)}function Jx(e,t,n,r){if("linear"===t)return e;if("relu"===t)return dx(e);if("elu"===t)return gk(e);if("relu6"===t)return Kx(e);if("prelu"===t)return ux(e,n);if("leakyrelu"===t)return Rk(e,r);throw new Error("Unknown fused activation ".concat(t,"."))}var Qx=function(e,t){return!(e>0)||"linear"===t},$x=ry({fusedConv2d_:function(e){var t=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,h=e.bias,p=e.activation,f=void 0===p?"linear":p,d=e.preluActivationWeights,v=e.leakyreluAlpha;if(!1===Qx(Kg.state.gradientDepth,f=f||"linear")){var m=ck(t,r,a,i,s,c,l);return null!=h&&(m=Db(m,h)),Jx(m,f,d,v)}var g=ty(t,"x","conv2d"),y=ty(r,"filter","conv2d"),b=g,k=!1;3===g.rank&&(k=!0,b=Yb(g,[1,g.shape[0],g.shape[1],g.shape[2]])),Df(4===b.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(b.rank,".")}),Df(4===y.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(y.rank,".")}),null!=l&&Df(zf(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode ".concat(l," but got pad ").concat(i,".")}),Df(b.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input (".concat(b.shape[3],") must match input depth for filter ").concat(y.shape[2],".")}),Df(Kb(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Df("NHWC"===s,function(){return"Error in conv2d: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var x,w,I=Bb(b.shape,y.shape,a,c,i,l);null!=h&&(x=n(Vg(x=ty(h,"bias","fused conv2d"),g),1)[0],kk(I.outShape,x.shape)),null!=d&&(w=ty(d,"prelu weights","fused conv2d"));var N=function(e,t){var r=n(t,4),o=r[0],s=r[1],u=r[2],l=r[3],h=Yx(e,u,f);Df(qb(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(c,"'")});var p=[hk(s.shape,h,o,a,i),qx(s,h,o.shape,a,i)];if(null!=l){var d=Zx(l,h);p.push(d)}return p},S={x:b,filter:y,bias:x,preluActivationWeights:w},C={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:f,leakyreluAlpha:v};return null==h?Eb(function(e,t,n){var r=Kg.runKernel(ig,S,C);return n([t,e,r]),k&&(r=Yb(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:N}})(b,y):Eb(function(e,t,n,r){var a=Kg.runKernel(ig,S,C);return r([t,e,a,n]),k&&(a=Yb(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:N}})(b,y,x)}}),ew=ry({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Yb(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;return 3===u.rank&&(u=Yb(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Kg.runKernel(nv,{x:s,dy:u},{strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n})}}),tw=ry({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=Yb(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c=Kg.runKernel(rv,{dy:s,filter:n},{strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e});return u?Yb(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),nw=ry({fusedDepthwiseConv2d_:function(e){var t,r=e.x,a=e.filter,i=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,h=e.dimRoundingMode,p=e.bias,f=e.activation,d=void 0===f?"linear":f,v=e.preluActivationWeights,m=e.leakyreluAlpha;if(!1===Qx(Kg.state.gradientDepth,d)){var g=dk(r,a,i,o,u,l,h);return null!=p&&(g=Db(g,p)),Jx(g,d,v,m)}var y=ty(r,"x","depthwiseConv2d"),b=ty(a,"filter","depthwiseConv2d"),k=y,x=!1;3===y.rank&&(x=!0,k=Yb(y,[1,y.shape[0],y.shape[1],y.shape[2]])),Df(4===k.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(k.rank,".")}),Df(4===b.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(b.rank,".")}),Df(k.shape[3]===b.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(k.shape[3],") must match the inChannels dimension in filter ").concat(b.shape[2],".")}),null==l&&(l=[1,1]),Df(Kb(i,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")}),null!=h&&Df(zf(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ".concat(h," but got pad ").concat(o,".")});var w,I,N=Bb(k.shape,b.shape,i,l,o,h,!0);null!=p&&(t=n(Vg(w=ty(p,"bias","fused conv2d"),y),1),w=t[0],kk(N.outShape,w.shape)),null!=v&&(I=ty(v,"prelu weights","fused depthwiseConv2d"));var S=function(e,t){Df(qb(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(l,"'")});var r=n(t,4),a=r[0],s=r[1],u=r[2],c=r[3],p=Yx(e,u,d),f=tw(s.shape,p,a,i,o,l,h),v=ew(s,p,a.shape,i,o,l,h);return null!=c?[f,v,Zx(w,p)]:[f,v]},C={x:k,filter:b,bias:w,preluActivationWeights:I},T={strides:i,pad:o,dataFormat:u,dilations:l,dimRoundingMode:h,activation:d,leakyreluAlpha:m};return null==p?Eb(function(e,t,n){var r=Kg.runKernel(og,C,T);return n([t,e,r]),x&&(r=Yb(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:S}})(k,b):Eb(function(e,t,n,r){var a=Kg.runKernel(og,C,T);return r([t,e,a,n]),x&&(a=Yb(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:S}})(k,b,w)}}),rw=ry({matMul_:function(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=ty(e,"a","matMul"),s=ty(t,"b","matMul");return o=(r=n(Vg(o,s),2))[0],s=r[1],Kg.runKernel(Od,{a:o,b:s},{transposeA:a,transposeB:i})}}),aw=ry({fusedMatMul_:function(e){var t=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,h=e.preluActivationWeights,p=e.leakyreluAlpha;if(!1===Qx(Kg.state.gradientDepth,l)){var f=rw(t,r,i,s);return null!=u&&(f=Db(f,u)),Jx(f,l,h,p)}var d=ty(t,"a","fused matMul"),v=ty(r,"b","fused matMul"),m=n(Vg(d,v),2);d=m[0],v=m[1];var g=i?d.shape[d.rank-2]:d.shape[d.rank-1],y=s?v.shape[v.rank-1]:v.shape[v.rank-2],b=i?d.shape[d.rank-1]:d.shape[d.rank-2],k=s?v.shape[v.rank-2]:v.shape[v.rank-1],x=d.shape.slice(0,-2),w=v.shape.slice(0,-2),I=Lf(x),N=Lf(w);Df(d.rank>=2&&v.rank>=2&&d.rank===v.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks ".concat(d.rank," and ").concat(v.rank,".")}),Df(Pf(x,w),function(){return"Error in fused matMul: outer dimensions (".concat(x,") and (").concat(w,") of Tensors with shapes ").concat(d.shape," and ").concat(v.shape," must match.")}),Df(g===y,function(){return"Error in fused matMul: inner shapes (".concat(g,") and (").concat(y,") of Tensors with shapes ").concat(d.shape," and ").concat(v.shape," and transposeA=").concat(i," and transposeB=").concat(s," must match.")});var S,C,T=d.shape.slice(0,-2).concat([b,k]),E=Yb(d,i?[I,g,b]:[I,b,g]),_=Yb(v,s?[N,k,y]:[N,y,k]);null!=u&&(S=n(Vg(S=ty(u,"bias","fused matMul"),d),1)[0],kk(T,S.shape)),null!=h&&(C=ty(h,"prelu weights","fused matMul"));var R=function(e,t){var r,a,o=n(t,4),c=o[0],h=o[1],p=o[2],f=o[3],d=Yx(Yb(e,p.shape),p,l);return i||s?!i&&s?(r=rw(d,h,!1,!1),a=rw(d,c,!0,!1)):i&&!s?(r=rw(h,d,!1,!0),a=rw(c,d,!1,!1)):(r=rw(h,d,!0,!0),a=rw(d,c,!0,!0)):(r=rw(d,h,!1,!0),a=rw(c,d,!0,!1)),null!=u?[r,a,Zx(f,d)]:[r,a]},A={a:E,b:_,bias:S,preluActivationWeights:C},D={transposeA:i,transposeB:s,activation:l,leakyreluAlpha:p};return null==u?Eb(function(e,t,n){var r=Kg.runKernel(ag,A,D);return n([e,t,r]),{value:Yb(r,T),gradFunc:R}})(E,_):Eb(function(e,t,n,r){var a=Kg.runKernel(ag,A,D);return r([e,t,a,n]),{value:Yb(a,T),gradFunc:R}})(E,_,S)}});function iw(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Ax(a,"float32")}ry({hammingWindow_:function(e){return iw(e,.54,.46)}});var ow=ry({hannWindow_:function(e){return iw(e,.5,.5)}}),sw=ry({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(bx(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=ak([bx(e,i,t-s),Sk([s],a)]);o.push(u),i+=n}return 0===o.length?Dx([],[0,t]):Yb(ak(o),[o.length,t])}});ry({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ow;null==r&&(r=function(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}(t));for(var i=sw(e,t,n),o=Ok(i,a(t)),s=[],u=0;u<i.shape[0];u++)s.push(Hx(bx(o,[u,0],[1,t]),r));return ak(s)}});var uw=ry({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=ty(e,"image","cropAndResize"),s=ty(t,"boxes","cropAndResize","float32"),u=ty(n,"boxInd","cropAndResize","int32"),c=s.shape[0];return Df(4===o.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")}),Df(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")}),Df(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")}),Df(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")}),Df(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(r)}),Df("bilinear"===a||"nearest"===a,function(){return"method must be bilinear or nearest, but was ".concat(a)}),Kg.runKernel(Qd,{image:o,boxes:s,boxInd:u},{method:a,extrapolationValue:i,cropSize:r})}}),cw=ry({flipLeftRight_:function(e){var t=ty(e,"image","flipLeftRight","float32");return Df(4===t.rank,function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}),Kg.runKernel(mv,{image:t},{})}}),lw=ry({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=ty(e,"image","rotateWithOffset","float32");return Df(4===a.rank,function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}),Kg.runKernel(rg,{image:a},{radians:t,fillValue:n,center:r})}});function hw(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),Df(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")}),Df(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")}),Df(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])}),Df(1===t.rank,function(){return"scores must be a 1D tensor"}),Df(t.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ").concat(t.shape[0])}),Df(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var pw=ry({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=ty(e,"boxes","nonMaxSuppression"),o=ty(t,"scores","nonMaxSuppression"),s=hw(i,o,n,r,a);return Kg.runKernel(rm,{boxes:i,scores:o},{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold})}});function fw(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||dw)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function dw(e,t){return e>t?1:e<t?-1:0}function vw(e,t,n,r,a){return yw(e,t,n,r,a,0)}function mw(e,t,n,r,a,i){return yw(e,t,n,r,a,0,!1,i,!0)}function gw(e,t,n,r,a,i){return yw(e,t,n,r,a,i,!0)}function yw(e,t,n,r,a,o){for(var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=[],h=0;h<t.length;h++)t[h]>a&&l.push({score:t[h],boxIndex:h,suppressBeginIndex:0});l.sort(xw);for(var p=o>0?-.5/o:0,f=[],d=[];f.length<n&&l.length>0;){var v=l.pop(),m=v.score,g=v.boxIndex,y=v.suppressBeginIndex;if(m<a)break;for(var b=!1,k=f.length-1;k>=y;--k){var x=bw(e,g,f[k]);if(x>=r){b=!0;break}if(v.score=v.score*kw(r,p,x),v.score<=a)break}v.suppressBeginIndex=f.length,b||(v.score===m?(f.push(g),d.push(v.score)):v.score>a&&fw(l,v,xw))}var w=f.length,I=n-w;u&&I>0&&(f.push.apply(f,i(new Array(I).fill(0))),d.push.apply(d,i(new Array(I).fill(0))));var N={selectedIndices:f};return s&&(N.selectedScores=d),c&&(N.validOutputs=w),N}function bw(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),f=(s-i)*(u-o),d=(h-c)*(p-l);if(f<=0||d<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,p),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(f+d-b)}function kw(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function xw(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function ww(){return(ww=Sf(regeneratorRuntime.mark(function e(t,n,r){var a,i,o,s,u,c,l,h,p,f,d=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>3&&void 0!==d[3]?d[3]:.5,i=d.length>4&&void 0!==d[4]?d[4]:Number.NEGATIVE_INFINITY,o=ty(t,"boxes","nonMaxSuppressionAsync"),s=ty(n,"scores","nonMaxSuppressionAsync"),u=hw(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],h=c[1],p=vw(l,h,r,a,i),f=p.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),Ax(f,"int32")));case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Iw=ry({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=ty(e,"boxes","nonMaxSuppression"),s=ty(t,"scores","nonMaxSuppression"),u=hw(o,s,n,r,a,i),c=Kg.runKernel(im,{boxes:o,scores:s},{maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma});return{selectedIndices:c[0],selectedScores:c[1]}}});function Nw(){return(Nw=Sf(regeneratorRuntime.mark(function e(t,n,r){var a,i,o,s,u,c,l,h,p,f,d,v,m=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=m.length>3&&void 0!==m[3]?m[3]:.5,i=m.length>4&&void 0!==m[4]?m[4]:Number.NEGATIVE_INFINITY,o=m.length>5&&void 0!==m[5]?m[5]:0,s=ty(t,"boxes","nonMaxSuppressionAsync"),u=ty(n,"scores","nonMaxSuppressionAsync"),c=hw(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,h=l[0],p=l[1],f=gw(h,p,r,a,i,o),d=f.selectedIndices,v=f.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:Ax(d,"int32"),selectedScores:Ax(v)}));case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Sw=ry({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=ty(e,"boxes","nonMaxSuppression"),s=ty(t,"scores","nonMaxSuppression"),u=hw(o,s,n,r,a,null),c=Kg.runKernel(am,{boxes:o,scores:s},{maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i});return{selectedIndices:c[0],validOutputs:c[1]}}});function Cw(){return(Cw=Sf(regeneratorRuntime.mark(function e(t,r,a){var i,o,s,u,c,l,h,p,f,d,v,m,g,y,b,k,x=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=x.length>3&&void 0!==x[3]?x[3]:.5,o=x.length>4&&void 0!==x[4]?x[4]:Number.NEGATIVE_INFINITY,s=x.length>5&&void 0!==x[5]&&x[5],u=ty(t,"boxes","nonMaxSuppressionAsync"),c=ty(r,"scores","nonMaxSuppressionAsync"),l=hw(u,c,a,i,o,null),h=l.maxOutputSize,p=l.iouThreshold,f=l.scoreThreshold,e.next=11,Promise.all([u.data(),c.data()]);case 11:return d=e.sent,v=n(d,2),m=v[0],g=v[1],y=mw(m,g,h,p,f,s),b=y.selectedIndices,k=y.validOutputs,e.abrupt("return",(u!==t&&u.dispose(),c!==r&&c.dispose(),{selectedIndices:Ax(b,"int32"),validOutputs:_b(k,"int32")}));case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Tw=ry({resizeBilinear_:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=ty(t,"images","resizeBilinear");Df(3===i.rank||4===i.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(i.rank,".")}),Df(2===n.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(n,".")}),Df(!1===a||!1===r,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var o=i,s=!1;3===i.rank&&(s=!0,o=Yb(i,[1,i.shape[0],i.shape[1],i.shape[2]]));e(n);var u=Kg.runKernel(km,{images:o},{alignCorners:r,halfPixelCenters:a,size:n});return s?Yb(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Ew=ry({resizeNearestNeighbor_:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=ty(t,"images","resizeNearestNeighbor");Df(3===i.rank||4===i.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(i.rank,".")}),Df(2===n.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(n,".")}),Df("float32"===i.dtype||"int32"===i.dtype,function(){return"`images` must have `int32` or `float32` as dtype"}),Df(!1===a||!1===r,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var o=i,s=!1;3===i.rank&&(s=!0,o=Yb(i,[1,i.shape[0],i.shape[1],i.shape[2]]));e(n);var u=Kg.runKernel(ym,{images:o},{alignCorners:r,halfPixelCenters:a,size:n});return s?Yb(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),_w=ry({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=ty(e,"image","transform","float32"),s=ty(t,"transforms","transform","float32");return Df(4===o.rank,function(){return"Error in transform: image must be rank 4,but got rank ".concat(o.rank,".")}),Df(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),Df(null==i||2===i.length,function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")}),Kg.runKernel(Ym,{image:o,transforms:s},{interpolation:n,fillMode:r,fillValue:a,outputShape:i})}}),Rw=ry({lessEqual_:function(e,t){var r,a=ty(e,"a","lessEqual"),i=ty(t,"b","lessEqual");return a=(r=n(Vg(a,i),2))[0],i=r[1],kk(a.shape,i.shape),Kg.runKernel(Dv,{a:a,b:i})}});function Aw(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");return Kg.runKernel(fm,{},{start:e,stop:t,step:n,dtype:r})}var Dw=ry({bandPart_:function(e,t,r){Df(t%1==0,function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")}),Df(r%1==0,function(){return"bandPart(): numUpper must be an integer, got ".concat(r,".")});var a=ty(e,"a","bandPart");Df(a.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(a.rank,".")});var i=a.shape,o=n(a.shape.slice(-2),2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(s,")."));if(!(r<=u))throw new Error("bandPart(): numUpper (".concat(r,") must not be greater than the number of columns (").concat(u,")."));t<0&&(t=s),r<0&&(r=u);var c=Yb(Aw(0,s,1,"int32"),[-1,1]),l=Aw(0,u,1,"int32"),h=Mk(c,l),p=zk(Rw(h,_b(+t,"int32")),_k(h,_b(-r,"int32"))),f=ax([s,u],a.dtype);return Yb(_x(Ox(Yb(a,[-1,s,u])).map(function(e){return Lx(p,e,f)})),i)}}),Fw=ry({pow_:function(e,t){var r,a=ty(e,"base","pow"),i=ty(t,"exp","pow");return a=(r=n(Vg(a,i),2))[0],i=r[1],Kg.runKernel(lm,{a:a,b:i})}});function Ow(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Ab(e);if(1!==e.rank&&null===n)return Ow(Yb(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Lk(Ab(e),n);if(t===1/0)return Fk(Ab(e),n);if(t===-1/0)return Hk(Ab(e),n);if("euclidean"===t||2===t)return Tx(Lk(Fw(Ab(e),_b(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Fk(Lk(Ab(e),n[0]),n[1]-1);if(t===1/0)return Fk(Lk(Ab(e),n[1]),n[0]);if(t===-1/0)return Hk(Lk(Ab(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Tx(Lk($k(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Mw=ry({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ow(e=ty(e,"x","norm"),t,n),i=a.shape;if(r){var o=Hf(n,e.shape);i=Xk(a.shape,o)}return Yb(a,i)}}),Lw=ry({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,Df(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){Df(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")})},a=1;a<e.length;++a)r(a)}():(t=!0,e=Cx(e,e.shape[0],0).map(function(e){return Ex(e,[0])})),Df(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")});for(var n=[],r=e,a=function(e){n.push(Kg.tidy(function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=Ok(Lk(Ok(n[a],t)),n[a]);t=Mk(t,i)}return mk(t,Mw(t,"euclidean"))}))},i=0;i<e.length;++i)a(i);return t?_x(n,0):n}});function Pw(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Kg.tidy(function(){Df(2===e.shape.length,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")});for(var r=e.shape[0],a=e.shape[1],i=Nk(r),o=Hy(e),s=Dx([[1]],[1,1]),u=Hy(s),c=r>=a?a:r,l=function(e){var t,c=o,l=u,h=i;t=n(Kg.tidy(function(){var t=bx(o,[e,e],[r-e,1]),n=Mw(t),c=bx(o,[e,e],[1,1]),l=Lx(Ek(c,0),Dx([[-1]]),Dx([[1]])),h=Mk(c,Ok(l,n)),p=mk(t,h);u=1===p.shape[0]?Hy(s):ak([s,bx(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);var f=tx(mk(rw(l,h),n)),d=bx(o,[e,0],[r-e,a]),v=Ok(f,u),m=zx(u);if(0===e)o=Mk(d,rw(v,rw(m,d)));else{var g=Mk(d,rw(v,rw(m,d)));o=ak([bx(o,[0,0],[e,a]),g],0)}var y=zx(v),b=bx(i,[0,e],[r,i.shape[1]-e]);if(0===e)i=Mk(b,rw(rw(b,u),y));else{var k=Mk(b,rw(rw(b,u),y));i=ak([bx(i,[0,0],[r,e]),k],1)}return[u,o,i]}),3),u=t[0],o=t[1],i=t[2],Nb([c,l,h])},h=0;h<c;++h)l(h);return!t&&r>a&&(i=bx(i,[0,0],[r,a]),o=bx(o,[0,0],[a,a])),[i,o]})}var zw=ry({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Df(e.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)}),2===e.rank)return Pw(e,t);var r=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),a=Ox(Yb(e,[r,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],o=[];return a.forEach(function(e){var r=n(Pw(e,t),2),a=r[0],s=r[1];i.push(a),o.push(s)}),[Yb(_x(i,0),e.shape),Yb(_x(o,0),e.shape)]}}),Bw=(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Bw||(Bw={})),Bw),Vw=ry({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bw.SUM_BY_NONZERO_WEIGHTS,r=ty(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=ty(t,"weights","computeWeightedLoss"));var i=null==a?r:Ok(r,a);if(n===Bw.NONE)return i;if(n===Bw.SUM)return Lk(i);if(n===Bw.MEAN){if(null==a)return Uk(i);var o=r.size/a.size,s=mk(Lk(i),Lk(a));return o>1?mk(s,_b(o)):s}if(n===Bw.SUM_BY_NONZERO_WEIGHTS){if(null==a)return mk(Lk(i),_b(r.size));var u=Ok(a,ix(r.shape)),c=Uy(Lk(nx(u,_b(0))),"float32");return mk(Lk(i),c)}throw Error("Unknown reduction: ".concat(n))}});ry({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bw.SUM_BY_NONZERO_WEIGHTS,a=ty(e,"labels","absoluteDifference"),i=ty(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=ty(n,"weights","absoluteDifference")),Ff(a.shape,i.shape,"Error in absoluteDifference: ");var s=Ab(Mk(a,i));return Vw(s,o,r)}}),ry({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bw.SUM_BY_NONZERO_WEIGHTS,i=ty(e,"labels","cosineDistance"),o=ty(t,"predictions","cosineDistance"),s=null;null!=r&&(s=ty(r,"weights","cosineDistance")),Ff(i.shape,o.shape,"Error in cosineDistance: ");var u=_b(1),c=Mk(u,Lk(Ok(i,o),n,!0));return Vw(c,s,a)}}),ry({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bw.SUM_BY_NONZERO_WEIGHTS,a=ty(e,"labels","hingeLoss"),i=ty(t,"predictions","hingeLoss"),o=null;null!=n&&(o=ty(n,"weights","hingeLoss")),Ff(a.shape,i.shape,"Error in hingeLoss: ");var s=_b(1);a=Mk(Ok(_b(2),a),s);var u=dx(Mk(s,Ok(a,i)));return Vw(u,o,r)}}),ry({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bw.SUM_BY_NONZERO_WEIGHTS,i=ty(e,"labels","huberLoss"),o=ty(t,"predictions","huberLoss"),s=null;null!=n&&(s=ty(n,"weights","huberLoss")),Ff(i.shape,o.shape,"Error in huberLoss: ");var u=_b(r),c=Ab(Mk(o,i)),l=jk(c,u),h=Mk(c,l),p=Db(Ok(_b(.5),$k(l)),Ok(u,h));return Vw(p,s,a)}}),ry({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bw.SUM_BY_NONZERO_WEIGHTS,i=ty(e,"labels","logLoss"),o=ty(t,"predictions","logLoss"),s=null;null!=n&&(s=ty(n,"weights","logLoss")),Ff(i.shape,o.shape,"Error in logLoss: ");var u=_b(1),c=_b(r),l=tx(Ok(i,Ak(Db(o,c)))),h=Ok(Mk(u,i),Ak(Db(Mk(u,o),c))),p=Mk(l,h);return Vw(p,s,a)}});var Ww=ry({squaredDifference_:function(e,t){var r,a=ty(e,"a","squaredDifference"),i=ty(t,"b","squaredDifference");return a=(r=n(Vg(a,i),2))[0],i=r[1],kk(a.shape,i.shape),Kg.runKernel(Vm,{a:a,b:i},{})}});ry({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bw.SUM_BY_NONZERO_WEIGHTS,a=ty(e,"labels","meanSquaredError"),i=ty(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=ty(n,"weights","meanSquaredError")),Ff(a.shape,i.shape,"Error in meanSquaredError: ");var s=Ww(a,i);return Vw(s,o,r)}});var Uw=ry({log1p_:function(e){var t={x:ty(e,"x","log1p")};return Kg.runKernel(Mv,t)}});ry({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bw.SUM_BY_NONZERO_WEIGHTS,i=ty(e,"multiClassLabels","sigmoidCrossEntropy"),o=ty(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=ty(n,"weights","sigmoidCrossEntropy")),Ff(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=_b(r),c=_b(1),l=_b(.5);i=Db(Ok(i,Mk(c,u)),Ok(l,u))}var h=function(e,t){var n=ty(e,"labels","sigmoidCrossEntropyWithLogits"),r=ty(t,"logits","sigmoidCrossEntropyWithLogits");Ff(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=dx(r),i=Ok(r,n),o=Uw(Dk(tx(Ab(r))));return Db(Mk(a,i),o)}(i,o);return Vw(h,s,a)}});var Hw=ry({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=ty(e,"x","logSumExp"),a=Hf(t,r.shape),i=Fk(r,a,!0),o=Mk(r,i),s=Dk(o),u=Lk(s,a),c=Ak(u),l=Db(Yb(i,c.shape),c);if(n){var h=Xk(l.shape,a);return Yb(l,h)}return l}});ry({softmaxCrossEntropy_:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bw.SUM_BY_NONZERO_WEIGHTS,o=ty(e,"onehotLabels","softmaxCrossEntropy"),s=ty(t,"logits","softmaxCrossEntropy"),u=null;if(null!=r&&(u=ty(r,"weights","softmaxCrossEntropy")),Ff(o.shape,s.shape,"Error in softmaxCrossEntropy: "),a>0){var c=_b(a),l=_b(1),h=_b(o.shape[1]);o=Db(Ok(o,Mk(l,c)),mk(c,h))}var p=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===r&&(r=t.rank-1),r!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(r));return Eb(function(e,t,a){var i=Hw(t,[r],!0),o=Mk(Uy(t,"float32"),i);a([e,o]);var s=tx(Ok(o,e));return{value:Lk(s,[r]),gradFunc:function(e,t){var a=n(t,2),i=a[0],o=a[1],s=Xk(e.shape,[r]);return[Ok(Yb(e,s),Mk(Uy(i,"float32"),Dk(o))),Ok(Yb(e,s),Mk(Dk(o),Uy(i,"float32")))]}}})(e,t)}(o,s);return Vw(p,u,i)}});var jw={flipLeftRight:cw,resizeNearestNeighbor:Ew,resizeBilinear:Tw,rotateWithOffset:lw,cropAndResize:uw,nonMaxSuppression:pw,nonMaxSuppressionAsync:function(e,t,n){return ww.apply(this,arguments)},nonMaxSuppressionWithScore:Iw,nonMaxSuppressionWithScoreAsync:function(e,t,n){return Nw.apply(this,arguments)},nonMaxSuppressionPadded:Sw,nonMaxSuppressionPaddedAsync:function(e,t,n){return Cw.apply(this,arguments)},transform:_w},Gw={bandPart:Dw,gramSchmidt:Lw,qr:zw},qw=function(){var e=function(e){d(n,e);var t=m(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return x(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Kg.backend.epsilon()),a}return I(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Kg.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:Ib(function(){return Px(a).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:Ib(function(){return Px(a).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Ib(function(){var e=Db(Ok(o,t.rho),Ok($k(i),1-t.rho)),n=Ok(mk(Tx(Db(s,t.epsilon)),Tx(Db(o,t.epsilon))),i),r=Db(Ok(s,t.rho),Ok($k(n),1-t.rho));o.assign(e),s.assign(r);var u=Db(Ok(n,-t.learningRate),a);a.assign(u)})}}),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Nb(this.accumulatedGrads.map(function(e){return e.variable})),Nb(this.accumulatedUpdates.map(function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[].concat(i(e.accumulatedGrads),i(e.accumulatedUpdates)),t.next=3,e.saveIterations();case 3:return t.t0=t.sent,t.abrupt("return",[t.t0].concat(n.map(function(e){return{name:e.originalName,tensor:e.variable}})));case 5:case"end":return t.stop()}},t)}))()}},{key:"setWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.extractIterations(e);case 2:n.t0=(e=n.sent).length,r=n.t0/2,t.accumulatedGrads=e.slice(0,r).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),t.accumulatedUpdates=e.slice(r,2*r).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}});case 5:case"end":return n.stop()}},n)}))()}},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(Rb);return e.className="Adadelta",e}();kb(qw);var Kw=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return x(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return I(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Kg.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:Ib(function(){return Sk(a.shape,t.initialAccumulatorValue).variable(false)})}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;Ib(function(){var e=Db(o,$k(i));o.assign(e);var n=Db(Ok(mk(i,Tx(Db(e,Kg.backend.epsilon()))),-t.learningRate),a);a.assign(n)})}}),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Nb(this.accumulatedGrads.map(function(e){return e.variable}))}},{key:"getWeights",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.saveIterations();case 2:return t.t0=t.sent,t.abrupt("return",[t.t0].concat(e.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}})));case 4:case"end":return t.stop()}},t)}))()}},{key:"setWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.extractIterations(e);case 2:e=n.sent,t.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}});case 4:case"end":return n.stop()}},n)}))()}},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(Rb);return e.className="Adagrad",e}();kb(Kw);var Xw=function(){var e=function(e){d(n,e);var t=m(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return x(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Ib(function(){i.accBeta1=_b(r).variable(),i.accBeta2=_b(a).variable()}),null==o&&(i.epsilon=Kg.backend.epsilon()),i}return I(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Ib(function(){var r=Mk(1,t.accBeta1),a=Mk(1,t.accBeta2);n.forEach(function(n,i){var o=Kg.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Ib(function(){return Px(o).variable(!1)})}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:Ib(function(){return Px(o).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Db(Ok(u,t.beta1),Ok(s,1-t.beta1)),h=Db(Ok(c,t.beta2),Ok($k(s),1-t.beta2)),p=mk(l,r),f=mk(h,a);u.assign(l),c.assign(h);var d=Db(Ok(mk(p,Db(Tx(f),t.epsilon)),-t.learningRate),o);o.assign(d)}}),t.accBeta1.assign(Ok(t.accBeta1,t.beta1)),t.accBeta2.assign(Ok(t.accBeta2,t.beta2))}),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Nb(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Nb(this.accumulatedSecondMoment.map(function(e){return e.variable}))}},{key:"getWeights",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[].concat(i(e.accumulatedFirstMoment),i(e.accumulatedSecondMoment)),t.next=3,e.saveIterations();case 3:return t.t0=t.sent,t.abrupt("return",[t.t0].concat(n.map(function(e){return{name:e.originalName,tensor:e.variable}})));case 5:case"end":return t.stop()}},t)}))()}},{key:"setWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.extractIterations(e);case 2:e=n.sent,Ib(function(){t.accBeta1.assign(Fw(t.beta1,t.iterations_+1)),t.accBeta2.assign(Fw(t.beta2,t.iterations_+1))}),r=e.length/2,t.accumulatedFirstMoment=e.slice(0,r).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),t.accumulatedSecondMoment=e.slice(r,2*r).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}});case 6:case"end":return n.stop()}},n)}))()}},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(Rb);return e.className="Adam",e}();kb(Xw);var Yw=function(){var e=function(e){d(n,e);var t=m(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return x(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Ib(function(){i.iteration=_b(0).variable(),i.accBeta1=_b(r).variable()}),null==o&&(i.epsilon=Kg.backend.epsilon()),i}return I(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Ib(function(){var r=Mk(1,t.accBeta1),a=mk(-t.learningRate,Db(Ok(t.iteration,t.decay),1));n.forEach(function(n,i){var o=Kg.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Px(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Px(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Db(Ok(u,t.beta1),Ok(s,1-t.beta1)),h=Ok(c,t.beta2),p=Ab(s),f=Wk(h,p);u.assign(l),c.assign(f);var d=Db(Ok(mk(a,r),mk(l,Db(f,t.epsilon))),o);o.assign(d)}}),t.iteration.assign(Db(t.iteration,1)),t.accBeta1.assign(Ok(t.accBeta1,t.beta1))}),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Nb(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Nb(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))}},{key:"getWeights",value:function(){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}},e)}))()}},{key:"setWeights",value:function(e){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}},e)}))()}},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(Rb);return e.className="Adamax",e}();kb(Yw);var Zw=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return I(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Kg.registeredVariables[n];Ib(function(){var e=Db(Ok(t.c,a),i);i.assign(e)})}}),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Sb(_b(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.saveIterations();case 2:return t.t0=t.sent,t.abrupt("return",[t.t0]);case 4:case"end":return t.stop()}},t)}))()}},{key:"setWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.extractIterations(e);case 2:if(n.t0=(e=n.sent).length,0===n.t0){n.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return n.stop()}},n)}))()}},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(Rb);return e.className="SGD",e}();kb(Zw);var Jw=function(){var e=function(e){d(n,e);var t=m(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return x(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=_b(a.momentum),a}return I(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Kg.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:Ib(function(){return Px(a).variable(false)})}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Ib(function(){var e,n=Db(Ok(t.m,i),o);e=Db(Ok(t.c,t.useNesterov?Db(o,Ok(n,t.m)):n),a),i.assign(n),a.assign(e)})}),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Nb(this.accumulations.map(function(e){return e.variable}))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.saveIterations();case 2:return t.t0=t.sent,t.abrupt("return",[t.t0].concat(e.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}})));case 4:case"end":return t.stop()}},t)}))()}},{key:"setWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.extractIterations(e);case 2:e=n.sent,t.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}});case 4:case"end":return n.stop()}},n)}))()}},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(Zw);return e.className="Momentum",e}();kb(Jw);var Qw=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(x(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Kg.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return g(r)}return I(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Kg.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:Ib(function(){return Px(a).variable(i)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:Ib(function(){return Px(a).variable(i)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:Ib(function(){return Px(a).variable(i)})});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;Ib(function(){var e=Db(Ok(s,t.decay),Ok($k(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=Db(Ok(n,t.decay),Ok(o,1-t.decay)),c=mk(Ok(o,t.learningRate),Tx(Mk(e,Db($k(i),t.epsilon)))),l=Db(Ok(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var h=Mk(a,l);a.assign(h)}else{var p=Db(Ok(s,t.decay),Ok($k(o),1-t.decay)),f=Db(Ok(u,t.momentum),mk(Ok(o,t.learningRate),Tx(Db(p,t.epsilon))));s.assign(p),u.assign(f);var d=Mk(a,f);a.assign(d)}})}}),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Nb(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Nb(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Nb(this.accumulatedMoments.map(function(e){return e.variable}))}},{key:"getWeights",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[].concat(i(e.accumulatedMeanSquares),i(e.accumulatedMoments)),e.centered&&n.push.apply(n,i(e.accumulatedMeanGrads)),t.next=4,e.saveIterations();case 4:return t.t0=t.sent,t.abrupt("return",[t.t0].concat(n.map(function(e){return{name:e.originalName,tensor:e.variable}})));case 6:case"end":return t.stop()}},t)}))()}},{key:"setWeights",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.extractIterations(e);case 2:e=n.sent,r=t.centered?e.length/3:e.length/2,a=!1,t.accumulatedMeanSquares=e.slice(0,r).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}}),t.accumulatedMoments=e.slice(r,2*r).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}}),t.centered&&(t.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}}));case 5:case"end":return n.stop()}},n)}))()}},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(Rb);return e.className="RMSProp",e}();kb(Qw);var $w=function(){function e(){x(this,e)}return I(e,null,[{key:"sgd",value:function(e){return new Zw(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Jw(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new Qw(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Xw(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new qw(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Yw(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new Kw(e,t)}}]),e}(),eI={sgd:$w.sgd,momentum:$w.momentum,adadelta:$w.adadelta,adagrad:$w.adagrad,rmsprop:$w.rmsprop,adamax:$w.adamax,adam:$w.adam},tI="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function nI(){return new Promise(function(e){return tI(function(){return e()})})}function rI(e,t){var n=e[0].length;e.forEach(function(e,t){Df(e.length===n,function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")})}),Df(t>=0&&t<n,function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")});var r=e[0];e.forEach(function(e,a){for(var i=0;i<n;i++)Df(i===t||e[i]===r[i],function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")})})}function aI(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}var iI=30;function oI(e){return e<=iI?e:ed(e,Math.floor(Math.sqrt(e)))}function sI(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function uI(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function cI(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2==1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function lI(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];a.push(r?e[0]/n:e[0]*n);for(var i=1;i<e.length;++i)a.push(i<=t.length?r?t[i-1]*e[i]:e[i]/t[i-1]:e[i]);return a}function hI(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function pI(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function fI(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===Lf(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,o=a[a.length-1],s=1,u=0;u<a.length-1;++u)s*=a[u];var c=e.shape,l=a.slice();l.pop();for(var h=1,p=o;p<n;++p)h*=c[p],l.push(c[p]);var f=[].concat(i(td(e.shape).map(function(e){return e/h})),[1]).slice(0,o);return[l,s,h,f]}function dI(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function vI(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}dI(n,t,e)}function mI(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,o=n.length,s=1,u=a;u<o;++u)s*=n[u];var c=a<1?1:a;return{sliceRank:a,numUpdates:Lf(t.shape)/c,sliceSize:s,strides:[].concat(i(td(n.slice(0,a))),[1]),outputSize:Lf(n)}}var gI=1.7580993408473768,yI=1.0507009873554805,bI=.3275911,kI=.254829592,xI=-.284496736,wI=1.421413741,II=-1.453152027,NI=1.061405429;function SI(){var e;fd().getBool("IS_TEST")||(e=console).warn.apply(e,arguments)}function CI(){var e;fd().getBool("IS_TEST")||(e=console).log.apply(e,arguments)}function TI(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function EI(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function _I(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function RI(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function AI(e,t){return{real:e[2*t],imag:e[2*t+1]}}function DI(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function FI(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function OI(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function MI(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)Df(e.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(e.shape[n]/t);else{Df(t.reduce(function(e,t){return-1===t&&(e+=1),e},0)<=1,function(){return"There should be only one negative value in split array."});var a=t.indexOf(-1);if(-1!==a){var i=t.reduce(function(e,t){return t>0?e+t:e});t[a]=e.shape[n]-i}Df(e.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t}return r}function LI(e,t){var n,r=!1;for(e<=iI?(n=e,r=!0):n=ed(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ed(e,n+1);return n}function PI(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)r.push(i!==t?e[i]:n);return r}function zI(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,h=1,p=0;p<r;++p)u.push(e.shape[p]),c*=e.shape[p];for(var f=r;f<n;f++)u.push(e.shape[f]),l*=e.shape[f];for(var d=r;d<a;d++)u.push(t.shape[d]);for(var v=n+1;v<i;v++)u.push(e.shape[v]),h*=e.shape[v];return{batchSize:c,sliceSize:h,outerSize:l,dimSize:s,outputShape:u}}function BI(e){try{return e.map(function(e){return bg(e)})}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(t))}}function VI(e){return e.map(function(e){return yg(e)})}function WI(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=Wy(e,"int32"),i=Wy([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]);i.values.set(s,o*e.length)}return i.toTensor()}var UI={kernelName:yd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(e,Xx(Uy(r,"float32"),-1))}}}},HI={kernelName:bd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){var t=$k(Uy(r,"float32")),n=Tx(Mk(_b(1),t));return tx(mk(e,n))}}}},jI={kernelName:kd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){var t=Tx(Mk($k(Uy(r,"float32")),1));return mk(e,t)}}}},GI={kernelName:xd,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=kk(a.shape,i.shape);return{a:function(){var t=e,n=bk(a.shape,o);return n.length>0&&(t=Lk(t,n)),Yb(t,a.shape)},b:function(){var t=e,n=bk(i.shape,o);return n.length>0&&(t=Lk(t,n)),Yb(t,i.shape)}}}},qI={kernelName:wd,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n}},KI={kernelName:Id,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Px(r)}}}},XI={kernelName:Nd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Px(r)}}}},YI={kernelName:Sd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,Tx(Mk(_b(1),$k(Uy(r,"float32")))))}}}},ZI={kernelName:Cd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){var t=Tx(Db(_b(1),$k(Uy(r,"float32"))));return mk(e,t)}}}},JI={kernelName:_d,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=kk(a.shape,i.shape);return{a:function(){var t=Db($k(a),$k(i)),n=Ok(e,mk(i,t)),r=bk(a.shape,o);return r.length>0&&(n=Lk(n,r)),Yb(n,a.shape)},b:function(){var t=Db($k(a),$k(i)),n=tx(Ok(e,mk(a,t))),r=bk(i.shape,o);return r.length>0&&(n=Lk(n,r)),Yb(n,i.shape)}}}},QI={kernelName:Td,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,Db($k(Uy(r,"float32")),1))}}}},$I={kernelName:Ed,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,Mk(_b(1),$k(Uy(r,"float32"))))}}}},eN=ry({avgPool3dGrad_:function(e,t,n,r,a,i){var o=ty(e,"dy","avgPool3dGrad"),s=ty(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=Yb(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Yb(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Df(5===u.rank,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(u.rank,".")}),Df(5===c.rank,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,".")}),null!=i&&Df(zf(a),function(){return"Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ".concat(i," but got pad ").concat(a,".")});var h=Kg.runKernel(Fd,{dy:u,input:c},{filterSize:n,strides:r,pad:a,dimRoundingMode:i});return l?Yb(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),tN={kernelName:Dd,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;return{x:function(){return eN(e,a,i,o,s,u)}}}},nN=ry({avgPoolGrad_:function(e,t,n,r,a){var i=ty(e,"dy","avgPoolGrad"),o=ty(t,"input","avgPoolGrad");Df(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=Yb(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Yb(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Df(4===u.rank,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(u.rank,".")}),Df(4===s.rank,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")});var l=Kg.runKernel(Ad,{dy:u,input:s},{filterSize:n,strides:r,pad:a});return c?Yb(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),rN={kernelName:Rd,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.filterSize,o=r.strides,s=r.pad;return{x:function(){return nN(e,a,i,o,s)}}}},aN={kernelName:Od,inputsToSave:["a","b"],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s=r.transposeA,u=r.transposeB;return s||u?!s&&u?{a:function(){return rw(e,o,!1,!1)},b:function(){return rw(e,i,!0,!1)}}:s&&!u?{a:function(){return rw(o,e,!1,!0)},b:function(){return rw(i,e,!1,!1)}}:{a:function(){return rw(o,e,!0,!0)},b:function(){return rw(e,i,!0,!0)}}:{a:function(){return rw(e,o,!1,!0)},b:function(){return rw(i,e,!0,!1)}}}},iN=ry({spaceToBatchND_:function(e,t,n){var r=ty(e,"x","spaceToBatchND");return Df(r.rank>=1+t.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)}),Df(n.length===t.length,function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)}),Df(r.shape.reduce(function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}),Kg.runKernel(Pm,{x:r},{blockShape:t,paddings:n})}}),oN={kernelName:Md,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return iN(e,r,a)}}}},sN={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n.inputShape,a=n.shape,i=Array.from(a),o=r.length-1;o>=0;o--)if(r[o]===a[o])i[o]=1;else if(1!==r[o])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(a,"]."));for(var s=[],u=0;u<i.length;u++)i[u]>1&&s.push(u);return{x:function(){return Lk(e,s,!0)}}}},uN={kernelName:Pd,gradFunc:function(e){return{x:function(){return e.clone()}}}},cN={kernelName:zd,gradFunc:function(e){return{x:function(){return Px(e)}}}},lN={kernelName:Bd,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.clipValueMin,o=r.clipValueMax;return{x:function(){return Lx(zk(_k(a,i),Rw(a,o)),e,Px(e))}}}},hN={kernelName:Wd,inputsToSave:["x"],gradFunc:UI.gradFunc},pN={kernelName:Ud,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map(function(e){return e.shape}),a=Hf(n.axis,t[0].shape)[0],i=r.map(function(e){return e[a]});return Cx(e,i,a).map(function(e){return function(){return e}})}},fN={kernelName:Hd,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s=r.dilations,u=r.strides,c=r.pad,l=r.dataFormat;return Df(qb(s),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(s,"'")}),{x:function(){return hk(i.shape,e,o,u,c,l)},filter:function(){return qx(i,e,o.shape,u,c,l)}}}},dN={kernelName:Gd,inputsToSave:["dy","filter"],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;return{dy:function(){return ck(e,o,s,u,c,1,l)},filter:function(){return qx(e,i,o.shape,s,u,c,l)}}}},vN=ry({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Yb(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;return 4===o.rank&&(o=Yb(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),Df(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,".")}),Df(5===o.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(o.shape,".")}),Df(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,".")}),Df(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")}),Df(o.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")}),Kg.runKernel(Kd,{x:i,dy:o},{strides:r,pad:a,filterShape:n})}}),mN=ry({conv3DBackpropInput_:function(e,t,n,r,a){Df(e.length===t.rank,function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")});var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=Yb(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];Df(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,".")}),Df(5===o.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(o.rank)}),Df(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank)}),Df(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")}),Df(c===n.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")});var l=Kg.runKernel(Xd,{dy:o,filter:n},{pad:a,strides:r,inputShape:i});return s?Yb(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),gN={kernelName:qd,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var a=r.dilations,i=r.strides,o=r.pad;Df(qb(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(a,"'")});var s=n(t,2),u=s[0],c=s[1];return{x:function(){return mN(u.shape,e,c,i,o)},filter:function(){return vN(u,e,c.shape,i,o)}}}},yN=ry({sin_:function(e){var t={x:ty(e,"x","sin")};return Kg.runKernel(Rm,t)}}),bN={kernelName:Yd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(tx(yN(Uy(r,"float32"))),e)}}}},kN=ry({sinh_:function(e){var t={x:ty(e,"x","sinh")};return Kg.runKernel(Am,t)}}),xN={kernelName:Zd,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(kN(Uy(r,"float32")),e)}}}},wN=ry({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:ty(e,"x","cumsum")};return Kg.runKernel(Jd,a,{axis:t,exclusive:n,reverse:r})}}),IN={kernelName:Jd,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.axis,o=r.exclusive,s=r.reverse;return{x:function(){var t=Zk([i],a.rank),n=wN(e,i,o,!s);return null!=t&&(n=zx(n,t)),n}}}},NN={kernelName:tv,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var a=r.dilations,i=r.strides,o=r.pad,s=r.dimRoundingMode,u=null==a?[1,1]:a;Df(qb(u),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(u,"'")});var c=n(t,2),l=c[0],h=c[1];return Df(4===l.rank,function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(l.rank,".")}),Df(4===h.rank,function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(h.rank,".")}),Df(l.shape[3]===h.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(l.shape[3],") must match the inChannels dimension in filter ").concat(h.shape[2],".")}),Df(Kb(i,u),function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(i," and dilations '").concat(u,"'.")}),null!=s&&Df(zf(o),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}),{x:function(){return tw(l.shape,e,h,i,o,a,s)},filter:function(){return ew(l,e,h.shape,i,o,a,s)}}}},SN={kernelName:av,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s={x:i,filter:o,dy:e},u={x:i,filter:o,dy:e};return{x:function(){return Kg.runKernel(iv,s,r)},filter:function(){return Kg.runKernel(ov,u,r)}}}},CN={kernelName:uv,outputsToSave:[!0],gradFunc:function(e,t){var r={dy:e,y:n(t,1)[0]};return{x:function(){return Kg.runKernel(cv,r)}}}},TN={kernelName:lv,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0],a=Ok(Dk(tx($k(r))),2/Math.sqrt(Math.PI));return{x:function(){return Ok(e,a)}}}},EN={kernelName:pv,outputsToSave:[!0],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(e,r)}}}},_N={kernelName:fv,inputsToSave:["input"],gradFunc:function(e,t){var r=n(t,1)[0];return{input:function(){return Yb(e,r.shape)}}}},RN={kernelName:dv,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(e,Dk(r))}}}},AN={kernelName:gv,gradFunc:function(e){return{x:function(){return Px(e)}}}},DN={kernelName:yv,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=kk(a.shape,i.shape);return{a:function(){var t=mk(e,Uy(i,"float32")),n=bk(a.shape,o);return n.length>0?Yb(Lk(t,n),a.shape):t},b:function(){var t=Ok(e,Uy(a,"float32")),n=bk(i.shape,o);n.length>0&&(t=Yb(Lk(t,n),i.shape));var r=$k(i);return tx(mk(t,Uy(r,"float32")))}}}},FN=ry({rsqrt_:function(e){var t={x:ty(e,"x","rsqrt")};return Kg.runKernel(Sm,t)}}),ON={kernelName:bv,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,r){var a=r.varianceEpsilon,i=n(t,4),o=i[0],s=i[1],u=i[2],c=i[3],l=null==c?_b(1):c,h=bk(s.shape,o.shape),p=[];if(1===s.rank){for(var f=0;f<o.shape.length-1;++f)p.push(o.shape[f]);p.push(1)}var d=Mk(o,s),v=Ok(e,l),m=FN(Db(u,_b(a))),g=Ok(Ok(Ok(m,m),m),_b(-.5));return{x:function(){return Yb(Ok(Ok(e,1===s.rank?Ik(Yb(m,[1,1,1,s.shape[0]]),p):m),l),o.shape)},mean:function(){var e=Ok(Ok(m,_b(-1)),v);return 1===s.rank&&(e=Lk(e,h)),Yb(e,s.shape)},variance:function(){var e=Ok(Ok(g,d),v);return 1===s.rank&&(e=Lk(e,h)),Yb(e,s.shape)},scale:function(){var t=Ok(d,m),n=Ok(e,t);return 1===s.rank&&(n=Lk(n,h)),Yb(n,s.shape)},offset:function(){var t=e;return 1===s.rank&&(t=Lk(t,h)),Yb(t,s.shape)}}}},MN=ry({unsortedSegmentSum_:function(e,t,n){var r=ty(e,"x","unsortedSegmentSum"),a=ty(t,"segmentIds","unsortedSegmentSum","int32");return Df(zf(n),function(){return"numSegments must be of dtype int"}),Kg.runKernel($m,{x:r,segmentIds:a},{numSegments:n})}}),LN={kernelName:kv,inputsToSave:["x","indices"],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s=r.axis,u=Hf(s,i.shape)[0];return{x:function(){var t=i.shape,n=o.size,r=t.slice(0,u),a=r.length,c=t.slice(s,t.length).slice(1),l=c.length,h=PN(0,a),p=PN(a+1,a+1+l),f=zN([r,[n],c]),d=Yb(e,f),v=Yb(o,[n]),m=zN([[a],h,p]),g=zx(d,m),y=MN(g,v,i.shape[u]),b=Jk(m);return y=zx(y,b)},indices:function(){return o}}}};function PN(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function zN(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var BN={kernelName:Iv,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1];return{a:function(){return Px(a)},b:function(){return Px(i)}}}},VN={kernelName:Nv,gradFunc:function(e){return{x:function(){return Uy(e,"float32")}}}},WN={kernelName:Tv,gradFunc:function(e){return{x:function(){return Px(e)}}}},UN={kernelName:Ev,gradFunc:function(e){return{x:function(){return Px(e)}}}},HN={kernelName:_v,gradFunc:function(e){return{x:function(){return Px(e)}}}},jN={kernelName:Rv,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.alpha,o=Ek(a,0);return{x:function(){return Lx(o,e,Ok(e,i))}}}},GN={kernelName:Mv,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,Db(r,1))}}}},qN={kernelName:Ov,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,Uy(r,"float32"))}}}},KN={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.axis;return{logits:function(){var t=Dk(a);return Mk(e,Ok(Lk(e,i,!0),t))}}}},XN=ry({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5;return Kg.runKernel(Vv,{x:e,y:t,dy:n},{depthRadius:r,bias:a,alpha:i,beta:o})}}),YN={kernelName:Bv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;return{x:function(){return XN(i,o,e,s,u,c,l)}}}};function ZN(e,t,n,r){return t.rank<n.rank&&(t=Yb(t,Xk(t.shape,r))),e.rank<n.rank&&(e=Yb(e,Xk(e.shape,r))),{x:function(){return Ok(e,Uy(xk(n,t),e.dtype))}}}for(var JN={kernelName:Wv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=ZN(e,t[1],a,Hf(r,a.shape));return{x:function(){return i.x()}}}},QN=ry({less_:function(e,t){var r,a=ty(e,"a","less"),i=ty(t,"b","less");return a=(r=n(Vg(a,i),2))[0],i=r[1],kk(a.shape,i.shape),Kg.runKernel(Av,{a:a,b:i})}}),$N={kernelName:Uv,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1];return{a:function(){return Ok(e,Uy(_k(a,i),"float32"))},b:function(){return Ok(e,Uy(QN(a,i),"float32"))}}}},eS=ry({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=ty(e,"dy","maxPool3dGrad"),u=ty(t,"input","maxPool3dGrad"),c=ty(n,"output","maxPool3dGrad"),l=s,h=u,p=c,f=!1;4===u.rank&&(f=!0,l=Yb(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=Yb(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=Yb(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Df(5===l.rank,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,".")}),Df(5===h.rank,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(h.rank,".")}),Df(5===p.rank,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(p.rank,".")}),null!=o&&Df(zf(i),function(){return"Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")});var d=Kg.runKernel(qv,{dy:l,input:h,output:p},{filterSize:r,strides:a,pad:i,dimRoundingMode:o});return f?Yb(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),tS={kernelName:Gv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode;return{x:function(){return eS(e,i,o,s,u,c,l)}}}},nS=ry({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=ty(e,"dy","maxPoolGrad"),u=ty(t,"input","maxPoolGrad"),c=ty(n,"output","maxPoolGrad");return Df(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")}),Df(4===s.rank,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,".")}),Df(4===u.rank,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(u.rank,".")}),null!=o&&Df(zf(i),function(){return"Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}),Kg.runKernel(jv,{dy:s,input:u,output:c},{filterSize:r,strides:a,pad:i,dimRoundingMode:o})}}),rS={kernelName:Hv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var a=n(t,2),i=a[0],o=a[1],s=r.filterSize,u=r.strides,c=r.pad;return{x:function(){return nS(e,i,o,s,u,c)}}}},aS={kernelName:Xv,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=Hf(r.axis,a.shape),o=Lf(Kk(a.shape,i)[1]);return{x:function(){var t=a.shape.slice();i.forEach(function(e){t[e]=1});var n=Yb(e,t);return mk(Ok(n,ix(a.shape,"float32")),o)}}}},iS={kernelName:Yv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var a=r.axis,i=n(t,2),o=i[0],s=ZN(e,i[1],o,Hf(a,o.shape));return{x:function(){return s.x()}}}},oS={kernelName:Zv,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1];return{a:function(){return Ok(e,Uy(Rw(a,i),"float32"))},b:function(){return Ok(e,Uy(Ek(a,i),"float32"))}}}},sS={kernelName:Jv,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map(function(e){return e[0]});return{x:function(){return bx(e,a,r.shape)}}}},uS={kernelName:Qv,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=kk(a.shape,i.shape);return{a:function(){var t=bk(a.shape,o);return t.length>0?Yb(Lk(e,t),a.shape):e},b:function(){var t=Ok(e,tx(Ck(mk(a,i)))),n=bk(i.shape,o);return n.length>0?Yb(Lk(t,n),i.shape):t}}}},cS={kernelName:em,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=kk(a.shape,i.shape);return{a:function(){var t=Ok(e,Uy(i,"float32")),n=bk(a.shape,o);return n.length>0?Yb(Lk(t,n),a.shape):t},b:function(){var t=Ok(e,Uy(a,"float32")),n=bk(i.shape,o);return n.length>0?Yb(Lk(t,n),i.shape):t}}}},lS={kernelName:tm,gradFunc:function(e){return{x:function(){return tx(e)}}}},hS={kernelName:sm,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return ax(n.shape,"float32")}}}},pS={kernelName:om,gradFunc:function(e){return{x:function(){return Px(e)}}}},fS={kernelName:um,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return Ox(e,r).map(function(e){return function(){return e}})}},dS={kernelName:cm,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map(function(e){return e[0]});return{x:function(){return bx(e,a,r.shape)}}}},vS={kernelName:lm,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var r=n(t,3),a=r[0],i=r[1],o=r[2],s=a,u=i,c=kk(s.shape,u.shape);return{a:function(){var t=Uy(u,"float32"),n=Ok(e,Ok(t,Fw(s,Mk(t,_b(1))))),r=bk(s.shape,c);return r.length>0&&(n=Lk(n,r)),Yb(n,s.shape)},b:function(){var t=Ek(s,0),n=Lx(t,Ak(s),Px(s)),r=Ok(e,Ok(o,n)),a=bk(u.shape,c);return a.length>0&&(r=Lk(r,a)),Yb(r,u.shape)}}}},mS={kernelName:hm,inputsToSave:["x","alpha"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=Ek(a,0);return{x:function(){return Lx(o,e,Ok(e,i))},alpha:function(){var t=Lx(o,Px(e),Ok(e,a)),n=bk(i.shape,e.shape);return n.length>0&&(t=Lk(t,n)),Yb(t,i.shape)}}}},gS={kernelName:sv,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=kk(a.shape,i.shape);return{a:function(){var t=mk(e,Uy(i,"float32")),n=bk(a.shape,o);return n.length>0?Yb(Lk(t,n),a.shape):t},b:function(){var t=Ok(e,Uy(a,"float32")),n=bk(i.shape,o);n.length>0&&(t=Yb(Lk(t,n),i.shape));var r=$k(i);return tx(mk(t,Uy(r,"float32")))}}}},yS={kernelName:vm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,tx($k(r)))}}}},bS={kernelName:wm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0],a=Ok(Rw(r,6),Xx(r));return{x:function(){return Ok(e,Uy(a,"float32"))}}}},kS={kernelName:mm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(e,Uy(Xx(r),"float32"))}}}},xS={kernelName:gm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Yb(e,r.shape)}}}},wS={kernelName:km,inputsToSave:["images"],gradFunc:function(e,t,r){var a={dy:e,images:n(t,1)[0]};return{images:function(){return Kg.runKernel(xm,a,r)}}}},IS={kernelName:ym,inputsToSave:["images"],gradFunc:function(e,t,r){var a={dy:e,images:n(t,1)[0]};return{images:function(){return Kg.runKernel(bm,a,r)}}}},NS={kernelName:Im,gradFunc:function(e,t,n){var r=Hf(n.dims,e.shape);return{x:function(){return vx(e,r)}}}},SS={kernelName:Nm,gradFunc:function(e){return{x:function(){return Px(e)}}}},CS={kernelName:Sm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return tx(mk(e,Ok(Fw(r,1.5),2)))}}}},TS=ry({logicalNot_:function(e){var t={x:ty(e,"x","logicalNot","bool")};return Kg.runKernel(Pv,t)}}),ES={kernelName:Tm,inputsToSave:["condition"],gradFunc:function(e,t){var r=n(t,1)[0];return{condition:function(){return Uy(Px(r),"float32")},t:function(){return Ok(e,Uy(r,e.dtype))},e:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return Ok(e,Uy(TS(r),e.dtype))})}}},_S={kernelName:Em,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){var t=Ek(r,_b(0)),n=_b(gI),a=_b(yI),i=Ok(e,a),o=Ok(Ok(e,n),Dk(Uy(r,"float32")));return Lx(t,i,o)}}}},RS={kernelName:Fm,outputsToSave:[!0],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(e,Ok(r,Mk(_b(1),r)))}}}},AS={kernelName:Dm,gradFunc:function(e){return{x:function(){return Px(e)}}}},DS=ry({cos_:function(e){var t={x:ty(e,"x","cos")};return Kg.runKernel(Yd,t)}}),FS={kernelName:Rm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(DS(Uy(r,"float32")),e)}}}},OS=ry({cosh_:function(e){var t={x:ty(e,"x","cosh")};return Kg.runKernel(Zd,t)}}),MS={kernelName:Am,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(OS(Uy(r,"float32")),e)}}}},LS={kernelName:_m,inputsToSave:["x"],gradFunc:function(e,t,r){for(var a=n(t,1)[0],i=r.begin,o=r.size,s=a.shape,u=n(mb(a,i,o),2),c=u[0],l=u[1],h=[],p=0;p<e.rank;p++)h.push([c[p],s[p]-c[p]-l[p]]);return{x:function(){return sx(e,h)}}}},PS={kernelName:Bm,outputsToSave:[!0],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.dim,o=Ok(e,a);return{logits:function(){return Mk(o,Ok(Lk(o,[i],!0),a))}}}},zS={kernelName:Om,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(e,yx(r))}}}},BS=ry({batchToSpaceND_:function(e,t,n){var r=ty(e,"x","batchToSpaceND"),a=t.reduce(function(e,t){return e*t});return Df(r.rank>=1+t.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)}),Df(n.length===t.length,function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)}),Df(r.shape[0]%a==0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}),Kg.runKernel(Md,{x:r},{blockShape:t,crops:n})}}),VS={kernelName:Pm,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return BS(e,r,a)}}}},WS={kernelName:zm,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return ak(e,r)}}}},US=0,HS=[UI,HI,jI,GI,qI,KI,XI,YI,ZI,JI,QI,$I,tN,rN,aN,oN,sN,uN,cN,lN,hN,pN,dN,fN,gN,bN,xN,IN,NN,SN,gS,CN,TN,EN,_N,RN,DN,AN,ON,LN,BN,VN,WN,UN,HN,jN,GN,qN,KN,YN,JN,JN,$N,tS,rS,aS,iS,oS,sS,uS,cS,lS,hS,pS,fS,dS,dS,vS,mS,yS,bS,kS,xS,wS,IS,NS,SS,CS,ES,_S,RS,AS,FS,MS,LS,PS,zS,VS,VS,WS,WS,{kernelName:Mm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,Ok(Tx(Uy(r,"float32")),2))}}}},{kernelName:Vm,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=_b(2);return{a:function(){return Ok(e,Ok(o,Mk(a,i)))},b:function(){return Ok(e,Ok(o,Mk(i,a)))}}}},{kernelName:Wm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(e,Ok(Uy(r,"float32"),2))}}}},{kernelName:tg,gradFunc:function(e){return{x:function(){return Px(e)}}}},{kernelName:Um,inputsToSave:["a","b"],gradFunc:function(e,t){var r=n(t,2),a=r[0],i=r[1],o=kk(a.shape,i.shape);return{a:function(){var t=e,n=bk(a.shape,o);return n.length>0&&(t=Lk(t,n)),Yb(t,a.shape)},b:function(){var t=e,n=bk(i.shape,o);return n.length>0&&(t=Lk(t,n)),Yb(tx(t),i.shape)}}}},{kernelName:Lm,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=a.shape.slice();Hf(r.axis,a.shape).forEach(function(e){i[e]=1});var o=Yb(e,i),s=Ok(o,ix(a.shape,"float32"));return{x:function(){return s}}}},{kernelName:Gm,inputsToSave:["x"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return mk(e,$k(DS(r)))}}}},{kernelName:qm,outputsToSave:[!0],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return Ok(Mk(_b(1),$k(r)),e)}}}},{kernelName:Km,inputsToSave:["x"],gradFunc:function(e,t,r){var a=n(t,1)[0],i=r.reps;return{x:function(){var t=Px(a);if(1===a.rank)for(var n=0;n<i[0];++n)t=Db(t,bx(e,[n*a.shape[0]],[a.shape[0]]));else if(2===a.rank)for(var r=0;r<i[0];++r)for(var o=0;o<i[1];++o)t=Db(t,bx(e,[r*a.shape[0],o*a.shape[1]],[a.shape[0],a.shape[1]]));else if(3===a.rank)for(var s=0;s<i[0];++s)for(var u=0;u<i[1];++u)for(var c=0;c<i[2];++c)t=Db(t,bx(e,[s*a.shape[0],u*a.shape[1],c*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(4!==a.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(a.rank," tensors yet."));for(var l=0;l<i[0];++l)for(var h=0;h<i[1];++h)for(var p=0;p<i[2];++p)for(var f=0;f<i[3];++f)t=Db(t,bx(e,[l*a.shape[0],h*a.shape[1],p*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return t}}}},{kernelName:Zm,gradFunc:function(e,t,n){var r=Jk(n.perm);return{x:function(){return zx(e,r)}}}},{kernelName:Qm,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return _x(e,r)}}}},{kernelName:$m,inputsToSave:["segmentIds"],gradFunc:function(e,t){var r=n(t,1)[0];return{x:function(){return function(e,t){for(var n=Wk(t,Px(t)),r=Tk(e,n),a=_k(t,_b(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=wk(a,o+1);a=zk(a,ix(r.shape,"bool"));var s=Px(r);return Lx(a,r,s)}(e,r)}}}},{kernelName:eg,gradFunc:function(e){return{x:function(){return Px(e)}}}}];US<HS.length;US++){fg(HS[US])}Ag().prototype.abs=function(){return this.throwIfDisposed(),Ab(this)};var jS=ry({acos_:function(e){var t={x:ty(e,"x","acos")};return Kg.runKernel(bd,t)}});Ag().prototype.acos=function(){return this.throwIfDisposed(),jS(this)};var GS=ry({acosh_:function(e){var t={x:ty(e,"x","acosh")};return Kg.runKernel(kd,t)}});Ag().prototype.acosh=function(){return this.throwIfDisposed(),GS(this)},Ag().prototype.add=function(e){return this.throwIfDisposed(),Db(this,e)},Ag().prototype.all=function(e,t){return this.throwIfDisposed(),Fb(this,e,t)},Ag().prototype.any=function(e,t){return this.throwIfDisposed(),Ob(this,e,t)},Ag().prototype.argMax=function(e){return this.throwIfDisposed(),Mb(this,e)};var qS=ry({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:ty(e,"x","argMin")};return Kg.runKernel(Nd,n,{axis:t})}});Ag().prototype.argMin=function(e){return this.throwIfDisposed(),qS(this,e)},Ag().prototype.asScalar=function(){return this.throwIfDisposed(),Df(1===this.size,function(){return"The array must have only 1 element."}),Yb(this,[])},Ag().prototype.asType=function(e){return this.throwIfDisposed(),Uy(this,e)},Ag().prototype.as1D=function(){return this.throwIfDisposed(),Yb(this,[this.size])},Ag().prototype.as2D=function(e,t){return this.throwIfDisposed(),Yb(this,[e,t])},Ag().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Yb(this,[e,t,n])},Ag().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Yb(this,[e,t,n,r])},Ag().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Yb(this,[e,t,n,r,a])};var KS=ry({asin_:function(e){var t={x:ty(e,"x","asin")};return Kg.runKernel(Sd,t)}});Ag().prototype.asin=function(){return this.throwIfDisposed(),KS(this)};var XS=ry({asinh_:function(e){var t={x:ty(e,"x","asinh")};return Kg.runKernel(Cd,t)}});Ag().prototype.asinh=function(){return this.throwIfDisposed(),XS(this)};var YS=ry({atan_:function(e){var t={x:ty(e,"x","atan")};return Kg.runKernel(Td,t)}});Ag().prototype.atan=function(){return this.throwIfDisposed(),YS(this)};var ZS=ry({atan2_:function(e,t){var r,a=ty(e,"a","atan2"),i=ty(t,"b","atan2");return a=(r=n(Vg(a,i),2))[0],i=r[1],Kg.runKernel(_d,{a:a,b:i})}});Ag().prototype.atan2=function(e){return this.throwIfDisposed(),ZS(this,e)};var JS=ry({atanh_:function(e){var t={x:ty(e,"x","atanh")};return Kg.runKernel(Ed,t)}});Ag().prototype.atanh=function(){return this.throwIfDisposed(),JS(this)},Ag().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Zb(this,e,t,n,r)},Ag().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),BS(this,e,t)},Ag().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),$b(this,e,t,n,r,a)},Ag().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Mx(this,e)},Ag().prototype.cast=function(e){return this.throwIfDisposed(),Uy(this,e)};var QS=ry({ceil_:function(e){var t={x:ty(e,"x","ceil")};return Kg.runKernel(zd,t)}});Ag().prototype.ceil=function(){return this.throwIfDisposed(),QS(this)},Ag().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),rk(this,e,t)},Ag().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Rg&&(e=[e]),ak([this].concat(i(e)),t)},Ag().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),lk(this,e,t,n,r,a,i)},Ag().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),pk(this,e,t,n,r,a)},Ag().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),ck(this,e,t,n,r,a,i)},Ag().prototype.cos=function(){return this.throwIfDisposed(),DS(this)},Ag().prototype.cosh=function(){return this.throwIfDisposed(),OS(this)},Ag().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),wN(this,e,t,n)};var $S=ry({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=ty(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return Df(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)}),Df(i*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)}),Df(o%(t*t)==0,function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}),Kg.runKernel(ev,{x:r},{blockSize:t,dataFormat:n})}});Ag().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),$S(this,e,t)},Ag().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),dk(this,e,t,n,r,a,i)};var eC=ry({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=ty(e,"x","dilation2d"),s=ty(t,"filter","dilation2d");Df(3===o.rank||4===o.rank,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(o.rank,".")}),Df(3===s.rank,function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,".")}),Df("NHWC"===i,function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)});var u=o,c=!1;3===o.rank&&(u=Yb(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l=Kg.runKernel(av,{x:u,filter:s},{strides:n,pad:r,dilations:a});return c?Yb(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});Ag().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),eC(this,e,t,n,r,a)};var tC=ry({divNoNan_:function(e,t){var r=ty(e,"a","div"),a=ty(t,"b","div"),i=n(Vg(r,a),2);r=i[0],a=i[1];var o=mk(r,a),s=Px(o),u=xk(a,s);return Lx(u,s,o)}});Ag().prototype.divNoNan=function(e){return this.throwIfDisposed(),tC(this,e)},Ag().prototype.div=function(e){return this.throwIfDisposed(),mk(this,e)};var nC=ry({dot_:function(e,t){var n=ty(e,"t1","dot"),r=ty(t,"t2","dot");Df(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")});var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(Df(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")}),1===n.rank&&1===r.rank){var o=Yb(n,[1,-1]),s=Yb(r,[-1,1]),u=rw(o,s);return Yb(u,[])}if(1===n.rank&&2===r.rank){var c=Yb(n,[1,-1]),l=Yb(r,[r.shape[0],r.shape[1]]),h=rw(c,l);return Yb(h,[h.size])}if(2===n.rank&&1===r.rank){var p=Yb(r,[-1,1]),f=rw(n,p);return Yb(f,[f.size])}var d=Yb(r,[r.shape[0],r.shape[1]]);return rw(n,d)}});Ag().prototype.dot=function(e){return this.throwIfDisposed(),nC(this,e)},Ag().prototype.elu=function(){return this.throwIfDisposed(),gk(this)},Ag().prototype.equal=function(e){return this.throwIfDisposed(),xk(this,e)};var rC=ry({erf_:function(e){var t=ty(e,"x","erf");return Df("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=Uy(t,"float32")),Kg.runKernel(lv,{x:t})}});Ag().prototype.erf=function(){return this.throwIfDisposed(),rC(this)},Ag().prototype.exp=function(){return this.throwIfDisposed(),Dk(this)},Ag().prototype.expandDims=function(e){return this.throwIfDisposed(),wk(this,e)};var aC=ry({expm1_:function(e){var t={x:ty(e,"x","expm1")};return Kg.runKernel(dv,t)}});Ag().prototype.expm1=function(){return this.throwIfDisposed(),aC(this)},Ag().prototype.fft=function(){return this.throwIfDisposed(),Ux(this)},Ag().prototype.flatten=function(){return this.throwIfDisposed(),Yb(this,[this.size])},Ag().prototype.floor=function(){return this.throwIfDisposed(),Ck(this)},Ag().prototype.floorDiv=function(e){return this.throwIfDisposed(),vk(this,e)},Ag().prototype.gather=function(e,t){return this.throwIfDisposed(),Tk(this,e,t)},Ag().prototype.greaterEqual=function(e){return this.throwIfDisposed(),_k(this,e)},Ag().prototype.greater=function(e){return this.throwIfDisposed(),Ek(this,e)},Ag().prototype.ifft=function(){return this.throwIfDisposed(),jx(this)},Ag().prototype.irfft=function(){return this.throwIfDisposed(),Gx(this)};var iC=ry({isFinite_:function(e){var t={x:ty(e,"x","isFinite")};return Kg.runKernel(Tv,t)}});Ag().prototype.isFinite=function(){return this.throwIfDisposed(),iC(this)};var oC=ry({isInf_:function(e){var t={x:ty(e,"x","isInf")};return Kg.runKernel(Ev,t)}});Ag().prototype.isInf=function(){return this.throwIfDisposed(),oC(this)};var sC=ry({isNaN_:function(e){var t={x:ty(e,"x","isNaN")};return Kg.runKernel(_v,t)}});Ag().prototype.isNaN=function(){return this.throwIfDisposed(),sC(this)},Ag().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Rk(this,e)},Ag().prototype.lessEqual=function(e){return this.throwIfDisposed(),Rw(this,e)},Ag().prototype.less=function(e){return this.throwIfDisposed(),QN(this,e)};var uC=ry({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=ty(e,"x","localResponseNormalization");Df(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")}),Df(zf(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")});var o=i,s=!1;3===i.rank&&(s=!0,o=Yb(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u=Kg.runKernel(Bv,{x:o},{depthRadius:t,bias:n,alpha:r,beta:a});return s?Yb(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});Ag().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),uC(this,e,t,n,r)};var cC=ry({logSigmoid_:function(e){var t=ty(e,"x","logSigmoid");return Eb(function(e){return{value:tx(Sx(tx(e))),gradFunc:function(t){return Ok(t,yx(tx(e)))}}})(t)}});Ag().prototype.logSigmoid=function(){return this.throwIfDisposed(),cC(this)},Ag().prototype.logSoftmax=function(e){return this.throwIfDisposed(),Pk(this,e)},Ag().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Hw(this,e,t)},Ag().prototype.log=function(){return this.throwIfDisposed(),Ak(this)},Ag().prototype.log1p=function(){return this.throwIfDisposed(),Uw(this)},Ag().prototype.logicalAnd=function(e){return this.throwIfDisposed(),zk(this,e)},Ag().prototype.logicalNot=function(){return this.throwIfDisposed(),TS(this)};var lC=ry({logicalOr_:function(e,t){var n=ty(e,"a","logicalOr","bool"),r=ty(t,"b","logicalOr","bool");return kk(n.shape,r.shape),Kg.runKernel(zv,{a:n,b:r})}});Ag().prototype.logicalOr=function(e){return this.throwIfDisposed(),lC(this,e)};var hC=ry({logicalXor_:function(e,t){var n=ty(e,"a","logicalXor","bool"),r=ty(t,"b","logicalXor","bool");return kk(n.shape,r.shape),zk(lC(e,t),TS(zk(e,t)))}});Ag().prototype.logicalXor=function(e){return this.throwIfDisposed(),hC(this,e)},Ag().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),rw(this,e,t,n)},Ag().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Bk(this,e,t,n,r)},Ag().prototype.max=function(e,t){return this.throwIfDisposed(),Fk(this,e,t)},Ag().prototype.maximum=function(e){return this.throwIfDisposed(),Wk(this,e)},Ag().prototype.mean=function(e,t){return this.throwIfDisposed(),Uk(this,e,t)},Ag().prototype.min=function(e,t){return this.throwIfDisposed(),Hk(this,e,t)},Ag().prototype.minimum=function(e){return this.throwIfDisposed(),jk(this,e)};var pC=ry({mirrorPad_:function(e,t,n){Df("reflect"===n||"symmetric"===n,function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")});var r=ty(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Df(t.length===r.rank,function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")});for(var a="reflect"===n?1:0,i=function(e){Df(2===t[e].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Df(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)})},o=0;o<r.rank;o++)i(o);return Kg.runKernel(Jv,{x:r},{paddings:t,mode:n})}});Ag().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),pC(this,e,t)};var fC=ry({mod_:function(e,t){var r,a=ty(e,"a","mod"),i=ty(t,"b","mod");return a=(r=n(Vg(a,i),2))[0],i=r[1],Kg.runKernel(Qv,{a:a,b:i})}});Ag().prototype.mod=function(e){return this.throwIfDisposed(),fC(this,e)},Ag().prototype.mul=function(e){return this.throwIfDisposed(),Ok(this,e)},Ag().prototype.neg=function(){return this.throwIfDisposed(),tx(this)},Ag().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Mw(this,e,t,n)},Ag().prototype.notEqual=function(e){return this.throwIfDisposed(),nx(this,e)},Ag().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),rx(this,e,t,n)},Ag().prototype.onesLike=function(){return this.throwIfDisposed(),ox(this)},Ag().prototype.pad=function(e,t){return this.throwIfDisposed(),sx(this,e,t)};var dC=ry({pool_:function(e,t,r,a,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===a&&(a="valid");var s=ty(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=Yb(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Df(Kb(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(i,"'")});var l,h=Pb(u.shape,t,o,i,a),p=[h.dilationHeight,h.dilationWidth];l="same"===a?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),a=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],a[t]]})}([h.filterHeight,h.filterWidth],p):[[0,0],[0,0]];var f=1===p[0]&&1===p[1],d=n(function(e,t,n){var r=n.map(function(e){return e[0]}),a=n.map(function(e){return e[1]}),i=e.concat(r,a),o=t.map(function(e,t){return(e-i[t]%e)%e}),s=a.map(function(e,t){return e+o[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,o[t]]})]}([h.inHeight,h.inWidth],p,l),2),v=d[0],m=d[1],g=f?a:"valid",y=f?u:iN(u,p,v),b=("avg"===r?function(){return Zb(y,t,o,g)}:function(){return Bk(y,t,o,g)})(),k=f?b:BS(b,p,m);return c?Yb(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});Ag().prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),dC(this,e,t,n,r,a)},Ag().prototype.pow=function(e){return this.throwIfDisposed(),Fw(this,e)},Ag().prototype.prelu=function(e){return this.throwIfDisposed(),ux(this,e)};var vC=ry({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=ty(e,"x","prod");return"bool"===r.dtype&&(r=Uy(r,"int32")),Kg.runKernel(pm,{x:r},{axis:t,keepDims:n})}});Ag().prototype.prod=function(e,t){return this.throwIfDisposed(),vC(this,e,t)};var mC=ry({reciprocal_:function(e){var t={x:ty(e,"x","reciprocal")};return Kg.runKernel(vm,t)}});Ag().prototype.reciprocal=function(){return this.throwIfDisposed(),mC(this)},Ag().prototype.relu=function(){return this.throwIfDisposed(),dx(this)},Ag().prototype.relu6=function(){return this.throwIfDisposed(),Kx(this)},Ag().prototype.reshapeAs=function(e){return this.throwIfDisposed(),Yb(this,e.shape)},Ag().prototype.reshape=function(e){return this.throwIfDisposed(),Yb(this,e)},Ag().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Tw(this,e,t,n)},Ag().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Ew(this,e,t,n)},Ag().prototype.reverse=function(e){return this.throwIfDisposed(),vx(this,e)},Ag().prototype.rfft=function(){return this.throwIfDisposed(),Hx(this)};var gC=ry({round_:function(e){var t={x:ty(e,"x","round")};return Kg.runKernel(Nm,t)}});Ag().prototype.round=function(){return this.throwIfDisposed(),gC(this)},Ag().prototype.rsqrt=function(){return this.throwIfDisposed(),FN(this)},Ag().prototype.selu=function(){return this.throwIfDisposed(),mx(this)},Ag().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),gx(this,e,t,n,r,a,i)},Ag().prototype.sigmoid=function(){return this.throwIfDisposed(),yx(this)};var yC=ry({sign_:function(e){var t={x:ty(e,"x","sign")};return Kg.runKernel(Dm,t)}});Ag().prototype.sign=function(){return this.throwIfDisposed(),yC(this)},Ag().prototype.sin=function(){return this.throwIfDisposed(),yN(this)},Ag().prototype.sinh=function(){return this.throwIfDisposed(),kN(this)},Ag().prototype.slice=function(e,t){return this.throwIfDisposed(),bx(this,e,t)},Ag().prototype.softmax=function(e){return this.throwIfDisposed(),Nx(this,e)},Ag().prototype.softplus=function(){return this.throwIfDisposed(),Sx(this)},Ag().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),iN(this,e,t)},Ag().prototype.split=function(e,t){return this.throwIfDisposed(),Cx(this,e,t)},Ag().prototype.sqrt=function(){return this.throwIfDisposed(),Tx(this)},Ag().prototype.square=function(){return this.throwIfDisposed(),$k(this)},Ag().prototype.squaredDifference=function(e){return this.throwIfDisposed(),Ww(this,e)},Ag().prototype.squeeze=function(e){return this.throwIfDisposed(),Ex(this,e)},Ag().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof Rg?[this,e]:[this].concat(i(e));return _x(n,t)},Ag().prototype.step=function(e){return this.throwIfDisposed(),Xx(this,e)};var bC=ry({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:ty(e,"x","stridedSlice")};return Kg.runKernel(jm,c,{begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u})}});Ag().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),bC(this,e,t,n,r,a,i,o,s)},Ag().prototype.sub=function(e){return this.throwIfDisposed(),Mk(this,e)},Ag().prototype.sum=function(e,t){return this.throwIfDisposed(),Lk(this,e,t)};var kC=ry({tan_:function(e){var t={x:ty(e,"x","tan")};return Kg.runKernel(Gm,t)}});Ag().prototype.tan=function(){return this.throwIfDisposed(),kC(this)},Ag().prototype.tanh=function(){return this.throwIfDisposed(),Rx(this)},Ag().prototype.tile=function(e){return this.throwIfDisposed(),Ik(this,e)},Ag().prototype.toBool=function(){return this.throwIfDisposed(),Uy(this,"bool")},Ag().prototype.toFloat=function(){return this.throwIfDisposed(),Uy(this,"float32")},Ag().prototype.toInt=function(){return this.throwIfDisposed(),Uy(this,"int32")};var xC=ry({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=ty(e,"x","topk");if(0===a.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=a.shape[a.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(i,") but got ").concat(t));var o={x:a},s={k:t,sorted:r},u=Kg.runKernel(Xm,o,s),c=n(u,2),l=c[0],h=c[1];return{values:l,indices:h}}});Ag().prototype.topk=function(e,t){return this.throwIfDisposed(),xC(this,e,t)},Ag().prototype.transpose=function(e){return this.throwIfDisposed(),zx(this,e)};var wC,IC=ry({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=ty(e,"x","unique","string_or_numeric");Df(r.rank>0,function(){return"The input tensor must be at least 1D"});var a={x:r},i={axis:t},o=Kg.runKernel(Jm,a,i),s=n(o,2),u=s[0],c=s[1];return{values:u,indices:c}}});function NC(){return null==wC&&(wC=Kg.backend.epsilon()),wC}Ag().prototype.unique=function(e){return this.throwIfDisposed(),IC(this,e)},Ag().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),MN(this,e,t)},Ag().prototype.unstack=function(e){return this.throwIfDisposed(),Ox(this,e)},Ag().prototype.where=function(e,t){return this.throwIfDisposed(),Lx(e,this,t)},Ag().prototype.zerosLike=function(){return this.throwIfDisposed(),Px(this)};var SC=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,e),Object.setPrototypeOf(y(r),n.prototype),r}return n}(l(Error)),CC=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,e),Object.setPrototypeOf(y(r),n.prototype),r}return n}(l(Error)),TC=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,e),Object.setPrototypeOf(y(r),n.prototype),r}return n}(l(Error)),EC=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,e),Object.setPrototypeOf(y(r),n.prototype),r}return n}(l(Error)),_C=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,e),Object.setPrototypeOf(y(r),n.prototype),r}return n}(l(Error));function RC(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function AC(e,t){if(!e)throw new _C(t)}function DC(e,t){var n,r=0,a=s(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function FC(e){return 1===e.length?e[0]:e}function OC(e){return Array.isArray(e)?e:[e]}function MC(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function LC(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}Error;var PC={};function zC(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function BC(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach(function(e){return BC(e)});else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?BC(a):e[r]=a.value)}}function VC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var o,s=e;if(s in r)o=r[s];else if(s in PC)o=PC[s];else if(null==(o=t[s]))throw new TC("Unknown ".concat(a,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(a," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(a," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return o}var u,c,l,h=e;if(null==h.className||null==h.config)throw new TC("".concat(a,": Improper config format: ").concat(JSON.stringify(h),".\n'className' and 'config' must set."));var p,f,d=h.className;if(d in r?(p=(u=n(r[d],2))[0],f=u[1]):d in PC?(p=(c=n(PC.className,2))[0],f=c[1]):d in t&&(p=(l=n(t[d],2))[0],f=l[1]),null==p)throw new TC("Unknown ".concat(a,": ").concat(d,". This may be due to one of the following reasons:\n1. The ").concat(a," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(a," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=f){for(var v={},m=0,g=Object.keys(PC);m<g.length;m++){var y=g[m];v[y]=PC[y]}for(var b=0,k=Object.keys(r);b<k.length;b++){var x=k[b];v[x]=r[x]}h.config.customObjects=v;for(var w=Object.assign({},PC),I=0,N=Object.keys(r);I<N.length;I++){var S=N[I];PC[S]=r[S]}BC(h.config);var C=f(p,h.config,r,i);return PC=Object.assign({},w),C}for(var T=Object.assign({},PC),E=0,_=Object.keys(r);E<_.length;E++){var R=_[E];PC[R]=r[R]}var A=new p(h.config);return PC=Object.assign({},T),A}function WC(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function UC(e){if(null==e)return e;var t,n=[],r=s(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function HC(e){if(null==e)throw new TC("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function jC(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new TC("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function GC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return AC(n>=0),AC(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(function(e){return typeof e===t})}function qC(e,t){Array.isArray(e)?(Df(e.length>0,function(){return"".concat(t," is unexpectedly an empty array.")}),e.forEach(function(e,n){return qC(e,"element ".concat(n+1," of ").concat(t))})):Df(Number.isInteger(e)&&e>0,function(){return"Expected ".concat(t," to be a positive integer, but got ").concat(KC(e),".")})}function KC(e){return null===e?"null":Array.isArray(e)?"["+e.map(function(e){return KC(e)}).join(",")+"]":"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function XC(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function YC(e,t){return Ib(function(){return Tx(Lk(Ok(e,e),t,!0))})}var ZC=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"getConfig",value:function(){return{}}}]),n}(yb);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return I(n,[{key:"apply",value:function(e){var t=this;return Ib(function(){var n=YC(e,t.axis),r=rk(n,0,t.maxValue);return Ok(e,mk(r,Db(NC(),n)))})}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(ZC);return e.className="MaxNorm",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return I(n,[{key:"apply",value:function(e){var t=this;return Ib(function(){return mk(e,Db(NC(),YC(e,t.axis)))})}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(ZC);return e.className="UnitNorm",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return dx(e)}}]),n}(ZC);return e.className="NonNeg",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return I(n,[{key:"apply",value:function(e){var t=this;return Ib(function(){var n=YC(e,t.axis),r=Db(Ok(t.rate,rk(n,t.minValue,t.maxValue)),Ok(1-t.rate,n));return Ok(e,mk(r,Db(NC(),n)))})}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(ZC);return e.className="MinMaxNorm",e}());var JC={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function QC(e){return zC(e)}function $C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return VC(e,bb.getMap().classNameMap,t,"constraint")}function eT(e){return null==e?null:"string"==typeof e?$C({className:e in JC?JC[e]:e,config:{}}):e instanceof ZC?e:$C(e)}var tT=["channelsFirst","channelsLast"],nT=["nearest","bilinear"],rT=["valid","same","causal"],aT=["max","avg"],iT=["sum","mul","concat","ave"],oT=new Map;function sT(e){jC(tT,"DataFormat",e)}function uT(e){jC(rT,"PaddingMode",e)}function cT(e){jC(aT,"PoolMode",e)}var lT=[];function hT(e,t){lT.push(e);try{var n=t();return lT.pop(),n}catch(r){throw lT.pop(),r}}function pT(e){if(!vT(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===lT.length?"":lT.join("/")+"/")+e}function fT(e){if(!vT(e))throw new Error("Not a valid tensor name: '"+e+"'");oT.has(e)||oT.set(e,0);var t=oT.get(e);if(oT.set(e,oT.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return oT.set(n,1),n}return e}var dT=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function vT(e){return!!e.match(dT)}function mT(e){return e===parseInt(e.toString(),10)}function gT(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function yT(e){return Ax(e=Array.isArray(e)?new Float32Array(e):e)}function bT(e){return Hk(yT(e)).dataSync()[0]}function kT(e){return Fk(yT(e)).dataSync()[0]}function xT(e,t){if(t<e)throw new TC("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function wT(e,t){return e.asType(t)}function IT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function NT(e,t,n){return Ib(function(){switch(e.rank){case 1:return kx(e,t,n);case 2:return xx(e,[t,0],[n,e.shape[1]]);case 3:return wx(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Ix(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return bx(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return bx(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new TC("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}})}function ST(e,t,n){return Ib(function(){switch(e.rank){case 1:return kx(e,t,n);case 2:return xx(e,[0,t],[e.shape[0],n]);case 3:return wx(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Ix(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new TC("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}})}function CT(e,t,n,r){return Ib(function(){switch(e.rank){case 1:return kx(e,t,n);case 2:switch(r){case 1:return NT(e,t,n);case 2:return ST(e,t,n);default:throw new TC("The axis is not within the rank of the tensor ".concat(r))}case 3:switch(r){case 1:return NT(e,t,n);case 2:return wx(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return ST(e,t,n);default:throw new TC("The axis is not within the rank of the tensor ".concat(r))}case 4:switch(r){case 1:return NT(e,t,n);case 2:return Ix(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Ix(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return ST(e,t,n);default:throw new TC("The axis is not within the rank of the tensor ".concat(r))}default:throw new TC("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}})}function TT(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),ak(e,n)}function ET(e,t){switch(e.rank){case 1:return ik([e,t]);case 2:return ok([e,t],0);case 3:return sk([e,t],0);case 4:return uk([e,t],0);default:throw new TC("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function _T(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new TC("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return Ik(e,t)}function RT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return px(e,t,n,r,a)}function AT(e,t,n,r){if(e.rank<2||t.rank<2)throw new EC("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new EC("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape));if(2===e.rank&&2===t.rank)return aw({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?OT(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),o=a.pop();e=e.reshape([-1,o]);var s=t.shape.slice(),u=s.pop(),c=s.pop(),l=[].concat(i(s),[u]),h=Array.from({length:t.rank},function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n});t=t.transpose(h).reshape([c,-1]);var p=[].concat(i(a),i(l));return aw({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?OT(e.rank,r,"channelsLast"):null,activation:n}).reshape(p)}function DT(e,t,n){return Ib(function(){return t=Array.isArray(t)?Ax(t,"int32"):t.toInt(),Tk(e,t,n)})}function FT(e){return Ok(e,e)}function OT(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new TC("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(e<3)return t;throw new TC("Unsupported input rank by biasAdd: ".concat(t.rank))}function MT(e,t,n){return Ib(function(){return null==n&&(n="channelsLast"),sT(n),e.add(OT(e.rank,t,n))})}function LT(e,t,n,r){return Ib(function(){return Bx(e,t,n,r)})}function PT(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var zT=["fanIn","fanOut","fanAvg"],BT=["normal","uniform","truncatedNormal"],VT=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(yb);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e,t){return ax(e,t)}}]),n}(VT);return e.className="Zeros",e}());var WT=function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e,t){return ix(e,t)}}]),n}(VT);return e.className="Ones",e}();kb(WT),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),r=t.call(this),"object"!=typeof e)throw new TC("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new TC("config must have value set but got ".concat(e));return r.value=e.value,g(r)}return I(n,[{key:"apply",value:function(e,t){var n=this;return Ib(function(){return Ok(_b(n.value),ix(e,t))})}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(VT);return e.className="Constant",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return I(n,[{key:"apply",value:function(e,t){return fx(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(VT);return e.className="RandomUniform",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return I(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new EC("randomNormal does not support dType ".concat(t,"."));return RT(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(VT);return e.className="RandomNormal",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return I(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new EC("truncatedNormal does not support dType ".concat(t,"."));return Fx(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(VT);return e.className="TruncatedNormal",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return I(n,[{key:"apply",value:function(e,t){var n=this;return Ib(function(){if(2!==e.length||e[0]!==e[1])throw new TC("Identity matrix initializer can only be used for 2D square matrices.");return Ok(n.gain,Nk(e[0]))})}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(VT);return e.className="Identity",e}());var UT=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),r=t.call(this),e.scale<0)throw new TC("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(e){jC(zT,"FanMode",e)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(e){jC(BT,"Distribution",e)}(r.distribution),r.seed=e.seed,g(r)}return I(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(sT(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=gT(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=gT(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=gT(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if(i/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,a):Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new EC("".concat(this.getClassName()," does not support dType ").concat(t,"."));return Fx(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return fx(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(VT);return e.className="VarianceScaling",e}();kb(UT);var HT=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return I(n,[{key:"getClassName",value:function(){return UT.className}}]),n}(UT);return e.className="GlorotUniform",e}();kb(HT);var jT=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return I(n,[{key:"getClassName",value:function(){return UT.className}}]),n}(UT);return e.className="GlorotNormal",e}();kb(jT);var GT=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return I(n,[{key:"getClassName",value:function(){return UT.className}}]),n}(UT);return e.className="HeNormal",e}();kb(GT);var qT=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return I(n,[{key:"getClassName",value:function(){return UT.className}}]),n}(UT);return e.className="HeUniform",e}();kb(qT);var KT=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return I(n,[{key:"getClassName",value:function(){return UT.className}}]),n}(UT);return e.className="LeCunNormal",e}();kb(KT);var XT=function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return I(n,[{key:"getClassName",value:function(){return UT.className}}]),n}(UT);return e.className="LeCunNormal",e}();kb(XT),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new EC("Random seed is not implemented for Orthogonal Initializer yet.");return g(r)}return I(n,[{key:"apply",value:function(e,t){var n=this;return Ib(function(){if(e.length<2)throw new EC("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 (".concat(e[0]*e[1],") elements: Slowness may result."));var t=RT(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=Gw.gramSchmidt(t);return e[0]>e[1]&&(r=r.transpose()),Ok(n.gain,r)})}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(VT);return e.className="Orthogonal",e}());var YT={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ZT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return VC(e,bb.getMap().classNameMap,t,"initializer")}function JT(e){return zC(e)}function QT(e){if("string"==typeof e){var t=e in YT?YT[e]:e;if("GlorotNormal"===t)return new jT;if("GlorotUniform"===t)return new HT;if("HeNormal"===t)return new GT;if("HeUniform"===t)return new qT;if("LeCunNormal"===t)return new KT;if("LeCunUniform"===t)return new XT;var n={};return n.className=t,n.config={},ZT(n)}return e instanceof VT?e:ZT(e)}var $T=0;function eE(){return $T++}var tE={};function nE(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in tE||(tE[e]=0),tE[e]+=1,e+tE[e].toString()}function rE(e){return Array.isArray(e)&&Array.isArray(e[0])}function aE(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function iE(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new TC("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function oE(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new TC("Expected exactly 1 Shape; got ".concat(e.length))}return e}function sE(e){var t,n=0,r=s(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=0===a.shape.length?1:a.shape.reduce(function(e,t){return e*t})}}catch(i){r.e(i)}finally{r.f()}return n}var uE="Variable",cE=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:uE,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;x(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=eE(),this.originalName=pT(r=null==r?uE:r),this.name=fT(this.originalName),this.trainable_=a,this.constraint=i,this.val=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Kg.makeVariable(e,t,n,r)}(t,this.trainable_,this.name,this.dtype)}return I(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function lE(e){return e.map(function(e){return e.read()})}function hE(e){e.forEach(function(e){e[0].write(e[1])})}var pE=function e(t){x(this,e),this.dtype=t.dtype,this.shape=t.shape,this.ndim=null!=t.shape?t.shape.length:t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},fE=function e(t,n,r,a,i,o,s){x(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=eE(),null!=o&&(this.originalName=pT(o),this.name=fT(this.originalName)),this.rank=n.length},dE=0,vE=function(){function e(t,n){x(this,e),this.callArgs=n,this.id=dE++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=s(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return I(e,[{key:"getConfig",value:function(){var e,t=[],n=s(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(null!=r?r.name:null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),mE=0,gE=function(e){d(n,e);var t=m(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=mE++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=MC(i)+"_"+nE(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return e.initialWeights=null!=r.weights?r.weights:null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return I(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new CC("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new TC("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return FC(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return FC(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new SC("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new SC("Layer ".concat(this.name," is not connected, no input to return."));return FC(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new SC("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new SC("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return FC(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map(function(e){return e()})}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach(function(t){return t.trainable=e}),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter(function(e){return e.trainable}):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter(function(e){return!e.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=OC(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=OC(this.inputSpec);if(e.length!==t.length)throw new TC("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ").concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new TC("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new TC("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new TC("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new TC("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new TC("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var p=a.shape[h],f=r.shape[h];if(null!=p&&null!=f&&p!==f)throw new TC("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=OC(e),i=!0,o=s(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof fE)){i=!1;break}}}catch(h){o.e(h)}finally{o.f()}var u,c=!0,l=s(a);try{for(l.s();!(u=l.n()).done;){if(u.value instanceof fE){c=!1;break}}}catch(h){l.e(h)}finally{l.f()}if(i===c)throw new TC("Arguments to apply() must be all SymbolicTensors or all Tensors");return hT(this.name,function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=s(OC(e));try{for(o.s();!(r=o.n()).done;){var u=r.value;i.push(u.shape)}}catch(h){o.e(h)}finally{o.f()}n.build(FC(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&c&&(n._refCount=1)}if(n.assertInputCompatibility(e),c){var l,p=n.call(e,t),f=[],d=s(OC(p));try{for(d.s();!(l=d.n()).done;){var v=l.value;-1!==a.indexOf(v)&&(v=v.clone()),f.push(v)}}catch(h){d.e(h)}finally{d.f()}if(p=FC(f),null!=n.activityRegularizer)throw new EC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}var m,g=function(e){var t,n=[],r=s(e=OC(e));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(h){r.e(h)}finally{r.f()}return FC(n)}(e),y=n.computeOutputShape(g),b="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?g[0]:g),m=null!=y&&y.length>0&&Array.isArray(y[0])?y.map(function(r,a){return new fE(b,r,n,OC(e),t,n.name,a)}):new fE(b,y,n,OC(e),t,n.name),n.addInboundNode(e,m,null,null,g,y,t),n._refCount++,null!=n.activityRegularizer)throw new EC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return m})}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{var t=!1;this.batchInputShape.forEach(function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)}),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new SC("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=s(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new SC("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}},{key:"countParams",value:function(){if(!this.built)throw new CC("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return sE(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return lE(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;Ib(function(){var n=t.weights;if(n.length!==e.length)throw new TC('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var r=[],a=lE(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!Pf(o.shape,u.shape))throw new TC("Layer weight shape ".concat(o.shape," not compatible with provided weight shape ").concat(u.shape));r.push([s,u])}hE(r)}})}},{key:"addWeight",value:function(e,t,n,r,a,i,o){if(-1!==this._addedWeightNames.indexOf(e))throw new TC("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=QT("zeros"));var s=r.apply(t,n),u=new cE(s,n,e,i,o);return s.dispose(),null!=a&&this.addLoss(function(){return a.apply(u.read())}),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=OC(e),null!=this._losses&&(t=this.losses).push.apply(t,i(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach(function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))})}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=OC(e);t=OC(t),n=OC(n),r=OC(r),a=aE(a),i=aE(i);var c,l=[],h=[],p=[],f=s(u);try{for(f.s();!(c=f.n()).done;){var d=c.value;l.push(d.sourceLayer),h.push(d.nodeIndex),p.push(d.tensorIndex)}}catch(m){f.e(m)}finally{f.f()}new vE({outboundLayer:this,inboundLayers:l,nodeIndices:h,tensorIndices:p,inputTensors:u,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var v=0;v<t.length;v++)t[v].sourceLayer=this,t[v].nodeIndex=this.inboundNodes.length-1,t[v].tensorIndex=v}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach(function(e){return e.dispose()}),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(yb);function yE(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,u=s(yE(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(u.s();!(o=u.n()).done;){var c=o.value;-1===a.indexOf(c)&&a.push(c)}}catch(l){u.e(l)}finally{u.f()}}return a}var bE=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:nE("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new TC("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new TC("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new TC("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new fE(r.dtype,r.batchInputShape,y(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new vE({outboundLayer:y(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),g(r)}return I(n,[{key:"apply",value:function(e,t){throw new TC("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(gE);return e.className="InputLayer",e}();function kE(e){return xE.apply(this,arguments)}function xE(){return(xE=Sf(regeneratorRuntime.mark(function e(t){var n,r,a,i,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Nb(a);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function wE(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}kb(bE);var IE=function(){function e(){x(this,e),this.validationData=null}return I(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(e,t){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}},{key:"onEpochEnd",value:function(e,t){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}},{key:"onBatchBegin",value:function(e,t){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}},{key:"onBatchEnd",value:function(e,t){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}},{key:"onTrainBegin",value:function(e){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}},{key:"onTrainEnd",value:function(e){return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}},{key:"setModel",value:function(e){}}]),e}(),NE=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;x(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return I(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=s(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=s(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a,i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:null==t&&(t={}),a=s(n.callbacks),r.prev=2,a.s();case 4:if((i=a.n()).done){r.next=10;break}return o=i.value,r.next=8,o.onEpochBegin(e,t);case 8:r.next=4;break;case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(2),a.e(r.t0);case 15:return r.prev=15,a.f(),r.finish(15);case 18:case"end":return r.stop()}},r,null,[[2,12,15,18]])}))()}},{key:"onEpochEnd",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a,i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:null==t&&(t={}),a=s(n.callbacks),r.prev=2,a.s();case 4:if((i=a.n()).done){r.next=10;break}return o=i.value,r.next=8,o.onEpochEnd(e,t);case 8:r.next=4;break;case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(2),a.e(r.t0);case 15:return r.prev=15,a.f(),r.finish(15);case 18:case"end":return r.stop()}},r,null,[[2,12,15,18]])}))()}},{key:"onBatchBegin",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a,i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:null==t&&(t={}),a=s(n.callbacks),r.prev=2,a.s();case 4:if((i=a.n()).done){r.next=10;break}return o=i.value,r.next=8,o.onBatchBegin(e,t);case 8:r.next=4;break;case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(2),a.e(r.t0);case 15:return r.prev=15,a.f(),r.finish(15);case 18:case"end":return r.stop()}},r,null,[[2,12,15,18]])}))()}},{key:"onBatchEnd",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a,i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:null==t&&(t={}),a=s(n.callbacks),r.prev=2,a.s();case 4:if((i=a.n()).done){r.next=10;break}return o=i.value,r.next=8,o.onBatchEnd(e,t);case 8:r.next=4;break;case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(2),a.e(r.t0);case 15:return r.prev=15,a.f(),r.finish(15);case 18:case"end":return r.stop()}},r,null,[[2,12,15,18]])}))()}},{key:"onTrainBegin",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:null==e&&(e={}),r=s(t.callbacks),n.prev=2,r.s();case 4:if((a=r.n()).done){n.next=10;break}return i=a.value,n.next=8,i.onTrainBegin(e);case 8:n.next=4;break;case 10:n.next=15;break;case 12:n.prev=12,n.t0=n.catch(2),r.e(n.t0);case 15:return n.prev=15,r.f(),n.finish(15);case 18:case"end":return n.stop()}},n,null,[[2,12,15,18]])}))()}},{key:"onTrainEnd",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:null==e&&(e={}),r=s(t.callbacks),n.prev=2,r.s();case 4:if((a=r.n()).done){n.next=10;break}return i=a.value,n.next=8,i.onTrainEnd(e);case 8:n.next=4;break;case 10:n.next=15;break;case 12:n.prev=12,n.t0=n.catch(2),r.e(n.t0);case 15:return n.prev=15,r.f(),n.finish(15);case 18:case"end":return n.stop()}},n,null,[[2,12,15,18]])}))()}}]),e}(),SE=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.call(this)}return I(n,[{key:"onEpochBegin",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.seen=0,t.totals={};case 1:case"end":return e.stop()}},e)}))()}},{key:"onBatchEnd",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function e(){var r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==t&&(t={}),r=null==t.size?0:t.size,n.seen+=r,a=function(e){var a=t[e];if("number"==typeof a)n.totals.hasOwnProperty(e)||(n.totals[e]=0),n.totals[e]=n.totals[e]+a*r;else{var i;e in n.totals?i=n.totals[e]:n.totals[e]=0;var o=Ib(function(){return Db(n.totals[e],Ok(a,r))});n.totals[e]=o,null!=i&&i.dispose()}},t)a(i);case 5:case"end":return e.stop()}},e)}))()}},{key:"onEpochEnd",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function e(){var r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){r=s(n.params.metrics);try{for(i=function(){var e=a.value;null!=n.totals[e]&&("number"==typeof n.totals[e]?t[e]=n.totals[e]/n.seen:Ib(function(){var r=Ok(mk(1,n.seen),n.totals[e]);t[e]=r,n.totals[e].dispose(),Sb(t[e])}))},r.s();!(a=r.n()).done;)i()}catch(o){r.e(o)}finally{r.f()}}case 1:case"end":return e.stop()}},e)}))()}}]),n}(IE),CE=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"onTrainBegin",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.epoch=[],t.history={};case 1:case"end":return e.stop()}},e)}))()}},{key:"onEpochEnd",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:for(a in null==t&&(t={}),n.epoch.push(e),t)null==n.history[a]&&(n.history[a]=[]),n.history[a].push(t[a]);case 2:case"end":return r.stop()}},r)}))()}},{key:"syncData",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n,r,a,i,o,s,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(i in n=[],r=[],a=[],e.history)for(o=e.history[i],s=0;s<o.length;++s)"number"!=typeof o[s]&&(n.push(o[s].data()),r.push(i),a.push(s));return t.next=4,Promise.all(n);case 4:for(u=t.sent,c=0;c<u.length;++c)e.history[r[c]][a[c]].dispose(),e.history[r[c]][a[c]]=u[c][0];case 6:case"end":return t.stop()}},t)}))()}}]),n}(IE),TE=function(e){d(n,e);var t=m(n);function n(e,r){var a;if(x(this,n),(a=t.call(this)).currentEpoch=0,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Jf(a.yieldEvery)&&(a.maybeWait=function(e,t){var n,r=gg();return function(){var a=gg();return a-r<t||(r=a,n=e.apply(void 0,arguments)),n}}(a.maybeWait.bind(y(a)),a.yieldEvery)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,g(a)}return I(n,[{key:"maybeWait",value:function(e,t,n){var r=this;return Sf(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],a.t0=null!=r.yield,!a.t0){a.next=6;break}return a.next=5,kE(n);case 5:i.push(r.yield(e,t,n));case 6:return i.push(nI()),a.next=9,Promise.all(i);case 9:case"end":return a.stop()}},a)}))()}},{key:"onEpochBegin",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n.currentEpoch=e,r.t0=null!=n.epochBegin,!r.t0){r.next=7;break}return r.next=5,kE(t);case 5:return r.next=7,n.epochBegin(e,t);case 7:case"end":return r.stop()}},r)}))()}},{key:"onEpochEnd",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=[],r.t0=null!=n.epochEnd,!r.t0){r.next=6;break}return r.next=5,kE(t);case 5:a.push(n.epochEnd(e,t));case 6:return"epoch"===n.yieldEvery&&a.push(nI()),r.next=9,Promise.all(a);case 9:case"end":return r.stop()}},r)}))()}},{key:"onBatchBegin",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=null!=n.batchBegin,!r.t0){r.next=6;break}return r.next=4,kE(t);case 4:return r.next=6,n.batchBegin(e,t);case 6:case"end":return r.stop()}},r)}))()}},{key:"onBatchEnd",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=[],r.t0=null!=n.batchEnd,!r.t0){r.next=6;break}return r.next=5,kE(t);case 5:a.push(n.batchEnd(e,t));case 6:return"batch"===n.yieldEvery?a.push(nI()):Jf(n.yieldEvery)&&a.push(n.maybeWait(n.currentEpoch,e,t)),r.next=9,Promise.all(a);case 9:case"end":return r.stop()}},r)}))()}},{key:"onTrainBegin",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=null!=t.trainBegin,!n.t0){n.next=6;break}return n.next=4,kE(e);case 4:return n.next=6,t.trainBegin(e);case 6:case"end":return n.stop()}},n)}))()}},{key:"onTrainEnd",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=null!=t.trainEnd,!n.t0){n.next=6;break}return n.next=4,kE(e);case 4:return n.next=6,t.trainEnd(e);case 6:case"end":return n.stop()}},n)}))()}}]),n}(IE);function EE(e,t){return null==e&&(e={}),e instanceof IE?[e]:Array.isArray(e)&&e[0]instanceof IE?e:OC(e).map(function(e){return new TE(e,t)})}var _E=function(){var e=function(){function e(){x(this,e)}return I(e,null,[{key:"registerCallbackConstructor",value:function(t,n){Df(t>=0&&Number.isInteger(t),function(){return"Verbosity level is expected to be an integer >= 0, but got ".concat(t)}),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach(function(e){if(e===t)throw new TC("Duplicate callback constructor.")})}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,i(e.constructors[a]))}return n.map(function(e){return new e})}}]),e}();return e.constructors={},e}();function RE(e,t,n,r,a,o,s,u,c){var l=new CE,h=[new SE].concat(i(_E.createCallbacks(t)));null!=e&&h.push.apply(h,i(e)),h.push(l);var p=new NE(h);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:o,batchSize:s,verbose:t,doValidation:u,metrics:c}),{callbackList:p,history:l}}function AE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return VC(e,bb.getMap().classNameMap,t,"layer",n)}function DE(e,t){return Ib(function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=Lk(FT(e),t,!0),r=Sk(n.shape,NC()),a=Tx(Wk(n,r));return mk(e,a)})}function FE(e,t){return Ib(function(){return Uk(FT(Mk(t,e)),-1)})}function OE(e,t){return Ib(function(){return Uk(Ab(Mk(t,e)),-1)})}function ME(e,t){return Ib(function(){var n=Mk(e,t),r=rk(Ab(e),NC(),Number.MAX_VALUE),a=Ab(mk(n,r));return Ok(100,Uk(a,-1))})}function LE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ib(function(){if(n)t=Nx(t);else{var r=Lk(t,t.shape.length-1,!0);t=mk(t,r)}return t=rk(t,NC(),1-NC()),tx(Lk(Ok(e.toFloat(),Ak(t)),t.shape.length-1))})}function PE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ib(function(){var r=Ck(function(e){var t=[gT(e.shape)];return e.reshape(t)}(e)).toInt(),a=(t=rk(t,NC(),1-NC())).shape;return LE(rx(r,a[a.length-1]).reshape(a),t,n)})}function zE(e,t){return Ib(function(){var n;return n=rk(t,NC(),1-NC()),n=Ak(mk(n,Mk(1,n))),Uk(function(e,t){if(!Pf(e.shape,t.shape))throw new TC("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Ib(function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())})}(e,n),-1)})}function BE(e,t){return Ib(function(){var n=DE(e,-1),r=DE(t,-1),a=Ok(n,r);return tx(Lk(a,-1))})}var VE={meanSquaredError:FE,meanAbsoluteError:OE,meanAbsolutePercentageError:ME,meanSquaredLogarithmicError:function(e,t){return Ib(function(){var n=rk(t,NC(),Number.MAX_VALUE),r=Ak(Db(1,n)),a=rk(e,NC(),Number.MAX_VALUE),i=Ak(Db(1,a));return Uk(FT(Mk(r,i)),-1)})},squaredHinge:function(e,t){return Ib(function(){var n=Wk(0,Mk(1,Ok(e,t)));return Uk(FT(n),-1)})},hinge:function(e,t){return Ib(function(){var n=Wk(0,Mk(1,Ok(e,t)));return Uk(n,-1)})},categoricalHinge:function(e,t){return Ib(function(){var n=Lk(Ok(e,t),-1),r=Fk(Ok(Mk(1,e),t),-1);return Wk(0,Db(1,Mk(r,n)))})},logcosh:function(e,t){return Ib(function(){var n=Math.log(2),r=Mk(t,e),a=Mk(Db(r,Sx(Ok(-2,r))),n);return Uk(a,-1)})},categoricalCrossentropy:LE,sparseCategoricalCrossentropy:PE,binaryCrossentropy:zE,kullbackLeiblerDivergence:function(e,t){return Ib(function(){var n=rk(e,NC(),1),r=rk(t,NC(),1);return Lk(Ok(e,Ak(mk(n,r))),-1)})},poisson:function(e,t){return Ib(function(){var n=Ak(Db(NC(),t));return Uk(Mk(t,Ok(e,n)),-1)})},cosineProximity:BE};function WE(e){if("string"==typeof e){if(e in VE)return VE[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new TC(t)}return e}function UE(e,t){return Ib(function(){var n=Ok(.5,ox(t)),r=wT(Ek(t,n),e.dtype);return Uk(xk(e,r),-1)})}function HE(e,t){return Ib(function(){return wT(xk(Mb(e,-1),Mb(t,-1)),"float32")})}function jE(e,t){return zE(e,t)}function GE(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),xk(e,t).asType("float32")}var qE=LE,KE=PE,XE={binaryAccuracy:UE,categoricalAccuracy:HE,precision:function(e,t){return Ib(function(){var n=function(e,t){return Ib(function(){return zk(e.equal(1),t.equal(1)).sum().cast("float32")})}(e,t),r=function(e,t){return Ib(function(){return zk(e.equal(0),t.equal(1)).sum().cast("float32")})}(e,t),a=n.add(r);return Lx(Ek(a,0),n.div(a),0).cast("float32")})},categoricalCrossentropy:qE,sparseCategoricalCrossentropy:KE,mse:FE,MSE:FE,mae:OE,MAE:OE,mape:ME,MAPE:ME,cosine:BE};function YE(e){if("string"==typeof e&&e in XE)return XE[e];if("string"!=typeof e&&null!=e)return e;throw new TC("Unknown metric ".concat(e))}function ZE(e){if(AC(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(VE);n<r.length;n++){var a=r[n];if(VE[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(XE);i<o.length;i++){var s=o[i];if(XE[s]===e){t=s;break}}return void 0!==t?t:e.name}function JE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!QE(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576."))}}function QE(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r||!QE(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=s(e);try{for(i.s();!(a=i.n()).done;){if(!QE(a.value))return!1}}catch(u){i.e(u)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function $E(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function e_(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(a){r="multiple"}$E(["".concat(e.name," (").concat(e.getClassName(),")"),r,e.countParams().toString()],t,n)}function t_(e,t,n,r){var a;try{a=JSON.stringify(e.outputShape)}catch(d){a="multiple"}var i,o=[],u=s(e.inboundNodes);try{for(u.s();!(i=u.n()).done;){var c=i.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l)o.push("".concat(c.inboundLayers[l].name,"[").concat(c.nodeIndices[l],"][").concat(c.tensorIndices[l],"]"))}}catch(v){u.e(v)}finally{u.f()}var h=e.name,p=e.getClassName(),f=0===o.length?"":o[0];$E(["".concat(h," (").concat(p,")"),a,e.countParams().toString(),f],t,r);for(var d=1;d<o.length;++d)$E(["","","",o[d]],t,r)}function n_(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function r_(e,t){if(null===e)return null;if("string"==typeof e)return LC(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];n_(t,a,i)?n.push(i):n.push(r_(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var h=LC(c);o[h]=r_(l,h)}}return o}function a_(e,t){if(null==e)return null;if("string"==typeof e)return MC(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];n_(t,a,i)?n.push(i):n.push(a_(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];o[MC(c)]="name"!==c&&"className"!==c||"string"!=typeof l?a_(l,c):l}return o}var i_=function(){function e(t){if(x(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=s(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return I(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new TC("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,n){if(null==e.dtype||e.dtype===n.dtype)return n;try{return Uy(n,e.dtype)}catch(t){throw new TC("The dtype of the feed (".concat(n.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof fE){if(null==this.id2Value[e.id])throw new TC("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new TC("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof fE){if(null==this.id2Value[e.id])throw new TC("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new TC("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Nb(this.id2Mask)}}]),e}(),o_={},s_={};function u_(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),u=o?e:[e],c=u.map(function(e){return e.name}),l=[],h=t.names(),p=s(c);try{for(p.s();!(a=p.n()).done;){var f=a.value;-1!==h.indexOf(f)?l.push(t.getValue(f)):l.push(null)}}catch(z){p.e(z)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,v,m=c.join(",")+"|"+t.names().join(",");if(null==o_[m]){var g=function(e,t){Df(null!=e&&e.length>0,function(){return"Expected at least one fetch, got none"});var n=[],r={};if(1===e.length){var a=l_(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,u=s(e);try{for(u.s();!(i=u.n()).done;){var c,l=l_(i.value,t),h=l.sorted,p=l.recipientMap,f=s(h);try{for(f.s();!(c=f.n()).done;){var d=c.value;o.has(d.name)||(n.push(d),o.add(d.name))}}catch(z){f.e(z)}finally{f.f()}var v=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach(function(t){return r[e].add(t)})};for(var m in p)v(m)}}catch(z){u.e(z)}finally{u.f()}}return{sorted:n,recipientCounts:c_(r)}}(u,t);d=g.sorted,v=g.recipientCounts,o_[m]=d,s_[m]=v}d=o_[m],v={},i||Object.assign(v,s_[m]);for(var y=new i_(t),b=0;b<d.length;++b){if(null!=r){var k=wb().numTensors;k>r.maxNumTensors&&(r.maxNumTensors=k),k<r.minNumTensors&&(r.minNumTensors=k)}var x=d[b],w=x.sourceLayer;if(!(w instanceof bE)){var I,N=[],S=[],C=[],T=!1,E=s(x.inputs);try{for(E.s();!(I=E.n()).done;){var _=I.value,R=y.getValue(_),A=y.getMask(_);N.push(R),S.push(A),null!=A&&(T=!0),i||(v[_.name]--,0===v[_.name]&&!t.hasKey(_)&&-1===c.indexOf(_.name)&&!R.isDisposed&&!0!==_.sourceLayer.stateful&&C.push(R))}}catch(z){E.e(z)}finally{E.f()}T&&((n=n||{}).mask=S[0]);var D=OC(w.apply(N,n)),F=null;w.supportsMasking&&(F=w.computeMask(N,S));for(var O=h_(x),M=Array.isArray(O)?O:[O],L=0;L<M.length;++L){y.hasKey(M[L])||y.add(M[L],D[L],Array.isArray(F)?F[0]:F);var P=c.indexOf(M[L].name);-1!==P&&(l[P]=D[L])}i||Nb(C)}}return y.disposeMasks(),o?l:l[0]}function c_(e){var t={};for(var n in e)t[n]=e[n].size;return t}function l_(e,t){var n,r=new Set,a=[],i={},o=s(t.names());try{for(o.s();!(n=o.n()).done;){var u=n.value;r.add(u)}}catch(m){o.e(m)}finally{o.f()}var c=[],l=[];for(c.push(e);c.length>0;){var h=c[c.length-1];if(r.has(h.name))c.pop();else{var p=l[l.length-1]===c.length-1;if(0===h.inputs.length||p)c.pop(),a.push(h),r.add(h.name),p&&l.pop();else{l.push(c.length-1);var f,d=s(h.inputs);try{for(d.s();!(f=d.n()).done;){var v=f.value;null==i[v.name]&&(i[v.name]=new Set),i[v.name].add(h.name),!r.has(v.name)&&c.push(v)}}catch(m){d.e(m)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function h_(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=s(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}var p_=function(e){d(r,e);var t=m(r);function r(e){var n;if(x(this,r),(n=t.call(this,{})).containerNodes=new Set,n.name=e.name,null==n.name){var a=n.getClassName().toLowerCase();n.name=nE(a)}if(n.supportsMasking=!1,n.trainable_=!0,n.inputs=Array.isArray(e.inputs)?e.inputs.slice():[e.inputs],n.outputs=Array.isArray(e.outputs)?e.outputs.slice():[e.outputs],UC(n.inputs).length!==n.inputs.length)throw new TC("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(n.inputs.map(function(e){return e.name})));UC(n.outputs).length!==n.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(n.outputs.map(function(e){return e.name}))),n.inputLayers=[],n.inputLayersNodeIndices=[],n.inputLayersTensorIndices=[],n.outputLayers=[],n.outputLayersNodeIndices=[],n.outputLayersTensorIndices=[],n.layers=[],n.internalContainerRefs=[];var i,o=s(n.outputs);try{for(o.s();!(i=o.n()).done;){var u=i.value,c=u.nodeIndex,l=u.tensorIndex;n.outputLayers.push(u.sourceLayer),n.outputLayersNodeIndices.push(c),n.outputLayersTensorIndices.push(l)}}catch(be){o.e(be)}finally{o.f()}var h,p=s(n.inputs);try{for(p.s();!(h=p.n()).done;){var f=h.value,d=f.sourceLayer,v=f.nodeIndex,m=f.tensorIndex;AC(0===v,"input layer has >1 nodes"),AC(0===m,"input layer has >1 tensors"),n.inputLayers.push(d),n.inputLayersNodeIndices.push(v),n.inputLayersTensorIndices.push(m)}}catch(be){p.e(be)}finally{p.f()}n.inputNames=[],n.outputNames=[],n.feedInputShapes=[],n.feedInputNames=[],n.feedOutputNames=[];for(var b=0;b<n.inputLayers.length;b++){var k=n.inputLayers[b];if(!(k instanceof bE))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(b," (0-based) originates from layer type ").concat(k.getClassName(),"."));n.inputNames.push(k.name),n.feedInputShapes.push(k.batchInputShape),n.feedInputNames.push(k.name)}var w,I=s(n.outputLayers);try{for(I.s();!(w=I.n()).done;){var N=w.value;n.outputNames.push(N.name)}}catch(be){I.e(be)}finally{I.f()}n.internalInputShapes=n.inputs.map(function(e){return e.shape}),n.internalOutputShapes=n.outputs.map(function(e){return e.shape});var S,C={},T={},E={},_={},R={},A=[],D=function e(t,a,i,o,s,u){(null==o||null==s||null==u)&&(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new CC("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){n.containerNodes.add(r.nodeKey(o,s)),o.id in R||(R[o.id]=Object.keys(R).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,h=0;h<l;h++)e(c.inputTensors[h],a,i,c.inboundLayers[h],c.nodeIndices[h],c.tensorIndices[h]);for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);A.push(c)}},F=[],O=[],M=s(n.outputs);try{for(M.s();!(S=M.n()).done;){D(S.value,F,O)}}catch(be){M.e(be)}finally{M.f()}var L,P=s(A.slice().reverse());try{for(P.s();!(L=P.n()).done;){var z=L.value;T[z.id]=z,z.id in C||(C[z.id]=0);var B=C[z.id];B=Math.max(B,null==E[z.outboundLayer.id]?0:E[z.outboundLayer.id]),E[z.outboundLayer.id]=B,_[z.outboundLayer.id]=z.outboundLayer,C[z.id]=B;for(var V=0;V<z.inboundLayers.length;V++){var W=z.inboundLayers[V].inboundNodes[z.nodeIndices[V]];C[W.id]=Math.max(B+1,null==C[W.id]?0:C[W.id]),T[W.id]=W}}}catch(be){P.e(be)}finally{P.f()}var U={};for(var H in C){var j=C[H];j in U||(U[j]=[]),U[j].push(T[H])}var G={};for(var q in E){var K=E[q];K in G||(G[K]=[]),G[K].push(_[q])}var X=Object.keys(G).map(function(e){return parseInt(e,10)}).sort(WC);n.layers=[];var Y,Z=s(X);try{for(Z.s();!(Y=Z.n()).done;){var J=G[Y.value];J.sort(function(e,t){var n=R[e.id],r=R[t.id];return n<r?-1:n>r?1:0});var Q,$=s(J);try{for($.s();!(Q=$.n()).done;){var ee=Q.value;ee instanceof r&&n.internalContainerRefs.push(ee),n.layers.push(ee)}}catch(be){$.e(be)}finally{$.f()}}}catch(be){Z.e(be)}finally{Z.f()}n.layersByDepth=G,X=Object.keys(U).map(function(e){return parseInt(e,10)}).sort(WC);var te,ne=n.inputs.slice(),re=[],ae=s(X);try{for(ae.s();!(te=ae.n()).done;){var ie,oe=s(U[te.value]);try{for(oe.s();!(ie=oe.n()).done;){var se=ie.value,ue=se.outboundLayer;if(null!=ue){var ce,le=s(se.inputTensors);try{for(le.s();!(ce=le.n()).done;){var he=ce.value;if(-1===ne.indexOf(he))throw new CC("Graph disconnected: cannot obtain value for tensor ".concat(he,' at layer "').concat(ue.name,'". The following previous layers were accessed without issue: ').concat(re))}}catch(be){le.e(be)}finally{le.f()}var pe,fe=s(se.outputTensors);try{for(fe.s();!(pe=fe.n()).done;){var de=pe.value;ne.push(de)}}catch(be){fe.e(be)}finally{fe.f()}re.push(ue.name)}}}catch(be){oe.e(be)}finally{oe.f()}}}catch(be){ae.e(be)}finally{ae.f()}n.nodesByDepth=U;var ve,me=n.layers.map(function(e){return e.name}),ge=s(me);try{var ye=function(){var e=ve.value,t=me.filter(function(t){return t===e}).length;if(1!==t)throw new CC('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(me))};for(ge.s();!(ve=ge.n()).done;)ye()}catch(be){ge.e(be)}finally{ge.f()}return n.outboundNodes=[],n.inboundNodes=[],new vE({outboundLayer:y(n),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:n.inputs,outputTensors:n.outputs,inputMasks:n.inputs.map(function(e){return null}),outputMasks:n.outputs.map(function(e){return null}),inputShapes:n.inputs.map(function(e){return e.shape}),outputShapes:n.outputs.map(function(e){return e.shape})}),n.built=!0,n._refCount=1,g(n)}return I(r,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){var t,n=s(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(u){n.e(u)}finally{n.f()}var a,i=s(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(u){i.e(u)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach(function(t){t._trainableWeights.forEach(function(t){return t.trainable=e})}),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new TC("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=s(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=s(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,i(r.nonTrainableWeights))}}catch(l){n.e(l)}finally{n.f()}if(!this.trainable){var a,o=[],u=s(this.layers);try{for(u.s();!(a=u.n()).done;){var c=a.value;o.push.apply(o,i(c.trainableWeights))}}catch(l){u.e(l)}finally{u.f()}return o.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=s(this.layers);try{for(i.s();!(t=i.n()).done;){var o,u=t.value,c=s(u.weights);try{for(c.s();!(o=c.n()).done;){var l=o.value;if(null!=r[l.originalName])throw new TC("Duplicate weight name: ".concat(l.originalName));r[l.originalName]=l,a++}}catch(g){c.e(g)}finally{c.f()}}}catch(g){i.e(g)}finally{i.f()}var h=[];for(var p in e){var f=p;if(null==r[p]){var d=p.split("/");f=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(null!=r[f])h.push([r[f],e[p]]);else if(n)throw new TC("Provided weight data has no target variable: ".concat(p));delete r[f]}if(n){var v=[];for(var m in r)v.push(m);if(v.length>0)throw new TC("".concat(v.length," of ").concat(a," weights are not set: ").concat(v))}hE(h)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 3.3.0",t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=a_(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return Ib(function(){e=OC(e);for(var r=new i_,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return u_(n.outputs,r,t)})}},{key:"computeMask",value:function(e,t){var n=this;return Ib(function(){var r;return e=OC(e),r=null==t?RC(null,e.length):OC(t),n.runInternalGraph(e,r)[1]})}},{key:"computeOutputShape",value:function(e){var t=aE(e);if(t.length!==this.inputLayers.length)throw new TC("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++)n[this.inputLayers[r].name+"_0_0"]=t[r];var a=Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(WC);if(a.length>1){var i,o=s(a);try{for(o.s();!(i=o.n()).done;){var u,c=i.value,l=s(this.nodesByDepth[c]);try{for(l.s();!(u=l.n()).done;){var h=u.value,p=h.outboundLayer;if(-1===this.inputLayers.map(function(e){return e.id}).indexOf(p.id)){for(var f=[],d=0;d<h.inboundLayers.length;d++)f.push(n["".concat(h.inboundLayers[d].name,"_").concat(h.nodeIndices[d],"_").concat(h.tensorIndices[d])]);for(var v=aE(p.computeOutputShape(FC(f))),m=p.inboundNodes.indexOf(h),g=0;g<v.length;g++)n["".concat(p.name,"_").concat(m,"_").concat(g)]=v[g]}}}catch(I){l.e(I)}finally{l.f()}}}catch(I){o.e(I)}finally{o.f()}}for(var y=[],b=[],k=0;k<this.outputLayers.length;k++)b.push("".concat(this.outputLayers[k].name,"_").concat(this.outputLayersNodeIndices[k],"_").concat(this.outputLayersTensorIndices[k]));for(var x=0;x<b.length;x++){var w=b[x];AC(w in n),y.push(n[w])}return FC(y)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=RC(null,e.length));for(var r={},a=0;a<this.inputs.length;++a)r[this.inputs[a].id]=[e[a],t[a]];var i,o=s(Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(WC));try{for(o.s();!(i=o.n()).done;){var u,c=i.value,l=s(this.nodesByDepth[c]);try{for(l.s();!(u=l.n()).done;){var h,p=u.value,f=p.outboundLayer,d=p.inputTensors,v=p.outputTensors,m=new Array,g=s(d);try{for(g.s();!(h=g.n()).done;){var y=h.value;y.id in r&&m.push(r[y.id])}}catch(P){g.e(P)}finally{g.f()}if(m.length===d.length){var b=void 0,k=void 0,x=void 0,w=void 0,I={};if(null!=p.callArgs&&(I=p.callArgs),1===m.length){var N=n(m[0],2),S=N[0],C=N[1];null==I.mask&&(I.mask=C),x=OC(f.call(S,I)),w=OC(f.computeMask(S,C)),b=[S],k=[C]}else b=m.map(function(e){return e[0]}),k=m.map(function(e){return e[1]}),null==I.mask&&(I.mask=k),x=OC(f.call(b,I)),w=OC(f.computeMask(b,k));if(f.activityRegularizer)throw new EC("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var T=0;T<v.length;++T)r[v[T].id]=[x[T],w[T]]}}}catch(P){l.e(P)}finally{l.f()}}}catch(P){o.e(P)}finally{o.f()}var E,_=[],R=[],A=[],D=s(this.outputs);try{for(D.s();!(E=D.n()).done;){var F=E.value;AC(F.id in r,"Could not compute output ".concat(F.name," : ").concat(F.id));var O=n(r[F.id],2),M=O[0],L=O[1];A.push(M.shape),_.push(M),R.push(L)}}catch(P){D.e(P)}finally{D.f()}return[_,R,A]}},{key:"buildNodeConversionMap",value:function(e){var t,n,a={},i=s(this.layers);try{for(i.s();!(n=i.n()).done;){var o=n.value;t=o instanceof r?1:0;for(var u=0;u<o.inboundNodes.length;u++){var c=r.nodeKey(o,u);this.containerNodes.has(c)&&(a[c]=t,t+=1)}}}catch(l){i.e(l)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new TC("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new TC("Provide either a layer name or layer index");var n,r=s(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new TC("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return Ib(function(){var t,n=[],a=s(e.layers);try{for(a.s();!(t=a.n()).done;)for(var o=t.value,u=0;u<o.inboundNodes.length;++u){var c=r.nodeKey(o,u);e.containerNodes.has(c)&&n.push.apply(n,i(o.calculateLosses()))}}catch(l){a.e(l)}finally{a.f()}return n})}},{key:"getConfig",value:function(){var e,t={name:this.name},n=this.buildNodeConversionMap(this.layers),a=[],i=s(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,u=o.getClassName(),c=o.getConfig(),l=[],h=0;h<o.inboundNodes.length;h++){var p=o.inboundNodes[h],f=r.nodeKey(o,h),d={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),d=p.callArgs}catch(v){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ").concat(p.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),d={}}if(p.inboundLayers.length>0){for(var v=[],m=0;m<p.inboundLayers.length;m++){var g=p.inboundLayers[m],y=p.tensorIndices[m],b=n[r.nodeKey(g,p.nodeIndices[m])];null==b&&(b=0),v.push([g.name,b,y,d])}l.push(v)}}}var k={};k.name=o.name,k.className=u,k.config=c,k.inboundNodes=l,a.push(k)}}catch(A){i.e(A)}finally{i.f()}t.layers=a;for(var x=[],w=0;w<this.inputLayers.length;w++){var I=this.inputLayers[w],N=r.nodeKey(I,this.inputLayersNodeIndices[w]);if(this.containerNodes.has(N)){var S=n[N];null==S&&(S=0),x.push([I.name,S,this.inputLayersTensorIndices[w]])}}t.inputLayers=x;for(var C=[],T=0;T<this.outputLayers.length;T++){var E=this.outputLayers[T],_=r.nodeKey(E,this.outputLayersNodeIndices[T]);if(this.containerNodes.has(_)){var R=n[_];null==R&&(R=0),C.push([E.name,R,this.outputLayersTensorIndices[T]])}}return t.outputLayers=C,t}},{key:"stateful",get:function(){if(this._stateful)throw new TC("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=s(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;Ib(function(){e.layers.forEach(function(e){e.stateful&&e.resetStates()})})}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],u=s(t);try{for(u.s();!(a=u.n()).done;){var c=a.value,l=c[0],h=c[1],p=c[2];if(n=null==c[3]?{}:c[3],!(l in r))return void i(e,t);var f=r[l];if(f.inboundNodes.length<=h)return void i(e,t);o.push(f.inboundNodes[h].outputTensors[p])}}catch(d){u.e(d)}finally{u.f()}o.length>0&&e.apply(FC(o),n)}function u(e){var a=e.name,o=AE(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach(function(e){if(!(e instanceof Array))throw new TC("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)})}var c,l=t.name,h=t.layers,p=s(h);try{for(p.s();!(c=p.n()).done;){var f=c.value;u(f)}}catch(z){p.e(z)}finally{p.f()}for(;!HC(a);){var d,v=s(h);try{for(v.s();!(d=v.n()).done;){var m=d.value,g=r[m.name];if(g.name in a){var y=a[g.name];delete a[g.name];var b,k=s(y);try{for(k.s();!(b=k.n()).done;){var x=b.value;o(g,x)}}catch(z){k.e(z)}finally{k.f()}}}}catch(z){v.e(z)}finally{v.f()}}var w,I=[],N=[],S=t.inputLayers,C=s(S);try{for(C.s();!(w=C.n()).done;){var T=w.value,E=T[0],_=T[1],R=T[2];AC(E in r),I.push(r[E].inboundNodes[_].outputTensors[R])}}catch(z){C.e(z)}finally{C.f()}var A,D=t.outputLayers,F=s(D);try{for(F.s();!(A=F.n()).done;){var O=A.value,M=O[0],L=O[1],P=O[2];AC(M in r),N.push(r[M].inboundNodes[L].outputTensors[P])}}catch(z){F.e(z)}finally{F.f()}return new e({inputs:I,outputs:N,name:l})}}]),r}(gE);function f_(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(function(e){return null});if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach(function(t){a.push(t in e?e[t]:null)}),a}throw new Error("The model has multiple (".concat(r,") outputs, so ").concat(n," must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}function d_(e,t,n,r){return v_.apply(this,arguments)}function v_(){return(v_=Sf(regeneratorRuntime.mark(function e(t,n,r,a){var i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=12;break}return i=Ib(function(){if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1)return t.argMax(1);if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))}),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Nb(i),s=[],e.abrupt("return",(o.forEach(function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])}),Ax(s,"float32")));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function m_(e,t){return Ok(e,t)}function g_(e,t){var n,r;n=t.xs,r=t.ys,Df(null!=n&&null!=r,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)});var a=y_("input",e.inputNames,n),i=y_("output",e.outputNames,r),o=a[0].shape[0];Df(a.length===e.inputs.length,function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(a.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")")}),Df(i.length===e.outputs.length,function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(i.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")});for(var s=function(t){Df(a[t].shape[0]===o,function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(a[t].shape[0],"; expected  ").concat(o," based on input ").concat(e.inputNames[0],".")})},u=0;u<a.length;u++)s(u);for(var c=function(t){Df(i[t].shape[0]===o,function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(o," based on input ").concat(e.inputNames[0],".")})},l=0;l<i.length;l++)c(l);return{xs:a,ys:i}}function y_(e,t,n){if(n instanceof Rg)return[n];if(Array.isArray(n))return Df(n.length===t.length,function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")}),n;var r,a=[],i=s(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new TC("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(u){i.e(u)}finally{i.f()}return a}function b_(e){if(3===e.length)throw new EC("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function k_(){return(k_=Sf(regeneratorRuntime.mark(function e(t,n,r){var a,i,o,s,u,c,l,h,p,f,d,v,m,g,y,b,k,x,w,I,N,S,C,T,E,_,R,A,D,F,O,M;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,Df(null!=t.optimizer,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),Df(null!=r,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),Df(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(r.epochs)}),Df(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(r.batchesPerEpoch)}),Df(null==r.validationSplit,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(i=null!=r.validationData)&&(w_(r.validationData)?Df(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(r.validationBatches)}):(u=b_(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),h=i?l.slice().concat(l.map(function(e){return"val_"+e})):l.slice(),p=EE(r.callbacks,r.yieldEvery),f=null==r.verbose?1:r.verbose,d=RE(p,f,r.epochs,null,null,x_(n,r),null,i,h),v=d.callbackList,m=d.history,v.setModel(t),t.history=m,e.next=14,v.onTrainBegin();case 14:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=18,n.iterator();case 18:y=e.sent;case 19:if(!(g<r.epochs)){e.next=89;break}return b={},e.next=23,v.onEpochBegin(g);case 23:if(k=0,x=0,e.t0=a,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:y=e.sent;case 29:if(a&&!(k<r.batchesPerEpoch)){e.next=82;break}return e.next=32,y.next();case 32:if(w=e.sent,!a||!w.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as ".concat(r.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(k," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(r.batchesPerEpoch*r.epochs," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("break",82);case 36:if(null==w.value){e.next=63;break}return I=g_(t,w.value),N=I.xs,S=I.ys,(C={}).batch=x,C.size=N[0].shape[0],e.next=42,v.onBatchBegin(x,C);case 42:if(T=[],null==r.classWeight){e.next=55;break}E=f_(r.classWeight,t.outputNames),_=0;case 46:if(!(_<E.length)){e.next=55;break}return e.t1=T,e.next=50,d_(S[_],null,E[_]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++_,e.next=46;break;case 55:for(R=N.concat(S).concat(T),A=c(R),Nb(R),D=0;D<l.length;++D)F=A[D],C[l[D]]=F,Sb(F);return e.next=60,v.onBatchEnd(x,C);case 60:wE(C),x++,k++;case 63:if(!(a?k>=r.batchesPerEpoch:w.done)){e.next=78;break}if(!i){e.next=77;break}if(O=void 0,!w_(r.validationData)){e.next=74;break}return e.t4=OC,e.next=70,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 70:e.t5=e.sent,e.t3=(0,e.t4)(e.t5),e.next=75;break;case 74:e.t3=OC(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 75:for(O=e.t3,M=0;M<t.metricsNames.length;++M)b["val_".concat(t.metricsNames[M])]=O[M];case 77:return e.abrupt("break",82);case 78:if(!t.stopTraining_){e.next=80;break}return e.abrupt("break",82);case 80:e.next=29;break;case 82:return e.next=84,v.onEpochEnd(g,b);case 84:if(g++,!t.stopTraining_){e.next=87;break}return e.abrupt("break",89);case 87:e.next=19;break;case 89:return e.next=91,v.onTrainEnd();case 91:return e.next=93,t.history.syncData();case 93:return e.abrupt("return",t.history);case 94:return e.prev=94,t.isTraining=!1,e.finish(94);case 97:case"end":return e.stop()}},e,null,[[4,,94,97]])}))).apply(this,arguments)}function x_(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function w_(e){return"function"==typeof e.iterator}function I_(e){return"function"==typeof e.next}function N_(){return(N_=Sf(regeneratorRuntime.mark(function e(t,n,r){var a,i,o,s,u,c,l,h,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=4;break}throw new EC("Verbose mode is not implemented yet.");case 4:if(Df(!a||r.batches>0&&Number.isInteger(r.batches),function(){return"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(r.batches))}),!I_(n)){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:s=e.t0,u=0,c=0,l=regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=Ib(function(){return n.value&&function(){var e=g_(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=Ib(function(){return i(s)});if(Nb(s),0===c)for(var h=0;h<l.length;++h)o.push(_b(0));for(var p=s[0].shape[0],f=function(e){var t=l[e],n=o[e];o[e]=Ib(function(){return Db(o[e],Ok(p,t))}),c>0&&Nb(n)},d=0;d<l.length;++d)f(d);Nb(l),u+=p,++c}(),o}),!n.done){e.next=6;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(r.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}},e)});case 15:if(a&&!(c<r.batches)){e.next=22;break}return e.delegateYield(l(),"t1",17);case 17:if("break"!==e.t1){e.next=20;break}return e.abrupt("break",22);case 20:e.next=15;break;case 22:for(h=0;h<o.length;++h)p=o[h],o[h]=mk(o[h],u),Nb(p);return e.abrupt("return",FC(o));case 24:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S_(e){Df(e>0&&Number.isInteger(e),function(){return"batchSize is required to be a positive integer, but got ".concat(e)})}function C_(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(function(e){return NT(e,t,n-t)}):NT(e,t,n-t)}function T_(e,t){return Ib(function(){return null==e?null:Array.isArray(e)?e.map(function(e){return T_(e,t)}):DT(e,"int32"===t.dtype?t:t.toInt())})}function E_(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function __(e,t,n,r,a,i,o,s,u,c,l,h,p,f,d){return R_.apply(this,arguments)}function R_(){return(R_=Sf(regeneratorRuntime.mark(function e(t,n,r,a,i,o,s,u,c,l,h,p,f,d,v){var m,g,y,b,k,x,w,I;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i&&(i=32),null==o&&(o=1),null==h&&(h=!0),null==f&&(f=0),m=!1,null!=c&&null!=l&&(m=!0),null==v||(m=!0,null!=d)){e.next=4;break}throw new TC("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 4:return null!=(g=t.checkNumSamples(r,i,d,"steps_per_epoch"))&&(y=xT(0,g)),null==s&&(s=1),b=RE(u,s,o,f,g,d,i,m,p),k=b.callbackList,x=b.history,k.setModel(t),t.history=x,e.next=11,k.onTrainBegin();case 11:t.stopTraining_=!1,w=regeneratorRuntime.mark(function e(o){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.onEpochBegin(o);case 2:if(s={},null==d){e.next=5;break}throw new EC("stepsPerEpoch mode is not implemented yet.");case 5:return e.delegateYield(regeneratorRuntime.mark(function e(){var o,u,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==h){e.next=2;break}throw new EC("batch shuffling is not implemneted yet");case 2:h&&_f(y),o=Ax(y),u=E_(g,i),p=regeneratorRuntime.mark(function e(h){var p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p={},e.next=3,k.onBatchBegin(h,p);case 3:return Ib(function(){var e=u[h][0],f=u[h][1],d=NT(o,e,f-e);p.batch=h,p.size=f-e;for(var v=T_(r,d),g=n(v),y=0;y<a.length;++y){var b=g[y];p[a[y]]=b,Sb(b)}if(h===u.length-1&&m)for(var k=t.testLoop(c,l,i),x=0;x<a.length;++x){var w=a[x],I=k[x];Sb(I),s["val_"+w]=I}}),e.next=6,k.onBatchEnd(h,p);case 6:if(wE(p),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}},e)}),f=0;case 6:if(!(f<u.length)){e.next=14;break}return e.delegateYield(p(f),"t0",8);case 8:if("break"!==e.t0){e.next=11;break}return e.abrupt("break",14);case 11:++f,e.next=6;break;case 14:o.dispose();case 15:case"end":return e.stop()}},e)})(),"t0",6);case 6:return e.next=8,k.onEpochEnd(o,s);case 8:if(!t.stopTraining_){e.next=10;break}return e.abrupt("return","break");case 10:case"end":return e.stop()}},e)}),I=f;case 14:if(!(I<o)){e.next=22;break}return e.delegateYield(w(I),"t0",16);case 16:if("break"!==e.t0){e.next=19;break}return e.abrupt("break",22);case 19:++I,e.next=14;break;case 22:return e.next=24,k.onTrainEnd();case 24:return e.next=26,t.history.syncData();case 26:return e.abrupt("return",t.history);case 27:case"end":return e.stop()}},e)}))).apply(this,arguments)}function A_(){return(A_=Sf(regeneratorRuntime.mark(function e(t,n,r){var a,i,o,s,u,c,l,h,p,f,d,v,m,g,y,b,k,x,w,I,N,S,C,T=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=T.length>3&&void 0!==T[3]?T[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,S_(p=null==a.batchSize?32:a.batchSize),f=!1,e.next=10,t.standardizeUserData(n,r,a.sampleWeight,a.classWeight,f,p);case 10:if(d=e.sent,i=d[0],o=d[1],h=d[2],m=!1,!(null!=a.validationData&&a.validationData.length>0)){e.next=24;break}if(m=!0,2===a.validationData.length){e.next=16;break}throw 3===a.validationData.length?new EC("validationData including sample weights is not supported yet."):new TC("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(a.validationData," is invalid."));case 16:return s=a.validationData[0],u=a.validationData[1],g=!0,e.next=20,t.standardizeUserData(s,u,null,null,g,p);case 20:y=e.sent,c=y[0],l=y[1],v=c.concat(l),e.next=25;break;case 24:null!=a.validationSplit&&a.validationSplit>0&&a.validationSplit<1?(m=!0,b=Math.floor(i[0].shape[0]*(1-a.validationSplit)),k=i[0].shape[0],c=C_(i,b,k),i=C_(i,0,b),l=C_(o,b,k),o=C_(o,0,b),v=c.concat(l)):null!=a.validationSteps&&(m=!0);case 25:return x=i.concat(o).concat(h),t.checkTrainableWeightsConsistency(),w=t.makeTrainFunction(),I=t.getDedupedMetricsNames(),m?(t.makeTestFunction(),N=t.testFunction,S=I.slice().concat(I.map(function(e){return"val_"+e}))):(N=null,v=[],S=I.slice()),C=EE(a.callbacks,a.yieldEvery),e.next=32,__(t,w,x,I,p,a.epochs,a.verbose,C,N,v,a.shuffle,S,a.initialEpoch,null,null);case 32:return e.abrupt("return",e.sent);case 33:return e.prev=33,t.isTraining=!1,F_(i,n),F_(o,r),F_(c,s),F_(l,u),null!=h&&Nb(h),e.finish(33);case 36:case"end":return e.stop()}},e,null,[[4,,33,36]])}))).apply(this,arguments)}function D_(e){var t=[];e instanceof Rg&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(IT(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function F_(e,t){if(null!=e){var n=[];if(t instanceof Rg)n.push(t.id);else if(Array.isArray(t))t.forEach(function(e){return n.push(e.id)});else if(null!=t)for(var r in t)n.push(t[r].id);var a=[];if(e instanceof Rg)-1===n.indexOf(e.id)&&a.push(e);else if(Array.isArray(e))e.forEach(function(e){-1===n.indexOf(e.id)&&a.push(e)});else if(null!=e)for(var i in e){var o=e[i];-1===n.indexOf(o.id)&&a.push(o)}a.forEach(function(e){e.isDisposed||e.dispose()})}}function O_(e){return Array.isArray(e)}function M_(e){return!function(e){return e instanceof Rg}(e)&&!O_(e)}function L_(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(O_(e)&&e.length>0)o=!0;else if(M_(e)){for(var u in e)if(e.hasOwnProperty(u)){o=!0;break}}else o=!0;if(o)throw new TC("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map(function(e){return null});if(M_(e)){e=e,r=[];var c,l=s(t);try{for(l.s();!(c=l.n()).done;){var h=c.value;if(null==e[h])throw new TC('No data provided for "'.concat(h,'". Need data for each key in: ').concat(t));r.push(e[h])}}catch(g){l.e(g)}finally{l.f()}}else if(O_(e)){if((e=e).length!==t.length)throw new TC("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));r=e}else{if(e=e,t.length>1)throw new TC("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));r=[e]}if(r=D_(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var f=r[p];if(f.shape.length!==n[p].length)throw new TC("Error when checking ".concat(i,": expected ").concat(t[p]," to have ").concat(n[p].length," dimension(s). but got array with shape ").concat(f.shape));for(var d=0;d<n[p].length;++d)if(0!==d||a){var v=f.shape[d],m=n[p][d];if(null!=m&&m>=0&&v!==m)throw new TC("Error when checking ".concat(i,": expected ").concat(t[p]," to have shape [").concat(n[p],"], but got array with shape [").concat(f.shape,"]."))}}return r}function P_(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new TC("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new TC("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new TC("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ").concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new TC("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var z_=function(){var e=function(e){d(r,e);var t=m(r);function r(e){var n;return x(this,r),(n=t.call(this,e)).isTraining=!1,n}return I(r,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new TC("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,o=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var o=0,u=n;o<u.length;o++){var c=u[o];if(c.length>1||1===c.length&&c[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,i(c))}if(t){var l,h=s(e.layers);try{for(h.s();!(l=h.n()).done;){var p,f=l.value,d=!1,v=s(f.inboundNodes);try{for(v.s();!(p=v.n()).done;){var m=p.value;if(-1!==r.indexOf(m)){if(d){t=!1;break}d=!0}}}catch(g){v.e(g)}finally{v.f()}if(!t)break}}catch(g){h.e(g)}finally{h.f()}}return t}(e),u=["Layer (type)","Output shape","Param #"];if(o?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(function(e){return Math.floor(t*e)})),!o)for(var c in u.push("Receives inputs"),r=[],e.nodesByDepth){var l;(l=r).push.apply(l,i(e.nodesByDepth[c]))}a("_".repeat(t)),$E(u,n,a),a("=".repeat(t));for(var h=e.layers,p=0;p<h.length;++p)o?e_(h[p],n,a):t_(h[p],n,r,a),a((p===h.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var f=function(e){return sE(null!=e.collectedTrainableWeights?e.collectedTrainableWeights:e.trainableWeights)}(e),d=sE(e.nonTrainableWeights);a("Total params: ".concat(f+d)),a("Trainable params: ".concat(f)),a("Non-trainable params: ".concat(d)),a("_".repeat(t))}(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return eI.adagrad(.01)},Adadelta:function(){return eI.adadelta(1,.95,NC())},Adam:function(){return eI.adam(.001,.9,.999,NC())},Adamax:function(){return eI.adamax(.002,.9,.999,NC(),0)},RMSProp:function(){return eI.rmsprop(.001,.9,0,NC())},SGD:function(){return eI.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new TC("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Rb))throw new TC("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new TC("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map(function(e){return WE(e)})}else{var r=WE(e.loss);this.outputs.forEach(function(e){n.push(r)})}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new TC('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ').concat(this.outputNames));var i,o=s(this.outputNames);try{for(o.s();!(i=o.n()).done;){var u=i.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(u," during training")),n.push(WE(e.loss[u]))}}catch(d){o.e(d)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var c=0;c<this.outputs.length;++c){var l=this.internalOutputShapes[c];this.feedOutputNames.push(this.outputNames[c]),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[c])}var h=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],hT("loss",function(){for(var e=0;e<t.outputs.length;++e)if(-1===h.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}});var p=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(function(e){return[]});var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map(function(e){return n});var r,a=[],i=s(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,u=n.hasOwnProperty(o)?n[o]:[];Array.isArray(u)||(u=[u]),a.push(u)}}catch(d){i.e(d)}finally{i.f()}return a}(e.metrics,this.outputNames),f=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};hT("metric",function(){for(var e=function(e){-1===h.indexOf(e)&&function(n){var r,a,i,o,u=s(n);try{for(u.s();!(o=u.n()).done;){var c=o.value;if("string"==typeof c&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(c)){var l=t.internalOutputShapes[e],h=void 0;1===l[l.length-1]||t.lossFunctions[e]===zE?-1!==["accuracy","acc"].indexOf(c)?a=UE:-1!==["crossentropy","ce"].indexOf(c)&&(a=jE):t.lossFunctions[e]===PE?-1!==["accuracy","acc"].indexOf(c)?a=GE:-1!==["crossentropy","ce"].indexOf(c)&&(a=KE):-1!==["accuracy","acc"].indexOf(c)?a=HE:-1!==["crossentropy","ce"].indexOf(c)&&(a=qE),-1!==["accuracy","acc"].indexOf(c)?h="acc":-1!==["crossentropy","ce"].indexOf(c)&&(h="ce"),i=a,r=""+h}else i=YE(c),r=""+ZE(c);var p=void 0;hT(r,function(){p=i}),f(e,r,p)}}catch(d){u.e(d)}finally{u.f()}}(p[e])},n=0;n<t.outputs.length;++n)e(n)}),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;S_(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);return this.makeTestFunction(),FC(this.testLoop(this.testFunction,i,r,n.verbose,n.steps))}finally{F_(a[0],e),F_(a[1],t)}}},{key:"evaluateDataset",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(n.makeTestFunction(),function(e,t,n){return N_.apply(this,arguments)}(n,e,t)));case 1:case"end":return r.stop()}},r)}))()}},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new TC("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new TC("Either the input data should have a defined shape, or ".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new TC("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=this.retrieveSymbolicTensors(n?t:[t]),a=new i_;if(e instanceof Rg&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new TC("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var i=0;i<this.inputs.length;++i)a.add(this.inputs[i],e[i])}else{var o,u=s(this.inputs);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=e[c.name];if(null==l)throw new TC("No value is provided for the model's input ".concat(c.name));a.add(c,l)}}catch(p){u.e(p)}finally{u.f()}}var h=u_(r,a);return n?h:h[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=RC(null,e.length),r=e.length,a=s(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],u=o.map(function(e){return e.name}),c=0;c<e.length;++c){var l=u.indexOf(e[c]);if(-1!==l&&(n[c]=o[l],r--),0===r)break}if(0===r)break}}catch(p){a.e(p)}finally{a.f()}if(r>0){var h=[];throw n.forEach(function(t,n){null==t&&h.push(e[n])}),new TC("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(h)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ib(function(){var a=t.checkNumSamples(e);if(r)throw new EC("Verbose predictLoop() is not implemented yet.");for(var i=E_(a,n),o=t.outputs.map(function(e){return[]}),s=function(n){Ib(function(){var r=C_(e,i[n][0],i[n][1]),a=[];if(Array.isArray(r))for(var o=0;o<r.length;++o)a.push({key:t.inputs[o],value:r[o]});else a.push({key:t.inputs[0],value:r});var s=new i_(a);return u_(t.outputs,s)}).forEach(function(e,t){return o[t].push(e)})},u=0;u<i.length;++u)s(u);return FC(o.map(function(e){return ak(e,0)}))})}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=D_(e);P_(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return S_(r),this.predictLoop(n,r)}finally{F_(n,e)}}},{key:"predictOnBatch",value:function(e){P_(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new CC("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];r.push(this.feedLossFns[a]===PE?i.slice(0,i.length-1).concat([1]):i)}if(function(e,t,n){var r=UC(e.map(function(e){return e.shape[0]}));r.sort();var a=UC(t.map(function(e){return e.shape[0]}));if(a.sort(),r.length>1)throw new TC("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map(function(e){return e.shape}))));if(a.length>1)throw new TC("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map(function(e){return e.shape}))));if(r.length>0&&a.length>0&&!Pf(r,a))throw new TC("Input Tensors should have the same number of samples as target Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target sample(s)."))}(e=L_(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=L_(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[FE,zE,LE],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===LE&&1===i.shape[i.shape.length-1])throw new TC("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var h=u[l],p=c[l];if(null!=p&&h!==p)throw new TC("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!=0)throw new TC("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(e,t,r,a){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this;return Sf(regeneratorRuntime.mark(function u(){var c,l,h,p,f,d,v;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=s.standardizeUserDataXY(e,t,i,o),l=n(c,2),h=l[0],p=l[1],null==r){u.next=3;break}throw new Error("sample weight is not supported yet.");case 3:if(f=null,null==a){u.next=17;break}d=f_(a,s.outputNames),f=[],v=0;case 8:if(!(v<d.length)){u.next=17;break}return u.t0=f,u.next=12,d_(p[v],null,d[v]);case 12:u.t1=u.sent,u.t0.push.call(u.t0,u.t1);case 14:++v,u.next=8;break;case 17:return u.abrupt("return",[h,p,f]);case 18:case"end":return u.stop()}},u)}))()}},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return Ib(function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new EC("Verbose mode is not implemented yet.");if(null!=i)throw new EC("steps mode in testLoop() is not implemented yet");for(var u=E_(o,n),c=Ax(xT(0,o)),l=0;l<u.length;++l){var h=u[l][0],p=u[l][1],f=NT(c,h,p-h),d=T_(t,f),v=e(d);if(0===l)for(var m=0;m<v.length;++m)s.push(_b(0));for(var g=0;g<v.length;++g)s[g]=Db(s[g],Ok(p-h,v[g]))}for(var y=0;y<s.length;++y)s[y]=mk(s[y],o);return s})}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;DC(e,r)>1&&(a+="_".concat(DC(e.slice(0,n),r))),t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map(function(e){return e.read()});return[e.optimizer_.minimize(function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new i_(t),l=u_(e.outputs,c,{training:!0}),h=0;h<e.lossFunctions.length;++h){var p=e.lossFunctions[h](a[h],l[h]);null!=i[h]&&(p=m_(p,i[h]));var f=Uk(p);n.push(f),u=0===h?p:Db(u,p)}for(var d=0;d<e.metricsTensors.length;++d){var v=void 0;if(e.outputs.length>1&&d<e.outputs.length)v=n[d];else{var m=e.metricsTensors[d][1];v=Uk((0,e.metricsTensors[d][0])(a[m],l[m]))}Sb(v),o.push(v)}return u=Uk(u),e.calculateLosses().forEach(function(e){u=Db(u,e)}),u},!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return Ib(function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new i_(o),c=u_(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=Uk((0,e.lossFunctions[l])(i[l],c[l]));n=0===l?h:Db(n,h),r.push(n)}for(var p=0;p<e.metricsTensors.length;++p){var f=e.metricsTensors[p][1],d=Uk((0,e.metricsTensors[p][0])(i[f],c[f]));r.push(d)}return r})}}},{key:"fit",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this;return Sf(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",function(e,t,n){return A_.apply(this,arguments)}(r,e,t,n));case 1:case"end":return a.stop()}},a)}))()}},{key:"fitDataset",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",function(e,t,n){return k_.apply(this,arguments)}(n,e,t));case 1:case"end":return r.stop()}},r)}))()}},{key:"trainOnBatch",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a,i,o,u,c,l,h,p,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.standardizeUserData(e,t);case 2:a=r.sent,i=a[0],o=a[1],u=n.makeTrainFunction()(i.concat(o)),c=[],l=s(u),r.prev=8,l.s();case 10:if((h=l.n()).done){r.next=18;break}return p=h.value,r.next=14,p.data();case 14:f=r.sent,c.push(f[0]);case 16:r.next=10;break;case 18:r.next=23;break;case 20:r.prev=20,r.t0=r.catch(8),l.e(r.t0);case 23:return r.prev=23,l.f(),r.finish(23);case 26:return r.abrupt("return",(Nb(u),FC(c)));case 27:case"end":return r.stop()}},r,null,[[8,20,23,26]])}))()}},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=p(k(r.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=wb().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-wb().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=MC(this.loss);else if(Array.isArray(this.loss)){var t,n=s(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(c){n.e(c)}finally{n.f()}e=this.loss.map(function(e){return MC(e)})}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var u=o[i];if("string"!=typeof a[u])throw new Error("Serialization of non-string loss is not supported.");e[u]=MC(a[u])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[MC(ZE(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(e){return MC(ZE(e))});var e={};for(var t in this.metrics)e[t]=MC(ZE(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=AE(r_(e.optimizer_config));if("string"==typeof e.loss)t=LC(e.loss);else if(Array.isArray(e.loss))t=e.loss.map(function(e){return LC(e)});else if(null!=e.loss)for(var a in t={},e.loss)t[a]=LC(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map(function(e){return LC(e)});else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=LC(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a,o,s,u,c,l,h,p;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("string"!=typeof e){r.next=7;break}if(0!==(a=gy(e)).length){r.next=4;break}throw new TC("Cannot find any save handlers for URL '".concat(e,"'"));case 4:if(!(a.length>1)){r.next=6;break}throw new TC("Found more than one (".concat(a.length,") save handlers for URL '").concat(e,"'"));case 6:e=a[0];case 7:if(null!=e.save){r.next=9;break}throw new TC("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return r.next=11,uy(n.getNamedWeights(t));case 11:if(o=r.sent,s={modelTopology:n.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.3.0",convertedBy:null},null==t||!t.includeOptimizer||null==n.optimizer){r.next=27;break}return s.trainingConfig=n.getTrainingConfig(),c="optimizer",r.t0=uy,r.next=19,n.optimizer.getWeights();case 19:return r.t1=r.sent,r.t2=c,r.next=23,(0,r.t0)(r.t1,r.t2);case 23:l=r.sent,h=l.data,p=l.specs,(u=o.specs).push.apply(u,i(p)),o.data=fy([o.data,h]);case 27:return r.abrupt("return",(null!=n.userDefinedMetadata&&(JE(n.userDefinedMetadata,n.name,!0),s.userDefinedMetadata=n.userDefinedMetadata),s.weightData=o.data,s.weightSpecs=o.specs,e.save(s)));case 28:case"end":return r.stop()}},r)}))()}},{key:"setUserDefinedMetadata",value:function(e){JE(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),r}(p_);return e.className="Model",e}();kb(z_),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return n}(z_);return e.className="Functional",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:nE("sequential_"),null!=e.layers){var a,i=s(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(u){i.e(u)}finally{i.f()}}return g(r)}return I(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some(function(e){return e<0}))throw new TC("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof z_;if(r){if(1!==(t=e).outputs.length)throw new TC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new TC("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new TC("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new TC("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new bE({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new TC("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new TC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=yE(this.outputs[0])}this.inboundNodes=[],new vE({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:RC(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(e){return e.shape}),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(oE(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new z_({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),p(k(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),p(k(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new CC("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n.built){r.next=2;break}throw new CC("The model needs to be compiled before being used.");case 2:return r.abrupt("return",n.model.evaluateDataset(e,t));case 3:case"end":return r.stop()}},r)}))()}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this;return Sf(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r.built){a.next=2;break}throw new CC("The model needs to be compiled before being used.");case 2:return a.abrupt("return",r.model.fit(e,t,n));case 3:case"end":return a.stop()}},a)}))()}},{key:"fitDataset",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n.built){r.next=2;break}throw new CC("The model needs to be compiled before being used.");case 2:return r.abrupt("return",n.model.fitDataset(e,t));case 3:case"end":return r.stop()}},r)}))()}},{key:"trainOnBatch",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",n.model.trainOnBatch(e,t));case 1:case"end":return r.stop()}},r)}))()}},{key:"stopTraining",get:function(){if(null==this.model)throw new TC("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new TC("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=s(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new TC("Legacy serialization format not supported yet.");r=t}else Df(null!=t.layers,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new EC("Sequential.fromConfig called on non-Sequential input: ".concat(o));var u,c=s(r);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=AE(l,void 0,a);a&&h.setFastWeightInitDuringBuild(!0),o.add(h)}}catch(p){c.e(p)}finally{c.f()}return o}}]),n}(z_);return e.className="Sequential",e}());var B_=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"getConfig",value:function(){return{}}}]),n}(yb);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new EC("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return gk(e)}(e,t)}}]),n}(B_);return e.className="elu",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return mx(e)}}]),n}(B_);return e.className="selu",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return dx(e)}}]),n}(B_);return e.className="relu",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return Ib(function(){return jk(6,dx(e))})}}]),n}(B_);return e.className="relu6",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return e}}]),n}(B_);return e.className="linear",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return yx(e)}}]),n}(B_);return e.className="sigmoid",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return function(e){return Ib(function(){var t=Db(.5,Ok(.2,e));return rk(t,0,1)})}(e)}}]),n}(B_);return e.className="hardSigmoid",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return Sx(e)}}]),n}(B_);return e.className="softplus",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return function(e){return Ib(function(){return mk(e,Ab(e).add(1))})}(e)}}]),n}(B_);return e.className="softsign",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){return Rx(e)}}]),n}(B_);return e.className="tanh",e}());var V_=function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Nx(e,t)}}]),n}(B_);return e.className="softmax",e}();function W_(e){return e.getClassName()}function U_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return VC(e,bb.getMap().classNameMap,t,"activation")}function H_(e){if(null==e)return U_({className:"linear",config:{}});if("string"==typeof e){var t={};return t.className=e,t.config={},U_(t)}return e instanceof B_?e:U_(e)}kb(V_),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Pk(e,t)}}]),n}(B_);return e.className="logSoftmax",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Ib(function(){return yx(e.mul(t)).mul(e)})}}]),n}(B_);return e.className="swish",e}());var j_=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return n}(yb);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this),function(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return I(n,[{key:"apply",value:function(e){var t=this;return Ib(function(){var n=ax([1]);return t.hasL1&&(n=Db(n,Lk(Ok(t.l1,Ab(e))))),t.hasL2&&(n=Db(n,Lk(Ok(t.l2,FT(e))))),n.asScalar()})}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(j_);return e.className="L1L2",e}());var G_={l1l2:"L1L2"};function q_(e){return zC(e)}function K_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return VC(e,bb.getMap().classNameMap,t,"regularizer")}function X_(e){return null==e?null:"string"==typeof e?K_({className:e in G_?G_[e]:e,config:{}}):e instanceof j_?e:K_(e)}function Y_(e,t,n){if("number"==typeof e)return RC(e,t);if(e.length!==t)throw new TC("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!mT(a))throw new TC("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(a))}return e}function Z_(e,t,n,r){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return null==e?e:(a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r))}function J_(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+kT([n-t,0]);else{if("same"!==r)throw new TC("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function Q_(e,t){return Ib(function(){return sT(t),"channelsFirst"===t?zx(e,[0,2,3,1]):e})}function $_(e,t){return Ib(function(){return sT(t),"channelsFirst"===t?zx(e,[0,2,3,4,1]):e})}function eR(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Ib(function(){if(null==i&&(i="channelsLast"),sT(i),3!==e.rank&&4!==e.rank)throw new TC("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new TC("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=Q_(e,i);if("causal"===a)throw new EC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=$x({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=zx(u,[0,3,1,2])),u})}kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return I(n,[{key:"call",value:function(e,t){e=iE(e);var n=dx(e);return null!=this.maxValue&&(n=rk(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="ReLU",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return I(n,[{key:"call",value:function(e,t){var n=iE(e);return Rk(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="LeakyReLU",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=QT(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=X_(e.alphaRegularizer),r.alphaConstraint=eT(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new TC("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return g(r)}return I(n,[{key:"build",value:function(e){var t=(e=oE(e)).slice(1);if(null!=this.sharedAxes){var n,r=s(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new pE({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=iE(e),ux(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:JT(this.alphaInitializer),alphaRegularizer:q_(this.alphaRegularizer),alphaConstraint:QC(this.alphaConstraint),sharedAxes:this.sharedAxes},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="PReLU",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new EC("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,g(r)}return I(n,[{key:"call",value:function(e,t){var n=iE(e);return gk(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="ELU",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return I(n,[{key:"call",value:function(e,t){var n=iE(e);return n.mul(wT(n.greater(this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="ThresholdedReLU",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new V_).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return I(n,[{key:"call",value:function(e,t){var n=iE(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="Softmax",e}());var tR=function(e){d(n,e);var t=m(n);function n(e,r){var a;if(x(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,qC(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new EC("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=Y_(r.kernelSize,e,"kernelSize"),a.strides=Y_(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,uT(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,sT(a.dataFormat),a.activation=H_(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=QT(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=eT(r.biasConstraint),a.biasRegularizer=X_(r.biasRegularizer),a.activityRegularizer=X_(r.activityRegularizer),a.dilationRate=Y_(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new TC("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new TC("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new TC("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(a.dilationRate)));return g(a)}return I(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:W_(this.activation),useBias:this.useBias,biasInitializer:JT(this.biasInitializer),biasRegularizer:q_(this.biasRegularizer),activityRegularizer:q_(this.activityRegularizer),biasConstraint:QC(this.biasConstraint)},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(AC("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!GC(e.kernelSize,"number",1,3))throw new TC("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(gE),nR=function(e){d(r,e);var n=m(r);function r(e,t){var a;return x(this,r),(a=n.call(this,e,t)).kernel=null,r.verifyArgs(t),a.filters=t.filters,qC(a.filters,"filters"),a.kernelInitializer=QT(t.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=eT(t.kernelConstraint),a.kernelRegularizer=X_(t.kernelRegularizer),a}return I(r,[{key:"build",value:function(e){e=oE(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new TC("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:t({},n,r)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var t;e=iE(e);var r=null==n.bias?null:n.bias.read(),a=XC(n.activation.getClassName());if(null!=a&&2===n.rank)t=eR(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Ib(function(){if(null==i&&(i="channelsLast"),sT(i),3!==e.shape.length)throw new TC("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new TC("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new TC("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=zx(e,[0,2,1])),"causal"===a)throw new EC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=lk(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=MT(s,n)),s})}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=eR(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new EC("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return Ib(function(){if(null==i&&(i="channelsLast"),sT(i),4!==e.rank&&5!==e.rank)throw new TC("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new TC("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));var s=$_(e,i);if("causal"===a)throw new EC("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=fk(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=MT(s,n)),"channelsFirst"===i&&(s=zx(s,[0,4,1,2,3])),s})}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t})}},{key:"computeOutputShape",value:function(e){e=oE(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=Z_(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:JT(this.kernelInitializer),kernelRegularizer:q_(this.kernelRegularizer),kernelConstraint:QC(this.kernelConstraint)},t=p(k(r.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new TC("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}]),r}(tR),rR=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return I(n,[{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!GC(e.kernelSize,"number",1,2))throw new TC("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(nR);return e.className="Conv2D",e}();kb(rR),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return I(n,[{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new TC("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(nR);return e.className="Conv3D",e}()),kb(function(){var e=function(e){d(r,e);var n=m(r);function r(e){var t;if(x(this,r),(t=n.call(this,e)).inputSpec=[new pE({ndim:4})],"same"!==t.padding&&"valid"!==t.padding)throw new TC("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(t.padding));return g(t)}return I(r,[{key:"build",value:function(e){if(4!==(e=oE(e)).length)throw new TC("Input should have rank 4; Received input shape: "+JSON.stringify(e));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new TC("The channel dimension of the inputs should be defined. Found `None`.");var r=e[n],a=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new pE({ndim:4,axes:t({},n,r)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var t=iE(e);if(4!==t.shape.length)throw new TC("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape;"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var o=i[a],s=n.kernelSize[1],u=n.strides[1],c=[i[0],J_(i[r],n.strides[0],n.kernelSize[0],n.padding),J_(o,u,s,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=zx(t,[0,2,3,1]));var l=pk(t,n.kernel.read(),c,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(l=zx(l,[0,3,1,2])),null!=n.bias&&(l=MT(l,n.bias.read(),n.dataFormat)),null!=n.activation&&(l=n.activation.apply(l)),l})}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=oE(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=J_(a[n],s,i,this.padding),a[r]=J_(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=p(k(r.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),r}(rR);return e.className="Conv2DTranspose",e}());var aR=function(){var e=function(e){d(r,e);var n=m(r);function r(e,t){var a;if(x(this,r),(a=n.call(this,e,t)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==t.filters)throw new TC("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new TC("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new TC("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(t.padding)));return a.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,a.depthwiseInitializer=QT(t.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=X_(t.depthwiseRegularizer),a.depthwiseConstraint=eT(t.depthwiseConstraint),a.pointwiseInitializer=QT(t.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=X_(t.pointwiseRegularizer),a.pointwiseConstraint=eT(t.pointwiseConstraint),g(a)}return I(r,[{key:"build",value:function(e){if((e=oE(e)).length<this.rank+2)throw new TC("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n]||e[n]<0)throw new TC("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[n])));for(var r=e[n],a=this.kernelSize.concat([r,this.depthMultiplier]),i=[],o=0;o<this.rank;++o)i.push(1);i.push(r*this.depthMultiplier,this.filters);var s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",a,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):null,this.inputSpec=[new pE({ndim:this.rank+2,axes:t({},n,r)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var t;if(e=iE(e),1===n.rank)throw new EC("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=zx(e,[0,2,3,1])),t=gx(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=MT(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=zx(t,[0,3,1,2])),t})}},{key:"getConfig",value:function(){var e=p(k(r.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=JT(this.depthwiseInitializer),e.pointwiseInitializer=JT(this.pointwiseInitializer),e.depthwiseRegularizer=q_(this.depthwiseRegularizer),e.pointwiseRegularizer=q_(this.pointwiseRegularizer),e.depthwiseConstraint=QC(this.depthwiseConstraint),e.pointwiseConstraint=QC(this.pointwiseConstraint),e}}]),r}(nR);return e.className="SeparableConv",e}();function iR(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new TC("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function oR(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Ib(function(){var u=t.shape.length;if(u<3)throw new TC("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(xT(2,u));if(t=zx(t,c),null!=i)throw new EC("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=a.asType("bool").asType("float32")).rank===u-1&&(a=wk(a,-1)),a=zx(a,c)),r&&(t=vx(t,0),null!=a&&(a=vx(a,0)));var l,h,p,f=[],d=n,v=t.shape[0],m=Ox(t);null!=a&&(h=Ox(a));for(var g=function(t){var n=m[t],r=Ib(function(){return e(n,d)});if(null==a)l=r[0],d=r[1];else{var i=Ib(function(){var e=h[t],n=ox(e).sub(e);return{output:r[0].mul(e).add(d[0].mul(n)),newStates:d.map(function(t,a){return r[1][a].mul(e).add(t.mul(n))})}});l=i.output,d=i.newStates}s&&f.push(l)},y=0;y<v;++y)g(y);return s&&(p=_x(f,1)),[l,p,d]})}kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,2,e)}return n}(aR);return e.className="SeparableConv2D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return I(n,[{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!GC(e.kernelSize,"number",1,1))throw new TC("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(nR);return e.className="Conv1D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return I(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return Ib(function(){if(e=iE(e),"channelsLast"===n.dataFormat){var t=CT(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return CT(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=CT(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return CT(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)})}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="Cropping2D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,sT(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){jC(nT,"InterpolationFormat",e)}(r.interpolation),r}return I(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],null==e[2]?null:this.size[0]*e[2],null==e[3]?null:this.size[1]*e[3]]:[e[0],null==e[1]?null:this.size[0]*e[1],null==e[2]?null:this.size[1]*e[2],e[3]]}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var t=iE(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=zx(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?t.resizeNearestNeighbor([a,i]):t.resizeBilinear([a,i]);return zx(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?t.resizeNearestNeighbor([s,u]):t.resizeBilinear([s,u])})}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="UpSampling2D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=QT(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=eT(e.depthwiseConstraint),r.depthwiseRegularizer=X_(e.depthwiseRegularizer),r}return I(n,[{key:"build",value:function(e){if((e=oE(e)).length<4)throw new TC("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new TC("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return Ib(function(){null==a&&(a="channelsLast"),sT(a);var o=Q_(e,a);if(4!==e.rank)throw new TC("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new TC("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return o=dk(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=zx(o,[0,3,1,2])),o})}(e=iE(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=MT(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t})}},{key:"computeOutputShape",value:function(e){e=oE(e);var t="channelsFirst"===this.dataFormat?e[3]:e[2],n="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=Z_("channelsFirst"===this.dataFormat?e[2]:e[1],this.kernelSize[0],this.padding,this.strides[0]),a=Z_(t,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],n,r,a]:[e[0],r,a,n]}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=JT(this.depthwiseInitializer),e.depthwiseRegularizer=q_(this.depthwiseRegularizer),e.depthwiseConstraint=QC(this.depthwiseRegularizer),e}}]),n}(tR);return e.className="DepthwiseConv2D",e}());var sR=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r,a;if(x(this,n),r=t.call(this,e),null==e.cell)throw new TC("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new pR({cells:e.cell}):e.cell).stateSize)throw new TC("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new pE({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],g(r)}return I(n,[{key:"getStates",value:function(){return null==this.states_?xT(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(e){return null}):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){rE(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=s(t);try{for(o.s();!(a=o.n()).done;){var u=a.value;i.push([e[0],u])}}catch(c){o.e(c)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return Ib(function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map(function(e){return null});return[e].concat(r)}return e})}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new EC("Constants support is not implemented in RNN yet.");rE(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new pE({shape:[t,null].concat(i(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Pf(this.stateSpec.map(function(e){return e.shape[e.shape.length-1]}),r))throw new TC("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=r.map(function(e){return new pE({shape:[null,e]})});this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Ib(function(){if(!t.stateful)throw new SC("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new TC("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)t.states_=Array.isArray(t.cell.stateSize)?t.cell.stateSize.map(function(e){return ax([r,e])}):[ax([r,t.cell.stateSize])];else if(null==e)Nb(t.states_),null!=t.keptStates&&(Nb(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map(function(e){return ax([r,e])}):t.states_[0]=ax([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new TC("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===n?t.keptStates.push(t.states_.slice()):Nb(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!Pf(i.shape,s))throw new TC("State ".concat(a," is incompatible with layer ").concat(t.name,": expected shape=").concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map(function(e){return Sb(e.clone())})})}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=iR(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],u=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var c,l=s(r);try{for(l.s();!(c=l.n()).done;){var h=c.value;this.stateSpec.push(new pE({shape:h.shape}))}}catch(g){l.e(g)}finally{l.f()}u=u.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof fE){var f=[e].concat(o),d=this.inputSpec.concat(u),v=this.inputSpec;this.inputSpec=d;var m=p(k(n.prototype),"apply",this).call(this,f,t);return this.inputSpec=v,m}return p(k(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=iE(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new TC("RNN Layer has ".concat(o," state(s) but was passed ").concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=oR(function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]},e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var p=n.returnSequences?l:c;return n.returnState?[p].concat(h):p})}},{key:"getInitialState",value:function(e){var t=this;return Ib(function(){var n=ax(e.shape);return n=IT(n=Lk(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map(function(e){return e>1?_T(n,[1,e]):n}):t.cell.stateSize>1?[_T(n,[1,t.cell.stateSize])]:[n]})}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){p(k(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=AE(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(gE);return e.className="RNN",e}();kb(sR);var uR=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return n}(gE),cR=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,qC(r.units,"units"),r.activation=H_(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=QT(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=QT(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=QT(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=X_(e.kernelRegularizer),r.recurrentRegularizer=X_(e.recurrentRegularizer),r.biasRegularizer=X_(e.biasRegularizer),r.kernelConstraint=eT(e.kernelConstraint),r.recurrentConstraint=eT(e.recurrentConstraint),r.biasConstraint=eT(e.biasConstraint),r.dropout=bT([1,kT([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=bT([1,kT([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return I(n,[{key:"build",value:function(e){e=oE(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ib(function(){if(2!==(e=e).length)throw new TC("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=fR({ones:function(){return ox(e)},rate:n.dropout,training:i})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=fR({ones:function(){return ox(r)},rate:n.recurrentDropout,training:i}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=AT(null!=o?Ok(e,o):e,n.kernel.read()),null!=n.bias&&(a=MT(a,n.bias.read())),null!=s&&(r=Ok(r,s));var u=Db(a,AT(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]})}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:W_(this.activation),useBias:this.useBias,kernelInitializer:JT(this.kernelInitializer),recurrentInitializer:JT(this.recurrentInitializer),biasInitializer:JT(this.biasInitializer),kernelRegularizer:q_(this.kernelRegularizer),recurrentRegularizer:q_(this.recurrentRegularizer),biasRegularizer:q_(this.biasRegularizer),activityRegularizer:q_(this.activityRegularizer),kernelConstraint:QC(this.kernelConstraint),recurrentConstraint:QC(this.recurrentConstraint),biasConstraint:QC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(uR);return e.className="SimpleRNNCell",e}();kb(cR),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),e.cell=new cR(e),t.call(this,e)}return I(n,[{key:"call",value:function(e,t){var r=this;return Ib(function(){return null!=r.cell.dropoutMask&&(Nb(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Nb(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),p(k(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})})}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(sR);return e.className="SimpleRNN",e}());var lR=function(){var e=function(e){d(r,e);var t=m(r);function r(e){var n;if(x(this,r),(n=t.call(this,e)).DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new TC("GRUCell does not support reset_after parameter set to true.");return n.units=e.units,qC(n.units,"units"),n.activation=H_(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=H_(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=QT(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=QT(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=QT(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=X_(e.kernelRegularizer),n.recurrentRegularizer=X_(e.recurrentRegularizer),n.biasRegularizer=X_(e.biasRegularizer),n.kernelConstraint=eT(e.kernelConstraint),n.recurrentConstraint=eT(e.recurrentConstraint),n.biasConstraint=eT(e.biasConstraint),n.dropout=bT([1,kT([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=bT([1,kT([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,g(n)}return I(r,[{key:"build",value:function(e){e=oE(e),this.kernel=this.addWeight("kernel",[e[e.length-1],3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var r=this;return Ib(function(){if(2!==(e=e).length)throw new TC("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=null!=t.training&&t.training,i=e[1];e=e[0],0<r.dropout&&r.dropout<1&&null==r.dropoutMask&&(r.dropoutMask=fR({ones:function(){return ox(e)},rate:r.dropout,training:a,count:3})),0<r.recurrentDropout&&r.recurrentDropout<1&&null==r.recurrentDropoutMask&&(r.recurrentDropoutMask=fR({ones:function(){return ox(i)},rate:r.recurrentDropout,training:a,count:3}));var o,s,u,c=r.recurrentDropoutMask;0<r.dropout&&r.dropout<1&&(e=Ok(e,r.dropoutMask[0]));var l=AT(e,r.kernel.read());r.useBias&&(l=MT(l,r.bias.read())),0<r.recurrentDropout&&r.recurrentDropout<1&&(i=Ok(i,c[0]));var h=r.recurrentKernel.read(),p=n(Cx(h,[2*r.units,r.units],h.rank-1),2),f=p[0],d=p[1],v=AT(i,f),m=n(Cx(l,3,l.rank-1),3),g=m[0],y=m[1],b=m[2],k=n(Cx(v,2,v.rank-1),2),x=k[0],w=k[1];o=r.recurrentActivation.apply(Db(g,x)),s=r.recurrentActivation.apply(Db(y,w));var I=AT(Ok(s,i),d);u=r.activation.apply(Db(b,I));var N=Db(Ok(o,i),Ok(Db(1,tx(o)),u));return[N,N]})}},{key:"getConfig",value:function(){var e=p(k(r.prototype),"getConfig",this).call(this),t={units:this.units,activation:W_(this.activation),recurrentActivation:W_(this.recurrentActivation),useBias:this.useBias,kernelInitializer:JT(this.kernelInitializer),recurrentInitializer:JT(this.recurrentInitializer),biasInitializer:JT(this.biasInitializer),kernelRegularizer:q_(this.kernelRegularizer),recurrentRegularizer:q_(this.recurrentRegularizer),biasRegularizer:q_(this.biasRegularizer),activityRegularizer:q_(this.activityRegularizer),kernelConstraint:QC(this.kernelConstraint),recurrentConstraint:QC(this.recurrentConstraint),biasConstraint:QC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),r}(uR);return e.className="GRUCell",e}();kb(lR),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new lR(e),t.call(this,e)}return I(n,[{key:"call",value:function(e,t){var r=this;return Ib(function(){return null!=r.cell.dropoutMask&&(Nb(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Nb(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),p(k(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})})}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(sR);return e.className="GRU",e}());var hR=function(){var e=function(e){d(r,e);var t=m(r);function r(e){var n;return x(this,r),(n=t.call(this,e)).DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,qC(n.units,"units"),n.activation=H_(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=H_(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=QT(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=QT(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=QT(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=e.unitForgetBias,n.kernelRegularizer=X_(e.kernelRegularizer),n.recurrentRegularizer=X_(e.recurrentRegularizer),n.biasRegularizer=X_(e.biasRegularizer),n.kernelConstraint=eT(e.kernelConstraint),n.recurrentConstraint=eT(e.recurrentConstraint),n.biasConstraint=eT(e.biasConstraint),n.dropout=bT([1,kT([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=bT([1,kT([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return I(r,[{key:"build",value:function(e){var t,n;if(e=oE(e),this.kernel=this.addWeight("kernel",[e[e.length-1],4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var r=this.biasInitializer,a=this.units;n=new((t=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e,t){var n=r.apply([a]),i=(new WT).apply([a]),o=r.apply([2*a]);return ET(ET(n,i),o)}}]),n}(VT)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var r=this;return Ib(function(){var a=null!=t.training&&t.training;if(3!==(e=e).length)throw new TC("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var i=e[1],o=e[2];e=e[0],0<r.dropout&&r.dropout<1&&null==r.dropoutMask&&(r.dropoutMask=fR({ones:function(){return ox(e)},rate:r.dropout,training:a,count:4})),0<r.recurrentDropout&&r.recurrentDropout<1&&null==r.recurrentDropoutMask&&(r.recurrentDropoutMask=fR({ones:function(){return ox(i)},rate:r.recurrentDropout,training:a,count:4}));var s,u,c,l,h=r.recurrentDropoutMask;0<r.dropout&&r.dropout<1&&(e=Ok(e,r.dropoutMask[0]));var p=AT(e,r.kernel.read());0<r.recurrentDropout&&r.recurrentDropout<1&&(i=Ok(i,h[0])),p=Db(p,AT(i,r.recurrentKernel.read())),r.useBias&&(p=MT(p,r.bias.read()));var f=n(Cx(p,4,p.rank-1),4),d=f[0],v=f[1],m=f[2],g=f[3];s=r.recurrentActivation.apply(d),u=r.recurrentActivation.apply(v),c=Db(Ok(u,o),Ok(s,r.activation.apply(m))),l=r.recurrentActivation.apply(g);var y=Ok(l,r.activation.apply(c));return[y,y,c]})}},{key:"getConfig",value:function(){var e=p(k(r.prototype),"getConfig",this).call(this),t={units:this.units,activation:W_(this.activation),recurrentActivation:W_(this.recurrentActivation),useBias:this.useBias,kernelInitializer:JT(this.kernelInitializer),recurrentInitializer:JT(this.recurrentInitializer),biasInitializer:JT(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:q_(this.kernelRegularizer),recurrentRegularizer:q_(this.recurrentRegularizer),biasRegularizer:q_(this.biasRegularizer),activityRegularizer:q_(this.activityRegularizer),kernelConstraint:QC(this.kernelConstraint),recurrentConstraint:QC(this.recurrentConstraint),biasConstraint:QC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),r}(uR);return e.className="LSTMCell",e}();kb(hR),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new hR(e),t.call(this,e)}return I(n,[{key:"call",value:function(e,t){var r=this;return Ib(function(){return null!=r.cell.dropoutMask&&(Nb(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Nb(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),p(k(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})})}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(sR);return e.className="LSTM",e}());var pR=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).cells=e.cells,r}return I(n,[{key:"stateSize",get:function(){var e,t=[],n=s(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,i(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var r,a=(e=e).slice(1),o=[],u=s(n.cells.slice().reverse());try{for(u.s();!(r=u.n()).done;){var c=r.value;Array.isArray(c.stateSize)?o.push(a.splice(0,c.stateSize.length)):o.push(a.splice(0,1))}}catch(y){u.e(y)}finally{u.f()}o.reverse();for(var l,h=[],p=0;p<n.cells.length;++p){var f=n.cells[p];a=o[p],l=0===p?[e[0]].concat(a):[l[0]].concat(a),l=f.call(l,t),h.push(l.slice(1))}a=[];var d,v=s(h.slice().reverse());try{for(v.s();!(d=v.n()).done;){var m,g=d.value;(m=a).push.apply(m,i(g))}}catch(y){v.e(y)}finally{v.f()}return[l[0]].concat(a)})}},{key:"build",value:function(e){var t;rE(e)&&(e=e[0]),e=e,this.cells.forEach(function(n,r){hT("RNNCell_".concat(r),function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map(function(e){return{className:e.getClassName(),config:e.getConfig()}})};return Object.assign({},e,t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=s(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,i(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=s(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,i(r.nonTrainableWeights))}}catch(l){n.e(l)}finally{n.f()}if(!this.trainable){var a,o=[],u=s(this.cells);try{for(u.s();!(a=u.n()).done;){var c=a.value;o.push.apply(o,i(c.trainableWeights))}}catch(l){u.e(l)}finally{u.f()}return o.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=s(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,i(r.weights))}}catch(a){n.e(a)}finally{n.f()}return lE(t)}},{key:"setWeights",value:function(e){var t,n=[],r=s(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=e.splice(a.weights.length),o=0;o<a.weights.length;++o)n.push([a.weights[o],i[o]])}catch(u){r.e(u)}finally{r.f()}hE(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=s(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(AE(o,r))}}catch(u){i.e(u)}finally{i.f()}return new e({cells:a})}}]),n}(uR);return e.className="StackedRNNCells",e}();function fR(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=function(){return LT(t(),n)},u=function(){return PT(s,t,a)};return!o||o<=1?Sb(u().clone()):Array(o).fill(void 0).map(u).map(function(e){return Sb(e.clone())})}kb(pR);var dR=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),e.unroll)throw new EC("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new EC("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new pE({ndim:5})],r}return I(n,[{key:"call",value:function(e,t){var r=this;return Ib(function(){if(null!=r.cell.dropoutMask&&(Nb(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Nb(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new TC("ConvRNN2D cell does not support constants");return p(k(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})})}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(i(t.slice(2)))),this.returnState&&(t=[t].concat(i(Array(2).fill([e[0]].concat(i(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return Ib(function(){var n=t.cell.stateSize,r=t.computeSingleOutputShape(e.shape),a=ax([r[0]].concat(i(r.slice(2))));return Array.isArray(n)?Array(n.length).fill(a):[a]})}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Ib(function(){if(!t.stateful)throw new SC("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),o=[a[0]].concat(i(a.slice(2)));if(null==r[0])throw new TC("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())t.states_=Array.isArray(t.cell.stateSize)?t.cell.stateSize.map(function(){return ax(o)}):[ax(o)];else if(null==e)Nb(t.states_),null!=t.keptStates&&(Nb(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map(function(){return ax(o)}):t.states_[0]=ax(o);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new TC("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));n?t.keptStates.push(t.states_.slice()):Nb(t.states_);for(var s=0;s<t.states_.length;++s){var u=e[s],c=o;if(!Pf(u.shape,c))throw new TC("State ".concat(s," is incompatible with layer ").concat(t.name,": expected shape=").concat(c,", received shape=").concat(u.shape));t.states_[s]=u}}t.states_=t.states_.map(function(e){return Sb(e.clone())})})}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,o=t.padding,s=t.strides,u=t.dilationRate,c="channelsFirst"===n,l=e[c?4:3],h=Z_(e[c?3:2],a[0],o,s[0],u[0]),p=Z_(l,a[1],o,s[1],u[1]);return[].concat(i(e.slice(0,2)),i(c?[r,h,p]:[h,p,r]))}}]),n}(sR);return e.className="ConvRNN2D",e}(),vR=function(){var e=function(e){d(r,e);var t=m(r);function r(e){var n;x(this,r);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(n=t.call(this,Object.assign({},e,{units:a}))).filters=a,qC(n.filters,"filters"),n.kernelSize=Y_(i,2,"kernelSize"),n.kernelSize.forEach(function(e){return qC(e,"kernelSize")}),n.strides=Y_(o||1,2,"strides"),n.strides.forEach(function(e){return qC(e,"strides")}),n.padding=s||"valid",uT(n.padding),n.dataFormat=u||"channelsLast",sT(n.dataFormat),n.dilationRate=Y_(c||1,2,"dilationRate"),n.dilationRate.forEach(function(e){return qC(e,"dilationRate")}),n}return I(r,[{key:"build",value:function(e){var t;e=oE(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new TC("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=this.kernelSize.concat([e[n],4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var a=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var i;if(this.unitForgetBias){var o=this.biasInitializer,s=this.filters;i=new((t=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"apply",value:function(e,t){return TT([o.apply([s]),ix([s]),o.apply([2*s])])}}]),n}(VT)).className="CustomInit",t)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,i,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var r=this;return Ib(function(){if(3!==e.length)throw new TC("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=t.training||!1,i=e[0],o=e[1],s=e[2];0<r.dropout&&r.dropout<1&&null==r.dropoutMask&&(r.dropoutMask=fR({ones:function(){return ox(i)},rate:r.dropout,training:a,count:4}));var u=r.dropoutMask,c=function(e,t,n){return t&&t[n]?Ok(t[n],e):e},l=c(i,u,0),h=c(i,u,1),p=c(i,u,2),f=c(i,u,3);0<r.recurrentDropout&&r.recurrentDropout<1&&null==r.recurrentDropoutMask&&(r.recurrentDropoutMask=fR({ones:function(){return ox(o)},rate:r.recurrentDropout,training:a,count:4}));var d=r.recurrentDropoutMask,v=c(o,d,0),m=c(o,d,1),g=c(o,d,2),y=c(o,d,3),b=n(Cx(r.kernel.read(),4,3),4),k=b[0],x=b[1],w=b[2],I=b[3],N=n(r.useBias?Cx(r.bias.read(),4):[null,null,null,null],4),S=N[0],C=N[1],T=N[2],E=N[3];l=r.inputConv(l,k,S,r.padding),h=r.inputConv(h,x,C,r.padding),p=r.inputConv(p,w,T,r.padding),f=r.inputConv(f,I,E,r.padding);var _=n(Cx(r.recurrentKernel.read(),4,3),4),R=_[0],A=_[1],D=_[2],F=_[3];v=r.recurrentConv(v,R),m=r.recurrentConv(m,A),g=r.recurrentConv(g,D),y=r.recurrentConv(y,F);var O=r.recurrentActivation.apply(Db(l,v)),M=r.recurrentActivation.apply(Db(h,m)),L=Db(Ok(M,s),Ok(O,r.activation.apply(Db(p,g)))),P=Ok(r.recurrentActivation.apply(Db(f,y)),r.activation.apply(L));return[P,P,L]})}},{key:"getConfig",value:function(){var e=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(p(k(r.prototype),"getConfig",this).call(this),["units"]);return Object.assign({},e,{filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides})}},{key:"inputConv",value:function(e,t,n,r){var a=ck(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?MT(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return ck(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),r}(hR);return e.className="ConvLSTM2DCell",e}();kb(vR),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){x(this,n);var r=new vR(e);return t.call(this,Object.assign({},e,{cell:r}))}return I(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(dR);return e.className="ConvLSTM2D",e}());var mR=function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return I(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return PT(function(){return LT(r,n.rate,i,n.seed)},function(){return r},a)}return e})}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return p(k(n.prototype),"dispose",this).call(this)}}]),n}(gE);return e.className="Dropout",e}();kb(mR),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return I(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(mR);return e.className="SpatialDropout1D",e}()),kb(function(){var e=function(e){d(r,e);var n=m(r);function r(e){var t;if(x(this,r),(t=n.call(this,e)).activation=null,t.useBias=!0,t.kernel=null,t.bias=null,t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),t.batchInputShape=[a,e.inputDim]}return t.units=e.units,qC(t.units,"units"),t.activation=H_(e.activation),null!=e.useBias&&(t.useBias=e.useBias),t.kernelInitializer=QT(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.biasInitializer=QT(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.kernelConstraint=eT(e.kernelConstraint),t.biasConstraint=eT(e.biasConstraint),t.kernelRegularizer=X_(e.kernelRegularizer),t.biasRegularizer=X_(e.biasRegularizer),t.activityRegularizer=X_(e.activityRegularizer),t.supportsMasking=!0,t.inputSpec=[{minNDim:2}],g(t)}return I(r,[{key:"build",value:function(e){var n=(e=oE(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:t({},-1,n)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=oE(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r,a=iE(e),i=XC(n.activation.getClassName());return null!=i?r=AT(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=AT(a,n.kernel.read()),null!=n.bias&&(r=MT(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r})}},{key:"getConfig",value:function(){var e={units:this.units,activation:W_(this.activation),useBias:this.useBias,kernelInitializer:JT(this.kernelInitializer),biasInitializer:JT(this.biasInitializer),kernelRegularizer:q_(this.kernelRegularizer),biasRegularizer:q_(this.biasRegularizer),activityRegularizer:q_(this.activityRegularizer),kernelConstraint:QC(this.kernelConstraint),biasConstraint:QC(this.biasConstraint)},t=p(k(r.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),r}(gE);return e.className="Dense",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e=e||{})).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return I(n,[{key:"computeOutputShape",value:function(e){var t,n=s((e=oE(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new TC('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(r){n.e(r)}finally{n.f()}return[e[0],gT(e,1)]}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=r.transpose(a)}return function(e){if(e.rank<=1)throw new TC("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],gT(e.shape,1)];return e.reshape(t)}(r)})}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="Flatten",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=H_(e.activation),r}return I(n,[{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e);return n.activation.apply(r)})}},{key:"getConfig",value:function(){var e={activation:W_(this.activation)},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="Activation",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return I(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return Ib(function(){return function(e,t){return Ib(function(){if(2!==e.shape.length)throw new TC("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return _T(IT(e,1),[1,t,1])})}(e=iE(e),n.n)})}},{key:"getConfig",value:function(){var e={n:this.n},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="RepeatVector",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;x(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return I(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new TC("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=gT(e);if(null!==i){if(0===a||u%a!=0)throw new TC(n);r[i]=u/a}else if(u!==a)throw new TC(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return r.reshape(i)})}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="Reshape",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));var a=xT(1,e.dims.length+1);if(!Pf(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new pE({ndim:r.dims.length+1})],g(r)}return I(n,[{key:"computeOutputShape",value:function(e){var t=(e=oE(e)).slice();return this.dims.forEach(function(n,r){t[r+1]=e[n]}),t}},{key:"call",value:function(e,t){return zx(iE(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="Permute",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return I(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=iE(e);return Ob(nx(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e),a=Ob(nx(r,n.maskValue),-1,!0);return r.mul(a.asType(r.dtype))})}}]),n}(gE);return e.className="Masking",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=null==e.inputLength?[a,null]:[a].concat(OC(e.inputLength))}return r.inputDim=e.inputDim,qC(r.inputDim,"inputDim"),r.outputDim=e.outputDim,qC(r.outputDim,"outputDim"),r.embeddingsInitializer=QT(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=X_(e.embeddingsRegularizer),r.activityRegularizer=X_(e.activityRegularizer),r.embeddingsConstraint=eT(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,g(r)}return I(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return Ib(function(){return n.maskZero?(e=iE(e),nx(e,Px(e))):null})}},{key:"computeOutputShape",value:function(e){if(e=oE(e),null==this.inputLength)return[].concat(i(e),[this.outputDim]);var t=OC(this.inputLength);if(t.length!==e.length-1)throw new TC('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],o=e[r+1];if(null!=a&&null!=o&&a!==o)throw new TC('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==a&&(t[n]=o),n++}return[e[0]].concat(i(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e);return"int32"!==r.dtype&&(r=wT(r,"int32")),DT(n.embeddings.read(),r.as1D()).reshape(oE(n.computeOutputShape(r.shape)))})}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:JT(this.embeddingsInitializer),embeddingsRegularizer:q_(this.embeddingsRegularizer),activityRegularizer:q_(this.activityRegularizer),embeddingsConstraint:QC(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="Embedding",e}());var gR=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return I(n,[{key:"mergeFunction",value:function(e){throw new EC}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new TC("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[oE(e)]),(e=e).length<2)throw new TC("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=s(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(l){r.e(l)}finally{r.f()}if((n=UC(n)).length>1)throw new TC("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var u=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,u)}var c=e.map(function(e){return e.length});this.reshapeRequired=-1!==e.indexOf(null)||1!==UC(c).length}},{key:"call",value:function(e,t){var n=this;return Ib(function(){if(e=e,n.reshapeRequired){var t=[],r=e.map(function(e){return e.rank});if(-1===r.indexOf(null)){var a,i=kT(r),o=s(e);try{for(o.s();!(a=o.n()).done;){for(var u=a.value,c=u.rank,l=0;l<i-c;++l)u=IT(u,1);t.push(u)}}catch(T){o.e(T)}finally{o.f()}return n.mergeFunction(t)}var h,p=!1,f=s(e);try{for(f.s();!(h=f.n()).done;){var d=h.value,v=d.rank;if(null==v){var m=d.shape,g=m[0],y=m.slice(1).concat([g]),b=d.reshape([g].concat(gT(m.slice(1))));b=(b=zx(b,[1,0])).reshape(y),t.push(b),p=!0}else if(v>1){var k=xT(1,v).concat([0]);t.push(zx(d,k)),p=!0}else t.push(d)}}catch(T){f.e(T)}finally{f.f()}var x=n.mergeFunction(t),w=x.rank;if(p)if(null==w){var I=x.shape,N=I[I.length-1],S=[N].concat(I.slice(0,I.length-1));x=zx(x.reshape([-1,N]),[1,0]).reshape(S)}else if(w>1){var C=[w-1].concat(xT(0,w-1));x=zx(x,C)}return x}return n.mergeFunction(e)})}},{key:"computeOutputShape",value:function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=s(e);try{for(o.s();!(a=o.n()).done;){var u=a.value;null!=u&&null!==u[0]&&i.push(u[0])}}catch(c){o.e(c)}finally{o.f()}return t=1===(i=UC(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return Ib(function(){if(null==t)return null;if(!Array.isArray(t))throw new TC("`mask` should be an Array");if(!Array.isArray(e))throw new TC("`inputs` should be an Array");if(t.length!==e.length)throw new TC("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every(function(e){return null==e}))return null;for(var n=(t=t.map(function(e){return null==e?e:wk(e,0)}))[0],r=1;r<t.length-1;++r)n=zk(n,t[r]);return n})}}]),n}(gE);function yR(e,t){for(;e<0;)e+=t;return e}function bR(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=ek(e,t,n,r,a,o);else if(3===e.rank)i=tk(e,t,n,r,a,o);else{if(4!==e.rank)throw new EC("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=nk(e,t,n,r,a,o)}return i}function kR(e,t,n,r,a,i){return Ib(function(){var o;sT(a),cT(i),uT(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=Q_(e,a);var s="same"===r?"same":"valid";return o="max"===i?Bk(e,t,n,s):Zb(e,t,n,s),"channelsFirst"===a&&(o=zx(o,[0,3,1,2])),o})}function xR(e,t,n,r,a,i){return Ib(function(){var o;sT(a),cT(i),uT(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=$_(e,a);var s="same"===r?"same":"valid";return o="max"===i?Vk(e,t,n,s):Jb(e,t,n,s),"channelsFirst"===a&&(o=zx(o,[0,4,1,2,3])),o})}kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"mergeFunction",value:function(e){return Ib(function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Db(t,e[n]);return t})}}]),n}(gR);return e.className="Add",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"mergeFunction",value:function(e){return Ib(function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Ok(t,e[n]);return t})}}]),n}(gR);return e.className="Multiply",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"mergeFunction",value:function(e){return Ib(function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Db(t,e[n]);return Ok(1/e.length,t)})}}]),n}(gR);return e.className="Average",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"mergeFunction",value:function(e){return Ib(function(){for(var t=e[0],n=1;n<e.length;++n)t=Wk(t,e[n]);return t})}}]),n}(gR);return e.className="Maximum",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"mergeFunction",value:function(e){return Ib(function(){for(var t=e[0],n=1;n<e.length;++n)t=jk(t,e[n]);return t})}}]),n}(gR);return e.className="Minimum",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return I(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new TC("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=s(e=e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(h){r.e(h)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var u,c=!1,l=s(a);try{for(l.s();!(u=l.n()).done;){if(Pf(u.value,o)){c=!0;break}}}catch(h){l.e(h)}finally{l.f()}c||a.push(o)}if(a.length>1)throw new TC("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return Ib(function(){return TT(e,t.axis)})}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new TC("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=s(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(u){i.e(u)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new TC("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new TC("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new TC("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return Ib(function(){var r=!0;if(t.forEach(function(e){null==e||(r=!1)}),r)return null;for(var a=[],i=0;i<e.length;++i)a.push(null==t[i]?ox(e[i]).asType("bool"):t[i].rank<e[i].rank?wk(t[i],-1):t[i]);var o=ak(a,n.axis);return Fb(o,-1,!1)})}},{key:"getConfig",value:function(){var e={axis:this.axis},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gR);return e.className="Concatenate",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return I(n,[{key:"build",value:function(e){Df(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new EC("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new TC("Dimension incompatibility: ".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new TC("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map(function(t,n){return yR(t,e[n].shape.length)}):[yR(this.axes,n.shape.length),yR(this.axes,r.shape.length)],this.normalize&&(n=DE(n,t[0]),r=DE(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new EC("batchDot is not implemented for tensors of 4D or higher rank yet");if(Df(e.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length)}),Df(e.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length)}),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new EC("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return Ib(function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=e.reshape(e.shape.concat(c))}else n=0;if(o=2===e.shape.length&&2===t.shape.length?i[0]===i[1]?e.mul(t).sum(i[0]):e.transpose([1,0]).mul(t).sum(i[1]):e.matMul(t,i[0]!==e.shape.length-1,i[1]===t.shape.length-1),n>0){for(var h,p=[],f=h=r>a?r+a-3:r-1;f<h+n;++f)p.push(f);o=o.squeeze(p)}return 1===o.shape.length&&(o=o.expandDims(1)),o})}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[yR(this.axes,e.length),yR(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){Df(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new EC("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gR);return e.className="Dot",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return I(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e);return PT(function(){return RT(r.shape,0,n.stddev).add(r)},function(){return r},t.training||!1)})}}]),n}(gE);return e.className="GaussianNoise",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return I(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t);var r=iE(e);return n.rate>0&&n.rate<1?PT(function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul(RT(r.shape,1,e))},function(){return r},t.training||!1):r})}}]),n}(gE);return e.className="GaussianDropout",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return I(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||iE(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=p(k(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Ib(function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return PT(function(){var t=iE(e),a=-1.7580993408473766,i=_k(fx(r),n.rate);i=wT(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate;return t.mul(i).add(i.add(-1).mul(a)).mul(o).add(s)},function(){return iE(e)},t.training||!1)}return e})}}]),n}(gE);return e.className="AlphaDropout",e}()),kb(function(){var e=function(e){d(a,e);var r=m(a);function a(e){var t;return x(this,a),null==e&&(e={}),(t=r.call(this,e)).supportsMasking=!0,t.axis=null==e.axis?-1:e.axis,t.momentum=null==e.momentum?.99:e.momentum,t.epsilon=null==e.epsilon?.001:e.epsilon,t.center=null==e.center||e.center,t.scale=null==e.scale||e.scale,t.betaInitializer=QT(e.betaInitializer||"zeros"),t.gammaInitializer=QT(e.gammaInitializer||"ones"),t.movingMeanInitializer=QT(e.movingMeanInitializer||"zeros"),t.movingVarianceInitializer=QT(e.movingVarianceInitializer||"ones"),t.betaConstraint=eT(e.betaConstraint),t.gammaConstraint=eT(e.gammaConstraint),t.betaRegularizer=X_(e.betaRegularizer),t.gammaRegularizer=X_(e.gammaRegularizer),t}return I(a,[{key:"build",value:function(e){e=oE(e);var n=this.axis>=0?this.axis:this.axis+e.length,r=e[n];if(null==r)throw new TC("Axis ".concat(n," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new pE({ndim:e.length,axes:t({},n,r)})];var a=[r];this.scale&&(this.gamma=this.addWeight("gamma",a,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",a,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",a,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",a,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var r=this;return Ib(function(){var a=null!=t.training&&t.training,i=iE(e),o=i.shape,u=o.length,c=xT(0,u),l=r.axis>=0?r.axis:r.axis+u;c.splice(l,1);var h=RC(1,u);h[l]=o[l];var p=c.slice();p.sort();var f=!Pf(p,xT(0,u).slice(0,u-1));if(!a)return function(){if(f){var e=r.movingMean.read().reshape(h),t=r.movingVariance.read().reshape(h),n=r.center?r.beta.read().reshape(h):null,a=r.scale?r.gamma.read().reshape(h):null;return bR(i,e,t,n,a,r.epsilon)}return bR(i,r.movingMean.read(),r.movingVariance.read(),null==r.beta?null:r.beta.read(),null==r.gamma?null:r.gamma.read(),r.epsilon)}();var d=n(function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Pf(r.slice().sort(),xT(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Ib(function(){var i=ex(e,r),o=i.mean,s=i.variance;return[bR(e,o,s,n,t,a),o,s]})}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Ib(function(){var i,o=ex(e,r),u=o.mean,c=o.variance,l=[],h=s(xT(0,e.rank));try{for(h.s();!(i=h.n()).done;){var p=i.value;-1!==r.indexOf(p)?l.push(1):l.push(e.shape[p])}}catch(g){h.e(g)}finally{h.f()}var f=u.reshape(l),d=c.reshape(l),v=null==t?null:t.reshape(l),m=null==n?null:n.reshape(l);return[bR(e,f,d,m,v,a),u,c]})}(e,t,n,r,a)}(i,r.gamma.read(),r.beta.read(),c,r.epsilon),3),v=d[0],m=d[1],g=d[2],y=function(e,t,n){Ib(function(){var r=1-n,a=e.read(),i=a.sub(t).mul(r);e.write(a.sub(i))})};return y(r.movingMean,m,r.momentum),y(r.movingVariance,g,r.momentum),v})}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:JT(this.betaInitializer),gammaInitializer:JT(this.gammaInitializer),movingMeanInitializer:JT(this.movingMeanInitializer),movingVarianceInitializer:JT(this.movingVarianceInitializer),betaRegularizer:q_(this.betaRegularizer),gammaRegularizer:q_(this.gammaRegularizer),betaConstraint:QC(this.betaConstraint),gammaConstraint:QC(this.gammaConstraint)},t=p(k(a.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),a}(gE);return e.className="BatchNormalization",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(r.axis)));var a,i=s(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(r.axis)))}}catch(u){i.e(u)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=QT(e.betaInitializer||"zeros"),r.gammaInitializer=QT(e.gammaInitializer||"ones"),r.betaRegularizer=X_(e.betaRegularizer),r.gammaRegularizer=X_(e.gammaRegularizer),r.supportsMasking=!0,g(r)}return I(n,[{key:"build",value:function(e){var t=(e=oE(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=s(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(u){a.e(u)}finally{a.f()}if(this.axis.length!==UC(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map(function(t){return e[t]});this.gamma=this.scale?this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=iE(e),a=r.shape,i=a.length;return Ib(function(){var e,t=ex(r,n.axis,!0),o=t.mean,u=t.variance,c=RC(1,i),l=s(n.axis);try{for(l.s();!(e=l.n()).done;){var h=e.value;c[h]=a[h]}}catch(y){l.e(y)}finally{l.f()}for(var p=function(e){return null!=e&&e.shape.length!==i&&n.axis!==[i-1]?e.reshape(c):e},f=p(n.gamma.read()),d=p(n.beta.read()),v=[],m=[],g=0;g<i;++g)-1!==n.axis.indexOf(g)?(v.push(a[g]),m.push(1)):(v.push(1),m.push(a[g]));return o=o.tile(v),u=u.tile(v),f=f.tile(m),d=d.tile(m),bR(r,o,u,d,f,n.epsilon)})}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:JT(this.betaInitializer),gammaInitializer:JT(this.gammaInitializer),betaRegularizer:q_(this.betaRegularizer),gammaRegularizer:q_(this.gammaRegularizer)},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="LayerNormalization",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new TC("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new TC("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new TC("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new pE({ndim:4})],g(r)}return I(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=oE(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return Ib(function(){return function(e,t,n){return Ib(function(){if(4!==e.rank)throw new TC("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new TC("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new TC("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],sx(e,r)})}(iE(e),n.padding,n.dataFormat)})}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);return e.className="ZeroPadding2D",e}());var wR=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new TC("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(qC(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new TC("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));r.strides=e.strides}return qC(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,uT(r.padding),r.inputSpec=[new pE({ndim:3})],g(r)}return I(n,[{key:"computeOutputShape",value:function(e){var t=Z_((e=oE(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return Ib(function(){n.invokeCallHook(e,t),e=IT(iE(e),2);var r=n.poolingFunction(iE(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return Ex(r,[2])})}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return sT(a),uT(r),kR(e,t,n,r,a,"max")}}]),n}(wR);return e.className="MaxPooling1D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return sT(a),uT(r),kR(e,t,n,r,a,"avg")}}]),n}(wR);return e.className="AveragePooling1D",e}());var IR=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new TC("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return qC(r.poolSize,"poolSize"),qC(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,sT(r.dataFormat),uT(r.padding),r.inputSpec=[new pE({ndim:4})],g(r)}return I(n,[{key:"computeOutputShape",value:function(e){e=oE(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=Z_(t,this.poolSize[0],this.padding,this.strides[0]),n=Z_(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return Ib(function(){return n.invokeCallHook(e,t),n.poolingFunction(iE(e),n.poolSize,n.strides,n.padding,n.dataFormat)})}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return sT(a),uT(r),kR(e,t,n,r,a,"max")}}]),n}(IR);return e.className="MaxPooling2D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return sT(a),uT(r),kR(e,t,n,r,a,"avg")}}]),n}(IR);return e.className="AveragePooling2D",e}());var NR=function(e){d(n,e);var t=m(n);function n(e){var r;if(x(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new TC("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return qC(r.poolSize,"poolSize"),qC(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,sT(r.dataFormat),uT(r.padding),r.inputSpec=[new pE({ndim:5})],g(r)}return I(n,[{key:"computeOutputShape",value:function(e){e=oE(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=Z_(t,this.poolSize[0],this.padding,this.strides[0]),n=Z_(n,this.poolSize[1],this.padding,this.strides[1]),r=Z_(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return Ib(function(){return n.invokeCallHook(e,t),n.poolingFunction(iE(e),n.poolSize,n.strides,n.padding,n.dataFormat)})}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return sT(a),uT(r),xR(e,t,n,r,a,"max")}}]),n}(NR);return e.className="MaxPooling3D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return sT(a),uT(r),xR(e,t,n,r,a,"avg")}}]),n}(NR);return e.className="AveragePooling3D",e}());var SR=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).inputSpec=[new pE({ndim:3})],r}return I(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new EC}}]),n}(gE);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e||{})}return I(n,[{key:"call",value:function(e,t){return Ib(function(){var t=iE(e);return Uk(t,1)})}}]),n}(SR);return e.className="GlobalAveragePooling1D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){return x(this,n),t.call(this,e||{})}return I(n,[{key:"call",value:function(e,t){return Ib(function(){var t=iE(e);return Fk(t,1)})}}]),n}(SR);return e.className="GlobalMaxPooling1D",e}());var CR=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,sT(r.dataFormat),r.inputSpec=[new pE({ndim:4})],r}return I(n,[{key:"computeOutputShape",value:function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new EC}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(gE);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"call",value:function(e,t){var n=this;return Ib(function(){var t=iE(e);return Uk(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])})}}]),n}(CR);return e.className="GlobalAveragePooling2D",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"call",value:function(e,t){var n=this;return Ib(function(){var t=iE(e);return Fk(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])})}}]),n}(CR);return e.className="GlobalMaxPooling2D",e}());var TR=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).layer=e.layer,r}return I(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){p(k(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=AE(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(gE);kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;return x(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return I(n,[{key:"build",value:function(e){if((e=oE(e)).length<3)throw new TC("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),p(k(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=oE(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t);return[n[0],e[1]].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return Ib(function(){return oR(function(e,r){return[iE(n.layer.call(e,t)),[]]},e=iE(e),[],!1,null,null,!1,!0)[1]})}}]),n}(TR);return e.className="TimeDistributed",e}()),kb(function(){var e=function(e){d(n,e);var t=m(n);function n(e){var r;x(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=AE(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=AE(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){jC(iT,"BidirectionalMergeMode",e)}(r.mergeMode),e.weights)throw new EC("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return I(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState&&(r=a.slice(1)),t=t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):FC(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var o=iR(e,r,a,this.numConstants);if(e=o.inputs,r=o.initialState,a=o.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return p(k(n.prototype),"apply",this).call(this,e,t);var s=[],u=[];if(null!=r){var c=r.length;if(c%2>0)throw new TC("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,s.push.apply(s,i(r));var l=r.map(function(e){return new pE({shape:e.shape})});this.forwardLayer.stateSpec=l.slice(0,c/2),this.backwardLayer.stateSpec=l.slice(c/2),u.push.apply(u,i(l))}if(null!=a)throw new EC("Support for constants in Bidirectional layers is not implemented yet.");for(var h=s[0]instanceof fE,f=0,d=s;f<d.length;f++){if(d[f]instanceof fE!==h)throw new TC("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(h){var v=[e].concat(s),m=this.inputSpec.concat(u),g=this.inputSpec;this.inputSpec=m;var y=p(k(n.prototype),"apply",this).call(this,v,t);return this.inputSpec=g,y}return p(k(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Ib(function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=vx(a,1)),"concat"===n.mergeMode?o=TT([r,a]):"sum"===n.mergeMode?o=Db(r,a):"ave"===n.mergeMode?o=Ok(.5,Db(r,a)):"mul"===n.mergeMode?o=Ok(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o})}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;hT(this.forwardLayer.name,function(){t.forwardLayer.build(e)}),hT(this.backwardLayer.name,function(){t.backwardLayer.build(e)}),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map(function(e){return null});return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){p(k(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=p(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=AE(t.layer);if(delete t.layer,null!=t.numConstants)throw new EC("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(TR);return e.className="Bidirectional",e}());var ER,_R=(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(_R||(_R={})),_R);!function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(ER||(ER={}));var RR={};function AR(e){return RR[e]}function DR(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return FR(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map(function(e){return FR(e,n,r,a)});var u=FR(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:rd(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function FR(e,t,r,a){var i=n(LR(e),2),o=i[0],s=i[1];if(null!=a){var u=a.getHashTableHandleByName(o);if(null!=u)return u}var c=r.currentContextIds.find(function(e){return!!t[MR(o,e)]});return void 0!==c?t[MR(o,c)][s]:void 0}function OR(e,t){var r=n(LR(e),2),a=r[0],i=r[1];return[MR(a,t&&t.currentContextId),i]}function MR(e,t){return t?"".concat(e,"-").concat(t):e}function LR(e){var t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function PR(e,t,n){var r=DR("pad",e,t,n);if("explicit"===r){r=DR("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function zR(e){return e.kept?e:Hy(e)}var BR=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],VR=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],WR=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],UR=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],HR=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],jR=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],GR=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],qR=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],KR=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],XR=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],YR=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],ZR=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],JR=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],QR=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],$R=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],eA=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],tA=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}],nA=function(){function e(){var t;x(this,e);var n=(t=[]).concat.apply(t,i([v,b,w,N,S,C,T,A,R,E,D,F,O,M,L,P,_].map(function(e){return e.json})));this.opMappers=n.reduce(function(e,t){return e[t.tfOpName]=t,e},{})}return I(e,[{key:"transformGraph",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=[],i=[],o=[],s=e.node.reduce(function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):(null==n.input||0===n.input.length)&&o.push(e[n.name]),e},{}),u=[],c=[],l={},h={};null!=r&&(l=this.mapSignatureEntries(r.inputs),h=this.mapSignatureEntries(r.outputs));var p=Object.keys(s);p.forEach(function(e){var t=s[e];t.inputNames.forEach(function(e){var r=n(OR(e),1)[0];t.inputs.push(s[r]),s[r].children.push(t)})}),0===Object.keys(h).length?p.forEach(function(e){var t=s[e];0===t.children.length&&c.push(t)}):Object.keys(h).forEach(function(e){var t=n(OR(e),1)[0],r=s[t];null!=r&&(r.signatureKey=h[e],c.push(r))}),Object.keys(l).length>0?Object.keys(l).forEach(function(e){var t=n(OR(e),1)[0],r=s[t];r&&(r.signatureKey=l[e],u.push(r))}):u=a;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce(function(e,n){return e[n.signature.name]=t.mapFunction(n),e},{}));var d={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:r,functions:f};return o.length>0&&(d.initNodes=o),d}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce(function(t,n){return t[e[n].name]=n,t},{})}},{key:"mapNode",value:function(e){var t=AR(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(e){return e.startsWith("^")?e.substr(1):e}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce(function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e},{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce(function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=aA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=aA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=dA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=dA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=oA(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=oA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=fA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=fA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=iA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=iA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=mA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=mA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=pA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=pA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=vA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=vA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=cA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=cA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=lA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=lA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=uA(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=uA(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t},{})),n}},{key:"mapFunction",value:function(e){var t=this,r=e.nodeDef,a=[],i={};null!=r&&(i=r.reduce(function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&a.push(e[n.name]),e},{}));var o=[],s=[];e.signature.inputArg.forEach(function(e){var t=n(OR(e.name),1)[0],r={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:sA(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,o.push(r),i[t]=r}),Object.keys(i).forEach(function(e){var t=i[e];t.inputNames.forEach(function(e){var r=n(OR(e),1)[0];t.inputs.push(i[r]),i[r].children.push(t)})});var u=e.ret;e.signature.outputArg.forEach(function(e){var t=n(OR(u[e.name]),2),r=t[0],a=t[1],o=i[r];null!=o&&(o.defaultOutput=a,s.push(o))});var c=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:s,weights:a,placeholders:[],signature:c}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e},{}),outputs:e.signature.outputArg.reduce(function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n},{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function rA(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=fd().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function aA(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?rA(a.s,r):n}function iA(e,t,n){var r=e[t];return r?r.b:n}function oA(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function sA(e){switch("string"==typeof e&&(e=_R[e]),e){case _R.DT_FLOAT:return"float32";case _R.DT_INT32:case _R.DT_INT64:case _R.DT_INT8:case _R.DT_UINT8:return"int32";case _R.DT_BOOL:return"bool";case _R.DT_DOUBLE:return"float32";case _R.DT_STRING:return"string";default:return null}}function uA(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function cA(e,t,n){var r=e[t];return r&&r.type?sA(r.type):n}function lA(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map(function(e){return sA(e)}):n}function hA(e){if(!e.unknownRank)return null!=e.dim?e.dim.map(function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)}):[]}function pA(e,t,n){var r=e[t];return r&&r.shape?hA(r.shape):n}function fA(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(function(e){return"number"==typeof e?e:parseInt(e,10)}):n}function dA(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map(function(e){return rA(e,r)}):n}function vA(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(function(e){return hA(e)}):n}function mA(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var gA=function(){function e(t,n,r){var a=this;x(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(function(e){return a.getInput(e)}),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(function(e,t){return e[t]=a.getAttr(t),e},{}))}return I(e,[{key:"getInput",value:function(e){return FR(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return FR(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return oA(this.node.rawAttrs,e,t);if(null!=n.s)return aA(this.node.rawAttrs,e,t);if(null!=n.b)return iA(this.node.rawAttrs,e,t);if(null!=n.shape)return pA(this.node.rawAttrs,e,t);if(null!=n.type)return cA(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return fA(this.node.rawAttrs,e,t);if(null!=n.list.s)return dA(this.node.rawAttrs,e,t);if(null!=n.list.shape)return vA(this.node.rawAttrs,e,t);if(null!=n.list.b)return mA(this.node.rawAttrs,e,t);if(null!=n.list.type)return lA(this.node.rawAttrs,e,t)}return t}}]),e}(),yA=ry({addN_:function(e){Df(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Df(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)});var t=e.map(function(e,t){return ty(e,"tensors".concat(t),"addN")}),n=t[0];return t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Pf(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),Kg.runKernel(wd,t)}});function bA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){Df(e.length===t.length,function(){return n+" Shapes ".concat(e," and ").concat(t," must match")});for(var r=0;r<e.length;r++){var a=e[r],i=t[r];Df(a<0||i<0||a===i,function(){return n+" Shapes ".concat(e," and ").concat(t," must match")})}}}function kA(e){return!("number"==typeof e||e.some(function(e){return e<0}))}function xA(e,t,n){var r=wA(e,n),a=!kA(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach(function(e){r=wA(e.shape,r)}),!kA(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function wA(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var IA=function(){function e(t,n,r,a,i,o,s){x(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=_b(0),Sb(this.idTensor)}return I(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach(function(t){(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map(function(e){return t.read(e)})}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),bA(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Sb(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(e,r){return n.write(e,t[r])})}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return oy([],[0].concat(this.elementShape));var r=this.readMany(e);return bA(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),_x(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return oy([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return bA(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),ak(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,i(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Ox(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map(function(e){return r+=e});if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];Ib(function(){t=Yb(t,[1,r,i]);for(var s=0;s<e.length;++s)o[s]=Yb(bx(t,[0,0===s?0:a[s-1],0],[1,e[s],i]),n.elementShape);return o});for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),NA=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;x(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach(function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));bA(n,e.shape,"TensorList shape mismatch: "),Sb(e)}),this.idTensor=_b(0),this.maxNumElements=a,Sb(this.idTensor)}return I(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e(i(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach(function(t){(null==e||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));bA(e,this.elementShape,"TensorList shape mismatch: ");var a=xA(this.elementShape,this.tensors,e);return Ib(function(){var e=n.tensors.map(function(e){return Yb(e,a)});return _x(e,0)})}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=xA(this.elementShape,this.tensors,e),r=this.tensors.pop();return bA(r.shape,e,"TensorList shape mismatch: "),Yb(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(bA(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Sb(e),this.tensors.push(e)}},{key:"resize",value:function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));this.tensors.length=e}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));bA(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=xA(this.elementShape,this.tensors,t);return Yb(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));bA(this.elementShape,t.shape,"TensorList shape mismatch: "),Sb(t),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));bA(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=xA(this.elementShape,this.tensors,n);return 0===e.length?oy([],[0].concat(a)):Ib(function(){var t=e.map(function(e){return Yb(r.tensors[e],a)});return _x(t,0)})}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));bA(this.elementShape,t,"TensorList shape mismatch: ");var r=xA(this.elementShape,this.tensors,t);return 0===this.size()?oy([],[0].concat(r)):Ib(function(){var e=n.tensors.map(function(e){return Yb(e,r)});return ak(e,0)})}}]),e}(),SA=function(){var e=Sf(regeneratorRuntime.mark(function e(t,n,r){var a,o,s,u,c,l,h,p,f,d,v,m,g,y,b,k,x,w,I,N,S,C,T,E,_,R,A,D,F,O,M,L,P,z,B,V,W,U,H,j,G,q,K,X,Y,Z,J,Q,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,he,pe,fe,de,ve,me,ge,ye,be,ke,xe,we,Ie,Ne,Se,Ce,Te,Ee,_e;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?16:"Switch"===e.t0?17:"Merge"===e.t0?28:"Enter"===e.t0?30:"Exit"===e.t0?32:"NextIteration"===e.t0?34:"TensorArrayV3"===e.t0?36:"TensorArrayWriteV3"===e.t0?38:"TensorArrayReadV3"===e.t0?40:"TensorArrayGatherV3"===e.t0?42:"TensorArrayScatterV3"===e.t0?44:"TensorArrayConcatV3"===e.t0?46:"TensorArraySplitV3"===e.t0?48:"TensorArraySizeV3"===e.t0?50:"TensorArrayCloseV3"===e.t0?52:"TensorListSetItem"===e.t0?54:"TensorListGetItem"===e.t0?56:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?58:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?60:"TensorListGather"===e.t0?64:"TensorListStack"===e.t0?66:"TensorListFromTensor"===e.t0?68:"TensorListConcat"===e.t0?70:"TensorListPushBack"===e.t0?72:"TensorListPopBack"===e.t0?74:"TensorListSplit"===e.t0?76:78;break;case 3:return a=DR("thenBranch",t,n,r),o=DR("elseBranch",t,n,r),s=DR("cond",t,n,r),u=DR("args",t,n,r),e.next=6,s.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(u,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[o].executeFunctionAsync(u,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return e.delegateYield(regeneratorRuntime.mark(function e(){var a,i,o,s,u,c,l,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=DR("body",t,n,r),i=DR("cond",t,n,r),o=DR("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map(function(e){return e.id}),e.next=9,s[0].data();case 9:c=e.sent,s.forEach(function(e){!e.kept&&-1===u.indexOf(e.id)&&e.dispose()}),l=o,h=regeneratorRuntime.mark(function e(){var t,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map(function(e){return e.id}),t.forEach(function(e){!e.kept&&-1===u.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()}),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach(function(e){!e.kept&&-1===u.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()});case 13:case"end":return e.stop()}},e)});case 13:if(!c[0]){e.next=17;break}return e.delegateYield(h(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}},e)})(),"t2",13);case 13:if("object"!=typeof(c=e.t2)){e.next=16;break}return e.abrupt("return",c.v);case 16:return e.abrupt("return",[zR(DR("pred",t,n,r))]);case 17:return l=DR("pred",t,n,r),(h=DR("data",t,n,r)).kept||(h=zR(h)),e.next=22,l.data();case 22:if(!e.sent[0]){e.next=26;break}e.t3=[void 0,h],e.next=27;break;case 26:e.t3=[h,void 0];case 27:return e.abrupt("return",e.t3);case 28:return p=t.inputNames.find(function(e){return void 0!==FR(e,n,r)}),e.abrupt("return",p?[zR(FR(p,n,r))]:void 0);case 30:return f=DR("frameName",t,n,r),d=DR("tensor",t,n,r),e.abrupt("return",(r.enterFrame(f),[zR(d)]));case 32:return v=DR("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[zR(v)]));case 34:return m=DR("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[zR(m)]));case 36:return g=DR("size",t,n,r),y=DR("dtype",t,n,r),b=DR("elementShape",t,n,r),k=DR("dynamicSize",t,n,r),x=DR("clearAfterRead",t,n,r),w=DR("identicalElementShapes",t,n,r),I=DR("name",t,n,r),N=new IA(I,y,g,b,w,k,x),e.abrupt("return",(r.addTensorArray(N),[N.idTensor,_b(1)]));case 38:return S=DR("tensorArrayId",t,n,r),C=DR("index",t,n,r),T=DR("tensor",t,n,r),E=r.getTensorArray(S.id),e.abrupt("return",(E.write(C,T),[E.idTensor]));case 40:return _=DR("tensorArrayId",t,n,r),R=DR("index",t,n,r),e.abrupt("return",[r.getTensorArray(_.id).read(R)]);case 42:return A=DR("tensorArrayId",t,n,r),D=DR("indices",t,n,r),F=DR("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(A.id).gather(D,F)]);case 44:return O=DR("tensorArrayId",t,n,r),M=DR("indices",t,n,r),L=DR("tensor",t,n,r),P=r.getTensorArray(O.id),e.abrupt("return",(P.scatter(M,L),[P.idTensor]));case 46:return z=DR("tensorArrayId",t,n,r),B=r.getTensorArray(z.id),V=DR("dtype",t,n,r),e.abrupt("return",[B.concat(V)]);case 48:return W=DR("tensorArrayId",t,n,r),U=DR("tensor",t,n,r),H=DR("lengths",t,n,r),j=r.getTensorArray(W.id),e.abrupt("return",(j.split(H,U),[j.idTensor]));case 50:return G=DR("tensorArrayId",t,n,r),e.abrupt("return",[_b(r.getTensorArray(G.id).size(),"int32")]);case 52:return q=DR("tensorArrayId",t,n,r),K=r.getTensorArray(q.id),e.abrupt("return",(K.clearAndClose(),[K.idTensor]));case 54:return X=DR("tensorListId",t,n,r),Y=DR("index",t,n,r),Z=DR("tensor",t,n,r),J=r.getTensorList(X.id),e.abrupt("return",(J.setItem(Y,Z),[J.idTensor]));case 56:return Q=DR("tensorListId",t,n,r),$=DR("index",t,n,r),ee=DR("elementShape",t,n,r),te=DR("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Q.id).getItem($,ee,te)]);case 58:return ne=DR("indices",t,n,r),re=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,i(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var o=new NA([],n,e.dtype,r),s=Ox(e,0);return t.forEach(function(e,t){o.setItem(e,s[t])}),o}(DR("tensor",t,n,r),ne,DR("elementShape",t,n,r),DR("numElements",t,n,r)),e.abrupt("return",(r.addTensorList(re),[re.idTensor]));case 60:return ae=DR("elementShape",t,n,r),ie=DR("elementDType",t,n,r),oe="TensorListReserve"===t.op?"numElements":"maxNumElements",se=function(e,t,n){return new NA([],e,t,n)}(ae,ie,DR(oe,t,n,r)),e.abrupt("return",(r.addTensorList(se),[se.idTensor]));case 64:return ue=DR("tensorListId",t,n,r),ce=DR("indices",t,n,r),le=DR("elementShape",t,n,r),he=DR("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ue.id).gather(ce,he,le)]);case 66:return pe=DR("tensorListId",t,n,r),fe=DR("elementShape",t,n,r),de=DR("elementDType",t,n,r),ve=DR("numElements",t,n,r),e.abrupt("return",[r.getTensorList(pe.id).stack(fe,de,ve)]);case 68:return me=function(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));bA(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=Ox(e);return new NA(a,t,r)}(DR("tensor",t,n,r),DR("elementShape",t,n,r),DR("elementDType",t,n,r)),e.abrupt("return",(r.addTensorList(me),[me.idTensor]));case 70:return ge=DR("tensorListId",t,n,r),ye=r.getTensorList(ge.id),be=DR("dtype",t,n,r),ke=DR("elementShape",t,n,r),e.abrupt("return",[ye.concat(be,ke)]);case 72:return xe=DR("tensorListId",t,n,r),we=DR("tensor",t,n,r),Ie=r.getTensorList(xe.id),e.abrupt("return",(Ie.pushBack(we),[Ie.idTensor]));case 74:return Ne=DR("tensorListId",t,n,r),Se=DR("elementShape",t,n,r),Ce=DR("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ne.id).popBack(Se,Ce)]);case 76:return Te=DR("tensor",t,n,r),Ee=DR("elementShape",t,n,r),_e=function(e,t,n){var r=0,a=t.map(function(e){return r+=e});if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=wA(e.shape.slice(1),n),o=0===r?0:e.size/r,s=Ib(function(){var n=[];e=Yb(e,[1,r,o]);for(var s=0;s<t.length;++s)n[s]=Yb(bx(e,[0,0===s?0:a[s-1],0],[1,t[s],o]),i);return e.dispose(),n}),u=new NA([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}(Te,DR("lengths",t,n,r),Ee),e.abrupt("return",(r.addTensorList(_e),[_e.idTensor]));case 78:throw TypeError("Node type ".concat(t.op," is not implemented"));case 79:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),CA=ry({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:ty(e,"x","maxPoolWithArgmax")},o=Kg.runKernel(Kv,i,{filterSize:t,strides:n,pad:r,includeBatchInIndex:a});return{result:o[0],indexes:o[1]}}});function TA(e,t,r){var a=n(DR("fusedOps",e,t,r),2),i=a[0],o=a[1],s="biasadd"===i,u="prelu"===o,c="fusedbatchnorm"===i,l=DR("numArgs",e,t,r);if(s){if(u&&2!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&1!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");var h=DR("strides",e,t,r),p=PR(e,t,r),f=DR("dataFormat",e,t,r).toUpperCase(),d=DR("dilations",e,t,r),v=n(DR("args",e,t,r),2);return{stride:h,pad:p,dataFormat:f,dilations:d,biasArg:v[0],preluArg:v[1],activationFunc:o,leakyreluAlpha:DR("leakyreluAlpha",e,t,r)}}function EA(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Kg.runKernel(Fv,{},{start:e,stop:t,num:n})}var _A=ry({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=ty(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?Yb(a,[1,-1]):a},u=Kg.runKernel($v,s,{numSamples:t,seed:n,normalized:r});return 1===o?Yb(u,[u.size]):u}});function RA(){return(RA=Sf(regeneratorRuntime.mark(function e(t){var n,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=ty(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=WI(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var AA=function(e){return RA.apply(this,arguments)};function DA(){return(DA=Sf(regeneratorRuntime.mark(function e(t,n){var r,a,i,o,s,u,c,l,h,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=ty(t,"x","setdiff1d"),a=ty(n,"y","setdiff1d"),Df(r.dtype===a.dtype,function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")}),Df(1===r.rank,function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")}),Df(1===a.rank,function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")}),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new Tg([u],r.dtype),h=new Tg([u],"int32"),p=0,f=0;p<i.length;p++)s.has(i[p])||(l.values[f]=i[p],h.values[f]=p,f++);return e.abrupt("return",[l.toTensor(),h.toTensor()]);case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function FA(e,t,n){return{boxes:DR("boxes",e,t,n),scores:DR("scores",e,t,n),maxOutputSize:DR("maxOutputSize",e,t,n),iouThreshold:DR("iouThreshold",e,t,n),scoreThreshold:DR("scoreThreshold",e,t,n),softNmsSigma:DR("softNmsSigma",e,t,n)}}var OA=function(){var e=Sf(regeneratorRuntime.mark(function e(t,n,r){var a,i,o,s,u,c,l,h,p,f,d,v,m,g,y,b,k,x,w,I,N,S,C,T;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?3:"NonMaxSuppressionV4"===e.t0?14:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?25:"Where"===e.t0?30:"ListDiff"===e.t0?36:37;break;case 3:return a=FA(t,n,r),i=a.boxes,o=a.scores,s=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,l=a.softNmsSigma,e.next=12,jw.nonMaxSuppressionWithScoreAsync(i,o,s,u,c,l);case 12:return h=e.sent,e.abrupt("return",[h.selectedIndices,h.selectedScores]);case 14:return p=FA(t,n,r),f=p.boxes,d=p.scores,v=p.maxOutputSize,m=p.iouThreshold,g=p.scoreThreshold,y=DR("padToMaxOutputSize",t,n,r),e.next=23,jw.nonMaxSuppressionPaddedAsync(f,d,v,m,g,y);case 23:return b=e.sent,e.abrupt("return",[b.selectedIndices,b.validOutputs]);case 25:return k=FA(t,n,r),x=k.boxes,w=k.scores,I=k.maxOutputSize,N=k.iouThreshold,S=k.scoreThreshold,e.next=28,jw.nonMaxSuppressionAsync(x,w,I,N,S);case 28:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 30:return C=Uy(DR("condition",t,n,r),"bool"),e.next=33,AA(C);case 33:return e.t2=e.sent,T=[e.t2],e.abrupt("return",(C.dispose(),T));case 36:return e.abrupt("return",function(e,t){return DA.apply(this,arguments)}(DR("x",t,n,r),DR("y",t,n,r)));case 37:throw TypeError("Node type ".concat(t.op," is not implemented"));case 38:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),MA=function(){function e(t,n){x(this,e),this.keyDType=t,this.valueDType=n,this.handle=_b(0),this.tensorMap=new Map,Sb(this.handle)}return I(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return _b(this.size(),"int32")}},{key:"import",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.checkKeyAndValueTensor(e,t),r.next=3,e.data();case 3:return a=r.sent,r.abrupt("return",(n.tensorMap.forEach(function(e){return e.dispose()}),n.tensorMap.clear(),Ib(function(){var e=Ox(t),r=a.length,i=e.length;Df(r===i,function(){return"The number of elements doesn't match, keys has ".concat(r," elements, the values has ").concat(i," elements.")});for(var o=0;o<r;o++){var s=a[o],u=e[o];Sb(u),n.tensorMap.set(s,u)}return n.handle})));case 5:case"end":return r.stop()}},r)}))()}},{key:"find",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.checkKeyAndValueTensor(e,t),r.next=3,e.data();case 3:return a=r.sent,r.abrupt("return",Ib(function(){for(var e=[],r=0;r<a.length;r++){var i=n.findWithDefault(a[r],t);e.push(i)}return _x(e)}));case 5:case"end":return r.stop()}},r)}))()}},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]),e}(),LA=function(){var e=Sf(regeneratorRuntime.mark(function e(t,n,r,a){var i,o,s,u,c,l,h,p,f,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?5:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?10:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?15:17;break;case 3:return i=DR("keyDType",t,n,r),o=DR("valueDType",t,n,r),s=new MA(i,o),e.abrupt("return",(a.addHashTable(t.name,s),[s.handle]));case 5:return u=DR("tableHandle",t,n,r,a),c=DR("keys",t,n,r),l=DR("values",t,n,r),e.next=8,a.getHashTableById(u.id).import(c,l);case 8:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 10:return h=DR("tableHandle",t,n,r,a),p=DR("keys",t,n,r),f=DR("defaultValue",t,n,r),e.next=13,a.getHashTableById(h.id).find(p,f);case 13:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 15:return d=DR("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(d.id).tensorSize()]);case 17:throw TypeError("Node type ".concat(t.op," is not implemented"));case 18:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),PA=ry({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=ty(e,"sparseIndices","sparseToDense","int32"),i=ty(t,"sparseValues","sparseToDense"),o=ty(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));if(0!==t.rank&&(1!==t.rank||t.size!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o),Kg.runKernel(Hm,{sparseIndices:a,sparseValues:i,defaultValue:o},{outputShape:n})}}),zA=ry({bincount_:function(e,t,n){var r=ty(e,"x","bincount"),a=ty(t,"weights","bincount");return Df("int32"===r.dtype,function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)}),Df(n>=0,function(){return"size must be non-negative, but got ".concat(n,".")}),Df(a.size===r.size||0===a.size,function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}),Kg.runKernel(Ld,{x:r,weights:a},{size:n})}}),BA=ry({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=ty(e,"x","denseBincount"),i=ty(t,"weights","denseBincount");return Df("int32"===a.dtype,function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)}),Df(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")}),Df(n>=0,function(){return"size must be non-negative, but got ".concat(n,".")}),Df(i.size===a.size||0===i.size,function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(i.shape,".")}),Kg.runKernel($d,{x:a,weights:i},{size:n,binaryOutput:r})}}),VA=ry({scatterND_:function(e,t,n){var r=ty(e,"indices","scatterND","int32"),a=ty(t,"updates","scatterND");return vI(a,r,n),Kg.runKernel(Cm,{indices:r,updates:a},{shape:n})}}),WA=ry({gatherND_:function(e,t){var n=ty(t,"indices","gatherND","int32"),r={params:ty(e,"x","gatherND"),indices:n};return Kg.runKernel(xv,r)}});function UA(e,t,r,a){var i=function(e,t,r){switch(e.category){case"arithmetic":return Ib(function(){return function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[Db(DR("a",e,t,n),DR("b",e,t,n))];case"AddN":return[yA(DR("tensors",e,t,n))];case"FloorMod":case"Mod":return[fC(DR("a",e,t,n),DR("b",e,t,n))];case"Mul":return[Ok(DR("a",e,t,n),DR("b",e,t,n))];case"RealDiv":case"Div":return[mk(DR("a",e,t,n),DR("b",e,t,n))];case"DivNoNan":return[tC(DR("a",e,t,n),DR("b",e,t,n))];case"FloorDiv":return[vk(DR("a",e,t,n),DR("b",e,t,n))];case"Sub":return[Mk(DR("a",e,t,n),DR("b",e,t,n))];case"Minimum":return[jk(DR("a",e,t,n),DR("b",e,t,n))];case"Maximum":return[Wk(DR("a",e,t,n),DR("b",e,t,n))];case"Pow":return[Fw(DR("a",e,t,n),DR("b",e,t,n))];case"SquaredDifference":return[Ww(DR("a",e,t,n),DR("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"basic_math":return Ib(function(){return function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[Ab(DR("x",e,t,n))];case"Acos":return[jS(DR("x",e,t,n))];case"Acosh":return[GS(DR("x",e,t,n))];case"Asin":return[KS(DR("x",e,t,n))];case"Asinh":return[XS(DR("x",e,t,n))];case"Atan":return[YS(DR("x",e,t,n))];case"Atan2":return[ZS(DR("x",e,t,n),DR("y",e,t,n))];case"Atanh":return[JS(DR("x",e,t,n))];case"Ceil":return[QS(DR("x",e,t,n))];case"Complex":return[ay(DR("real",e,t,n),DR("imag",e,t,n))];case"Cos":return[DS(DR("x",e,t,n))];case"Cosh":return[OS(DR("x",e,t,n))];case"Elu":return[gk(DR("x",e,t,n))];case"Erf":return[rC(DR("x",e,t,n))];case"Exp":return[Dk(DR("x",e,t,n))];case"Expm1":return[aC(DR("x",e,t,n))];case"Floor":return[Ck(DR("x",e,t,n))];case"Log":return[Ak(DR("x",e,t,n))];case"Log1p":return[Uw(DR("x",e,t,n))];case"Imag":return[Vx(DR("x",e,t,n))];case"Neg":return[tx(DR("x",e,t,n))];case"Reciprocal":return[mC(DR("x",e,t,n))];case"Real":return[Wx(DR("x",e,t,n))];case"Relu":return[dx(DR("x",e,t,n))];case"Round":return[gC(DR("x",e,t,n))];case"Selu":return[mx(DR("x",e,t,n))];case"Sigmoid":return[yx(DR("x",e,t,n))];case"Sin":return[yN(DR("x",e,t,n))];case"Sign":return[yC(DR("x",e,t,n))];case"Sinh":return[kN(DR("x",e,t,n))];case"Softplus":return[Sx(DR("x",e,t,n))];case"Sqrt":return[Tx(DR("x",e,t,n))];case"Square":return[$k(DR("x",e,t,n))];case"Tanh":return[Rx(DR("x",e,t,n))];case"Tan":return[kC(DR("x",e,t,n))];case"ClipByValue":return[rk(DR("x",e,t,n),DR("clipValueMin",e,t,n),DR("clipValueMax",e,t,n))];case"Relu6":return[Kx(DR("x",e,t,n))];case"Rsqrt":return[FN(FR(e.inputNames[0],t,n))];case"Prod":return[vC(DR("x",e,t,n),DR("axes",e,t,n))];case"LeakyRelu":return[Rk(DR("x",e,t,n),DR("alpha",e,t,n))];case"Prelu":return[ux(DR("x",e,t,n),DR("alpha",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"control":return SA(e,t,r);case"convolution":return Ib(function(){return function(e,t,n){switch(e.op){case"Conv1D":var r=DR("stride",e,t,n),a=DR("pad",e,t,n),i=DR("dataFormat",e,t,n).toUpperCase(),o=DR("dilation",e,t,n);return[lk(DR("x",e,t,n),DR("filter",e,t,n),r,a,i,o)];case"Conv2D":var s=DR("strides",e,t,n),u=PR(e,t,n),c=DR("dataFormat",e,t,n).toUpperCase(),l=DR("dilations",e,t,n);return[ck(DR("x",e,t,n),DR("filter",e,t,n),[s[1],s[2]],u,c,[l[1],l[2]])];case"_FusedConv2D":var h=TA(e,t,n),p=h.stride,f=h.pad,d=h.dataFormat,v=h.dilations,m=h.biasArg,g=h.preluArg,y=h.activationFunc,b=h.leakyreluAlpha;return[$x({x:DR("x",e,t,n),filter:DR("filter",e,t,n),strides:[p[1],p[2]],pad:f,dataFormat:d,dilations:[v[1],v[2]],bias:m,activation:y,preluActivationWeights:g,leakyreluAlpha:b})];case"FusedDepthwiseConv2dNative":var k=TA(e,t,n),x=k.stride,w=k.pad,I=k.dataFormat,N=k.dilations,S=k.biasArg,C=k.preluArg,T=k.activationFunc,E=k.leakyreluAlpha;return[nw({x:DR("x",e,t,n),filter:DR("filter",e,t,n),strides:[x[1],x[2]],pad:w,dataFormat:I,dilations:[N[1],N[2]],bias:S,activation:T,preluActivationWeights:C,leakyreluAlpha:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var _=DR("outputShape",e,t,n),R=DR("strides",e,t,n),A=PR(e,t,n);return[pk(DR("x",e,t,n),DR("filter",e,t,n),_,[R[1],R[2]],A)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var D=DR("strides",e,t,n),F=PR(e,t,n),O=DR("dilations",e,t,n),M=DR("dataFormat",e,t,n).toUpperCase();return[dk(DR("input",e,t,n),DR("filter",e,t,n),[D[1],D[2]],F,M,[O[1],O[2]])];case"Conv3D":var L=DR("strides",e,t,n),P=DR("pad",e,t,n),z=DR("dataFormat",e,t,n).toUpperCase(),B=DR("dilations",e,t,n);return[fk(DR("x",e,t,n),DR("filter",e,t,n),[L[1],L[2],L[3]],P,z,[B[1],B[2],B[3]])];case"AvgPool":var V=DR("strides",e,t,n),W=DR("pad",e,t,n),U=DR("kernelSize",e,t,n);return[Zb(DR("x",e,t,n),[U[1],U[2]],[V[1],V[2]],W)];case"MaxPool":var H=DR("strides",e,t,n),j=DR("pad",e,t,n),G=DR("kernelSize",e,t,n);return[Bk(DR("x",e,t,n),[G[1],G[2]],[H[1],H[2]],j)];case"MaxPoolWithArgmax":var q=DR("strides",e,t,n),K=DR("pad",e,t,n),X=DR("kernelSize",e,t,n),Y=DR("includeBatchInIndex",e,t,n),Z=CA(DR("x",e,t,n),[X[1],X[2]],[q[1],q[2]],K,Y);return[Z.result,Z.indexes];case"AvgPool3D":var J=DR("strides",e,t,n),Q=DR("pad",e,t,n),$=DR("kernelSize",e,t,n);return[Jb(DR("x",e,t,n),[$[1],$[2],$[3]],[J[1],J[2],J[3]],Q)];case"MaxPool3D":var ee=DR("strides",e,t,n),te=DR("pad",e,t,n),ne=DR("kernelSize",e,t,n);return[Vk(DR("x",e,t,n),[ne[1],ne[2],ne[3]],[ee[1],ee[2],ee[3]],te)];case"Dilation2D":var re=DR("strides",e,t,n),ae=DR("pad",e,t,n),ie=DR("dilations",e,t,n),oe=re[1],se=re[2],ue=ie[1],ce=ie[2];return[eC(DR("x",e,t,n),DR("filter",e,t,n),[oe,se],ae,[ue,ce],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"creation":return Ib(function(){return function(e,t,n){switch(e.op){case"Fill":var r=DR("shape",e,t,n),a=DR("dtype",e,t,n);return[Sk(r,DR("value",e,t,n),a)];case"LinSpace":return[EA(DR("start",e,t,n),DR("stop",e,t,n),DR("num",e,t,n))];case"Multinomial":var i=DR("logits",e,t,n),o=DR("numSamples",e,t,n),s=DR("seed",e,t,n);return[_A(i,o,s)];case"OneHot":var u=DR("indices",e,t,n),c=DR("depth",e,t,n),l=DR("onValue",e,t,n),h=DR("offValue",e,t,n);return[rx(u,c,l,h)];case"Ones":return[ix(DR("shape",e,t,n),DR("dtype",e,t,n))];case"OnesLike":return[ox(DR("x",e,t,n))];case"RandomUniform":return[fx(DR("shape",e,t,n),DR("minval",e,t,n),DR("maxval",e,t,n),DR("dtype",e,t,n))];case"Range":return[Aw(DR("start",e,t,n),DR("stop",e,t,n),DR("step",e,t,n),DR("dtype",e,t,n))];case"TruncatedNormal":var p=DR("shape",e,t,n),f=DR("mean",e,t,n),d=DR("stdDev",e,t,n),v=DR("seed",e,t,n);return[Fx(p,f,d,DR("dtype",e,t,n),v)];case"Zeros":return[ax(DR("shape",e,t,n),DR("dtype",e,t,n))];case"ZerosLike":return[Px(DR("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"dynamic":return OA(e,t,r);case"evaluation":return Ib(function(){return function(e,t,n){switch(e.op){case"TopKV2":var r=DR("x",e,t,n),a=DR("k",e,t,n),i=DR("sorted",e,t,n),o=xC(r,a,i);return[o.values,o.indices];case"Unique":var s=DR("x",e,t,n),u=IC(s);return[u.values,u.indices];case"UniqueV2":var c=DR("x",e,t,n),l=DR("axis",e,t,n),h=IC(c,l);return[h.values,h.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"image":return Ib(function(){return function(e,t,n){switch(e.op){case"ResizeBilinear":var r=DR("images",e,t,n),a=DR("size",e,t,n),i=DR("alignCorners",e,t,n),o=DR("halfPixelCenters",e,t,n);return[jw.resizeBilinear(r,[a[0],a[1]],i,o)];case"ResizeNearestNeighbor":var s=DR("images",e,t,n),u=DR("size",e,t,n),c=DR("alignCorners",e,t,n),l=DR("halfPixelCenters",e,t,n);return[jw.resizeNearestNeighbor(s,[u[0],u[1]],c,l)];case"CropAndResize":var h=DR("image",e,t,n),p=DR("boxes",e,t,n),f=DR("boxInd",e,t,n),d=DR("cropSize",e,t,n),v=DR("method",e,t,n),m=DR("extrapolationValue",e,t,n);return[jw.cropAndResize(h,p,f,d,v,m)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"graph":return Ib(function(){return function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=DR("default",e,t,n);return[FR(e.name,t,n)||r];case"Placeholder":return[FR(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[zR(DR("x",e,t,n))];case"IdentityN":return DR("x",e,t,n).map(function(e){return zR(e)});case"Snapshot":return[zR(DR("x",e,t,n))];case"Shape":return[Ax(DR("x",e,t,n).shape,"int32")];case"ShapeN":return DR("x",e,t,n).map(function(e){return Ax(e.shape)});case"Size":return[_b(DR("x",e,t,n).size,"int32")];case"Rank":return[_b(DR("x",e,t,n).rank,"int32")];case"NoOp":return[_b(1)];case"Print":var a=DR("x",e,t,n),i=DR("data",e,t,n),o=DR("message",e,t,n),s=DR("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var u=0;u<i.length;u++)console.log(Array.prototype.slice.call(i[u].dataSync()).slice(0,s));return[a];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"logical":return Ib(function(){return function(e,t,n){switch(e.op){case"Equal":return[xk(DR("a",e,t,n),DR("b",e,t,n))];case"NotEqual":return[nx(DR("a",e,t,n),DR("b",e,t,n))];case"Greater":return[Ek(DR("a",e,t,n),DR("b",e,t,n))];case"GreaterEqual":return[_k(DR("a",e,t,n),DR("b",e,t,n))];case"Less":return[QN(DR("a",e,t,n),DR("b",e,t,n))];case"LessEqual":return[Rw(DR("a",e,t,n),DR("b",e,t,n))];case"LogicalAnd":return[zk(DR("a",e,t,n),DR("b",e,t,n))];case"LogicalNot":return[TS(DR("a",e,t,n))];case"LogicalOr":return[lC(DR("a",e,t,n),DR("b",e,t,n))];case"Select":case"SelectV2":return[Lx(DR("condition",e,t,n),DR("a",e,t,n),DR("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"matrices":return Ib(function(){return function(e,t,r){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[rw(DR("a",e,t,r),DR("b",e,t,r),DR("transposeA",e,t,r),DR("transposeB",e,t,r))];case"Transpose":return[zx(DR("x",e,t,r),DR("perm",e,t,r))];case"_FusedMatMul":var a=n(DR("fusedOps",e,t,r),2),i=a[0],o=a[1],s="biasadd"===i,u="prelu"===o,c=DR("numArgs",e,t,r),l=DR("leakyreluAlpha",e,t,r);if(s){if(u&&2!==c)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&1!==c)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var h=n(DR("args",e,t,r),2),p=h[0],f=h[1];return[aw({a:DR("a",e,t,r),b:DR("b",e,t,r),transposeA:DR("transposeA",e,t,r),transposeB:DR("transposeB",e,t,r),bias:p,activation:o,preluActivationWeights:f,leakyreluAlpha:l})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"normalization":return Ib(function(){return function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[$b(DR("x",e,t,n),DR("mean",e,t,n),DR("variance",e,t,n),DR("offset",e,t,n),DR("scale",e,t,n),DR("epsilon",e,t,n))];case"LRN":return[uC(DR("x",e,t,n),DR("radius",e,t,n),DR("bias",e,t,n),DR("alpha",e,t,n),DR("beta",e,t,n))];case"Softmax":return[Nx(DR("x",e,t,n))];case"LogSoftmax":return[Pk(DR("x",e,t,n))];case"SparseToDense":return[PA(DR("sparseIndices",e,t,n),DR("outputShape",e,t,n),DR("sparseValues",e,t,n),DR("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"reduction":return Ib(function(){return function(e,t,n){switch(e.op){case"Max":var r=DR("axis",e,t,n),a=DR("keepDims",e,t,n);return[Fk(DR("x",e,t,n),r,a)];case"Mean":var i=DR("axis",e,t,n),o=DR("keepDims",e,t,n);return[Uk(DR("x",e,t,n),i,o)];case"Min":var s=DR("axis",e,t,n),u=DR("keepDims",e,t,n);return[Hk(DR("x",e,t,n),s,u)];case"Sum":var c=DR("axis",e,t,n),l=DR("keepDims",e,t,n);return[Lk(DR("x",e,t,n),c,l)];case"All":var h=DR("axis",e,t,n),p=DR("keepDims",e,t,n);return[Fb(DR("x",e,t,n),h,p)];case"Any":var f=DR("axis",e,t,n),d=DR("keepDims",e,t,n);return[Ob(DR("x",e,t,n),f,d)];case"ArgMax":var v=DR("axis",e,t,n);return[Mb(DR("x",e,t,n),v)];case"ArgMin":var m=DR("axis",e,t,n);return[qS(DR("x",e,t,n),m)];case"Prod":var g=DR("axis",e,t,n),y=DR("keepDims",e,t,n);return[vC(DR("x",e,t,n),g,y)];case"Cumsum":var b=DR("axis",e,t,n),k=DR("exclusive",e,t,n),x=DR("reverse",e,t,n);return[wN(DR("x",e,t,n),b,k,x)];case"Bincount":var w=DR("x",e,t,n),I=DR("weights",e,t,n),N=DR("size",e,t,n);return[zA(w,I,N)];case"DenseBincount":var S=DR("x",e,t,n),C=DR("weights",e,t,n),T=DR("size",e,t,n),E=DR("binaryOutput",e,t,n);return[BA(S,C,T,E)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"slice_join":return Ib(function(){return function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var r=DR("n",e,t,n),a=DR("axis",e,t,n),i=DR("tensors",e,t,n);return i=i.slice(0,r),[ak(i,a)];case"Gather":var o=DR("x",e,t,n),s=DR("indices",e,t,n);return[Tk(o,Uy(s,"int32"),0)];case"GatherV2":var u=DR("axis",e,t,n),c=DR("batchDims",e,t,n),l=DR("x",e,t,n),h=DR("indices",e,t,n);return[Tk(l,Uy(h,"int32"),u,c)];case"Reverse":for(var p=DR("dims",e,t,n),f=[],d=0;d<p.length;d++)p[d]&&f.push(d);var v=DR("x",e,t,n);return[vx(v,f)];case"ReverseV2":var m=DR("axis",e,t,n),g=DR("x",e,t,n);return[vx(g,m)];case"Slice":var y=DR("begin",e,t,n),b=DR("size",e,t,n);return[bx(DR("x",e,t,n),y,b)];case"StridedSlice":var k=DR("begin",e,t,n),x=DR("end",e,t,n),w=DR("strides",e,t,n),I=DR("beginMask",e,t,n),N=DR("endMask",e,t,n),S=DR("ellipsisMask",e,t,n),C=DR("newAxisMask",e,t,n),T=DR("shrinkAxisMask",e,t,n),E=DR("x",e,t,n);return[bC(E,k,x,w,I,N,S,C,T)];case"Pack":return Ib(function(){var r=DR("axis",e,t,n),a=DR("tensors",e,t,n),i=a[0].shape,o=Ex(a[0]).shape,s=a.map(function(e){var t=Pf(e.shape,i);if(!t&&!Pf(Ex(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:Yb(e,i)});return[_x(s,r)]});case"Unpack":var _=DR("axis",e,t,n),R=DR("tensor",e,t,n);return Ox(R,_);case"Tile":var A=DR("reps",e,t,n);return[Ik(DR("x",e,t,n),A)];case"Split":case"SplitV":var D=DR("axis",e,t,n),F=DR("numOrSizeSplits",e,t,n),O=DR("x",e,t,n);return Cx(O,F,D);case"ScatterNd":var M=DR("indices",e,t,n),L=DR("values",e,t,n),P=DR("shape",e,t,n);return[VA(M,L,P)];case"GatherNd":var z=DR("x",e,t,n),B=DR("indices",e,t,n);return[WA(z,B)];case"SparseToDense":var V=DR("sparseIndices",e,t,n),W=DR("outputShape",e,t,n),U=DR("sparseValues",e,t,n),H=DR("defaultValue",e,t,n);return[PA(V,U,W,U.dtype===H.dtype?H:Uy(H,U.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"spectral":return Ib(function(){return function(e,t,n){switch(e.op){case"FFT":return[Ux(DR("x",e,t,n))];case"IFFT":return[jx(DR("x",e,t,n))];case"RFFT":return[Hx(DR("x",e,t,n))];case"IRFFT":return[Gx(DR("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"transformation":return Ib(function(){return function(e,t,n){switch(e.op){case"Cast":return[Uy(DR("x",e,t,n),DR("dtype",e,t,n))];case"ExpandDims":var r=DR("axis",e,t,n);return[wk(DR("x",e,t,n),r)];case"Squeeze":var a=DR("axis",e,t,n);return[Ex(DR("x",e,t,n),a)];case"Reshape":return[Yb(DR("x",e,t,n),DR("shape",e,t,n))];case"MirrorPad":return[pC(DR("x",e,t,n),DR("padding",e,t,n),DR("mode",e,t,n))];case"PadV2":case"Pad":return[sx(DR("x",e,t,n),DR("padding",e,t,n),DR("constantValue",e,t,n))];case"SpaceToBatchND":var i=DR("blockShape",e,t,n),o=DR("paddings",e,t,n);return[iN(DR("x",e,t,n),i,o)];case"BatchToSpaceND":var s=DR("blockShape",e,t,n),u=DR("crops",e,t,n);return[BS(DR("x",e,t,n),s,u)];case"DepthToSpace":var c=DR("blockSize",e,t,n),l=DR("dataFormat",e,t,n).toUpperCase();return[$S(DR("x",e,t,n),c,l)];case"BroadcastTo":return[Mx(DR("x",e,t,n),DR("shape",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,r)});case"hash_table":return LA(e,t,r,a);case"custom":var i=AR(e.op);if(i&&i.customExecutor)return i.customExecutor(new gA(e,t,r));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}}(e,t,r);return ld(i)?i.then(function(e){return[].concat(e)}):[].concat(i)}var HA=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};x(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return I(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map(function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)}).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function jA(e,t,n,r){var a=new Set,o=[],s=null,u=null,c=new Set,l=Object.keys(e).map(function(e){return LR(e)[0]}),h=[];null!=r&&(h=r.map(function(e){return LR(e.name)[0]}));for(var p=i(t);p.length>0;){var f=p.pop();if((XA(f)||YA(f)||ZA(f))&&null==s&&(u=(s=f).children.map(function(e){return e.name}).filter(function(e){return a.has(e)})),a.add(f.name),null==n[f.name]&&-1===l.indexOf(f.name)&&-1===h.indexOf(f.name)){if(0===f.inputs.length){o.push(f.name);continue}f.inputs.forEach(function(e){c.has(e.name)||(c.add(e.name),p.push(e))})}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:o,dynamicNode:s,syncInputs:u}}var GA=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],qA=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],KA=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function XA(e){return GA.indexOf(e.op)>=0}function YA(e){return qA.indexOf(e.op)>=0}function ZA(e){return KA.indexOf(e.op)>=0}var JA=function(){function e(t,n){var r=this;x(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach(function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)})}return I(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map(function(t){return e[t].map(function(e){return e.id})});this._weightIds=(t=[]).concat.apply(t,i(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})}},{key:"outputs",get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})}},{key:"inputNodes",get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})}},{key:"outputNodes",get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,n){return t[n]=e._functions[n].signature,t},{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map(function(e){return e.name}).sort(),r=t.map(function(e){return e.name}).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=jA(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map(function(e){return e.name}),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map(function(e){return LR(e)[0]}).map(function(t){return e.nodes[t]}),s=e.initNodes;o.forEach(function(e){r.has(e.name)&&i.push(e)}),e.weights.forEach(function(e){r.has(e.name)&&i.push(e)}),null!=s&&s.forEach(function(e){r.has(e.name)&&i.push(e)});for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach(function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every(function(e){return u.has(e.name)})&&i.push(e)})}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var r=this;e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(e){return r.graph.nodes[LR(e)[0]]}),o=t.map(function(e){return LR(e)[0]}),s=o.map(function(e){return r.graph.nodes[e]});0===s.length&&(s=this._outputs);var u=this.getCompilationKey(i,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));var l={},h={};return Ib(function(){var a=new HA(r.weightMap,l,h,r.functionExecutorMap),i=Object.assign({},r.weightMap);Object.keys(e).forEach(function(t){var r=n(LR(t),2),a=r[0],o=[];o[r[1]]=e[t],i[a]=o});for(var s=r.getFrozenTensorIds(i),u={},p=0;p<c.length;p++){var f=c[p];if(!i[f.name]){var d=UA(f,i,a,r._resourceManager);if(ld(d))throw new Error("The execution of the op '".concat(f.op,"' returned a promise. Please use model.executeAsync() instead."));i[f.name]=d,r.checkTensorForDisposal(f.name,f,i,a,s,o,u)}}return null==r.parent&&a.dispose(s),t.map(function(e){return FR(e,i,a)})})}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map(function(t){return e[t]}).map(function(e){return e.map(function(e){return e.id})}));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){"control"===t.category||-1!==i.indexOf(e)||(n[e].forEach(function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)}),t.inputs.forEach(function(e){if("control"!==e.category){var t=function(e,t,n){return t[MR(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach(function(e){if(e&&!a.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}})}}))}},{key:"executeAsync",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",n._executeAsync(e,t));case 1:case"end":return r.stop()}},r)}))()}},{key:"_executeAsync",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=this;return Sf(regeneratorRuntime.mark(function s(){var u,c,l,h,p,f;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n||(e=o.mapInputs(e),o.checkInputs(e),o.checkInputShapeAndType(e),t=o.mapOutputs(t),o.checkOutputs(t)),u=new HA(o.weightMap,r,a,o.functionExecutorMap),s.next=4,o.executeWithControlFlow(e,u,t,n);case 4:return c=s.sent,l=t.map(function(e){return FR(e,c,u)}),h=l.map(function(e){return e.id}),p=Object.keys(e).map(function(t){return e[t].id}),f=new Set([].concat(i(h),i(p),i(o.weightIds))),s.abrupt("return",(Object.keys(c).forEach(function(e){c[e].forEach(function(e){e&&!e.isDisposed&&!f.has(e.id)&&e.dispose()})}),null==o.parent&&u.dispose(f),l));case 10:case"end":return s.stop()}},s)}))()}},{key:"executeFunctionAsync",value:function(e,t,n){var r=this;return Sf(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=e.reduce(function(e,t,n){return e[r.inputs[n].name]=t,e},{}),a.abrupt("return",r._executeAsync(i,r.outputNodes,!0,t,n));case 2:case"end":return a.stop()}},a)}))()}},{key:"executeWithControlFlow",value:function(e,t,r,a){var o=this;return Sf(regeneratorRuntime.mark(function s(){var u,c,l,h,p,f,d,v,m,g,y,b,k,x,w,I,N;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:u=Object.keys(e),c=u.map(function(e){return o.graph.nodes[LR(e)[0]]}),l=r.map(function(e){return LR(e)[0]}),0===(h=l.map(function(e){return o.graph.nodes[e]})).length&&(h=o._outputs),p=jA(e,h,o.weightMap,o._initNodes),f=p.usedNodes,d=p.missingInputs,v=p.dynamicNode,m=p.syncInputs,g=[].concat(i(c),i(o.graph.weights),i(o._initNodes||[])).map(function(e){return{node:e,contexts:t.currentContext}}),y=Object.assign({},o.weightMap),Object.keys(e).forEach(function(t){var r=n(LR(t),2),a=r[0],i=[];i[r[1]]=e[t],y[a]=i}),b={},k=o.getFrozenTensorIds(y),x={};case 6:if(!(g.length>0)){s.next=12;break}return w=o.processStack(c,g,t,y,x,k,l,b,f),s.next=10,Promise.all(w);case 10:s.next=6;break;case 12:if(null==v&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((I=h.filter(function(e){return!XA(e)&&!FR(e.name,y,t)}).map(function(e){return e.name})).length>0)){s.next=17;break}throw N="",null!=v&&(N="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(m,"]")),new Error("Cannot compute the outputs [".concat(I,"] from the provided inputs [").concat(u,"]. Consider providing the following inputs: [").concat(d,"]. ").concat(N));case 17:return s.abrupt("return",y);case 18:case"end":return s.stop()}},s)}))()}},{key:"processStack",value:function(e,t,r,a,i,o,s,u,c){for(var l=this,h=[],p=function(){var e,p=t.pop();r.currentContext=p.contexts;var f="";if("Enter"===p.node.op&&DR("isConstant",p.node,a,r)&&(e=n(OR(p.node.name,r),1),f=e[0]),null==a[p.node.name]){var d,v=UA(p.node,a,r,l._resourceManager);f||(d=n(OR(p.node.name,r),1),f=d[0]);var m=r.currentContext;ld(v)?h.push(v.then(function(e){return a[f]=e,r.currentContext=m,l.checkTensorForDisposal(f,p.node,a,r,o,s,u),l.processChildNodes(p.node,t,r,a,i,c),e})):(a[f]=v,l.checkTensorForDisposal(f,p.node,a,r,o,s,u),l.processChildNodes(p.node,t,r,a,i,c))}else l.processChildNodes(p.node,t,r,a,i,c)};t.length>0;)p();return h}},{key:"processChildNodes",value:function(e,t,r,a,i,o){e.children.forEach(function(e){var s=n(OR(e.name,r),1)[0];i[s]||!o.has(e.name)||("Merge"===e.op?e.inputNames.some(function(e){return!!FR(e,a,r)})&&(i[s]=!0,t.push({contexts:r.currentContext,node:e})):e.inputNames.every(function(e){return!!FR(e,a,r)})&&(i[s]=!0,t.push({contexts:r.currentContext,node:e})))})}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(e){return e.dispose()})})}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach(function(r){var a=e[r],i=n(LR(r),1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value;Df(s.length===a.shape.length&&a.shape.every(function(e,t){return-1===s[t]||s[t]===e}),function(){return"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(a.shape,"]")})}o.attrParams.dtype&&o.attrParams.dtype.value&&Df(a.dtype===o.attrParams.dtype.value,function(){return"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(a.dtype)})})}},{key:"mapInputs",value:function(e){var t={};for(var n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}},{key:"checkInputs",value:function(e){var t=this,r=Object.keys(e).filter(function(e){var r=n(LR(e),1)[0];return null==t.graph.nodes[r]});if(r.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(r,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map(function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e},{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach(function(e){var r=n(LR(e),1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))})}}]),e}(),QA=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return I(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),$A="?tfjs-format=file",eD="model.json",tD=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",null==n&&(this.loadOptions={}),this.resourceManager=new QA}return I(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"findIOHandler",value:function(){var e=this,t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=eb(t,this.loadOptions);else{var n=function(t,n){return my.getLoadHandlers(t,e.loadOptions)}(t);if(0===n.length)n.push(eb(t,this.loadOptions));else if(n.length>1)throw new Error("Found more than one (".concat(n.length,") load handlers for URL '").concat([t],"'"));this.handler=n[0]}}},{key:"load",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.findIOHandler(),null!=e.handler.load){t.next=2;break}throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return t.next=4,e.handler.load();case 4:return n=t.sent,t.abrupt("return",e.loadSync(n));case 6:case"end":return t.stop()}},t)}))()}},{key:"loadSync",value:function(e){this.artifacts=e;var t,n=this.artifacts.modelTopology;t=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=t,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer);var r=function(e,t){var n,r,a={},i=0,o=s(t);try{for(o.s();!(r=o.n()).done;){var u=r.value,c=u.name,l=u.dtype,h=u.shape,p=Lf(h),f=void 0;if("quantization"in u){var d=u.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d)||!("scale"in d))throw new Error("Weight ".concat(u.name," with quantization ").concat(d.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(u.name," has unknown quantization dtype ").concat(d.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==l)throw new Error("Weight ".concat(u.name," is quantized with ").concat(d.dtype," which only supports weights of type float32 not ").concat(l,"."))}var v=sy[d.dtype],m=e.slice(i,i+p*v),g="uint8"===d.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===l)if("uint8"===d.dtype||"uint16"===d.dtype){f=new Float32Array(g.length);for(var y=0;y<g.length;y++)f[y]=g[y]*d.scale+d.min}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type float32."));void 0===n&&(n=vy()),f=n(g)}else{if("int32"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type int32."));f=new Int32Array(g.length);for(var b=0;b<g.length;b++)f[b]=Math.round(g[b]*d.scale+d.min)}i+=p*v}else if("string"===l){var k=Lf(u.shape);f=[];for(var x=0;x<k;x++){var w=new Uint32Array(e.slice(i,i+4))[0];i+=4;var I=new Uint8Array(e.slice(i,i+w));f.push(I),i+=w}}else{var N=sy[l],S=e.slice(i,i+p*N);if("float32"===l)f=new Float32Array(S);else if("int32"===l)f=new Int32Array(S);else if("bool"===l)f=new Uint8Array(S);else{if("complex64"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));f=new Float32Array(S);for(var C=new Float32Array(f.length/2),T=new Float32Array(f.length/2),E=0;E<C.length;E++)C[E]=f[2*E],T[E]=f[2*E+1];var _=oy(C,h,"float32"),R=oy(T,h,"float32");a[c]=ay(_,R),_.dispose(),R.dispose()}i+=p*N}"complex64"!==l&&(a[c]=oy(f,h,l))}}catch(A){o.e(A)}finally{o.f()}return a}(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new JA(nA.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var a=nA.Instance.transformGraph(e.modelInitializer);this.initializer=new JA(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof e){t.next=7;break}if(0!==(r=gy(e)).length){t.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));case 4:if(!(r.length>1)){t.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(e,"'"));case 6:e=r[0];case 7:if(null!=e.save){t.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return t.abrupt("return",e.save(n.artifacts));case 10:case"end":return t.stop()}},t)}))()}},{key:"predict",value:function(e,t){return this.execute(e,this.outputNodes)}},{key:"normalizeInputs",value:function(e){if(!(e instanceof Rg||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has ".concat(this.inputNodes.length," placeholders, while there are ").concat(e.length," input tensors."));return this.inputNodes.reduce(function(t,n,r){return t[n]=e[r],t},{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(e,t){var n=this;return Sf(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e=n.normalizeInputs(e),t=n.normalizeOutputs(t),r.next=3,n.executor.executeAsync(e,t);case 3:return a=r.sent,r.abrupt("return",a.length>1?a:a[0]);case 5:case"end":return r.stop()}},r)}))()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}]),e}();function nD(){return(nD=Sf(regeneratorRuntime.mark(function e(t){var n,r,a=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},null!=t){e.next=3;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 3:return null==n&&(n={}),n.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t="".concat(t).concat(eD).concat($A)),r=new tD(t,n),e.next=7,r.load();case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rD(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&Df("complex64"!==e.dtype,function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")})})}Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");var aD=WI,iD=function(){var e=function(e){d(n,e);var t=m(n);function n(){var e;return x(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new Cf(y(e),xb()),e}return I(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,fd().get("IS_NODE")&&SI("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Zf(n[0])){var a=n.map(function(e){return yg(e)});r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.readSync(e));case 1:case"end":return n.stop()}},n)}))()}},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?TI(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return bg(e)})}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return Wy(e.shape,e.dtype,n)}},{key:"makeOutput",value:function(e,t,n){var r=this.write(e,t,n);return xb().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e),r=n.complexTensorInfos;null!=r&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(e){return Sf(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=gg(),t.abrupt("return",(e(),{kernelMs:gg()-n}));case 2:case"end":return t.stop()}},t)}))()}},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){rD([e],"where");var t=this.readSync(e.dataId);return aD(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return p(k(n.prototype),"epsilon",this).call(this)}}]),n}(Tf);return e.nextDataId=0,e}();function oD(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(rD(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=Lf(s.shape),h=n||s.dtype,p=qf(h,l),f=0;f<l;++f)p[f]=t(c[f],i);return u.makeTensorInfo(s.shape,h,p)}}function sD(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(rD(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,h=t(c,l,i);return u.makeTensorInfo(s.shape,l,h)}}Tb("cpu",function(){return new iD},1);var uD=oD(uv,function(e){return e>=0?e:Math.exp(e)-1}),cD={kernelName:uv,backendName:"cpu",kernelFunc:uD};function lD(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var hD={kernelName:Nv,backendName:"cpu",kernelFunc:lD};function pD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;rD([a],"leakyRelu");for(var o=Lf(a.shape),s=n.data.get(a.dataId).values,u=Gf("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var fD={kernelName:Rv,backendName:"cpu",kernelFunc:pD};function dD(e){return function(t,n,r,a,i){var o=kk(t,n),s=o.length,u=td(o),c=Gf(i,Lf(o)),l=t.length,h=n.length,p=td(t),f=td(n),d=yk(t,o),v=yk(n,o);if(d.length+v.length===0)for(var m=0;m<c.length;++m)c[m]=e(r[m%r.length],a[m%a.length]);else for(var g=function(t){var n=cd(t,s,u),i=n.slice(-l);d.forEach(function(e){return i[e]=0});var o=ud(i,l,p),m=n.slice(-h);v.forEach(function(e){return m[e]=0});var g=ud(m,h,f);c[t]=e(r[o],a[g])},y=0;y<c.length;++y)g(y);return[c,o]}}var vD=dD(function(e,t){return e<0?t*e:e});function mD(e){var t=e.inputs,r=e.backend,a=t.x,i=t.alpha;rD([a,i],"prelu");var o=r.data.get(a.dataId).values,s=r.data.get(i.dataId).values,u=n(vD(a.shape,i.shape,o,s,a.dtype),2),c=u[0],l=u[1];return r.makeTensorInfo(l,a.dtype,c)}var gD={kernelName:hm,backendName:"cpu",kernelFunc:mD},yD=oD(mm,function(e){return Math.max(0,e)}),bD={kernelName:mm,backendName:"cpu",kernelFunc:yD},kD=oD(wm,function(e){return Math.min(Math.max(0,e),6)}),xD={kernelName:wm,backendName:"cpu",kernelFunc:kD};function wD(e,t,n,r,a){if("linear"===n)return lD({inputs:{x:t},backend:e});if("relu"===n)return yD({inputs:{x:t},backend:e});if("elu"===n)return uD({inputs:{x:t},backend:e});if("relu6"===n)return kD({inputs:{x:t},backend:e});if("prelu"===n)return mD({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return pD({inputs:{x:t},backend:e,attrs:{alpha:a}});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function ID(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var ND={kernelName:Vd,backendName:"cpu",kernelFunc:ID};function SD(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return ID({inputs:{real:SD(e,t,"float32"),imag:SD(e,t,"float32")},backend:e});var r=id(Lf(t),n);return e.makeTensorInfo(t,n,r)}function CD(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var TD={kernelName:dm,backendName:"cpu",kernelFunc:CD};function ED(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return lD({inputs:{x:i},backend:r});var s=SD(r,i.shape,i.dtype),u=ED({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=ID({inputs:{real:u,imag:s},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=CD({inputs:{input:i},backend:r}),h=ED({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),h}if(!Kf(i.dtype,o)){var p=lD({inputs:{x:i},backend:r});return{dataId:p.dataId,shape:p.shape,dtype:o}}if("int32"===o){var f=r.data.get(i.dataId).values,d=Int32Array.from(f);return r.makeTensorInfo(i.shape,"int32",d)}if("bool"===o){var v=r.data.get(i.dataId).values,m=mg([0],i.dtype),g=n(dD(function(e,t){return e!==t?1:0})(i.shape,[],v,m,"bool"),2),y=g[0],b=g[1];return r.makeTensorInfo(b,"bool",y)}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}var _D={kernelName:Pd,backendName:"cpu",kernelFunc:ED};function RD(e,t,r,a){return null==r?function(r){var i=r.inputs,o=r.backend,s=i.a,u=i.b,c=o;rD([s,u],e);var l=c.data.get(s.dataId).values,h=c.data.get(u.dataId).values,p=a||s.dtype,f=n(t(s.shape,u.shape,l,h,p),2),d=f[0],v=f[1];return c.makeTensorInfo(v,p,d)}:function(e){var i=e.inputs,o=e.backend,s=i.a,u=i.b,c=o;if("complex64"===s.dtype||"complex64"===u.dtype){var l=ED({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),h=c.data.get(l.dataId),p=h.complexTensorInfos.imag,f=c.data.get(h.complexTensorInfos.real.dataId).values,d=c.data.get(p.dataId).values,v=ED({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),m=c.data.get(v.dataId),g=m.complexTensorInfos.imag,y=c.data.get(m.complexTensorInfos.real.dataId).values,b=c.data.get(g.dataId).values,k=n(r(s.shape,u.shape,f,d,y,b),3),x=k[0],w=k[1],I=k[2],N=c.makeTensorInfo(I,"float32",x),S=c.makeTensorInfo(I,"float32",w),C=ID({inputs:{real:N,imag:S},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(N),c.disposeIntermediateTensorInfo(S),C}var T=c.data.get(s.dataId).values,E=c.data.get(u.dataId).values,_=a||s.dtype,R=n(t(s.shape,u.shape,T,E,_),2),A=R[0],D=R[1];return c.makeTensorInfo(D,_,A)}}function AD(e){return function(t,n,r,a,i,o){var s=kk(t,n),u=Lf(s),c=s.length,l=td(s),h=Gf("float32",u),p=Gf("float32",u),f=yk(t,s),d=yk(n,s),v=TI(r,a),m=TI(i,o),g=t.length,y=td(t),b=n.length,k=td(n);if(f.length+d.length===0)for(var x=0;x<h.length;x++){var w=x%v.length,I=x%m.length,N=e(v[2*w],v[2*w+1],m[2*I],m[2*I+1]);h[x]=N.real,p[x]=N.imag}else for(var S=function(t){var n=cd(t,c,l),r=n.slice(-g);f.forEach(function(e){return r[e]=0});var a=ud(r,g,y),i=n.slice(-b);d.forEach(function(e){return i[e]=0});var o=ud(i,b,k),s=e(v[2*a],v[2*a+1],m[2*o],m[2*o+1]);h[t]=s.real,p[t]=s.imag},C=0;C<h.length;C++)S(C);return[h,p,s]}}var DD=dD(function(e,t){return e+t}),FD=AD(function(e,t,n,r){return{real:e+n,imag:t+r}}),OD=RD(xd,DD,FD),MD={kernelName:xd,backendName:"cpu",kernelFunc:OD};function LD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=Lf(a.shape),s=Uf(i,o),u=Lf(s);Df(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(o," elements. The new shape and old shape must have the same number of elements.")}),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.imag;c.complexTensorInfos.real.shape=s,l.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var PD={kernelName:gm,backendName:"cpu",kernelFunc:LD};function zD(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.a,o=t.b,s=a.transposeA,u=a.transposeB;rD([i,o],"matMul");var c=i.shape.length,l=o.shape.length,h=s?i.shape[c-2]:i.shape[c-1],p=u?o.shape[l-1]:o.shape[l-2],f=s?i.shape[c-1]:i.shape[c-2],d=u?o.shape[l-2]:o.shape[l-1],v=i.shape.slice(0,-2),m=o.shape.slice(0,-2),g=Lf(v),y=Lf(m);Df(c>=2&&l>=2&&(g===y||1===g||1===y),function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(v,") and (").concat(m,").")});var b=(g>y?i.shape.slice(0,-2):o.shape.slice(0,-2)).concat([f,d]);Df(h===p,function(){return"Error in matMul: inner shapes (".concat(h,") and (").concat(p,") of Tensors with shapes ").concat(i.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(u," must match.")});for(var k=u?[y,d,p]:[y,p,d],x=LD({inputs:{x:i},backend:r,attrs:{shape:s?[g,h,f]:[g,f,h]}}),w=LD({inputs:{x:o},backend:r,attrs:{shape:k}}),I=s?x.shape[1]:x.shape[2],N=s?x.shape[2]:x.shape[1],S=u?w.shape[1]:w.shape[2],C=Math.max(g,y),T=r.data.get(x.dataId).values,E=r.data.get(w.dataId).values,_=td(x.shape),R=td(w.shape),A=n(s?[_[0],1,_[1]]:[_[0],_[1],1],3),D=A[0],F=A[1],O=A[2],M=n(u?[1,R[1],R[0]]:[R[1],1,R[0]],3),L=M[0],P=M[1],z=M[2],B=N*S,V=Wy([C,N,S],x.dtype),W=V.values,U=r.blockSize,H=0;H<C;H++)for(var j=0;j<N;j+=U)for(var G=0;G<S;G+=U)for(var q=0;q<I;q+=U)for(var K=Math.min(j+U,N),X=Math.min(G+U,S),Y=Math.min(q+U,I),Z=j;Z<K;Z++)for(var J=G;J<X;J++){for(var Q=0,$=q;$<Y;$++){var ee=Math.min(H,g-1)*D,te=Math.min(H,y-1)*z;Q+=T[ee+Z*F+$*O]*E[$*L+J*P+te]}W[H*B+(Z*S+J)]+=Q}return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(w),r.makeTensorInfo(b,V.dtype,V.values)}var BD={kernelName:Od,backendName:"cpu",kernelFunc:zD},VD={kernelName:ag,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,h=o.transposeA,p=o.transposeB,f=o.activation,d=o.leakyreluAlpha,v=[];t=zD({inputs:{a:s,b:u},attrs:{transposeA:h,transposeB:p},backend:i}),c&&(n=OD({inputs:{a:t,b:c},backend:i}),v.push(t),t=n),f&&(r=wD(i,t,f,l,d),v.push(t),t=r);for(var m=0,g=v;m<g.length;m++){var y=g[m];i.disposeIntermediateTensorInfo(y)}return t}};function WD(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var UD={kernelName:yd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;rD(t,"abs");var r=new Float32Array(Lf(t.shape));return r=WD(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,"float32")}},HD=oD(bd,function(e){return Math.acos(e)}),jD={kernelName:bd,backendName:"cpu",kernelFunc:HD},GD=oD(kd,function(e){return Math.acosh(e)}),qD={kernelName:kd,backendName:"cpu",kernelFunc:GD},KD={kernelName:wd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;rD(t,"addN");for(var a=r.map(function(e){return n.data.get(e.dataId).values}),i=Wy(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function XD(e,t,n,r,a){for(var i=t.length,o=Lf(t),s=td(t),u=td(a),c=Gf(n,Lf(a)),l=0;l<o;++l){for(var h=cd(l,i,s),p=new Array(h.length),f=0;f<p.length;f++)p[f]=h[r[f]];c[ud(p,i,u)]=e[l]}return c}function YD(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;rD(a,"transpose");for(var o=new Array(a.shape.length),s=0;s<o.length;s++)o[s]=a.shape[i[s]];var u=XD(r.data.get(a.dataId).values,a.shape,a.dtype,i,o);return{dataId:r.write(u,o,a.dtype),shape:o,dtype:a.dtype}}var ZD={kernelName:Zm,backendName:"cpu",kernelFunc:YD},JD={kernelName:"All",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims;rD(i,"all");var u=Hf(o,i.shape),c=u,l=Zk(c,i.shape.length),h=i;null!=l&&(h=YD({inputs:{x:i},backend:r,attrs:{perm:l}}),c=Qk(c.length,i.shape.length)),Yk("all",c,h.shape.length);for(var p=n(Kk(h.shape,c),2),f=p[0],d=Lf(p[1]),v=id(Lf(f),h.dtype),m=r.data.get(h.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],k=0;k<d;++k){var x=m[y+k];b=b&&x}v[g]=b}null!=l&&r.disposeIntermediateTensorInfo(h);var w=r.makeTensorInfo(f,h.dtype,v);if(s){var I=LD({inputs:{x:w},backend:r,attrs:{shape:Xk(f,u)}});return r.disposeIntermediateTensorInfo(w),I}return w}},QD={kernelName:"Any",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims;rD(i,"any");var u=Hf(o,i.shape),c=u,l=Zk(c,i.shape.length),h=i;null!=l&&(h=YD({inputs:{x:i},backend:r,attrs:{perm:l}}),c=Qk(c.length,i.shape.length)),Yk("any",c,h.shape.length);for(var p=n(Kk(h.shape,c),2),f=p[0],d=Lf(p[1]),v=id(Lf(f),h.dtype),m=r.data.get(h.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],k=0;k<d;++k){var x=m[y+k];b=b||x}v[g]=b}null!=l&&r.disposeIntermediateTensorInfo(h);var w=r.makeTensorInfo(f,h.dtype,v);if(s){var I=LD({inputs:{x:w},backend:r,attrs:{shape:Xk(f,u)}});return r.disposeIntermediateTensorInfo(w),I}return w}},$D={kernelName:Id,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis;rD(i,"argMax");var s=Hf(o,i.shape),u=Zk(s,i.shape.length),c=i,l=[];null!=u&&(c=YD({inputs:{x:i},backend:r,attrs:{perm:u}}),l.push(c),s=Qk(s.length,c.shape.length)),Yk("argMax",s=[s[0]],c.shape.length);for(var h=n(Kk(c.shape,s),2),p=h[0],f=h[1],d=id(Lf(p),"int32"),v=Lf(f),m=r.data.get(c.dataId).values,g=0;g<d.length;++g){for(var y=g*v,b=m[y],k=0,x=0;x<v;++x){var w=m[y+x];w>b&&(b=w,k=x)}d[g]=k}return l.forEach(function(e){return r.disposeIntermediateTensorInfo(e)}),r.makeTensorInfo(p,"int32",d)}},eF={kernelName:Nd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis;rD(i,"argMin");var s=Hf(o,i.shape),u=Zk(s,i.shape.length),c=i,l=[];null!=u&&(c=YD({inputs:{x:i},backend:r,attrs:{perm:u}}),l.push(c),s=Qk(s.length,c.shape.length)),Yk("argMin",s=[s[0]],c.shape.length);for(var h=n(Kk(c.shape,s),2),p=h[0],f=h[1],d=id(Lf(p),"int32"),v=Lf(f),m=r.data.get(c.dataId).values,g=0;g<d.length;++g){for(var y=g*v,b=m[y],k=0,x=0;x<v;++x){var w=m[y+x];w<b&&(b=w,k=x)}d[g]=k}return l.forEach(function(e){return r.disposeIntermediateTensorInfo(e)}),r.makeTensorInfo(p,"int32",d)}},tF=oD(Sd,function(e){return Math.asin(e)}),nF={kernelName:Sd,backendName:"cpu",kernelFunc:tF},rF=oD(Cd,function(e){return Math.asinh(e)}),aF={kernelName:Cd,backendName:"cpu",kernelFunc:rF},iF=oD(Td,function(e){return Math.atan(e)}),oF={kernelName:Td,backendName:"cpu",kernelFunc:iF},sF=dD(function(e,t){return Math.atan2(e,t)}),uF=RD(_d,sF),cF={kernelName:_d,backendName:"cpu",kernelFunc:uF},lF=oD(Ed,function(e){return Math.atanh(e)}),hF={kernelName:Ed,backendName:"cpu",kernelFunc:lF};function pF(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,h=a.effectiveFilterWidth,p=a.padInfo.top,f=a.padInfo.left,d="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Wy(a.outShape,n),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],k=0;k<a.batchSize;++k)for(var x=k*g,w=k*r[0],I=0;I<a.inChannels;++I)for(var N=0;N<a.outHeight;++N)for(var S=N*o-p,C=Math.max(0,S),T=Math.min(a.inHeight,l+S),E=x+N*y,_=0;_<a.outWidth;++_){for(var R=_*s-f,A=Math.max(0,R),D=Math.min(a.inWidth,h+R),F=d,O=0,M=0,L=C;L<T;L+=u){for(var P=w+L*r[1],z=A;z<D;z+=c){var B=e[P+z*r[2]+I];"max"===i&&B>F?F=B:"avg"===i&&(O+=B,M++)}if(isNaN(F))break}m[E+_*b+I]="avg"===i?O/M:F}return v}function fF(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Wy(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,d=r.padInfo.left,v=Wy(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-f,k=b;k<0;)k+=c;for(var x=Math.min(r.inHeight,h+b),w=0;w<r.outWidth;++w){for(var I=w*u-d,N=I;N<0;)N+=l;for(var S=Math.min(r.inWidth,p+I),C=Number.NEGATIVE_INFINITY,T=-1,E=k;E<x;E+=c)for(var _=E-b,R=N;R<S;R+=l){var A=R-I,D=v.get(m,E,R,g);D>C&&(C=D,T=a?i?((m*r.inHeight+E)*r.inWidth+R)*r.inChannels+g:(E*r.inWidth+R)*r.inChannels+g:_*p+A)}o.set(T,m,y,w,g)}}return o}function dF(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,h=a.dilationWidth,p=a.effectiveFilterDepth,f=a.effectiveFilterHeight,d=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Wy(a.outShape,n),k=b.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],I=a.outShape[3]*a.outShape[4],N=a.outShape[4],S=0;S<a.batchSize;++S)for(var C=S*x,T=S*r[0],E=0;E<a.inChannels;++E)for(var _=0;_<a.outDepth;++_){for(var R=_*o-v,A=R;A<0;)A+=c;for(var D=Math.min(a.inDepth,p+R),F=C+_*w,O=0;O<a.outHeight;++O){for(var M=O*s-m,L=M;L<0;)L+=l;for(var P=Math.min(a.inHeight,f+M),z=F+O*I,B=0;B<a.outWidth;++B){for(var V=B*u-g,W=V;W<0;)W+=h;for(var U=Math.min(a.inWidth,d+V),H=z+B*N,j=y,G=0,q=0,K=A;K<D;K+=c){for(var X=T+K*r[1],Y=L;Y<P;Y+=l){for(var Z=X+Y*r[2],J=W;J<U;J+=h){var Q=e[Z+J*r[3]+E];if("max"===i&&Q>j?j=Q:"avg"===i&&(G+=Q,q++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}k[H+E]="avg"===i?G/q:j}}}return b}var vF={kernelName:Rd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;rD(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Df(Kb(o,1),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '1'")});var c,l=Pb(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Pf(l.inShape,l.outShape))c=lD({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,p=td(a.shape),f=pF(h,0,a.dtype,p,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}},mF={kernelName:Dd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;rD(a,"avgPool3d");var l=zb(a.shape,i,o,1,s,u,c),h=dF(n.data.get(a.dataId).values,0,a.dtype,td(a.shape),l,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}},gF={kernelName:Fd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;rD([a,i],"avgPool3DGrad");for(var l=zb(i.shape,o,s,1,u,c),h=l.strideDepth,p=l.strideHeight,f=l.strideWidth,d=l.filterDepth,v=l.filterHeight,m=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,k=l.effectiveFilterDepth,x=l.effectiveFilterHeight,w=l.effectiveFilterWidth,I=k-1-l.padInfo.front,N=w-1-l.padInfo.left,S=x-1-l.padInfo.top,C=Wy(i.shape,"float32"),T=1/(d*v*m),E=n.bufferSync(a),_=0;_<l.batchSize;++_)for(var R=0;R<l.inChannels;++R)for(var A=0;A<l.inDepth;++A)for(var D=0;D<l.inHeight;++D)for(var F=0;F<l.inWidth;++F){for(var O=A-I,M=D-S,L=F-N,P=0,z=0;z<k;z+=g){var B=(O+z)/h;if(!(B<0||B>=l.outDepth||Math.floor(B)!==B))for(var V=0;V<x;V+=y){var W=(M+V)/p;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var U=0;U<w;U+=b){var H=(L+U)/f;H<0||H>=l.outWidth||Math.floor(H)!==H||(P+=E.get(_,B,W,H,R))}}}C.set(P*T,_,A,D,F,R)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}},yF={kernelName:Ad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;rD([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=Pb(o.shape,s,u,1,c),h=l.strideHeight,p=l.strideWidth,f=l.filterHeight,d=l.filterWidth,v=l.dilationHeight,m=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,k=g-1-l.padInfo.top,x=Wy(o.shape,"float32"),w=1/(f*d),I=n.data.get(a.dataId).values,N=Wy(a.shape,"float32",I),S=0;S<l.batchSize;++S)for(var C=0;C<l.inChannels;++C)for(var T=0;T<l.inHeight;++T)for(var E=0;E<l.inWidth;++E){for(var _=T-k,R=E-b,A=0,D=0;D<g;D+=v){var F=(_+D)/h;if(!(F<0||F>=l.outHeight||Math.floor(F)!==F))for(var O=0;O<y;O+=m){var M=(R+O)/p;M<0||M>=l.outWidth||Math.floor(M)!==M||(A+=N.get(S,F,M,C))}}x.set(A*w,S,T,E,C)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},bF={kernelName:bv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;Df(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Df(null==o||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Df(null==i||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),rD([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,p=n.data.get(u.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),d=o?n.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(l.length),m=d.length,g=f.length,y=p.length,b=h.length,k=0,x=0,w=0,I=0,N=0;N<l.length;++N)v[N]=d[k++]+(l[N]-h[x++])*f[w++]/Math.sqrt(p[I++]+c),k>=m&&(k=0),x>=b&&(x=0),w>=g&&(w=0),I>=y&&(I=0);return n.makeTensorInfo(a.shape,a.dtype,v)}};function kF(e,t,n,r,a){var o=db(r,t,n),s=Lf(n),u=td(r);if(o){var c=vb(t,u);return"string"===a?e.slice(c,c+s):e.subarray(c,c+s)}for(var l=Wy(r,a,"string"===a?BI(e):e),h=Wy(n,a),p=0;p<h.size;++p){var f=h.indexToLoc(p),d=f.map(function(e,n){return e+t[n]});h.set.apply(h,[l.get.apply(l,i(d))].concat(i(f)))}return"string"===a?VI(h.values):h.values}function xF(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.begin,s=a.size;rD(i,"slice");var u=n(mb(i,o,s),2),c=u[0],l=u[1];nb(i,c,l);var h=kF(r.data.get(i.dataId).values,c,l,i.shape,i.dtype);return r.makeTensorInfo(l,i.dtype,h)}var wF={kernelName:_m,backendName:"cpu",kernelFunc:xF},IF={kernelName:Md,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;rD([a],"batchToSpaceND");var s=i.reduce(function(e,t){return e*t}),u=uI(a.shape,i,s),c=cI(u.length,i.length),l=lI(a.shape,i,s),h=hI(o,i.length),p=pI(l,o,i.length),f=LD({inputs:{x:a},backend:n,attrs:{shape:u}}),d=YD({inputs:{x:f},backend:n,attrs:{perm:c}}),v=LD({inputs:{x:d},backend:n,attrs:{shape:l}}),m=xF({inputs:{x:v},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(v),m}};function NF(e,t,n,r,a){for(var i=Lf(r),o=id(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function SF(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=Wy([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||o.set(r?1:t.size>0?o.get(s,c)+t.get(s,u):o.get(s,c)+1,s,c)}return o}var CF={kernelName:Ld,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=NF(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};function TF(e){return function(t,n,r){for(var a=Gf(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}var EF=TF(function(e){return Math.ceil(e)}),_F=sD(zd,EF),RF={kernelName:zd,backendName:"cpu",kernelFunc:_F},AF=oD(Bd,function(e,t){return e>t.clipValueMax?t.clipValueMax:e<t.clipValueMin?t.clipValueMin:e}),DF={kernelName:Bd,backendName:"cpu",kernelFunc:AF},FF={kernelName:Wd,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Lf(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.imag,o=n.data.get(a.complexTensorInfos.real.dataId).values,s=n.data.get(i.dataId).values,u=0;u<o.length;u++)r[u]=Math.hypot(o[u],s[u]);return n.makeOutput(r,t.shape,"float32")}};function OF(e,t,n,r){var a=qf(n,Lf(t));if(r&&"string"!==n){var i=0;e.forEach(function(e){var t=Lf(e.shape);a.set(e.vals,i),i+=t})}else{var o=0;e.forEach(function(e){for(var r="string"===n?BI(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]})}return a}function MF(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var LF={kernelName:Cv,backendName:"cpu",kernelFunc:MF};function PF(e){var t=e.inputs,n=e.backend,r=Hf(e.attrs.axis,t[0].shape)[0],a=aI(t.map(function(e){return e.shape}),r);if(0===Lf(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter(function(e){return Lf(e.shape)>0});if(1===i.length)return lD({inputs:{x:i[0]},backend:n});if(rI(i.map(function(e){return e.shape}),r),"complex64"===i[0].dtype){var o=i.map(function(e){return CD({inputs:{input:e},backend:n})}),s=i.map(function(e){return MF({inputs:{input:e},backend:n})}),u=PF({inputs:o,backend:n,attrs:{axis:r}}),c=PF({inputs:s,backend:n,attrs:{axis:r}}),l=ID({inputs:{real:u,imag:c},backend:n});return o.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),s.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}var h=i.map(function(e){var t=Lf(e.shape.slice(r));return LD({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),p=OF(h.map(function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}),a=aI(h.map(function(e){return e.shape}),1),t[0].dtype,1===h[0].shape[0]),f=aI(i.map(function(e){return e.shape}),r),d=n.makeTensorInfo(f,t[0].dtype,p);return h.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),d}var zF={kernelName:Ud,backendName:"cpu",kernelFunc:PF};function BF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;rD([a,i],"conv2d");for(var h=Xb(u),p=Bb(a.shape,i.shape,o,c,s,l,!1,h),f=p.filterHeight,d=p.filterWidth,v=p.dilationHeight,m=p.dilationWidth,g=p.padInfo.left,y=p.padInfo.top,b="channelsLast"===p.dataFormat,k=new Tg(p.outShape,a.dtype),x=td(a.shape),w=td(i.shape),I=x[0],N=b?x[1]:x[2],S=b?x[2]:1,C=b?1:x[1],T=k.strides[0],E=b?k.strides[1]:k.strides[2],_=b?k.strides[2]:1,R=b?1:k.strides[1],A=n.data.get(a.dataId).values,D=n.data.get(i.dataId).values,F=k.values,O=0;O<p.batchSize;++O)for(var M=O*I,L=O*T,P=0;P<p.outHeight;++P)for(var z=L+P*E,B=P*p.strideHeight-y,V=0;V<f;++V){var W=B+V*v;if(!(W<0||W>=p.inHeight))for(var U=V*w[0],H=M+W*N,j=0;j<p.outWidth;++j)for(var G=z+j*_,q=j*p.strideWidth-g,K=0;K<d;++K){var X=q+K*m;if(!(X<0||X>=p.inWidth))for(var Y=H+X*S,Z=U+K*w[1],J=0;J<p.inChannels;++J){for(var Q=A[Y+J*C],$=0;$<p.outChannels;++$)F[G+$*R]+=Q*D[Z+$];Z+=p.outChannels}}}return n.makeTensorInfo(k.shape,k.dtype,F)}var VF={kernelName:Hd,backendName:"cpu",kernelFunc:BF},WF={kernelName:jd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;rD([a,i],"conv2dBackpropFilter");for(var h=Xb(u),p=Bb(a.shape,l,o,1,s,c,!1,h),f=p.strideHeight,d=p.strideWidth,v=p.filterHeight,m=p.filterWidth,g="channelsLast"===p.dataFormat,y=new Tg(p.filterShape,"float32"),b=p.padInfo.left,k=p.padInfo.top,x=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=new Tg(a.shape,a.dtype,x),N=new Tg(i.shape,i.dtype,w),S=0;S<v;++S)for(var C=Math.max(0,Math.ceil((k-S)/f)),T=Math.min(p.outHeight,(p.inHeight+k-S)/f),E=0;E<m;++E)for(var _=Math.max(0,Math.ceil((b-E)/d)),R=Math.min(p.outWidth,(p.inWidth+b-E)/d),A=0;A<p.inChannels;++A)for(var D=0;D<p.outChannels;++D){for(var F=0,O=0;O<p.batchSize;++O)for(var M=C;M<T;++M)for(var L=S+M*f-k,P=_;P<R;++P){var z=E+P*d-b;F+=g?I.get(O,L,z,A)*N.get(O,M,P,D):I.get(O,A,L,z)*N.get(O,D,M,P)}y.set(F,S,E,A,D)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},UF={kernelName:Gd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.inputShape,u=a.strides,c=a.pad,l=a.dataFormat,h=a.dimRoundingMode;rD([i,o],"conv2dBackpropInput");var p=td(o.shape),f=td(i.shape),d=Xb(l),v=Bb(s,o.shape,u,1,c,h,!1,d),m=new Tg(v.inShape,"float32"),g=m.values,y=r.data.get(i.dataId).values,b=r.data.get(o.dataId).values,k=n(p,3),x=k[0],w=k[1],I=k[2],N=v.batchSize,S=v.filterHeight,C=v.filterWidth,T=v.inChannels,E=v.inHeight,_=v.inWidth,R=v.outChannels,A=v.outHeight,D=v.outWidth,F=v.strideHeight,O=v.strideWidth;d=v.dataFormat;for(var M=S-1-v.padInfo.top,L=C-1-v.padInfo.left,P="channelsLast"===d,z=m.strides[0],B=P?m.strides[1]:m.strides[2],V=P?m.strides[2]:1,W=P?1:m.strides[1],U=f[0],H=P?f[1]:f[2],j=P?f[2]:1,G=P?1:f[1],q=0;q<N;++q)for(var K=0;K<T;++K)for(var X=0;X<E;++X)for(var Y=X-M,Z=Math.max(0,Math.ceil(Y/F)),J=Math.min(A,(S+Y)/F),Q=0;Q<_;++Q){for(var $=Q-L,ee=Math.max(0,Math.ceil($/O)),te=Math.min(D,(C+$)/O),ne=0,re=Z;re<J;++re)for(var ae=re*F-Y,ie=ee;ie<te;++ie)for(var oe=U*q+H*re+j*ie,se=x*(S-1-ae)+w*(C-1-(ie*O-$))+I*K,ue=0;ue<R;++ue)ne+=y[oe+G*ue]*b[se+ue];g[z*q+B*X+V*Q+W*K]=ne}return r.makeTensorInfo(m.shape,m.dtype,m.values)}},HF={kernelName:qd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;rD([a,i],"conv3d");for(var c=Vb(a.shape,i.shape,o,u,s),l=c.filterDepth,h=c.filterHeight,p=c.filterWidth,f=c.dilationDepth,d=c.dilationHeight,v=c.dilationWidth,m=c.padInfo,g=m.front,y=m.left,b=m.top,k=new Tg(c.outShape,a.dtype),x=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=k.values,N=td(a.shape),S=td(i.shape),C=0;C<c.batchSize;++C)for(var T=C*N[0],E=C*k.strides[0],_=0;_<c.outDepth;++_)for(var R=E+_*k.strides[1],A=_*c.strideDepth-g,D=0;D<l;++D){var F=A+D*f;if(!(F<0||F>=c.inDepth))for(var O=D*S[0],M=T+F*N[1],L=0;L<c.outHeight;++L)for(var P=R+L*k.strides[2],z=L*c.strideHeight-b,B=0;B<h;++B){var V=z+B*d;if(!(V<0||V>=c.inHeight))for(var W=O+B*S[1],U=M+V*N[2],H=0;H<c.outWidth;++H)for(var j=P+H*c.outChannels,G=H*c.strideWidth-y,q=0;q<p;++q){var K=G+q*v;if(!(K<0||K>=c.inWidth))for(var X=U+K*c.inChannels,Y=W+q*S[2],Z=0;Z<c.inChannels;++Z){for(var J=x[X+Z],Q=0;Q<c.outChannels;++Q)I[j+Q]+=J*w[Y+Q];Y+=c.outChannels}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}},jF={kernelName:Kd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=t.dy,s=a.strides,u=a.pad,c=a.filterShape;rD([i,o],"conv3dBackpropFilterV2");for(var l=td(i.shape),h=td(o.shape),p=Vb(i.shape,c,s,1,u),f=p.strideDepth,d=p.strideHeight,v=p.strideWidth,m=p.filterDepth,g=p.filterHeight,y=p.filterWidth,b=new Tg(p.filterShape,"float32"),k=b.values,x=n(b.strides,4),w=x[0],I=x[1],N=x[2],S=x[3],C=r.data.get(o.dataId).values,T=n(h,4),E=T[0],_=T[1],R=T[2],A=T[3],D=r.data.get(i.dataId).values,F=n(l,4),O=F[0],M=F[1],L=F[2],P=F[3],z=p.padInfo.front,B=p.padInfo.left,V=p.padInfo.top,W=0;W<m;++W)for(var U=Math.max(0,Math.ceil((z-W)/f)),H=Math.min(p.outDepth,(p.inDepth+z-W)/f),j=W*w,G=0;G<g;++G)for(var q=Math.max(0,Math.ceil((V-G)/d)),K=Math.min(p.outHeight,(p.inHeight+V-G)/d),X=G*I+j,Y=0;Y<y;++Y)for(var Z=Math.max(0,Math.ceil((B-Y)/v)),J=Math.min(p.outWidth,(p.inWidth+B-Y)/v),Q=Y*N+X,$=0;$<p.inChannels;++$)for(var ee=$*S+Q,te=0;te<p.outChannels;++te){for(var ne=0,re=0;re<p.batchSize;++re)for(var ae=re*O,ie=re*E,oe=U;oe<H;++oe)for(var se=(W+oe*f-z)*M+ae,ue=oe*_+ie,ce=q;ce<K;++ce)for(var le=(G+ce*d-V)*L+se,he=ce*R+ue,pe=Z;pe<J;++pe)ne+=D[(Y+pe*v-B)*P+le+$]*C[pe*A+he+te];k[ee+te]=ne}return r.makeTensorInfo(b.shape,b.dtype,b.values)}},GF={kernelName:Xd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.pad,u=a.strides,c=a.inputShape;rD([i],"conv3dBackpropInputV2");for(var l=td(i.shape),h=td(o.shape),p=Vb(c,o.shape,u,1,s),f=new Tg(p.inShape,"float32"),d=f.values,v=n(f.strides,4),m=v[0],g=v[1],y=v[2],b=v[3],k=r.data.get(i.dataId).values,x=n(l,4),w=x[0],I=x[1],N=x[2],S=x[3],C=r.data.get(o.dataId).values,T=n(h,4),E=T[0],_=T[1],R=T[2],A=T[3],D=p.batchSize,F=p.filterDepth,O=p.filterHeight,M=p.filterWidth,L=p.inChannels,P=p.inDepth,z=p.inHeight,B=p.inWidth,V=p.outChannels,W=p.outDepth,U=p.outHeight,H=p.outWidth,j=p.strideDepth,G=p.strideHeight,q=p.strideWidth,K=F-1-p.padInfo.front,X=O-1-p.padInfo.top,Y=M-1-p.padInfo.left,Z=0;Z<D;++Z)for(var J=0;J<L;++J)for(var Q=0;Q<P;++Q)for(var $=Q-K,ee=Math.max(0,Math.ceil($/j)),te=Math.min(W,(F+$)/j),ne=0;ne<z;++ne)for(var re=ne-X,ae=Math.max(0,Math.ceil(re/G)),ie=Math.min(U,(O+re)/G),oe=0;oe<B;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/q)),ce=Math.min(H,(M+se)/q),le=0,he=ee;he<te;++he)for(var pe=he*j-$,fe=ae;fe<ie;++fe)for(var de=fe*G-re,ve=ue;ve<ce;++ve)for(var me=w*Z+I*he+N*fe+S*ve,ge=E*(F-1-pe)+_*(O-1-de)+R*(M-1-(ve*q-se))+A*J,ye=0;ye<V;++ye)le+=k[me+ye]*C[ge+ye];d[m*Z+g*Q+y*ne+b*oe+J]=le}return r.makeTensorInfo(f.shape,f.dtype,f.values)}},qF=oD(Yd,function(e){return Math.cos(e)}),KF={kernelName:Yd,backendName:"cpu",kernelFunc:qF},XF=oD(Zd,function(e){return Math.cosh(e)}),YF={kernelName:Zd,backendName:"cpu",kernelFunc:XF},ZF={kernelName:Qd,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,r=e.backend,a=e.attrs,i=t.image,o=t.boxes,s=t.boxInd,u=a.cropSize,c=a.method,l=a.extrapolationValue,h=n(i.shape,4),p=h[0],f=h[1],d=h[2],v=h[3],m=o.shape[0],g=n(u,2),y=g[0],b=g[1],k=Wy([m,y,b,v],"float32"),x=r.data.get(o.dataId).values,w=r.data.get(s.dataId).values,I=r.data.get(i.dataId).values,N=td(i.shape),S=td(k.shape),C=0;C<m;C++){var T=4*C,E=x[T],_=x[T+1],R=x[T+2],A=x[T+3],D=w[C];if(!(D>=p))for(var F=y>1?(R-E)*(f-1)/(y-1):0,O=b>1?(A-_)*(d-1)/(b-1):0,M=0;M<y;M++){var L=y>1?E*(f-1)+M*F:.5*(E+R)*(f-1);if(L<0||L>f-1)for(var P=0;P<b;P++)for(var z=0;z<v;z++)k.values[z+P*S[2]+M*S[1]+C*S[0]]=l;else if("bilinear"===c)for(var B=Math.floor(L),V=Math.ceil(L),W=L-B,U=0;U<b;U++){var H=b>1?_*(d-1)+U*O:.5*(_+A)*(d-1);if(H<0||H>d-1)for(var j=0;j<v;j++)k.values[j+U*S[2]+M*S[1]+C*S[0]]=l;else for(var G=Math.floor(H),q=Math.ceil(H),K=H-G,X=0;X<v;X++){var Y=X+G*N[2]+B*N[1]+D*N[0],Z=I[Y],J=I[Y=X+q*N[2]+B*N[1]+D*N[0]],Q=I[Y=X+G*N[2]+V*N[1]+D*N[0]],$=I[Y=X+q*N[2]+V*N[1]+D*N[0]],ee=Z+(J-Z)*K;Y=X+U*S[2]+M*S[1]+C*S[0],k.values[Y]=ee+(Q+($-Q)*K-ee)*W}}else for(var te=0;te<b;++te){var ne=b>1?_*(d-1)+te*O:.5*(_+A)*(d-1);if(ne<0||ne>d-1)for(var re=0;re<v;re++)k.values[re+te*S[2]+M*S[1]+C*S[0]]=l;else for(var ae=Math.round(ne),ie=Math.round(L),oe=0;oe<v;oe++)k.values[oe+te*S[2]+M*S[1]+C*S[0]]=I[oe+ae*N[2]+ie*N[1]+D*N[0]]}}}return r.makeTensorInfo(k.shape,k.dtype,k.values)}},JF={kernelName:Jd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;rD(a,"cumsum");var u=Zk([i],a.shape.length),c=a;null!=u&&(c=YD({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=Qk(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var h=zg(c.dtype,"int32"),p=id(Lf(c.shape),h),f=n.data.get(c.dataId).values,d=c.shape[c.shape.length-1],v=s?function(e,t){return e+d-t-1}:function(e,t){return e+t},m=0;m<f.length;m+=d)for(var g=0;g<d;g++){var y=v(m,g);if(0===g)p[y]=o?0:f[y];else{var b=v(m,g-1);p[y]=o?f[b]+p[b]:f[y]+p[b]}}var k=n.makeTensorInfo(c.shape,h,p);if(null!=u){var x=YD({inputs:{x:k},backend:n,attrs:{perm:Jk(u)}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(c),x}return k}},QF={kernelName:$d,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=NF(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=SF(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},$F={kernelName:ev,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Df("NHWC"===o,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}),Df(i>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(i)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],h=u*i,p=c*i,f=l/(i*i),d=n.data.get(a.dataId).values,v=new Float32Array(s*h*p*f),m=0,g=0;g<s;++g)for(var y=0;y<h;++y)for(var b=Math.floor(y/i),k=y%i,x=0;x<p;++x)for(var w=Math.floor(x/i),I=(k*i+x%i)*f,N=0;N<f;++N)v[m++]=d[N+I+l*(w+c*(b+u*g))];return n.makeTensorInfo([s,h,p,f],a.dtype,v)}};function eO(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;rD([a,i],"depthwiseConv2DNative");var l=td(a.shape),h=td(i.shape),p=u;null==p&&(p=[1,1]),Df(Kb(o,p),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(p,"'")});for(var f=Bb(a.shape,i.shape,o,p,s,c,!0),d=f.filterHeight,v=f.filterWidth,m=f.dilationHeight,g=f.dilationWidth,y=f.padInfo,b=y.left,k=y.top,x=f.outChannels/f.inChannels,w=new Tg(f.outShape,a.dtype),I=n.data.get(a.dataId).values,N=n.data.get(i.dataId).values,S=w.values,C=0;C<f.batchSize;++C)for(var T=C*l[0],E=C*w.strides[0],_=0;_<f.outHeight;++_)for(var R=E+_*w.strides[1],A=_*f.strideHeight-b,D=0;D<d;++D){var F=A+D*m;if(!(F<0||F>=f.inHeight))for(var O=D*h[0],M=T+F*l[1],L=0;L<f.outWidth;++L)for(var P=R+L*w.strides[2],z=L*f.strideWidth-k,B=0;B<v;++B){var V=z+B*g;if(!(V<0||V>=f.inWidth))for(var W=M+V*f.inChannels,U=P,H=O+B*h[1],j=0;j<f.inChannels;++j){for(var G=I[W+j],q=0;q<x;++q)S[U+q]+=G*N[H+q];U+=x,H+=x}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var tO={kernelName:tv,backendName:"cpu",kernelFunc:eO},nO={kernelName:nv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;rD([a,i],"depthwiseConv2dNativeBackpropFilter");for(var h=Bb(a.shape,l,o,s,u,c,!0),p=h.strideHeight,f=h.strideWidth,d=h.filterHeight,v=h.filterWidth,m=new Tg(h.filterShape,"float32"),g=h.padInfo.left,y=h.padInfo.top,b=h.outChannels/h.inChannels,k=n.data.get(a.dataId).values,x=new Tg(a.shape,a.dtype,k),w=n.data.get(i.dataId).values,I=new Tg(i.shape,i.dtype,w),N=0;N<d;++N)for(var S=Math.max(0,Math.ceil((y-N)/p)),C=Math.min(h.outHeight,(h.inHeight+y-N)/p),T=0;T<v;++T)for(var E=Math.max(0,Math.ceil((g-T)/f)),_=Math.min(h.outWidth,(h.inWidth+g-T)/f),R=0;R<h.outChannels;++R){for(var A=Math.trunc(R/b),D=R%b,F=0,O=0;O<h.batchSize;++O)for(var M=S;M<C;++M)for(var L=N+M*p-y,P=E;P<_;++P)F+=x.get(O,L,T+P*f-g,A)*I.get(O,M,P,R);m.set(F,N,T,A,D)}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},rO={kernelName:rv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.strides,u=a.dilations,c=a.pad,l=a.dimRoundingMode,h=a.inputShape;rD([i,o],"depthwiseConv2DNativeBackpropInput");for(var p=td(i.shape),f=td(o.shape),d=Bb(h,o.shape,s,u,c,l,!0),v=new Tg(d.inShape,"float32"),m=v.values,g=n(v.strides,3),y=g[0],b=g[1],k=g[2],x=r.data.get(i.dataId).values,w=n(p,3),I=w[0],N=w[1],S=w[2],C=r.data.get(o.dataId).values,T=n(f,3),E=T[0],_=T[1],R=T[2],A=d.batchSize,D=d.filterHeight,F=d.filterWidth,O=d.inChannels,M=d.inHeight,L=d.inWidth,P=d.outChannels,z=d.outHeight,B=d.outWidth,V=d.strideHeight,W=d.strideWidth,U=D-1-d.padInfo.top,H=F-1-d.padInfo.left,j=P/O,G=0;G<A;++G)for(var q=0;q<O;++q)for(var K=0;K<M;++K)for(var X=K-U,Y=Math.max(0,Math.ceil(X/V)),Z=Math.min(z,(D+X)/V),J=0;J<L;++J){for(var Q=J-H,$=Math.max(0,Math.ceil(Q/W)),ee=Math.min(B,(F+Q)/W),te=0,ne=Y;ne<Z;++ne)for(var re=ne*V-X,ae=$;ae<ee;++ae)for(var ie=I*G+N*ne+S*ae,oe=E*(D-1-re)+_*(F-1-(ae*W-Q))+R*q,se=0;se<j;++se)te+=x[ie+(q*j+se)]*C[oe+se];m[y*G+b*K+k*J+q]=te}return r.makeTensorInfo(v.shape,v.dtype,v.values)}},aO={kernelName:"Diag",backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Lf(r.shape),o=n.data.get(r.dataId).values,s=Wy([a,a],r.dtype),u=s.values,c=0;c<o.length;c++)u[c*a+c]=o[c];var l=[].concat(i(r.shape),i(r.shape));return n.makeTensorInfo(l,s.dtype,s.values)}},iO={kernelName:av,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,h=a.shape.length,p=c.data.get(i.dataId).values,f=i.shape.length,d=Lb(a.shape,i.shape,o,s,"NHWC",u),v=d.batchSize,m=d.inHeight,g=d.inWidth,y=d.inChannels,b=d.outHeight,k=d.outWidth,x=d.padInfo,w=d.strideHeight,I=d.strideWidth,N=d.filterHeight,S=d.filterWidth,C=d.dilationHeight,T=d.dilationWidth,E=d.outShape,_=Lf(E),R=E.length,A=qf(a.dtype,_),D=0;D<v;++D)for(var F=0;F<b;++F)for(var O=F*w-x.top,M=0;M<k;++M)for(var L=M*I-x.left,P=0;P<y;++P){for(var z=Number.MIN_SAFE_INTEGER,B=0;B<N;++B){var V=O+B*C;if(V>=0&&V<m)for(var W=0;W<S;++W){var U=L+W*T;if(U>=0&&U<g){var H=ud([D,V,U,P],h,td(a.shape)),j=ud([B,W,P],f,td(i.shape)),G=l[H]+p[j];G>z&&(z=G)}}}A[ud([D,F,M,P],R,td(E))]=z}return{dataId:c.write(mg(A,a.dtype),E,a.dtype),shape:E,dtype:a.dtype}}},oO={kernelName:ov,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=rd(a.shape,l.data.get(a.dataId).values),p=rd(i.shape,l.data.get(i.dataId).values),f=Lb(a.shape,i.shape,s,u,"NHWC",c),d=f.batchSize,v=f.inHeight,m=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,k=f.padInfo,x=f.strideHeight,w=f.strideWidth,I=f.filterHeight,N=f.filterWidth,S=f.dilationHeight,C=f.dilationWidth,T=f.outShape;Df(o.rank===T.length,function(){return"Error in ".concat(ov,", dy must have the same rank as output ").concat(T.length,", but got ").concat(o.rank)});for(var E=rd(T,l.data.get(o.dataId).values),_=od(i.shape,i.dtype),R=0;R<d;++R)for(var A=0;A<y;++A)for(var D=A*x-k.top,F=0;F<b;++F)for(var O=F*w-k.left,M=0;M<g;++M){for(var L=Number.MIN_SAFE_INTEGER,P=0,z=0,B=0;B<I;++B){var V=D+B*S;if(V>=0&&V<v)for(var W=0;W<N;++W){var U=O+W*C;if(U>=0&&U<m){var H=h[R][V][U][M]+p[B][W][M];H>L&&(L=H,P=B,z=W)}}}_[P][z][M]+=E[R][A][F][M]}return{dataId:l.write(mg(_,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},sO={kernelName:iv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=rd(a.shape,l.data.get(a.dataId).values),p=rd(i.shape,l.data.get(i.dataId).values),f=Lb(a.shape,i.shape,s,u,"NHWC",c),d=f.batchSize,v=f.inHeight,m=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,k=f.padInfo,x=f.strideHeight,w=f.strideWidth,I=f.filterHeight,N=f.filterWidth,S=f.dilationHeight,C=f.dilationWidth,T=f.outShape;Df(o.rank===T.length,function(){return"Error in ".concat(iv,", dy must have the same rank as output ").concat(T.length,", but got ").concat(o.rank)});for(var E=rd(T,l.data.get(o.dataId).values),_=od(a.shape,a.dtype),R=0;R<d;++R)for(var A=0;A<y;++A)for(var D=A*x-k.top,F=0;F<b;++F)for(var O=F*w-k.left,M=0;M<g;++M){for(var L=Number.MIN_SAFE_INTEGER,P=D<0?0:D,z=O<0?0:O,B=0;B<I;++B){var V=D+B*S;if(V>=0&&V<v)for(var W=0;W<N;++W){var U=O+W*C;if(U>=0&&U<m){var H=h[R][V][U][M]+p[B][W][M];H>L&&(L=H,P=V,z=U)}}}_[R][P][z][M]+=E[R][A][F][M]}return{dataId:l.write(mg(_,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},uO={kernelName:cv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;rD([r,a],"eluGrad");for(var i=new Float32Array(Lf(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},cO=dD(function(e,t){return e===t?1:0}),lO=RD(hv,cO,null,"bool"),hO={kernelName:hv,backendName:"cpu",kernelFunc:lO},pO=bI,fO=kI,dO=xI,vO=wI,mO=II,gO=NI,yO=oD(lv,function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+pO*n);return t*(1-((((gO*r+mO)*r+vO)*r+dO)*r+fO)*r*Math.exp(-n*n))}),bO={kernelName:lv,backendName:"cpu",kernelFunc:yO},kO=TF(function(e){return Math.exp(e)}),xO=sD(pv,kO),wO={kernelName:pv,backendName:"cpu",kernelFunc:xO};function IO(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Df(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),LD({inputs:{x:a},backend:n,attrs:{shape:s}})}var NO={kernelName:fv,backendName:"cpu",kernelFunc:IO},SO=TF(function(e){return Math.expm1(e)}),CO=sD(dv,SO),TO={kernelName:dv,backendName:"cpu",kernelFunc:CO},EO=dD(function(e,t){return e*t}),_O=AD(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}),RO=RD(em,EO,_O),AO={kernelName:em,backendName:"cpu",kernelFunc:RO},DO=dD(function(e,t){return e/t}),FO=RD(sv,DO),OO={kernelName:sv,backendName:"cpu",kernelFunc:FO},MO=dD(function(e,t){return e-t}),LO=AD(function(e,t,n,r){return{real:e-n,imag:t-r}}),PO=RD(Um,MO,LO),zO={kernelName:Um,backendName:"cpu",kernelFunc:PO};function BO(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=Lf(c),h=Gf("float32",l),p=Gf("float32",l),f=0;f<a;f++){for(var d=xF({inputs:{x:s},backend:n,attrs:{begin:[f,0],size:[1,i]}}),v=xF({inputs:{x:u},backend:n,attrs:{begin:[f,0],size:[1,i]}}),m=ID({inputs:{real:d,imag:v},backend:n}),g=VO(m,t,n),y=TI(g.real,g.imag),b=0;b<i;b++){var k=AI(y,b);h[f*i+b]=k.real,p[f*i+b]=k.imag}n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m)}var x=n.makeTensorInfo(c,"float32",h),w=n.makeTensorInfo(c,"float32",p),I=ID({inputs:{real:x,imag:w},backend:n});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),I}function VO(e,t,n){var r=Lf(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0==(e&e-1)}(r)){var s=WO(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),h=n.makeTensorInfo([],"float32",vg(r,"float32")),p=lD({inputs:{x:h},backend:n}),f=OO.kernelFunc({inputs:{a:c,b:h},backend:n}),d=OO.kernelFunc({inputs:{a:l,b:p},backend:n}),v=n.data.get(f.dataId).values,m=n.data.get(d.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),{real:v,imag:m}}return s}return EI(function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=OI(a*s,t,n),c=AI(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),DI(r,i,o,a)}return r}(TI(i,o),r,t))}function WO(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=TI(e,t),o=n/2,s=_I(i),u=s.real,c=s.imag,l=[u.length],h=a.makeTensorInfo(l,"float32",u),p=a.makeTensorInfo(l,"float32",c),f=ID({inputs:{real:h,imag:p},backend:a}),d=RI(i),v=d.real,m=d.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),k=ID({inputs:{real:y,imag:b},backend:a}),x=WO(u,c,o,r,a),w=x.real,I=x.imag,N=[w.length],S=a.makeTensorInfo(N,"float32",w),C=a.makeTensorInfo(N,"float32",I),T=ID({inputs:{real:S,imag:C},backend:a}),E=WO(v,m,o,r,a),_=E.real,R=E.imag,A=[_.length],D=a.makeTensorInfo(A,"float32",_),F=a.makeTensorInfo(A,"float32",R),O=ID({inputs:{real:D,imag:F},backend:a}),M=FI(n,r),L=[M.real.length],P=a.makeTensorInfo(L,"float32",M.real),z=a.makeTensorInfo(L,"float32",M.imag),B=ID({inputs:{real:P,imag:z},backend:a}),V=RO({inputs:{a:B,b:O},backend:a}),W=OD({inputs:{a:T,b:V},backend:a}),U=PO({inputs:{a:T,b:V},backend:a}),H=CD({inputs:{input:W},backend:a}),j=CD({inputs:{input:U},backend:a}),G=MF({inputs:{input:W},backend:a}),q=MF({inputs:{input:U},backend:a}),K=PF({inputs:[H,j],backend:a,attrs:{axis:0}}),X=PF({inputs:[G,q],backend:a,attrs:{axis:0}}),Y=a.data.get(K.dataId).values,Z=a.data.get(X.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(k),a.disposeIntermediateTensorInfo(S),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(X),{real:Y,imag:Z}}var UO={kernelName:"FFT",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Lf(r.shape),i=r.shape[r.shape.length-1],o=LD({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=BO(o,!1,n),u=LD({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function HO(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Qf(a),o=qf(i,Lf(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var jO={kernelName:vv,backendName:"cpu",kernelFunc:HO},GO={kernelName:mv,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,r=e.backend,a=t.image,i=r,o=Gf(a.dtype,Lf(a.shape)),s=n(a.shape,4),u=s[0],c=s[1],l=s[2],h=s[3],p=i.data.get(a.dataId).values,f=0;f<u;f++)for(var d=f*l*c*h,v=0;v<c;v++)for(var m=v*(l*h),g=0;g<l;g++)for(var y=g*h,b=0;b<h;b++){var k=Math.round(l-[u,v,g,b][2]),x=d+m+y+b,w=p[x];k>=0&&k<l&&(w=p[d+m+k*h+b]),o[x]=w}return{dataId:i.write(o,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},qO=TF(function(e){return Math.floor(e)}),KO=sD(gv,qO),XO={kernelName:gv,backendName:"cpu",kernelFunc:KO},YO=dD(function(e,t){return Math.floor(e/t)}),ZO=RD(yv,YO,null,"int32"),JO={kernelName:yv,backendName:"cpu",kernelFunc:ZO},QO={kernelName:ig,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,p=r.dimRoundingMode,f=r.activation,d=r.leakyreluAlpha,v=BF({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){var m=v;v=OD({inputs:{a:v,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(f){var g=v;v=wD(n,v,f,s,d),n.disposeIntermediateTensorInfo(g)}return v}},$O={kernelName:og,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,p=r.dimRoundingMode,f=r.activation,d=r.leakyreluAlpha,v=eO({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){var m=v;v=OD({inputs:{a:v,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(f){var g=v;v=wD(n,v,f,s,d),n.disposeIntermediateTensorInfo(g)}return v}},eM={kernelName:xv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=t.params,i=t.indices,o=Lf(a.shape),s=i.shape,u=s[s.length-1],c=n(fI(a,i),4),l=c[0],h=c[1],p=c[2],f=c[3];if(0===h)return r.makeTensorInfo(l,a.dtype,[]);for(var d=Wy([h,p],a.dtype),v=r.data.get(i.dataId).values,m=r.data.get(a.dataId).values,g=0;g<h;g++){for(var y=[],b=0,k=0;k<u;k++){var x=v[g*u+k];b+=x*f[k],y.push(x)}if(b<0||b>=o/p)throw new Error("Invalid indices: ".concat(y," does not index into ").concat(a.shape));for(var w=0;w<p;w++)d.values[g*p+w]=m[b*p+w]}return r.makeTensorInfo(l,d.dtype,d.values)}};function tM(e,t,n){for(var r=Wy(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=t.locToIndex([i[0],i[2]]);i[2]=t.values[o];var s=e.locToIndex(i);r.values[a]=e.values[s]}return r}var nM={kernelName:kv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;rD([a,i],"gatherV2");var u=s;null==s&&(u=0);var c=Lf(i.shape),l=zI(a,i,Hf(o,a.shape)[0],u),h=LD({inputs:{x:a},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),p=LD({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,c/l.batchSize]}}),f=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize],d=n.bufferSync(p),v=tM(n.bufferSync(h),d,f);return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.makeTensorInfo(l.outputShape,v.dtype,v.values)}},rM=dD(function(e,t){return e>t?1:0}),aM=RD(wv,rM,null,"bool"),iM={kernelName:wv,backendName:"cpu",kernelFunc:aM},oM=dD(function(e,t){return e>=t?1:0}),sM=RD(Iv,oM,null,"bool"),uM={kernelName:Iv,backendName:"cpu",kernelFunc:sM},cM={kernelName:Sv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Lf(r.shape),i=r.shape[r.shape.length-1],o=LD({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=BO(o,!0,n),u=LD({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},lM=oD(Tv,function(e){return Number.isFinite(e)?1:0},"bool"),hM={kernelName:Tv,backendName:"cpu",kernelFunc:lM},pM=oD(Ev,function(e){return Math.abs(e)===1/0?1:0},"bool"),fM={kernelName:Ev,backendName:"cpu",kernelFunc:pM},dM=oD(_v,function(e){return Number.isNaN(e)?1:0},"bool"),vM={kernelName:_v,backendName:"cpu",kernelFunc:dM},mM=dD(function(e,t){return e<t?1:0}),gM=RD(Av,mM,null,"bool"),yM={kernelName:Av,backendName:"cpu",kernelFunc:gM},bM=dD(function(e,t){return e<=t?1:0}),kM=RD(Dv,bM,null,"bool"),xM={kernelName:Dv,backendName:"cpu",kernelFunc:kM};function wM(e,t,n){var r=(t-e)/(n-1),a=id(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var IM={kernelName:Fv,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=wM(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},NM=TF(function(e){return Math.log(e)}),SM=sD(Ov,NM),CM={kernelName:Ov,backendName:"cpu",kernelFunc:SM},TM=oD(Mv,function(e){return Math.log1p(e)}),EM={kernelName:Mv,backendName:"cpu",kernelFunc:TM},_M=dD(function(e,t){return e&&t}),RM=RD(Lv,_M,null,"bool"),AM={kernelName:Lv,backendName:"cpu",kernelFunc:RM},DM=oD(Pv,function(e){return e?0:1},"bool"),FM={kernelName:Pv,backendName:"cpu",kernelFunc:DM},OM=dD(function(e,t){return e||t}),MM=RD(zv,OM,null,"bool"),LM={kernelName:zv,backendName:"cpu",kernelFunc:MM},PM={kernelName:Bv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;rD(a,"LRN");var c=a.shape[3],l=c-1,h=n.data.get(a.dataId).values,p=Lf(a.shape),f=new Float32Array(p);function d(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=h[n];a+=o*o}return a}for(var v=0;v<p;v++){var m=d(v),g=h[v]*Math.pow(o+s*m,-u);f[v]=g}return n.makeTensorInfo(a.shape,a.dtype,f)}},zM={kernelName:Vv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;rD(o,"LRNGrad");for(var h=Lf(o.shape),p=o.shape[3],f=n.data.get(o.dataId).values,d=n.data.get(a.dataId).values,v=n.data.get(i.dataId).values,m=new Float32Array(h),g=h,y=0;y<g;y++){for(var b=y%p,k=y-b+Math.max(0,b-s),x=y-b+Math.min(p,b+s+1),w=0,I=k;I<x;I++)w+=Math.pow(d[I],2);w=c*w+u;for(var N=k;N<x;N++){var S=-2*c*l*d[N]*v[y]/w;y===N&&(S+=Math.pow(w,-l)),S*=f[y],m[N]+=S}}return n.makeTensorInfo(o.shape,a.dtype,m)}};function BM(e,t,n,r){for(var a=Gf(r,Lf(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];c>s&&(s=c)}a[i]=s}return a}function VM(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.reductionIndices,s=a.keepDims,u=r,c=i.shape,l=c.length,h=Hf(o,c),p=h,f=Zk(p,l),d=u.data.get(i.dataId).values;if(null!=f){for(var v=new Array(l),m=0;m<v.length;m++)v[m]=c[f[m]];d=XD(d,c,i.dtype,f,v),p=Qk(p.length,l),c=v}rD(i,"max"),Yk("max",p,l);var g=n(Kk(c,p),2),y=g[0],b=BM(d,Lf(g[1]),y,i.dtype),k=u.write(b,y,i.dtype),x=y;return s&&(x=Xk(y,h)),{dataId:k,shape:x,dtype:i.dtype}}var WM={kernelName:Wv,backendName:"cpu",kernelFunc:VM},UM=dD(function(e,t){return Math.max(e,t)}),HM=RD(Uv,UM),jM={kernelName:Uv,backendName:"cpu",kernelFunc:HM},GM={kernelName:Hv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;rD(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Df(Kb(o,1),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '1'")});var c,l=Pb(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Pf(l.inShape,l.outShape))c=lD({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,p=td(a.shape),f=pF(h,0,a.dtype,p,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}},qM={kernelName:Gv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;rD(a,"maxPool3d");var l=zb(a.shape,i,o,1,s,u,c),h=dF(n.data.get(a.dataId).values,0,a.dtype,td(a.shape),l,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}},KM={kernelName:qv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;rD([a,i],"maxPool3DGrad");for(var l=zb(i.shape,o,s,1,u,c),h=function(e,t){for(var n=Wy(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.front,f=t.padInfo.top,d=t.padInfo.left,v=0;v<t.batchSize;++v)for(var m=0;m<t.inChannels;++m)for(var g=0;g<t.outDepth;++g){for(var y=g*r-p,b=y;b<0;)b+=o;for(var k=Math.min(t.inDepth,c+y),x=0;x<t.outHeight;++x){for(var w=x*a-f,I=w;I<0;)I+=s;for(var N=Math.min(t.inHeight,l+w),S=0;S<t.outWidth;++S){for(var C=S*i-d,T=C;T<0;)T+=u;for(var E=Math.min(t.inWidth,h+C),_=Number.NEGATIVE_INFINITY,R=-1,A=b;A<k;A+=o)for(var D=A-y,F=I;F<N;F+=s)for(var O=F-w,M=T;M<E;M+=u){var L=M-C,P=e.get(v,A,F,M,m);P>=_&&(_=P,R=D*l*h+O*l+L)}n.set(R,v,g,x,S,m)}}}return n}(n.bufferSync(i),l),p=l.strideDepth,f=l.strideHeight,d=l.strideWidth,v=l.dilationDepth,m=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,k=l.effectiveFilterWidth,x=y-1-l.padInfo.front,w=k-1-l.padInfo.left,I=b-1-l.padInfo.top,N=Wy(i.shape,"float32"),S=n.bufferSync(a),C=0;C<l.batchSize;++C)for(var T=0;T<l.inChannels;++T)for(var E=0;E<l.inDepth;++E)for(var _=0;_<l.inHeight;++_)for(var R=0;R<l.inWidth;++R){for(var A=E-x,D=_-I,F=R-w,O=0,M=0;M<y;M+=v){var L=(A+M)/p;if(!(L<0||L>=l.outDepth||Math.floor(L)!==L))for(var P=0;P<b;P+=m){var z=(D+P)/f;if(!(z<0||z>=l.outHeight||Math.floor(z)!==z))for(var B=0;B<k;B+=g){var V=(F+B)/d;if(!(V<0||V>=l.outWidth||Math.floor(V)!==V)){var W=y*b*k-1-h.get(C,L,z,V,T)===M*b*k+P*k+B?1:0;0!==W&&(O+=S.get(C,L,z,V,T)*W)}}}}N.set(O,C,E,_,R,T)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}},XM={kernelName:jv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;rD([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=Pb(o.shape,s,u,1,c,l),p=n.data.get(o.dataId).values,f=Wy(h.outShape,o.dtype,fF(p,o.shape,o.dtype,h).values),d=h.strideHeight,v=h.strideWidth,m=h.dilationHeight,g=h.dilationWidth,y=h.effectiveFilterHeight,b=h.effectiveFilterWidth,k=b-1-h.padInfo.left,x=y-1-h.padInfo.top,w=Wy(o.shape,"float32"),I=n.data.get(a.dataId).values,N=Wy(a.shape,"float32",I),S=0;S<h.batchSize;++S)for(var C=0;C<h.inChannels;++C)for(var T=0;T<h.inHeight;++T)for(var E=0;E<h.inWidth;++E){for(var _=T-x,R=E-k,A=0,D=0;D<y;D+=m){var F=(_+D)/d;if(!(F<0||F>=h.outHeight||Math.floor(F)!==F))for(var O=0;O<b;O+=g){var M=(R+O)/v;if(!(M<0||M>=h.outWidth||Math.floor(M)!==M)){var L=y*b-1-f.get(S,F,M,C)===D*b+O?1:0;0!==L&&(A+=N.get(S,F,M,C)*L)}}}w.set(A,S,T,E,C)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},YM={kernelName:Kv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.attrs,a=e.backend,i=t.x,o=r.filterSize,s=r.strides,u=r.pad,c=r.includeBatchInIndex,l=a;rD(i,"MaxPoolWithArgmax");var h=l.data.get(i.dataId).values,p=Pb(i.shape,o,s,[1,1],u),f=n(function(e,t,n,r,a){var i=pF(e,0,n,td(t),a,"max"),o=fF(e,t,n,a,!0,r);return[i.values,o.values]}(h,i.shape,i.dtype,c,p),2),d=f[0],v=f[1],m=l.write(d,p.outShape,i.dtype),g=l.write(v,p.outShape,i.dtype);return[{dataId:m,shape:p.outShape,dtype:i.dtype},{dataId:g,shape:p.outShape,dtype:"int32"}]}};function ZM(e){var t,r=e.inputs,a=e.backend,i=e.attrs,o=r.x,s=i.axis,u=i.keepDims;rD(o,"sum");var c=(t="bool"===o.dtype?ED({inputs:{x:o},backend:a,attrs:{dtype:"int32"}}):lD({inputs:{x:o},backend:a})).shape.length,l=Hf(s,t.shape),h=Zk(l,c),p=l,f=t;null!=h&&(f=YD({inputs:{x:t},backend:a,attrs:{perm:h}}),p=Qk(p.length,c)),Yk("sum",p,f.shape.length);for(var d=n(Kk(f.shape,p),2),v=d[0],m=d[1],g=SD(a,v,zg(f.dtype,"int32")),y=Lf(m),b=a.data.get(g.dataId).values,k=a.data.get(f.dataId).values,x=0;x<b.length;++x){for(var w=x*y,I=0,N=0;N<y;++N)I+=k[w+N];b[x]=I}if(u){var S=g;g=LD({inputs:{x:g},backend:a,attrs:{shape:Xk(g.shape,l)}}),a.disposeIntermediateTensorInfo(S)}return a.disposeIntermediateTensorInfo(t),null!=h&&a.disposeIntermediateTensorInfo(f),g}var JM={kernelName:Lm,backendName:"cpu",kernelFunc:ZM},QM={kernelName:Xv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Hf(i,a.shape),u=Lf(Kk(a.shape,s)[1]),c=[],l=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(l);var h=ED({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(h);var p=FO({inputs:{a:h,b:l},backend:n});c.push(p);var f=ZM({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:o}});return c.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),f}},$M={kernelName:Yv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims;rD(i,"min");var u=Hf(o,i.shape),c=u,l=Zk(c,i.shape.length),h=i;null!=l&&(h=YD({inputs:{x:i},backend:r,attrs:{perm:l}}),c=Qk(c.length,i.shape.length)),Yk("min",c,h.shape.length);for(var p=n(Kk(h.shape,c),2),f=p[0],d=Lf(p[1]),v=id(Lf(f),h.dtype),m=r.data.get(h.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],k=0;k<d;++k){var x=m[y+k];x<b&&(b=x)}v[g]=b}null!=l&&r.disposeIntermediateTensorInfo(h);var w=r.makeTensorInfo(f,h.dtype,v);if(s){var I=LD({inputs:{x:w},backend:r,attrs:{shape:Xk(f,u)}});return r.disposeIntermediateTensorInfo(w),I}return w}},eL=dD(function(e,t){return Math.min(e,t)}),tL=RD(Zv,eL),nL={kernelName:Zv,backendName:"cpu",kernelFunc:tL},rL={kernelName:Jv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;rD(a,"mirrorPad");for(var s=i.map(function(e,t){return e[0]+a.shape[t]+e[1]}),u=i.map(function(e){return e[0]}),c=i.map(function(e,t){return e[0]+a.shape[t]}),l="reflect"===o?0:1,h=n.data.get(a.dataId).values,p=a.shape.length,f=td(a.shape),d=Lf(s),v=s.length,m=td(s),g=Gf(a.dtype,d),y=0;y<d;y++){for(var b=cd(y,v,m),k=0;k<v;k++)b[k]<u[k]?b[k]=2*u[k]-b[k]-l:b[k]>=c[k]&&(b[k]=2*(c[k]-1)-b[k]+l);var x=ud(b=b.map(function(e,t){return e-u[t]}),p,f);g[y]=h[x]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},aL=dD(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),iL=RD(Qv,aL),oL={kernelName:Qv,backendName:"cpu",kernelFunc:iL};function sL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(o," and dim was ").concat(s));var u=Hf([s],a.shape),c=VM({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=Xk(c.shape,u),h=LD({inputs:{x:c},backend:n,attrs:{shape:l}}),p=PO({inputs:{a:a,b:h},backend:n}),f=xO({inputs:{x:p},backend:n}),d=ZM({inputs:{x:f},backend:n,attrs:{axis:u,keepDims:!1}}),v=LD({inputs:{x:d},backend:n,attrs:{shape:l}}),m=FO({inputs:{a:f,b:v},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(v),m}var uL={kernelName:Bm,backendName:"cpu",kernelFunc:sL},cL={kernelName:$v,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;rD(a,"multinomial");for(var u=s?a:sL({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],h=n.data.get(u.dataId).values,p=[c,i],f=id(Lf(p),"int32"),d=0;d<c;++d){var v=d*l,m=new Float32Array(l-1);m[0]=h[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+h[v+g];for(var y=cx.alea(o.toString()),b=d*i,k=0;k<i;++k){var x=y();f[b+k]=m.length;for(var w=0;w<m.length;w++)if(x<m[w]){f[b+k]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",f)}};function lL(e,t,n){var r=vg(-1,n);return EO([],t,r,e,n)}var hL={kernelName:tm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=t.x;rD(a,"neg");var i=n(lL(r.data.get(a.dataId).values,a.shape,a.dtype),2),o=i[0],s=i[1];return r.makeTensorInfo(s,a.dtype,o)}},pL=vw,fL={kernelName:rm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;rD(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,h=pL(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},dL=mw,vL={kernelName:am,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;rD(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,p=dL(l,h,o,s,u,c),f=p.selectedIndices,d=p.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}},mL=gw,gL={kernelName:im,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;rD(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,p=mL(l,h,o,s,u,c),f=p.selectedIndices,d=p.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([d.length],"float32",new Float32Array(d))]}},yL=dD(function(e,t){return e!==t?1:0}),bL=RD(nm,yL,null,"bool"),kL={kernelName:nm,backendName:"cpu",kernelFunc:bL},xL={kernelName:sm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,u=r.offValue;rD(a,"oneHot");var c=Lf(a.shape),l=new Float32Array(c*o);l.fill(u);for(var h=n.data.get(a.dataId).values,p=0;p<c;++p)h[p]>=0&&h[p]<o&&(l[p*o+h[p]]=s);return n.makeTensorInfo([].concat(i(a.shape),[o]),"int32",l)}};function wL(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=CD({inputs:{input:r},backend:n}),i=wL({inputs:{x:a},backend:n}),o=MF({inputs:{input:r},backend:n}),s=wL({inputs:{x:o},backend:n}),u=ID({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return HO({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var IL={kernelName:eg,backendName:"cpu",kernelFunc:wL},NL={kernelName:om,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=CD({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=MF({inputs:{input:a},backend:r}),u=wL({inputs:{x:s},backend:r}),c=ID({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return HO({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function SL(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return IO({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach(function(e){Ff(a,e.shape,"All tensors passed to stack must have matching shapes"),Df(i===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=[],s=PF({inputs:t.map(function(e){var t=IO({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t}),backend:n,attrs:{axis:r}});return o.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),s}var CL={kernelName:um,backendName:"cpu",kernelFunc:SL},TL={kernelName:cm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;rD(a,"pad");var s=i.map(function(e,t){return e[0]+a.shape[t]+e[1]}),u=i.map(function(e){return e[0]}),c=n.data.get(a.dataId).values,l=Lf(a.shape),h=a.shape.length,p=td(a.shape),f=Lf(s),d=s.length,v=td(s),m=Gf(a.dtype,f);0!==o&&m.fill(o);for(var g=0;g<l;g++)m[ud(cd(g,h,p).map(function(e,t){return e+u[t]}),d,v)]=c[g];return{dataId:n.write(m,s,a.dtype),shape:s,dtype:a.dtype}}},EL=dD(function(e,t){return Math.pow(e,t)}),_L=RD(lm,EL),RL={kernelName:lm,backendName:"cpu",kernelFunc:_L};function AL(e,t,r,a){for(var i=n(Kk(e,a),2),o=i[0],s=i[1],u=zg(t,"int32"),c=id(Lf(o),u),l=Lf(s),h=0;h<c.length;++h){for(var p=h*l,f=1,d=0;d<l;++d)f*=r[p+d];c[h]=f}return{outVals:c,outShape:o,outDtype:u}}var DL={kernelName:pm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;rD(a,"prod");var s=a.shape.length,u=Hf(i,a.shape),c=Zk(u,s),l=u,h=a,p=[];null!=c&&(h=YD({inputs:{x:a},backend:n,attrs:{perm:c}}),p.push(h),l=Qk(l.length,s));var f=n.data.get(h.dataId).values,d=AL(h.shape,h.dtype,f,l),v=d.outVals,m=d.outShape,g=d.outDtype,y=m;return o&&(y=Xk(m,u)),p.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),n.makeTensorInfo(y,g,v)}};function FL(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return id(0,r);var a=id(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var OL={kernelName:fm,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=FL(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},ML=oD(vm,function(e){return 1/e}),LL={kernelName:vm,backendName:"cpu",kernelFunc:ML},PL={kernelName:km,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.images,o=a.alignCorners,s=a.halfPixelCenters,u=a.size;rD(i,"resizeBilinear");for(var c=td(i.shape),l=n(u,2),h=l[0],p=l[1],f=n(i.shape,4),d=f[0],v=f[1],m=f[2],g=f[3],y=r.data.get(i.dataId).values,b=new Float32Array(Lf([d,h,p,g])),k=[o&&h>1?v-1:v,o&&p>1?m-1:m],x=[o&&h>1?h-1:h,o&&p>1?p-1:p],w=0,I=k[0]/x[0],N=k[1]/x[1],S=0;S<d;S++)for(var C=0;C<h;C++){var T;T=s?I*(C+.5)-.5:I*C;for(var E=Math.max(0,Math.floor(T)),_=T-E,R=Math.min(v-1,Math.ceil(T)),A=S*c[0]+E*c[1],D=S*c[0]+R*c[1],F=0;F<p;F++){var O;O=s?N*(F+.5)-.5:N*F;for(var M=Math.max(0,Math.floor(O)),L=O-M,P=Math.min(m-1,Math.ceil(O)),z=A+M*c[2],B=D+M*c[2],V=A+P*c[2],W=D+P*c[2],U=0;U<g;U++){var H=y[z+U],j=y[B+U],G=H+(y[V+U]-H)*L;b[w++]=G+(j+(y[W+U]-j)*L-G)*_}}}return r.makeTensorInfo([d,h,p,g],"float32",b)}},zL={kernelName:xm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.images,o=t.dy,s=a.alignCorners;rD([o,i],"resizeBilinearGrad");for(var u=td(i.shape),c=n(i.shape,4),l=c[0],h=c[1],p=c[2],f=c[3],d=n(o.shape,3),v=d[1],m=d[2],g=new Float32Array(l*h*p*f),y=[s&&v>1?h-1:h,s&&m>1?p-1:p],b=[s&&v>1?v-1:v,s&&m>1?m-1:m],k=y[0]/b[0],x=y[1]/b[1],w=r.data.get(o.dataId).values,I=0,N=0;N<l;N++)for(var S=N*u[0],C=0;C<v;C++)for(var T=C*k,E=Math.floor(T),_=Math.min(Math.ceil(T),h-1),R=S+E*u[1],A=S+_*u[1],D=T-E,F=1-D,O=0;O<m;O++)for(var M=O*x,L=Math.floor(M),P=Math.min(Math.ceil(M),p-1),z=M-L,B=1-z,V=R+L*u[2],W=R+P*u[2],U=A+L*u[2],H=A+P*u[2],j=F*B,G=F*z,q=D*B,K=D*z,X=0;X<f;X++){var Y=w[I++];g[V+X]+=Y*j,g[W+X]+=Y*G,g[U+X]+=Y*q,g[H+X]+=Y*K}return r.makeTensorInfo([l,p,h,f],"float32",g)}},BL={kernelName:ym,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.images,o=a.alignCorners,s=a.halfPixelCenters,u=a.size;rD(i,"resizeNearestNeighbor");for(var c=td(i.shape),l=n(u,2),h=l[0],p=l[1],f=n(i.shape,4),d=f[0],v=f[1],m=f[2],g=f[3],y=r.data.get(i.dataId).values,b=new Float32Array(d*h*p*g),k=[o&&h>1?v-1:v,o&&p>1?m-1:m],x=[o&&h>1?h-1:h,o&&p>1?p-1:p],w=k[0]/x[0],I=k[1]/x[1],N=0,S=0;S<d;S++)for(var C=S*c[0],T=0;T<h;T++){var E=s?w*(T+.5):w*T,_=Math.min(v-1,o?Math.round(E):Math.floor(E));s&&(_=Math.max(0,_));for(var R=C+_*c[1],A=0;A<p;A++){var D=s?I*(A+.5):I*A,F=Math.min(m-1,o?Math.round(D):Math.floor(D));s&&(F=Math.max(0,F));for(var O=R+F*c[2],M=0;M<g;M++)b[N++]=y[O+M]}}return r.makeTensorInfo([d,h,p,g],i.dtype,b)}},VL={kernelName:bm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.images,o=t.dy,s=a.alignCorners;rD([o,i],"resizeNearestNeighborGrad");for(var u=td(i.shape),c=td(o.shape),l=n(i.shape,4),h=l[0],p=l[1],f=l[2],d=l[3],v=n(o.shape,3),m=v[1],g=v[2],y=new Float32Array(h*p*f*d),b=r.data.get(o.dataId).values,k=[s&&m>1?p-1:p,s&&g>1?f-1:f],x=[s&&m>1?m-1:m,s&&g>1?g-1:g],w=k[0]/x[0],I=k[1]/x[1],N=1/w,S=1/I,C=2*Math.ceil(N)+2,T=2*Math.ceil(S)+2,E=0;E<h;E++)for(var _=E*u[0],R=0;R<p;R++)for(var A=_+R*u[1],D=Math.floor(R*N),F=Math.floor(D-C/2),O=0;O<f;O++)for(var M=A+O*u[2],L=Math.floor(O*S),P=Math.floor(L-T/2),z=0;z<d;z++){for(var B=0,V=0;V<C;V++){var W=V+F;if(!(W<0||W>=m)){var U=_+W*c[1],H=W*w;if(R===Math.min(p-1,s?Math.round(H):Math.floor(H)))for(var j=0;j<T;j++){var G=j+P;if(!(G<0||G>=g)){var q=U+G*c[2],K=G*I;O===Math.min(f-1,s?Math.round(K):Math.floor(K))&&(B+=b[q+z])}}}}y[M+z]=B}return r.makeTensorInfo(i.shape,i.dtype,y)}},WL={kernelName:Im,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dims;rD(a,"reverse");var s=a.shape.length,u=Hf(o,a.shape);if(0===s)return lD({inputs:{x:a},backend:n});for(var c=new Tg(a.shape,a.dtype),l=n.bufferSync(a),h=function(e){var t=c.indexToLoc(e),n=t.slice();u.forEach(function(e){return n[e]=a.shape[e]-1-n[e]}),c.set.apply(c,[l.get.apply(l,i(n))].concat(i(t)))},p=0;p<c.size;p++)h(p);return n.makeTensorInfo(c.shape,c.dtype,c.values)}},UL={kernelName:rg,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,r=e.attrs,a=e.backend,i=t.image,o=r.radians,s=r.fillValue,u=r.center,c=a,l=Gf(i.dtype,Lf(i.shape)),h=n(i.shape,4),p=h[0],f=h[1],d=h[2],v=h[3],m=n(sI(u,f,d),2),g=m[0],y=m[1],b=Math.sin(o),k=Math.cos(o),x=c.data.get(i.dataId).values,w=0;w<p;w++)for(var I=w*d*f*v,N=0;N<f;N++)for(var S=N*(d*v),C=0;C<d;C++)for(var T=C*v,E=0;E<v;E++){var _=[p,N,C,E],R=_[2],A=_[1],D=(R-g)*k-(A-y)*b,F=(R-g)*b+(A-y)*k;D=Math.round(D+g),F=Math.round(F+y);var O=s;"number"!=typeof s&&(O=3===E?255:s[E]),D>=0&&D<d&&F>=0&&F<f&&(O=x[I+F*(d*v)+D*v+E]),l[I+S+T+E]=O}return{dataId:c.write(l,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},HL=oD(Nm,function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}),jL={kernelName:Nm,backendName:"cpu",kernelFunc:HL},GL=TF(function(e){return 1/Math.sqrt(e)}),qL=sD(Sm,GL),KL={kernelName:Sm,backendName:"cpu",kernelFunc:qL};function XL(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=e.values,p=t.values;if(0===r)return Wy(n,t.dtype);var f=Wy(l,t.dtype);f.values.fill(u);for(var d=0;d<i;d++){for(var v=[],m=0,g=0;g<o;g++){var y=h[d*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(n));for(var b=0;b<a;b++)c?f.values[m*a+b]+=p[d*a+b]:f.values[m*a+b]=0===t.rank?p[0]:p[d*a+b]}return f}var YL={kernelName:Cm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=mI(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,f=XL(n.bufferSync(a),n.bufferSync(i),o,p,l,c,u,h,0,!0);return n.makeTensorInfo(o,f.dtype,f.values)}},ZL={kernelName:Tm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;rD([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=zg(a.dtype,i.dtype),h=id(Lf(a.shape),l),p=0,f=0===o||o>1||1===a.shape.length?1:Lf(a.shape.slice(1)),d=0;d<s.length;d++)for(var v=0;v<f;v++)h[p++]=1===s[d]?u[d]:c[d];return n.makeTensorInfo(a.shape,l,h)}},JL=gI,QL=yI,$L=oD(Em,function(e){return e>=0?QL*e:JL*(Math.exp(e)-1)}),eP={kernelName:Em,backendName:"cpu",kernelFunc:$L},tP=oD(Fm,function(e){return 1/(1+Math.exp(-e))}),nP={kernelName:Fm,backendName:"cpu",kernelFunc:tP},rP=oD(Dm,function(e){return e<0?-1:e>0?1:0}),aP={kernelName:Dm,backendName:"cpu",kernelFunc:rP},iP=oD(Rm,function(e){return Math.sin(e)}),oP={kernelName:Rm,backendName:"cpu",kernelFunc:iP},sP=oD(Am,function(e){return Math.sinh(e)}),uP={kernelName:Am,backendName:"cpu",kernelFunc:sP},cP=Math.log(1.1920928955078125e-7)+2,lP=oD(Om,function(e){var t=e>-cP,n=e<cP,r=Math.exp(e);return n?r:t?e:Math.log(1+r)}),hP={kernelName:Om,backendName:"cpu",kernelFunc:lP},pP={kernelName:Pm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.paddings;rD([a],"spaceToBatchND");var u=Lf(o),c=[[0,0]];c.push.apply(c,i(s));for(var l=1+o.length;l<a.shape.length;++l)c.push([0,0]);var h=TL.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),p=uI(h.shape,o,u,!1),f=cI(p.length,o.length,!1),d=lI(h.shape,o,u,!1),v=LD({inputs:{x:h},backend:n,attrs:{shape:p}}),m=YD({inputs:{x:v},backend:n,attrs:{perm:f}}),g=LD({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),g}},fP={kernelName:Hm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=mI(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.sliceSize,p=u.strides,f=u.outputSize,d=XL(n.bufferSync(a),n.bufferSync(i),s,f,h,l,c,p,n.data.get(o.dataId).values[0],!1);return n.makeTensorInfo(s,d.dtype,d.values)}},dP={kernelName:zm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.numOrSizeSplits,s=Hf(r.axis,a.shape)[0],u=MI(a,o,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(e){var t=i(l);t[s]=e;var r=xF({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r})}},vP=oD(Mm,function(e){return Math.sqrt(e)}),mP={kernelName:Mm,backendName:"cpu",kernelFunc:vP},gP={kernelName:Wm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;rD(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},yP=dD(function(e,t){var n=e-t;return n*n}),bP=RD(Vm,yP),kP={kernelName:Vm,backendName:"cpu",kernelFunc:bP},xP=oD(tg,function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),wP={kernelName:tg,backendName:"cpu",kernelFunc:xP};function IP(e,t,n,r){for(var a=Wy(e,t.dtype),o=0;o<a.size;o++){for(var s=a.indexToLoc(o),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[c]*n[c]+r[c];a.set.apply(a,[t.get.apply(t,u)].concat(i(s)))}return a}var NP={kernelName:jm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,h=r.newAxisMask,p=r.shrinkAxisMask;rD(a,"stridedSlice");var f,d=gb(a.shape,i,o,s,u,c,l,h,p),v=d.nonStrided,m=d.$begin,g=d.$strides,y=d.size,b=d.newShape,k=d.outShape,x=LD({inputs:{x:a},backend:n,attrs:{shape:b}});if(v){var w=xF({inputs:{x:x},backend:n,attrs:{begin:m,size:y}});f=LD({inputs:{x:w},backend:n,attrs:{shape:k}}),n.disposeIntermediateTensorInfo(w)}else if(k.some(function(e){return 0===e}))f=n.makeTensorInfo(k,a.dtype,[]);else{var I=IP(k,n.bufferSync(x),g,m);f=n.makeTensorInfo(I.shape,I.dtype,I.values)}var N=LD({inputs:{x:f},backend:n,attrs:{shape:k}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(f),N}},SP=oD(Gm,function(e){return Math.tan(e)}),CP={kernelName:Gm,backendName:"cpu",kernelFunc:SP},TP=oD(qm,function(e){return Math.tanh(e)});function EP(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=Wy(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}function _P(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Gf(n,o*r),c=Gf("int32",o*r),l=0;l<o;l++){for(var h=l*s,p=e.subarray(h,h+s),f=[],d=0;d<p.length;d++)f.push({value:p[d],index:d});f.sort(function(e,t){return t.value-e.value});for(var v=l*r,m=u.subarray(v,v+r),g=c.subarray(v,v+r),y=0;y<r;y++)m[y]=f[y].value,g[y]=f[y].index}var b=t.slice();return b[b.length-1]=r,[Wy(b,n,u),Wy(b,"int32",c)]}function RP(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Rf(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;return n<0?t<=1?n=0:n+=t*(Math.trunc(-n/(t-1))+1):n>t-1&&(t<=1?n=0:n-=t*Math.trunc(n/(t-1))),Rf(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Rf(0,e,t-1)}(e,t);case"constant":default:return function(e,t){return e}(e)}}function AP(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function DP(e,t,n,r,a,i,o,s,u,c,l){return AP(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function FP(e,t,n,r,a,i,o,s,u,c,l){var h=Math.floor(s),p=Math.floor(u),f=h+1,d=p+1;return(f-s)*((d-u)*AP(e,t,n,r,a,i,o,h,p,c,l)+(u-p)*AP(e,t,n,r,a,i,o,h,d,c,l))+(s-h)*((d-u)*AP(e,t,n,r,a,i,o,f,p,c,l)+(u-p)*AP(e,t,n,r,a,i,o,f,d,c,l))}function OP(e,t,n,r){for(var a=Hf(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new Tg(i,r,e),h=[],p=1===i[0]&&1===i[2],f=0;f<n[a];f++){var d=void 0;if(p)d=e[f].toString();else{for(var v=[],m=0;m<i[0];m++)for(var g=0;g<i[2];g++)v.push(l.get(m,f,g));d=v.join(",")}if(void 0!==u[d])c[f]=u[d];else{var y=Object.keys(u).length;u[d]=y,c[f]=y,h.push(f)}}var b=i.slice();b[1]=Object.keys(u).length;var k=new Tg(b,r);h.forEach(function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(l.get(n,e,r),n,t,r)});var x=n.slice();return x[a]=b[1],{outputValues:k.values,outputShape:x,indices:c}}for(var MP=0,LP=[VD,UD,jD,qD,MD,KD,JD,QD,$D,eF,nF,aF,oF,cF,hF,vF,mF,gF,yF,BD,bF,IF,CF,_D,RF,DF,ND,FF,zF,WF,UF,VF,jF,GF,HF,KF,YF,ZF,JF,QF,$F,tO,nO,rO,aO,iO,sO,oO,OO,cD,uO,hO,bO,wO,NO,TO,UO,jO,GO,XO,JO,QO,$O,eM,nM,iM,uM,hD,cM,LF,hM,fM,vM,fD,yM,xM,IM,CM,EM,AM,FM,LM,PM,zM,jM,GM,qM,KM,XM,YM,WM,QM,$M,nL,rL,oL,cL,AO,hL,fL,vL,gL,kL,xL,NL,CL,TL,RL,gD,DL,OL,TD,LL,bD,xD,PD,PL,zL,BL,VL,WL,UL,jL,KL,YL,ZL,eP,nP,aP,oP,uP,wF,uL,hP,pP,fP,dP,mP,gP,kP,wP,NP,zO,JM,CP,{kernelName:qm,backendName:"cpu",kernelFunc:TP},{kernelName:Km,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;rD(a,"tile");var o=EP(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},{kernelName:Xm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.k;rD(i,"topk");var s=n(_P(r.data.get(i.dataId).values,i.shape,i.dtype,o),2),u=s[0],c=s[1];return[r.makeTensorInfo(u.shape,u.dtype,u.values),r.makeTensorInfo(c.shape,c.dtype,c.values)]}},ZD,{kernelName:Ym,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,r=e.attrs,a=e.backend,i=t.image,o=t.transforms,s=r.interpolation,u=r.fillMode,c=r.fillValue,l=r.outputShape,h=n(i.shape,4),p=h[0],f=h[1],d=h[2],v=h[3],m=n(null!=l?l:[f,d],2),g=m[0],y=m[1],b=[p,g,y,v],k=td(i.shape),x=k[0],w=k[1],I=k[2],N=Gf(i.dtype,Lf(b));N.fill(c);for(var S=a.data.get(i.dataId).values,C=a.data.get(o.dataId).values,T=0;T<p;++T){for(var E=1===o.shape[0]?C:C.subarray(8*T,8*T+8),_=0;_<g;++_)for(var R=0;R<y;++R)for(var A=0;A<v;++A){var D=void 0,F=E[6]*R+E[7]*_+1;if(0!==F){var O=(E[3]*R+E[4]*_+E[5])/F,M=RP((E[0]*R+E[1]*_+E[2])/F,d,u),L=RP(O,f,u);switch(s){case"nearest":D=DP(S,f,d,x,w,I,T,L,M,A,c);break;case"bilinear":D=FP(S,f,d,x,w,I,T,L,M,A,c);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(s))}N[T*x+_*w+R*I+A]=D}}return a.makeTensorInfo(b,i.dtype,N)}return{dataId:a.write(N,b,i.dtype),shape:i.shape,dtype:i.dtype}}},{kernelName:Jm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;rD(i,"unique");var o=OP(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}},{kernelName:Qm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var h=new Array(o).fill(0),p=a.shape.slice();p[i]=1;for(var f=new Array(s),d=0;d<f.length;d++){h[i]=d;var v=xF({inputs:{x:a},backend:n,attrs:{begin:h,size:p}});f[d]=LD({inputs:{x:v},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(v)}return f}},{kernelName:$m,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;rD(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,h=0;h<c;++h){var p=IO({inputs:{input:l},backend:n,attrs:{dim:h+1}});l=p,u.push(p)}for(var f=0;f<o;++f){var d=vg(f,"int32"),v=n.makeTensorInfo([],"int32",d),m=lO({inputs:{a:v,b:l},backend:n}),g=ED({inputs:{x:m},backend:n,attrs:{dtype:"float32"}}),y=RO({inputs:{a:g,b:a},backend:n}),b=ZM({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(v),u.push(m),u.push(g),u.push(y),u.push(b)}var k=SL({inputs:s,backend:n,attrs:{axis:0}});return u.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),k}},IL];MP<LP.length;MP++){pg(LP[MP])}var PP={},zP={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function BP(e){if(!(e in PP)){var t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete PP[e]},!1),1===e?t.getContext("webgl",zP)||t.getContext("experimental-webgl",zP):t.getContext("webgl2",zP)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;PP[e]=t}var n=PP[e];return n.isContextLost()?(delete PP[e],BP(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),PP[e])}var VP=(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(VP||(VP={})),VP),WP=(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(WP||(WP={})),WP),UP=(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(UP||(UP={})),UP);function HP(e,t){return[t,e]}function jP(e){var t=Lf(e);return Bf(Math.ceil(t/4))}function GP(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function qP(e,t){var n,r,a,i,o,s,u,c,l,h=e;return 2===fd().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function KP(e,t){var n=t();return fd().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}function XP(e){return!!(fd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function YP(e,t){return az(e,function(){return e.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}var ZP,JP,QP=/ERROR: [0-9]+:([0-9]+):/g;function $P(e,t){if(KP(e,function(){return e.validateProgram(t)}),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function ez(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(KP(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),KP(e,function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)}),KP(e,function(){return e.enableVertexAttribArray(s)}),!0)}function tz(e,t,n){KP(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),KP(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)})}function nz(e,t){KP(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),KP(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function rz(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function az(e,t,n){var r=KP(e,function(){return t()});if(null==r)throw new Error(n);return r}function iz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Lf(e.slice(0,e.length-t))}function oz(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function sz(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[iz(e)].concat(i(oz(e)))),t}function uz(e){return e%2==0}function cz(e,t){if(Pf(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||uz(n)&&uz(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&uz(e[0])&&uz(t[0])}function lz(e,t){return null!=e.getExtension(t)}function hz(e){try{if(null!=BP(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function pz(e){var t=qP(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function fz(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&Df("complex64"!==e.dtype,function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")})})}var dz=fd();function vz(){var e,t,n,r,a,i,o,s,u,c;return 2===fd().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function mz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=td(t);return r.map(function(t,a){return"int ".concat(e[a]," = ").concat(n," / ").concat(t,"; ").concat(a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t),";")}).join("")}function gz(e){var t=td(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}dz.registerFlag("HAS_WEBGL",function(){return dz.getNumber("WEBGL_VERSION")>0}),dz.registerFlag("WEBGL_VERSION",function(){return hz(2)?2:hz(1)?1:0}),dz.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1}),dz.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===dz.get("WEBGL_VERSION")}),dz.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),dz.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),dz.registerFlag("WEBGL_PACK",function(){return dz.getBool("HAS_WEBGL")}),dz.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_PACK_CLIP",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),dz.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_PACK_REDUCE",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_LAZILY_UNPACK",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_CONV_IM2COL",function(){return dz.getBool("WEBGL_PACK")}),dz.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return function(e){if(null==ZP){var t=BP(e);ZP=t.getParameter(t.MAX_TEXTURE_SIZE)}return ZP}(dz.getNumber("WEBGL_VERSION"))}),dz.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return function(e){if(null==JP){var t=BP(e);JP=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,JP)}(dz.getNumber("WEBGL_VERSION"))}),dz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=dz.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=BP(e);return lz(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:lz(t,"EXT_disjoint_timer_query")?1:0}(e)}),dz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return dz.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Yg()}),dz.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return function(e){if(0===e)return!1;var t=BP(e);if(1===e){if(!lz(t,"OES_texture_float"))return!1}else if(!lz(t,"EXT_color_buffer_float"))return!1;return pz(t)}(dz.getNumber("WEBGL_VERSION"))}),dz.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!dz.getBool("WEBGL_FORCE_F16_TEXTURES")&&dz.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),dz.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return function(e){if(0===e)return!1;var t=BP(e);if(1!==e){if(lz(t,"EXT_color_buffer_float"))return pz(t);var n="EXT_color_buffer_half_float";if(lz(t,n)){var r=t.getExtension(n);return function(e,t){var n=qP(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,r)}return!1}return!(!lz(t,"OES_texture_float")||!lz(t,"WEBGL_color_buffer_float"))&&pz(t)}(dz.getNumber("WEBGL_VERSION"))}),dz.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return function(e){return 2===e&&null!=BP(e).fenceSync}(dz.getNumber("WEBGL_VERSION"))}),dz.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return dz.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),dz.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))}),dz.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return Yg()&&dz.getBool("IS_CHROME")?1:-1},function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))});var yz="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",bz=function e(t){x(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=VP.DENSE;var n=jP(t),r=vz();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(mz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},kz=function e(t){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=VP.DENSE;var n=jP(t),r=vz();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(mz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},xz=function e(t){x(this,e),this.variableNames=["A"],this.outTexUsage=WP.DOWNLOAD;var n=vz();this.outputShape=t,this.userCode="\n      ".concat(yz,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},wz=function e(t){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=WP.DOWNLOAD;var n=vz();this.outputShape=t,this.userCode="\n      ".concat(yz,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},Iz=function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];x(this,e),this.variableNames=["A"];var i=vz(),o=n(r,2),s=o[0],u=o[1];this.outputShape=t;var c="result";a&&(c="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(gz(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(u,";\n        int c = imod(flatIndex, ").concat(u,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(u,".0, ").concat(s,".0);\n        vec4 values = ").concat(i.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(i.output," = vec4(").concat(c,", 0., 0., 0.);\n      }\n    ")},Nz=function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];x(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var i=vz(),o=n(r,2),s=o[0],u=o[1];this.outputShape=t;var c="",l="result";a&&(l="floor(result * 255. + 0.5)");for(var h=0;h<=1;h++)for(var p=0;p<=1;p++){var f=2*h+p;c+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(p," < ").concat(t[2],") {\n            localCoords[2] += ").concat(p,";\n            if(localCoords[1] + ").concat(h," < ").concat(t[1],") {\n              localCoords[1] += ").concat(h,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(u,";\n              c = imod(flatIndex, ").concat(u,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(u,".0, ").concat(s,".0);\n              values = ").concat(i.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(f,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(f,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(f,"] = values[2];\n              } else {\n                result[").concat(f,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(gz(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(c,"\n\n        ").concat(i.output," = ").concat(l,";\n      }\n    ")};function Sz(e,t,n,r,a,i){!function(e,t){var n=fd().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] is invalid."));if(e>n||t>n)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] greater than WebGL maximum on this browser / GPU [").concat(n,"x").concat(n,"]."))}(t,n);var o=function(e){return az(e,function(){return e.createTexture()},"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return KP(e,function(){return e.bindTexture(s,o)}),KP(e,function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),KP(e,function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),KP(e,function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)}),KP(e,function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)}),KP(e,function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)}),KP(e,function(){return e.bindTexture(e.TEXTURE_2D,null)}),o}function Cz(e){return e.internalFormatFloat}function Tz(e){return e.internalFormatHalfFloat}function Ez(e){return e.downloadTextureFormat}function _z(e){return e.internalFormatPackedFloat}function Rz(e){return e.internalFormatPackedHalfFloat}var Az=function(){function e(t){x(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=fd().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){PP[e]=t}(n,t)):this.gl=BP(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(1===fd().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=YP(this.gl,"OES_texture_float"),lz(this.gl,i))this.textureHalfFloatExtension=YP(this.gl,i);else if(fd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),lz(this.gl,a))this.colorBufferHalfFloatExtension=YP(this.gl,a);else if(fd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",lz(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!lz(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=function(e){return function(e,t){var n=az(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return KP(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),KP(e,function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){var n=az(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return KP(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)}),KP(e,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return az(e,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=qP(this.gl,this.textureHalfFloatExtension)}return I(e,[{key:"debug",get:function(){return fd().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;KP(t,function(){return t.finish()}),KP(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),KP(t,function(){return t.deleteFramebuffer(e.framebuffer)}),KP(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),KP(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),KP(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,r,a){var i=n(HP(t,r),2);return Sz(e,i[0],i[1],Cz(a),a.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,r,a){var i=n(HP(t,r),2);return Sz(e,i[0],i[1],Tz(a),a.textureFormatFloat,a.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,r,a){var i=n(HP(t,r),2);return Sz(e,i[0],i[1],Ez(a),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){KP(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),n.data instanceof Uint8Array?KP(e,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)}):KP(e,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)}),KP(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;KP(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),KP(e,function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)}),KP(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,r,a){var i=n(GP(t,r),2);return Sz(e,i[0],i[1],Rz(a),e.RGBA,a.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,r,a){var i=n(GP(t,r),2);return Sz(e,i[0],i[1],_z(a),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(nz(this.gl,this.framebuffer),this.outputTexture=null),KP(this.gl,function(){return t.gl.deleteTexture(e)})}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,r){var a=this;return this.downloadMatrixDriver(e,function(){return function(e,t,r,a){var i=n(HP(t,r),2),o=i[0],s=i[1],u=new Uint8Array(function(e,t){return 4*e}(t*r));return KP(e,function(){return e.readPixels(0,0,o,s,a.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}(a.gl,t,r,a.textureConfig)})}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,r,a,i,o){return function(e,t,r,a,i,o,s,u){var c=e,l=new Float32Array(function(e,t){var r=n(GP(e,t),2);return r[0]*r[1]*4}(o,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}(this.gl,e,0,0,0,i,o)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();KP(e,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*t*n;return KP(e,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),KP(e,function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)}),KP(e,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}(this.gl,t,n);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(fd().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return function(e,t,n){var r=new Float32Array(t*n*4);return KP(e,function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)}),r}(r.gl,t,n)})}},{key:"createProgram",value:function(e){this.throwIfDisposed();var t=this.gl,n=function(e,t){var n=az(e,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(KP(e,function(){return e.shaderSource(n,t)}),KP(e,function(){return e.compileShader(n)}),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=QP.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map(function(e,t){return Vf((t+1).toString(),i)+e}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),h=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Vf(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t,e),r=function(e){var t=vz();return function(e,t){var n=az(e,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(KP(e,function(){return e.shaderSource(n,t)}),KP(e,function(){return e.compileShader(n)}),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}(t),a=function(e){return az(e,function(){return e.createProgram()},"Unable to create WebGLProgram.")}(t);return KP(t,function(){return t.attachShader(a,r)}),KP(t,function(){return t.attachShader(a,n)}),function(e,t){if(KP(e,function(){return e.linkProgram(t)}),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,a),this.debug&&$P(t,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n){return KP(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),ez(e,t,"clipSpacePos",n,3,20,0)&&ez(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),a}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&KP(this.gl,function(){return t.gl.deleteProgram(e)})}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&$P(this.gl,this.program),KP(this.gl,function(){return t.gl.useProgram(e)})}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return az(e,function(){return e.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),KP(this.gl,function(){return n.gl.getAttribLocation(e,t)})}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){KP(e,function(){return function(e,t,n){(function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE".concat(n,"]."))})(e,n),KP(e,function(){return e.activeTexture(e.TEXTURE0+n)}),KP(e,function(){return e.bindTexture(e.TEXTURE_2D,t)})}(e,t,r)}),KP(e,function(){return e.uniform1i(n,r)})}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,r){this.throwIfDisposed();var a=n(GP(t,r),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&$P(this.gl,this.program),rz(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),KP(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),KP(this.gl,function(){return e.gl.finish()})}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=YP(this.gl,2===fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Wf(function(){return t.disposed||t.isQueryAvailable(e,fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))});case 2:return n.abrupt("return",t.getQueryTime(e,fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return n.stop()}},n)}))()}},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)&&Wf(function(){return n.pollItems(),0===n.itemsToPoll.length})}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),tz(this.gl,e,this.framebuffer),this.debug&&rz(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(tz(this.gl,this.outputTexture,this.framebuffer),this.debug&&rz(this.gl)):nz(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;tz(r,e,this.framebuffer),this.debug&&rz(r),this.outputTexture=e,KP(r,function(){return r.viewport(0,0,t,n)}),KP(r,function(){return r.scissor(0,0,t,n)})}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),KP(this.gl,function(){return a.gl.scissor(e,t,n,r)})}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}(),Dz=f.getBroadcastDims;function Fz(e,t,n,r){var a=[];e.forEach(function(e){var t=Lf(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(a.push("uniform sampler2D ".concat(e.name,";")),a.push("uniform int offset".concat(e.name,";")))});var i,o,s=a.join("\n"),u=e.map(function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";return r+=n?Mz(e):Oz(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(r+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Dz(e.shapeInfo.logicalShape,t.logicalShape),c=Uz(s),l=s-o,h=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords.".concat(h[e+l]," = 0;")}).join("\n");var p;p=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords.".concat(h[t+l])}).join(", ");var f="return outputValue;",d=1===Lf(e.shapeInfo.logicalShape),v=1===Lf(t.logicalShape);if(1!==o||d||v){if(d&&!v)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=o-2,g=o-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?f="return vec4(outputValue.x);":u.indexOf(m)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(p,");\n      ").concat(f,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=e.shapeInfo.logicalShape.length,o=t.logicalShape.length;if(!e.shapeInfo.isUniform&&i===o&&null==e.shapeInfo.flatOffset&&Pf(e.shapeInfo.texShape,t.texShape))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var s,u=Uz(o),c=Dz(e.shapeInfo.logicalShape,t.logicalShape),l=o-i,h=["x","y","z","w","u","v"];s=0===i?"":o<2&&c.length>=1?"coords = 0;":c.map(function(e){return"coords.".concat(h[e+l]," = 0;")}).join("\n");var p;return p=o<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords.".concat(h[t+l])}).join(", "),"\n    float ".concat(a,"() {\n      ").concat(u," coords = getOutputCoords();\n      ").concat(s,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}(e,t)),r}(e,t,r)}).join("\n"),c=t.texShape,l=vz(),h=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(l),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(Lz,"\n    ").concat(Pz,"\n    ").concat(zz,"\n  ")}(l);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(n[1],".0);\n      }\n    "):1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(n[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return 2 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n    }\n  ")}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Pf(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],o="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+o,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t)}}(t.logicalShape,c),o=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(l)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t);case 2:return function(e,t){return Pf(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=mz(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=mz(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=mz(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=mz(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,c),o=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(l)),r&&(p+=Bz),[p,h,o,s,i,u,n].join("\n")}function Oz(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(t,";}");var a=n(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var s=n(e.shapeInfo.texShape,2),u=s[0],c=s[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(u,", ").concat(c,", ").concat(Vz(t),");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(Wz(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=Vz(t);return 1===i?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):1===a?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(i,", index + ").concat(o,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&Pf(t,a))return"\n    float ".concat(r,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(a[1],".0, ").concat(a[0],".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var i=jf(t),o=i.newShape,s=i.keptDims;if(o.length<t.length){return"\n      ".concat(Oz(Hz(e,o)),"\n      float ").concat(r,"(int row, int col) {\n        return ").concat(r,"(").concat(jz(["row","col"],s),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(t[1],", 1)));\n        ").concat(Wz(e),"\n      }\n    ");var u=a[0],c=a[1],l=Vz(n);return 1===c?"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(l,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(u,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):1===u?"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(l,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(c,".0, 0.5);\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n  float ".concat(r,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(t[1]," + col + ").concat(l,";\n    vec2 uv = uvFromFlat(").concat(u,", ").concat(c,", index);\n    return sampleTexture(").concat(n,", uv);\n  }\n")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],i=t[2],o=jf(t),s=o.newShape,u=o.keptDims;if(s.length<t.length){return"\n        ".concat(Oz(Hz(e,s)),"\n        float ").concat(r,"(int row, int col, int depth) {\n          return ").concat(r,"(").concat(jz(["row","col","depth"],u),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(a,", ").concat(i,", 1)));\n        ").concat(Wz(e),"\n      }\n    ");var c=e.shapeInfo.texShape,l=c[0],h=c[1],p=e.shapeInfo.flatOffset;return h===a&&null==p?"\n        float ".concat(r,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(i,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(h,".0, ").concat(l,".0);\n          return sampleTexture(").concat(n,", uv);\n        }\n      "):h===i&&null==p?"\n    float ".concat(r,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(t[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(h,".0, ").concat(l,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n      float ".concat(r,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(a," + col * ").concat(i," + depth + ").concat(Vz(n),";\n        vec2 uv = uvFromFlat(").concat(l,", ").concat(h,", index);\n        return sampleTexture(").concat(n,", uv);\n      }\n  ")}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],i=t[2]*a,o=t[1]*i,s=jf(t),u=s.newShape,c=s.keptDims;if(u.length<t.length){return"\n      ".concat(Oz(Hz(e,u)),"\n      float ").concat(r,"(int row, int col, int depth, int depth2) {\n        return ").concat(r,"(").concat(jz(["row","col","depth","depth2"],c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(o,", ").concat(i,", ").concat(a,", 1)));\n        ").concat(Wz(e),"\n      }\n    ");var l=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],f=h[1];return f===o&&null==l?"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):f===a&&null==l?"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(t[1]*t[2],", ").concat(t[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(i," +\n          depth * ").concat(a," + depth2;\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(f,", index + ").concat(Vz(n),");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=jf(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){return"\n      ".concat(Oz(Hz(e,c)),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(jz(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(Wz(e),"\n      }\n    ");var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,f=p[0],d=p[1];return d===s&&null==h?"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(d,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):d===a&&null==h?"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(d,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(Vz(n),";\n      vec2 uv = uvFromFlat(").concat(f,", ").concat(d,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=jf(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){return"\n      ".concat(Oz(Hz(e,i)),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(jz(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var s=t[5],u=t[4]*s,c=t[3]*u,l=t[2]*c,h=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(h,", ").concat(l,", ").concat(c,", ").concat(u,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(s,", 1)));\n        ").concat(Wz(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],v=f[1];return v===h&&null==p?"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(l,", ").concat(c,", ").concat(u,", ").concat(s,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):v===s&&null==p?"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(h," + col * ").concat(l," + depth * ").concat(c," +\n          depth2 * ").concat(u," + depth3 * ").concat(s," + depth4 + ").concat(Vz(n),";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(t.length,"-D input sampling is not yet supported"))}}function Mz(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name;return"\n    vec4 ".concat("get"+t.charAt(0).toUpperCase()+t.slice(1),"() {\n      return ").concat(vz().texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=vz();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(i.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],o=a[1],s=vz();if(null!=a&&Pf(t,a))return"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(i,".0);\n\n        return ").concat(s.texture2D,"(").concat(n,", uv);\n      }\n    ");var u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(Math.ceil(t[1]/2),", ").concat(u[0],", ").concat(u[1],", row, col);\n      return ").concat(s.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0]){return"\n        ".concat(Mz(Hz(e,t.slice(1))),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(jz(["b","row","col"],[1,2]),");\n        }\n      ")}var o=i[0],s=i[1],u=Math.ceil(t[2]/2);return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(o,", ").concat(s,", ").concat(u*Math.ceil(t[1]/2),", ").concat(u,", b, row, col);\n      return ").concat(vz().texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",p="b * ".concat(l," + (row / 2) * ").concat(c," + (col / 2)"),f=2;f<n-1;f++)h="int b".concat(f,", ")+h,l*=t[n-f-1],p="b".concat(f," * ").concat(l," + ")+p;return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(s,");\n      return ").concat(vz().texture2D,"(").concat(r,", uv);\n    }\n  ")}(e)}}var Lz="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Pz="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",zz="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Bz="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Vz(e){return"offset".concat(e)}function Wz(e){var t=e.name,n=Lf(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Uz(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Hz(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function jz(e,t){return t.map(function(t){return e[t]}).join(", ")}function Gz(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach(function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Pf(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Pf(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(s," must match"))}})}var qz=z.addImpl,Kz=z.bincountImpl,Xz=z.bincountReduceImpl,Yz=z.ceilImpl,Zz=z.concatImpl,Jz=z.expImpl,Qz=z.expm1Impl,$z=z.floorImpl,eB=z.gatherV2Impl,tB=z.greaterImpl,nB=z.lessImpl,rB=z.linSpaceImpl,aB=z.logImpl,iB=z.maxImpl,oB=z.maximumImpl,sB=z.minimumImpl,uB=z.multiplyImpl,cB=z.negImpl,lB=z.prodImpl,hB=z.rangeImpl,pB=z.rsqrtImpl,fB=z.simpleAbsImpl,dB=z.sliceImpl,vB=z.stridedSliceImpl,mB=z.subImpl,gB=z.tileImpl,yB=z.topKImpl,bB=z.transposeImpl,kB=z.uniqueImpl;function xB(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return"".concat(e,".").concat(t)})}function wB(e,t){return 1===t?[e]:xB(e,t)}var IB=function e(t){x(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=wB("rc",n),a=Uz(n),i=function(e,t,n){if(1===e)return"rc > ".concat(t[0]);for(var r="",a=e-2;a<e;a++)r+="".concat(n[a]," >= ").concat(t[a]),a<e-1&&(r+="||");return r}(n,t,r),o=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(n,t[t.length-1],t[t.length-2],r),s=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(0===r?"r":"rp1",", ").concat(0===a?"c":"cp1"),o=2;o<e;o++)i="".concat(t[t.length-1-o],",")+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0"):"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(t,r);this.userCode="\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n\n          if(").concat(i,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}},NB=function e(t,n){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2==1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(mz(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(n),"\n      ").concat(gz(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(t[1],";\n        int cols = ").concat(t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")},SB=function(){function e(t){x(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return I(e,[{key:"acquireTexture",value:function(e,t,n){var r=TB(t,n),a=EB(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=CB(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===UP.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===UP.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===UP.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===UP.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===UP.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=TB(n,r),i=EB(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=CB(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=fd().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(this.numFreeTextures+this.numUsedTextures,")"));var e=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*e),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function CB(e,t,r,a,i){var o,s=function(e,t){switch(e){case UP.PACKED_2X2_FLOAT32:return _z(t);case UP.PACKED_2X2_FLOAT16:return Rz(t);case UP.UNPACKED_FLOAT32:return Cz(t);case UP.UNPACKED_FLOAT16:return Tz(t);case UP.PACKED_4X1_UNSIGNED_BYTE:return Ez(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,a);if(i){var u=n(GP(e[0],e[1]),2);o=u[0]*u[1]}else{var c=n(HP(e[0],e[1]),2);o=c[0]*c[1]}return o*function(e,t){if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===e.RGBA16F)return 8;throw new Error("Unknown internal format ".concat(t))}(r,s)}function TB(e,t){if(e===WP.UPLOAD)return UP.PACKED_2X2_FLOAT32;if(e===WP.RENDER||null==e)return function(e){return fd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?UP.PACKED_2X2_FLOAT32:UP.UNPACKED_FLOAT32:e?UP.PACKED_2X2_FLOAT16:UP.UNPACKED_FLOAT16}(t);if(e===WP.DOWNLOAD||e===WP.PIXELS)return UP.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function EB(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var _B=function e(t,n){x(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},RB="return abs(x);",AB="return x;",DB=function e(t,n){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},FB=function e(t){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,r=wB("rc",n),a=Uz(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},OB=WI,MB={},LB=function(){var e=function(e){d(r,e);var t=m(r);function r(e){var n;if(x(this,r),(n=t.call(this)).pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.lastGlFlushTime=0,n.warnedAboutMemory=!1,n.warnedAboutCPUBackend=!1,n.pendingDeletes=0,n.disposed=!1,!fd().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var a=BP(fd().getNumber("WEBGL_VERSION"));n.binaryCache=function(e){return e in MB||(MB[e]={}),MB[e]}(fd().getNumber("WEBGL_VERSION")),n.gpgpu=new Az(a),n.canvas=a.canvas,n.gpgpuCreatedLocally=!0}else n.gpgpu=e,n.binaryCache={},n.gpgpuCreatedLocally=!1,n.canvas=e.gl.canvas;return n.textureManager=new SB(n.gpgpu),n.numMBBeforeWarning=null==fd().global.screen?1024:fd().global.screen.height*fd().global.screen.width*window.devicePixelRatio*600/1024/1024,n.texData=new Cf(y(n),xb()),g(n)}return I(r,[{key:"nextDataId",value:function(){return r.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((fd().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||fd().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:WP.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(fd().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:WP.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new DB(o,AB):new _B(o,AB);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,p,f=null!=this.activeTimers;return f&&(h=gg()),p="complex64"===r?TI(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.getValuesFromTexture(e),f&&(this.downloadWaitMs+=gg()-h),this.convertAndCacheOnCPU(e,p)}},{key:"read",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,o,s,u,c,l,h,p,f,d,v,m,g,y,b,k,x,w,I;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.pendingRead.has(e)){n.next=3;break}return r=t.pendingRead.get(e),n.abrupt("return",new Promise(function(e){return r.push(e)}));case 3:if(a=t.texData.get(e),o=a.values,s=a.shape,u=a.slice,c=a.dtype,l=a.complexTensorInfos,h=a.isPacked,null==u){n.next=8;break}return p=h?new DB(s,AB):new _B(s,AB),f=t.runWebGLProgram(p,[{dataId:e,shape:s,dtype:c}],c),d=t.read(f.dataId),n.abrupt("return",(t.disposeIntermediateTensorInfo(f),d));case 8:if(null==o){n.next=10;break}return n.abrupt("return",t.convertAndCacheOnCPU(e));case 10:if(fd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==fd().getNumber("WEBGL_VERSION")){n.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(g=null,"complex64"!==c&&fd().get("WEBGL_BUFFER_SUPPORTED")&&(v=t.decode(e),b=t.texData.get(v.dataId),g=(y=t.gpgpu).createBufferFromTexture.apply(y,[b.texture].concat(i(jP(s))))),t.pendingRead.set(e,[]),n.t0="complex64"!==c,!n.t0){n.next=19;break}return n.next=19,t.gpgpu.createAndWaitForFence();case 19:if("complex64"!==c){n.next=26;break}return n.next=22,Promise.all([t.read(l.real.dataId),t.read(l.imag.dataId)]);case 22:k=n.sent,m=TI(k[0],k[1]),n.next=27;break;case 26:null==g?m=t.getValuesFromTexture(e):(x=Lf(s),m=t.gpgpu.downloadFloat32MatrixFromBuffer(g,x));case 27:return null!=v&&t.disposeIntermediateTensorInfo(v),w=t.convertAndCacheOnCPU(e,m),I=t.pendingRead.get(e),n.abrupt("return",(t.pendingRead.delete(e),I.forEach(function(e){return e(w)}),t.pendingDisposal.has(e)&&(t.pendingDisposal.delete(e),t.disposeData(e)&&xb().removeDataId(e,t),t.pendingDeletes--),w));case 30:case"end":return n.stop()}},n)}))()}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return bg(e)})}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return Wy(e.shape,e.dtype,n)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!XP(n))throw fd().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,o=Lf(n);if(fd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s,u=this.decode(e),c=this.texData.get(u.dataId),l=(s=this.gpgpu).downloadMatrixFromPackedTexture.apply(s,[c.texture].concat(i(jP(n)))).subarray(0,o);return this.disposeIntermediateTensorInfo(u),l}var h=fd().getBool("WEBGL_PACK")&&!0===a,p=h?sz(n):n,f=h?new wz(p):new xz(p),d=this.runWebGLProgram(f,[{shape:p,dtype:r,dataId:e}],"float32"),v=this.texData.get(d.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(d),m}},{key:"timerAvailable",value:function(){return fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){var r,a,i,o,s,u,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.activeTimers,a=[],i=!1,null==t.programTimersStack?(t.programTimersStack=a,i=!0):t.activeTimers.push(a),t.activeTimers=a,e(),o=Mf(t.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),s=Mf(t.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),t.activeTimers=r,i&&(t.programTimersStack=null),u={uploadWaitMs:t.uploadWaitMs,downloadWaitMs:t.downloadWaitMs,kernelMs:null,wallMs:null},!(fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){n.next=13;break}return n.next=9,Promise.all(o);case 9:c=n.sent,u.kernelMs=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}(c),u.getExtraProfileInfo=function(){return c.map(function(e,t){return{name:s[t],ms:e}}).map(function(e){return"".concat(e.name,": ").concat(e.ms)}).join(", ")},n.next=14;break;case 13:u.kernelMs={error:"WebGL query timers are not supported in this environment."};case 14:return n.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,u));case 15:case"end":return n.stop()}},n)}))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:gg(),endMs:null}}},{key:"endTimer",value:function(e){return fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=gg(),e)}},{key:"getQueryTime",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?t.gpgpu.waitForQueryAndGetTime(e):e.endMs-e.startMs);case 1:case"end":return n.stop()}},n)}))()}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function(){return fd().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=xb().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,r=this.getCPUBackend();return!fd().getBool("IS_TEST")&&!this.warnedAboutCPUBackend&&null==r&&(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=r&&e.every(function(e){return null==t.texData.get(e.dataId).texture&&Lf(e.shape)<n})}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){SI("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return OB(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new DB(e.shape,t),a=this.compileAndRun(r,[e],n);return xb().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=fB(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(fd().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,RB,e.dtype);var n=new _B(e.shape,RB),r=this.compileAndRun(n,[e]);return xb().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Zf(n[0])){var a=n.map(function(e){return yg(e)});r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return xb().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new FB(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new IB(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[iz(e.shape)].concat(i(oz(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[iz(t)].concat(i(oz(t))),o=new NB(a,n),s=this.runWebGLProgram(o,[r],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=sz(a);return t=r?new kz(o):new bz(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===VP.DENSE){var u=jP(e.outputShape);s.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===Lf(o.shape))return s.values=Gf(o.dtype,0),o;var c=[],l=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Lf(t.shape)<=fd().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!cz(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),c.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(o.dataId);var h,p={shape:o.shape,texData:s,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach(function(e){r+="".concat(e.shape,"_").concat(e.isUniform?"uniform":e.texData.texShape,"_").concat(null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0)});var a=e.constructor.name;return a+="_"+r+"_"+e.userCode}(e,l,p),d=this.getAndSaveBinary(f,function(){return function(e,t,n,r){var a=t.userCode,i=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),o=i.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Fz(i,s,a,t.packedInputs),c=e.createProgram(u),l=null,h=e.getUniformLocation(c,"NAN",!1);1===fd().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var p={},f=0;f<t.variableNames.length;f++){var d=t.variableNames[f];p[d]=e.getUniformLocation(c,d,false),p["offset".concat(d)]=e.getUniformLocation(c,"offset".concat(d),false)}return{program:t,source:u,webGLProgram:c,uniformLocations:p,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:h}}(a.gpgpu,e,l,p)}),v=null!=this.activeTimers;v&&(h=this.startTimer()),function(e,t,n,r,a){Gz(t.inShapeInfos,n),Gz([t.outShapeInfo],[r]);var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(t.webGLProgram),1===fd().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)];if(null!=i){if(n.isUniform){if(Lf(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(i,s)}return}null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)}}),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,d,l,p,r),c.forEach(function(e){return a.disposeIntermediateTensorInfo(e)}),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));var m=fd().get("WEBGL_FLUSH_THRESHOLD");if(m>0){var g=gg();g-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=g)}if(!fd().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var y=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),y}return o}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.runWebGLProgram(e,t,n=n||t[0].dtype,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(fd().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Ib(function(){if(!fd().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=fd().getBool("DEBUG");fd().set("DEBUG",!1);var n=e.abs(_b(1e-8)).dataSync()[0];if(fd().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),r=t.shape,a=t.dtype,i=t.values,o=t.texture,s=t.usage,u=t.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=gg());var h=t.texShape;if(null==h&&(h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=fd().getNumber("WEBGL_MAX_TEXTURE_SIZE");t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?Af(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length&&(e=jf(e).newShape);var a=Lf(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i,o=iz(e),s=2,u=2;return e.length&&(s=(i=n(oz(e),2))[0],u=i[1]),Bf(a=o*(s/2)*(u/2)).map(function(e){return 2*e})}return Bf(a)}(r,u),t.texShape=h),null!=i){var p,f,d=sz(r),v=h[1],m=h[0],g=i instanceof Uint8Array;u?(v=(p=n(GP(h[0],h[1]),2))[0],m=p[1],f=new Nz(d,[m,v],g)):f=new Iz(d,[m,v],g);var y=this.makeTensorInfo([m,v],a);this.texData.get(y.dataId).usage=g?WP.PIXELS:WP.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),v,m,i);var b=this.runWebGLProgram(f,[y],a,null,!0),k=this.texData.get(b.dataId);t.texture=k.texture,t.texShape=k.texShape,t.isPacked=k.isPacked,t.usage=k.usage,this.disposeIntermediateTensorInfo(y),this.texData.delete(b.dataId),t.values=null,l&&(this.uploadWaitMs+=gg()-c)}else{var x=this.acquireTexture(h,s,a,u);t.texture=x}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Yf(t)}}]),r}(Tf);return e.nextDataId=0,e}();Zg()&&Tb("webgl",function(){return new LB},2);var PB=function e(t,n,r){x(this,e),this.variableNames=["A","B"],this.outputShape=kk(n,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},zB=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];x(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=kk(n,r);var i=this.outputShape.length,o="";if(a)if(0===i||1===Lf(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(Uz(i)," coords = getOutputCoords();\n        "),1===i)o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=wB("coords",i);o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")};function BB(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var VB={kernelName:Nv,backendName:"webgl",kernelFunc:BB};function WB(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=BB({inputs:{x:r},backend:n}),u=BB({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var UB={kernelName:Vd,backendName:"webgl",kernelFunc:WB},HB="return (a < 0.) ? b * a : a;",jB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",GB={kernelName:Rv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",vg(i,"float32")),s=fd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zB(jB,a.shape,o.shape):new PB(HB,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],a.dtype);return n.disposeIntermediateTensorInfo(o),u}},qB="return (a < 0.) ? b * a : a;",KB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",XB={kernelName:hm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=fd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zB(KB,r.shape,a.shape):new PB(qB,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}};function YB(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var h=c.texData.get(u.dataId),p=r(h.values,l);return c.makeTensorInfo(u.shape,l,p)}return i=fd().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new DB(u.shape,n):new _B(u.shape,t),c.runWebGLProgram(i,[u],l)}}function ZB(e){var t=e.opSnippet,r=e.packedOpSnippet,a=e.checkOutOfBounds,i=void 0!==a&&a,o=e.supportsComplex,s=void 0!==o&&o,u=e.cpuKernelImpl,c=e.dtype;return function(e){var a=e.inputs,o=e.backend,l=a.a,h=a.b,p=o;if(s&&"complex64"===l.dtype){var f=p.texData.get(l.dataId),d=p.texData.get(h.dataId),v=[[f.complexTensorInfos.real,d.complexTensorInfos.real],[f.complexTensorInfos.imag,d.complexTensorInfos.imag]].map(function(e){var r=n(e,2),a=r[0],i=r[1],o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s={dataId:i.dataId,dtype:i.dtype,shape:h.shape},u=new PB(t,l.shape,h.shape);return p.runWebGLProgram(u,[o,s],zg(a.dtype,i.dtype))}),m=n(v,2),g=m[0],y=m[1],b=WB({inputs:{real:g,imag:y},backend:p});return p.disposeIntermediateTensorInfo(g),p.disposeIntermediateTensorInfo(y),b}var k,x=c||zg(l.dtype,h.dtype);if(p.shouldExecuteOnCPU([l,h])&&null!=u){var w=p.texData.get(l.dataId),I=p.texData.get(h.dataId),N=n(u(l.shape,h.shape,w.values,I.values,x),2),S=N[0],C=N[1],T=p.makeTensorInfo(C,x);return p.texData.get(T.dataId).values=S,T}return k=fd().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=r?new zB(r,l.shape,h.shape,i):new PB(t,l.shape,h.shape),p.runWebGLProgram(k,[l,h],x)}}function JB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?KB:qB;if("leakyrelu"===e)return t?jB:HB;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var QB=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];x(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;var l=Math.ceil((a?t[1]:t[2])/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",m="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),m="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var y="rc.x",b="rc.x";t[0]<n[0]?y="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(b="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(v,"\n\n      const float sharedDimension = ").concat(l,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(l,"; i++) {\n          int batchA = ").concat(y,";\n          int batchB = ").concat(b,";\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(p,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(d[0],");\n          result += (").concat(f[1]," * ").concat(d[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(g,"\n\n        ").concat(m,"\n\n        setOutput(result);\n      }\n    ")},$B=function e(t,n,r){x(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=kk(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},eV="return a * b;";function tV(e){var t,r=e.inputs,a=e.backend,i=r.a,o=r.b,s=zg(i.dtype,o.dtype);if("complex64"===i.dtype){var u=a.texData.get(i.dataId),c=a.texData.get(o.dataId),l=new $B("return areal * breal - aimag * bimag;",i.shape,o.shape),h=new $B("return areal * bimag + aimag * breal;",i.shape,o.shape),p=[{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:o.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:o.shape}],f=a.runWebGLProgram(l,p,"float32"),d=a.runWebGLProgram(h,p,"float32"),v=WB({inputs:{real:f,imag:d},backend:a});return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(d),v}if(a.shouldExecuteOnCPU([i,o])){var m=a.texData.get(i.dataId),g=a.texData.get(o.dataId),y=n(uB(i.shape,o.shape,m.values,g.values,s),2),b=y[0],k=y[1],x=a.makeTensorInfo(k,s);return a.texData.get(x.dataId).values=b,x}return t=fd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zB(eV,i.shape,o.shape):new PB(eV,i.shape,o.shape),a.runWebGLProgram(t,[i,o],s)}var nV={kernelName:em,backendName:"webgl",kernelFunc:tV};function rV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.shape,s=n,u=Lf(a.shape),c=Uf(o,u),l=Lf(c);Df(u===l,function(){return"The new shape (".concat(c,") has ").concat(l," elements and the old shape (").concat(a.shape,") has ").concat(u," elements. The new shape and old shape must have the same number of elements.")});var h=s.texData.get(a.dataId);return!h.isPacked||cz(a.shape,c)||null!==h.texture&&cz(h.shape,c)?(s.incRef(a.dataId),{dataId:a.dataId,shape:c,dtype:a.dtype}):function(e,t,n){var r=[iz(e.shape)].concat(i(oz(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},o=[iz(t)].concat(i(oz(t))),s=new NB(o,r),u=n.runWebGLProgram(s,[a],e.dtype,null,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,c,s)}var aV={kernelName:gm,backendName:"webgl",kernelFunc:rV},iV=function e(t,n){x(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(zf(l)?l.toPrecision(2):l,", ones);")}var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")},oV=function e(t,n){x(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,p="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n      }\n    "),f="vec4";"all"===n?(s="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(p,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(2===h,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(3===h,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(p,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")};function sV(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=oI(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u,c=a[o],l=c.inSize,h=c.windowSize,p=c.outSize;s="mean"===n?0===o?new iV({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:p},l):new iV({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:p}):new oV({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:p},n),u=i,i=r.runWebGLProgram(s,[i],t),u.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(u)}return i}var uV=function e(t,n){x(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=Uz(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")},cV=function e(t,n){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Uz(this.rank),o=xB("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function lV(e,t,n){var r=fd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cV(e.shape,t):new uV(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function hV(e){var t=e.inputs,r=e.backend,a=e.attrs;return function(e,t,r,a){var i=e.shape.length,o=Hf(t,e.shape),s=o,u=Zk(s,i),c=null!=u,l=e;c&&(l=lV(e,u,a),s=Qk(s.length,i)),Yk("sum",s,i);var h=n(Kk(l.shape,s),2),p=h[0],f=h[1],d=p;r&&(d=Xk(p,o));var v=Lf(f),m=rV({inputs:{x:l},attrs:{shape:[Lf(e.shape)/v,v]},backend:a}),g=sV(m,Bg(e.dtype),"sum",a),y=rV({inputs:{x:g},attrs:{shape:d},backend:a});return a.disposeIntermediateTensorInfo(m),a.disposeIntermediateTensorInfo(g),c&&a.disposeIntermediateTensorInfo(l),y}(t.x,a.axis,a.keepDims,r)}var pV={kernelName:Lm,backendName:"webgl",kernelFunc:hV};function fV(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=new Array(i.shape.length),c=0;c<u.length;c++)u[c]=i.shape[o[c]];if(s.shouldExecuteOnCPU([i])){var l=s.texData.get(i.dataId).values,h=bB(l,i.shape,i.dtype,o,u);t=s.makeTensorInfo(u,i.dtype),s.texData.get(t.dataId).values=h}else t=lV(i,o,s);return t}var dV={kernelName:Zm,backendName:"webgl",kernelFunc:fV};function vV(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,p=e.activation,f=void 0===p?null:p,d=t.shape.length,v=n.shape.length,m=r?t.shape[d-2]:t.shape[d-1],g=a?n.shape[v-1]:n.shape[v-2],y=r?t.shape[d-1]:t.shape[d-2],b=a?n.shape[v-2]:n.shape[v-1],k=t.shape.slice(0,-2),x=n.shape.slice(0,-2),w=Lf(k),I=Lf(x);Df(d>=2&&v>=2&&(w===I||1===w||1===I),function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(k,") and (").concat(x,").")});var N=(w>I?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([y,b]);Df(m===g,function(){return"Error in matMul: inner shapes (".concat(m,") and (").concat(g,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")});var S,C=r?[w,m,y]:[w,y,m],T=a?[I,b,g]:[I,g,b],E=rV({inputs:{x:t},backend:i,attrs:{shape:C}}),_=rV({inputs:{x:n},backend:i,attrs:{shape:T}}),R=[E,_],A=Math.max(w,I),D=r?E.shape[1]:E.shape[2],F=null!=s,O=null!=c,M="leakyrelu"===f,L=null!=f?JB(f,!0):null;if((1===y||1===b)&&D>1e3&&!1===(F||O||M||null!=L)){var P=E,z=_;r&&(P=fV({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),R.push(P)),a&&(z=fV({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),R.push(z));var B=1===b,V=P;1!==b&&(V=rV({inputs:{x:P},backend:i,attrs:{shape:[A,D,1]}}),R.push(V));var W=1===b?2:1,U=z;B&&(U=rV({inputs:{x:z},backend:i,attrs:{shape:[A,1,D]}}),R.push(U));var H=tV({inputs:{a:V,b:U},backend:i});S=hV({inputs:{x:H},backend:i,attrs:{axis:W,keepDims:!0}}),R.push(H)}else{var j=zg(t.dtype,n.dtype),G=new QB(C,T,[A,y,b],r,a,F,L,O,M),q=[E,_];if(null!=s&&q.push(s),O&&q.push(c),M){var K=i.makeTensorInfo([],"float32",vg(h,"float32"));q.push(K),R.push(K)}S=i.runWebGLProgram(G,q,j)}var X=rV({inputs:{x:S},backend:i,attrs:{shape:N}});R.push(S);for(var Y=0,Z=R;Y<Z.length;Y++){var J=Z[Y];i.disposeIntermediateTensorInfo(J)}return X}var mV={kernelName:ag,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return vV({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},gV="return abs(x);",yV={kernelName:yd,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=fB(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=fd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new DB(a.shape,gV):new _B(a.shape,gV),r.runWebGLProgram(t,[a],a.dtype)}},bV=YB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),kV={kernelName:bd,backendName:"webgl",kernelFunc:bV},xV=YB({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),wV={kernelName:kd,backendName:"webgl",kernelFunc:xV},IV="return a + b;",NV=ZB({opSnippet:IV,packedOpSnippet:IV,supportsComplex:!0,cpuKernelImpl:qz}),SV={kernelName:xd,backendName:"webgl",kernelFunc:NV},CV=function e(t,n){x(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map(function(e,t){return"T".concat(t)});var r=[];this.variableNames.forEach(function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))});var a=this.variableNames.map(function(e){return"v".concat(e)}).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},TV=function e(t,n){x(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map(function(e,t){return"T".concat(t)});var r=[];this.variableNames.forEach(function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))});var a=this.variableNames.map(function(e){return"v".concat(e)}).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},EV={kernelName:wd,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return BB({inputs:{x:a[0]},backend:r});if(a.length>fd().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map(function(e){return e.dtype}).reduce(function(e,t){return zg(e,t)}),c=a.map(function(e){return e.shape}),l=fd().getBool("WEBGL_PACK")?new TV(a[0].shape,c):new CV(a[0].shape,c);return r.runWebGLProgram(l,a,u)}},_V={kernelName:"All",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=Hf(o,i.shape),l=c,h=Zk(l,u),p=i;null!=h&&(p=fV({inputs:{x:i},backend:r,attrs:{perm:h}}),l=Qk(l.length,u)),Yk("all",l,u);var f,d=n(Kk(p.shape,l),2),v=d[0],m=rV({inputs:{x:p},backend:r,attrs:{shape:[-1,Lf(d[1])]}}),g=sV(m,m.dtype,"all",r);return f=rV(s?{inputs:{x:g},backend:r,attrs:{shape:Xk(v,c)}}:{inputs:{x:g},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),null!=h&&r.disposeIntermediateTensorInfo(p),f}},RV={kernelName:"Any",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=Hf(o,i.shape),l=c,h=Zk(l,u),p=i;null!=h&&(p=fV({inputs:{x:i},backend:r,attrs:{perm:h}}),l=Qk(l.length,u)),Yk("any",l,u);var f,d=n(Kk(p.shape,l),2),v=d[0],m=rV({inputs:{x:p},backend:r,attrs:{shape:[-1,Lf(d[1])]}}),g=sV(m,m.dtype,"any",r);return f=rV(s?{inputs:{x:g},backend:r,attrs:{shape:Xk(v,c)}}:{inputs:{x:g},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),null!=h&&r.disposeIntermediateTensorInfo(p),f}},AV=function e(t,n,r){x(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));",";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat("max"===n?">":"<"," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")},DV=function e(t,n,r,a){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Df(t.length>2,function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")});var i=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),a||this.variableNames.push("bestIndicesA");var o,s,u=this.outputShape,c=u.length,l=Uz(c),h=wB("coords",c);if(1===i){var p=Uz(s=c+1);o="\n        ".concat(p," sourceLocR = ").concat(p,"(").concat(h.join(),", 0);\n        ++").concat(h[c-1],";\n        ").concat(p," sourceLocG = ").concat(p,"(").concat(h.join(),", 0);\n        ++").concat(h[c-2],";\n        ").concat(p," sourceLocA = ").concat(p,"(").concat(h.join(),", 0);\n        --").concat(h[c-1],";\n        ").concat(p," sourceLocB = ").concat(p,"(").concat(h.join(),", 0);\n        --").concat(h[c-2],";")}else s=c,o="\n        ".concat(l," sourceLocR = coords;\n        ++").concat(h[c-1],";\n        ").concat(l," sourceLocG = coords;\n        ++").concat(h[c-2],";\n        ").concat(l," sourceLocA = coords;\n        --").concat(h[c-1],";\n        ").concat(l," sourceLocB = coords;\n        --").concat(h[c-2],";");var f=["x","y","z","w","u","v"].slice(0,s),d="."+f[s-1],v=f.map(function(e){return"int "+e}),m=wB("sourceLocR",s-1).concat("inIdx.r"),g=wB("sourceLocG",s-1).concat("inIdx.g"),y=wB("sourceLocB",s-1).concat("inIdx.b"),b=wB("sourceLocA",s-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),")));"),I="vec4(\n            getAChannel(".concat(m.join(),"),\n            hasNextCol ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(b.join(),") : 0.)"),N=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(f.join(),"),\n                                          vec2(").concat(f.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(f.join(),"),\n                               vec2(").concat(f.slice(-2).join(),"));\n      }\n      ").concat(N,"\n      void main() {\n        ").concat(l," coords = getOutputCoords();\n        bool hasNextCol = ").concat(h[c-1]," < ").concat(u[c-1]-1,";\n        bool hasNextRow = ").concat(h[c-2]," < ").concat(u[c-2]-1,";\n        ").concat(o,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(d,", sourceLocG").concat(d,",\n          sourceLocB").concat(d,", sourceLocA").concat(d,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")};function FV(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=oI(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new AV(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var h=FV(e,t,n,l);return e.disposeIntermediateTensorInfo(l),h}function OV(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=oI(a[a.length-1]),o=new DV(a,i,n,null==r),s=e.runWebGLProgram(o,null==r?[t]:[t,r],"int32");if(s.shape.length===t.shape.length){var u=OV(e,t,n,s);return e.disposeIntermediateTensorInfo(s),u}return s}function MV(e,t,r,a){var i=[r];if(Yk("arg"+a.charAt(0).toUpperCase()+a.slice(1),i,t.shape.length),!fd().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var o=[],s=n(Kk(t.shape,i),2),u=s[0],c=Lf(s[1]),l=rV({inputs:{x:t},backend:e,attrs:{shape:[-1,c]}});o.push(l);var h=FV(e,l,a);o.push(h);var p=rV({inputs:{x:h},backend:e,attrs:{shape:u}});return o.forEach(function(t){return e.disposeIntermediateTensorInfo(t)}),p}return OV(e,t,a)}var LV={kernelName:Id,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=Hf(r.axis,a.shape),o=Zk(i,a.shape.length),s=a,u=[];null!=o&&(s=fV({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=Qk(i.length,s.shape.length)),Yk("argMax",[i[0]],s.shape.length);var c=MV(n,s,i[0],"max");return u.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),c}},PV={kernelName:Nd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=Hf(r.axis,a.shape),o=Zk(i,a.shape.length),s=a,u=[];null!=o&&(s=fV({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=Qk(i.length,s.shape.length)),Yk("argMin",[i[0]],s.shape.length);var c=MV(n,s,i[0],"min");return u.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),c}},zV=YB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),BV={kernelName:Sd,backendName:"webgl",kernelFunc:zV},VV=YB({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),WV={kernelName:Cd,backendName:"webgl",kernelFunc:VV},UV=YB({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),HV={kernelName:Td,backendName:"webgl",kernelFunc:UV},jV=ZB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),GV={kernelName:_d,backendName:"webgl",kernelFunc:jV},qV=YB({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),KV={kernelName:Ed,backendName:"webgl",kernelFunc:qV},XV=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(x(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,p=t.effectiveFilterWidth,f=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,m="0.0";if(v||(m="-1.0 / 1e-20"),r)this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(d,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?"((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"wR * ".concat(p," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var g="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(g="avgValue / count");var y=4*Math.floor(o/4),b=o%4,k="\n      if (".concat(v,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(d,");\n      const float initializationValue = ").concat(m,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(m,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(y,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(k,"\n          }\n\n          int xC = xCCorner + ").concat(y,";\n          if (").concat(1===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(2===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(3===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(k,"\n          }\n        }\n        setOutput(").concat(g,");\n      }\n    ")}},YV=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(x(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,p=t.dilationWidth,f=t.effectiveFilterDepth,d=t.effectiveFilterHeight,v=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,k="0.0";if(b||(k="-1.0 / 1e-20"),r)this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(d,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(v,";\n                  wC += ").concat(p,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(d," * ").concat(v," +\n                      wR * ").concat(v," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var w="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(w="avgValue / count");var I=4*Math.floor(o/4),N=o%4,S="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(k,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(k,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(I,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(p,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(p,", ch)\n              );\n\n              ").concat(S,"\n            }\n\n            int xC = xCCorner + ").concat(I,";\n            if (").concat(1===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(2===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(3===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                initializationValue\n              );\n\n              ").concat(S,"\n            }\n          }\n          setOutput(").concat(w,");\n        }\n      }\n    ")}},ZV={kernelName:Rd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;fz(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Df(Kb(o,1),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '1'")});var c=Pb(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Pf(c.inShape,c.outShape))return BB({inputs:{x:a},backend:n});var l=new XV(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}},JV={kernelName:Dd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=zb(a.shape,i,o,[1,1,1],s,u,c),h=new YV(l,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},QV=function e(t){x(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n            wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,";\n            wC+= ").concat(t.dilationWidth,") {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},$V=function e(t){x(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterDepth*t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n            wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},eW={kernelName:Fd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=zb(i.shape,o,s,[1,1,1],u,c),h=new $V(l);return n.runWebGLProgram(h,[a],i.dtype)}},tW={kernelName:Ad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;fz([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Pb(o.shape,s,u,1,c),h=new QV(l);return n.runWebGLProgram(h,[a],o.dtype)}},nW={kernelName:Od,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return vV({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},rW=function e(t,n,r,a,i,o){x(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],kk(t,n),kk(t,r);var s="0.0";null!=a&&(kk(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(kk(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},aW=function e(t,n,r,a,i,o){x(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],kk(t,n),kk(t,r);var s="vec4(0.0)";null!=a&&(kk(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(kk(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},iW={kernelName:bv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;Df(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Df(null==s||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Df(null==u||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],h=null;null!=s&&(h=s.shape,l.push(s));var p=null;null!=u&&(p=u.shape,l.push(u));var f=fd().getBool("WEBGL_PACK_NORMALIZATION")?new aW(a.shape,i.shape,o.shape,h,p,c):new rW(a.shape,i.shape,o.shape,h,p,c);return n.runWebGLProgram(f,l,l[0].dtype)}},oW=function(){function e(t){x(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=Uz(this.rank),a="uniform int start[".concat(this.rank,"];"),i=function(e){if(1===e)return"sourceLoc";if(e<=6)return sW.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);n="\n        ".concat(r," sourceLoc;\n        ").concat(r," coords = getOutputCoords();\n        ").concat(t.map(function(e,t){return"sourceLoc.".concat(sW[t]," = start[").concat(t,"] + coords.").concat(sW[t],";")}).join("\n"),"\n      "),this.userCode="\n      ".concat(a,"\n      void main() {\n        ").concat(n,"\n        setOutput(getSource(").concat(i,"));\n      }\n    ")}return I(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),sW=["x","y","z","w","u","v"],uW=function(){function e(t){x(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=Uz(this.rank),r=wB("coords",this.rank),a=wB("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map(function(e,t){return"start[".concat(t,"]")}).join(),");"):t.map(function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")}).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}return I(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}();function cW(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=n(mb(i,a.begin,a.size),2),s=o[0],u=o[1];if(nb(i,s,u),0===Lf(u))return r.makeTensorInfo(u,i.dtype,[]);if(r.shouldExecuteOnCPU([i])||"string"===i.dtype){var c=r.texData.get(i.dataId),l=dB(c.values,s,u,i.shape,i.dtype);return r.makeTensorInfo(u,i.dtype,l)}var h=r.texData.get(i.dataId).isPacked,p=db(i.shape,s,u);if(h||!p){var f=fd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uW(u):new oW(u),d=f.getCustomSetupFunc(s);return r.runWebGLProgram(f,[i],i.dtype,d)}return r.uploadToGPU(i.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=vb(t,td(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(i,s,u,r)}var lW={kernelName:_m,backendName:"webgl",kernelFunc:cW},hW={kernelName:Md,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Df(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(e,t){return e*t}),u=uI(a.shape,i,s),c=cI(u.length,i.length),l=lI(a.shape,i,s),h=hI(o,i.length),p=pI(l,o,i.length),f=[],d=rV({inputs:{x:a},backend:n,attrs:{shape:u}}),v=fV({inputs:{x:d},backend:n,attrs:{perm:c}}),m=rV({inputs:{x:v},backend:n,attrs:{shape:l}}),g=cW({inputs:{x:m},backend:n,attrs:{begin:h,size:p}});return f.push(d),f.push(v),f.push(m),f.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),g}},pW={kernelName:Ld,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=Kz(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}},fW=ZB({opSnippet:"return float(a != b);",dtype:"bool"}),dW={kernelName:nm,backendName:"webgl",kernelFunc:fW};function vW(e){var t=e.inputs,n=e.backend,r=t.input;return BB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var mW={kernelName:dm,backendName:"webgl",kernelFunc:vW},gW={kernelName:Pd,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return BB({inputs:{x:i},backend:r});var s=ax(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=WB({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=vW({inputs:{input:i},backend:r}),h=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),h}if(!Kf(i.dtype,o)){var p=BB({inputs:{x:i},backend:r});return{dataId:p.dataId,shape:p.shape,dtype:o}}if("int32"===o)return function(e,t){var n=new _B(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var f=r.makeTensorInfo([],"bool",Gf("bool",1)),d=fW({inputs:{a:i,b:f},backend:r});return r.disposeIntermediateTensorInfo(f),d}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},yW="return ceil(x);",bW=YB({opSnippet:yW,packedOpSnippet:yW,cpuKernelImpl:Yz}),kW={kernelName:zd,backendName:"webgl",kernelFunc:bW},xW=function(){function e(t){x(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return I(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),wW=function(){function e(t){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return I(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),IW={kernelName:Bd,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax,u=(t=fd().getBool("WEBGL_PACK_CLIP")?new wW(i.shape):new xW(i.shape)).getCustomSetupFunc(o,s);return r.runWebGLProgram(t,[i],i.dtype,u)}},NW=function e(t){x(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "};function SW(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var CW={kernelName:Wd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new NW(r.shape),o=[SW(r,a.complexTensorInfos.real),SW(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},TW=function e(t){x(this,e),this.outputShape=[],this.outputShape=aI(t,1),this.variableNames=t.map(function(e,t){return"T".concat(t)});var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++)a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(n[i-1],"));"));a.push("else setOutput(getT".concat(n.length,"(yR, yC-").concat(n[n.length-1],"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")},EW=function e(t,n){x(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=aI(t,n);var r=this.outputShape,a=r.length,i=Uz(a),o=wB("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map(function(e,t){return"T".concat(t)});var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),p=s.join(),f="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(p,"), vec2(").concat(h.join(),"));\n        }"),d=1;d<u.length;d++){var v=u[d-1];f+="\n        if (".concat(l," < ").concat(u[d],"  && ").concat(l," >= ").concat(u[d-1],") {\n          return getChannel(\n            getT").concat(d,"(").concat(_W(s,l,v),"),\n            vec2(").concat(_W(h,l,v),"));\n        }")}var m=u[u.length-1];f+="\n        return getChannel(\n          getT".concat(u.length,"(").concat(_W(s,l,m),"),\n          vec2(").concat(_W(h,l,m),"));"),this.userCode="\n      float getValue(".concat(s.map(function(e){return"int "+e}),") {\n        ").concat(f,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function _W(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?"".concat(e," - ").concat(n):e}).join()}function RW(e){var t=e.inputs,n=e.backend,r=t.input;return BB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var AW={kernelName:Cv,backendName:"webgl",kernelFunc:RW};function DW(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map(function(e){return vW({inputs:{input:e},backend:n})}),i=e.map(function(e){return RW({inputs:{input:e},backend:n})}),o=DW(a,t,n),s=DW(i,t,n),u=WB({inputs:{real:o,imag:s},backend:n});return a.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),i.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("string"===r){var c=FW(e,t,n),l=c.tensors2D,h=c.outShape,p=l.map(function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}),f=Zz(p,h,r,1===l[0].shape[0]),d=aI(e.map(function(e){return e.shape}),t),v=n.makeTensorInfo(d,r,f);return l.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),v}if(e.length>fd().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var m=Math.floor(e.length/2),g=DW(e.slice(0,m),t,n),y=DW(e.slice(m),t,n),b=DW([g,y],t,n);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}if(fd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var k=new EW(e.map(function(e){return e.shape}),t);return n.runWebGLProgram(k,e,r)}var x=FW(e,t,n),w=x.tensors2D,I=x.outShape,N=new TW(w.map(function(e){return e.shape})),S=n.runWebGLProgram(N,w,r);w.forEach(function(e){return n.disposeIntermediateTensorInfo(e)});var C=rV({inputs:{x:S},attrs:{shape:I},backend:n});return n.disposeIntermediateTensorInfo(S),C}function FW(e,t,n){var r=aI(e.map(function(e){return e.shape}),t);return{tensors2D:e.map(function(e){return rV({inputs:{x:e},attrs:{shape:[-1,Lf(e.shape.slice(t))]},backend:n})}),outShape:r}}function OW(e){var t=e.inputs,n=e.backend,r=Hf(e.attrs.axis,t[0].shape)[0],a=aI(t.map(function(e){return e.shape}),r);if(0===Lf(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter(function(e){return Lf(e.shape)>0});return 1===i.length?BB({inputs:{x:i[0]},backend:n}):(rI(i.map(function(e){return e.shape}),r),DW(i,r,n))}var MW={kernelName:Ud,backendName:"webgl",kernelFunc:OW},LW=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];x(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,p=t.filterHeight,f=t.filterWidth,d=4*Math.floor(t.inChannels/4),v=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1,k="",w="";r&&(k=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),w="result = activation(result);");var I=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(k,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(h,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(d,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===v,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(d,") *\n                    getW(wR, wC, ").concat(d,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(d,", xR, xC) *\n                    getW(wR, wC, ").concat(d,", d2);\n              }\n\n            } else if (").concat(2===v,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===v,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2),\n                getW(wR, wC, ").concat(d," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1),\n                  getX(batch, xR, xC, ").concat(d," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC),\n                  getX(batch, ").concat(d," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(I,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")},PW=function e(t){x(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,p=t.filterHeight,f=t.filterWidth,d=4*Math.floor(t.inChannels/4),v=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(d,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===v,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(d,") *\n                  getW(wF, wR, wC, ").concat(d,", d2);\n              } else if (").concat(2===v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(d,"),\n                  getX(batch, xF, xR, xC, ").concat(d," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(d,", d2),\n                  getW(wF, wR, wC, ").concat(d," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(d,"),\n                  getX(batch, xF, xR, xC, ").concat(d," + 1),\n                  getX(batch, xF, xR, xC, ").concat(d," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(d,", d2),\n                  getW(wF, wR, wC, ").concat(d," + 1, d2),\n                  getW(wF, wR, wC, ").concat(d," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},zW=function e(t,n,r){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var a=r.filterWidth,i=r.inChannels,o=r.strideWidth,s=r.strideHeight,u=r.padInfo,c=r.outWidth,l=r.dilationWidth,h=r.dilationHeight,p=r.dataFormat,f=u.left,d=u.top,v=i*a,m=vz(),g="channelsLast"===p,y=g?0:1,b=g?1:2,k="",w=0;w<=1;w++)for(var I=0;I<=1;I++)k+="\n          blockIndex = rc.y + ".concat(I,";\n          pos = rc.x + ").concat(w,";\n\n          if(blockIndex < ").concat(t[1]," && pos < ").concat(t[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(d,";\n            d0 = offsetY + ").concat(h," * (pos / ").concat(v,");\n\n            if(d0 < ").concat(n[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(o,". - ").concat(f,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(v,".) / ").concat(i,".));\n\n              if(d1 < ").concat(n[b]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(i,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*w+I,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*w+I,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(k,"\n\n        ").concat(m.output," = result;\n      }\n    ")};function BW(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,p=e.activation,f=void 0===p?null:p,d=n.shape,v=i.texData.get(n.dataId),m="channelsLast"===a.dataFormat,g=[],y=d[2]%2!=0&&!!v.isPacked;if((1!=d[0]*d[1]*d[2]&&1!==a.outChannels||!(a.inChannels>1e3))&&fd().getBool("WEBGL_LAZILY_UNPACK")&&fd().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&y){var b={dataId:n.dataId,shape:[1,m?d[0]*d[1]*(d[2]+1):d[0]*d[2]*(d[3]+1),a.inChannels],dtype:n.dtype},k=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,Df(cz(v.shape,b.shape),function(){return"packed reshape ".concat(v.shape," to ").concat(b.shape," isn't free")});var x=rV({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});g.push(x);var w=vV({a:b,b:x,backend:i,transposeA:!1,transposeB:!1,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:h}),I=i.texData.get(w.dataId);Df(I.isPacked,function(){return"batchMatMul result is expected to be packed"}),v.shape=k,I.shape=a.outShape,(t=BB({inputs:{x:w},backend:i})).shape=a.outShape,g.push(w)}else{var N=rV({inputs:{x:n},backend:i,attrs:{shape:[1,m?d[0]*d[1]*d[2]:d[0]*d[2]*d[3],a.inChannels]}}),S=rV({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),C=vV({a:N,b:S,transposeA:!1,transposeB:!1,backend:i,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:h});t=rV({inputs:{x:C},backend:i,attrs:{shape:a.outShape}}),g.push(N),g.push(S),g.push(C)}for(var T=0,E=g;T<E.length;T++){var _=E[T];i.disposeIntermediateTensorInfo(_)}return t}function VW(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,h=e.activation,p=void 0===h?null:h,f=r.filterWidth,d=r.filterHeight,v=r.inChannels,m=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=f*d*v,k=g*m,x=[b,k],w=[],I=rV({inputs:{x:t},backend:a,attrs:{shape:t.shape.slice(1)}}),N=rV({inputs:{x:n},backend:a,attrs:{shape:[1,b,Lf(n.shape)/b]}});w.push(I),w.push(N);var S=new zW(x,I.shape,r),C=a.runWebGLProgram(S,[I],"float32"),T=rV({inputs:{x:C},backend:a,attrs:{shape:[1,x[0],x[1]]}});w.push(C),w.push(T);var E=null!=o,_=null!=u,R="leakyrelu"===p,A=p?JB(p,!0):null,D=new QB(T.shape,N.shape,[1,k,r.outChannels],!0,!1,E,A,_,R),F=[T,N];if(o&&F.push(o),_&&F.push(u),R){var O=a.makeTensorInfo([],"float32",vg(l,"float32"));F.push(O),w.push(O)}var M=a.runWebGLProgram(D,F,"float32"),L=rV({inputs:{x:M},backend:a,attrs:{shape:y?[1,g,m,r.outChannels]:[1,r.outChannels,g,m]}});w.push(M);for(var P=0,z=w;P<z.length;P++){var B=z[P];a.disposeIntermediateTensorInfo(B)}return L}var WW={kernelName:Hd,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode,p=Xb(c),f=Bb(i.shape,o.shape,s,l,u,h,!1,p);if(1!==f.filterHeight||1!==f.filterWidth||1!==f.dilationHeight||1!==f.dilationWidth||1!==f.strideHeight||1!==f.strideWidth||"SAME"!==f.padInfo.type&&"VALID"!==f.padInfo.type)if(fd().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=VW({x:i,filter:o,convInfo:f,backend:r});else{var d=new LW(f);t=r.runWebGLProgram(d,[i,o],"float32")}else t=BW({x:i,filter:o,convInfo:f,backend:r});var v=rV({inputs:{x:t},backend:r,attrs:{shape:f.outShape}});return r.disposeIntermediateTensorInfo(t),v}},UW=function e(t){x(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat("channelsLast"===t.dataFormat,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},HW=function e(t){x(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(a?3:1,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(a?1:2,"], coords[").concat(a?2:3,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(a,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},jW=function e(t){x(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t.strideDepth," - ").concat(t.padInfo.front,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},GW=function e(t){x(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(t.strideDepth,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},qW={kernelName:jd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,h=Xb(u),p=Bb(a.shape,l,o,1,s,c,!1,h),f=new UW(p);return n.runWebGLProgram(f,[a,i],"float32")}},KW={kernelName:Gd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,h=Xb(c),p=Bb(o,i.shape,s,1,u,l,!1,h),f=new HW(p);return n.runWebGLProgram(f,[a,i],"float32")}},XW={kernelName:qd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Vb(a.shape,i.shape,o,u,s),l=new PW(c);return n.runWebGLProgram(l,[a,i],"float32")}},YW={kernelName:Kd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=Vb(a.shape,u,o,1,s),l=new jW(c);return n.runWebGLProgram(l,[a,i],"float32")}},ZW={kernelName:Xd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=Vb(r.inputShape,i.shape,s,1,o),c=new GW(u);return n.runWebGLProgram(c,[a,i],"float32")}},JW=YB({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),QW={kernelName:Yd,backendName:"webgl",kernelFunc:JW},$W=YB({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),eU={kernelName:Zd,backendName:"webgl",kernelFunc:$W},tU=function e(t,r,a,i,o){x(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=n(t,4),u=s[0],c=s[1],l=s[2],h=s[3],p=n(r,1)[0],f=n(a,2),d=f[0],v=f[1];this.outputShape=[p,d,v,h];var m="bilinear"===i?1:0,g=c-1+".0",y=l-1+".0",b=n(d>1?[""+(c-1)/(d-1),"(y2-y1) * height_ratio","y1*".concat(g," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(g)],3),k=b[0],w=b[1],I=b[2],N=n(v>1?[""+(l-1)/(v-1),"(x2-x1) * width_ratio","x1*".concat(y," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(y)],3),S=N[0],C=N[1],T=N[2];this.userCode="\n      const float height_ratio = float(".concat(k,");\n      const float width_ratio = float(").concat(S,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(u,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(C,";\n\n        float in_y = ").concat(I,";\n        if( in_y < 0.0 || in_y > ").concat(g," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n        float in_x = ").concat(T,";\n        if( in_x < 0.0 || in_x > ").concat(y," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},nU={kernelName:Qd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new tU(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}},rU=function(){function e(t,n,r){x(this,e),this.variableNames=["x"],this.outputShape=t;var a=t.length,i=n?"0.0":"getX(".concat(aU(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != "+(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < ".concat(o):"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(Uz(a)," coords = getOutputCoords();\n        int end = ").concat(iU(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(iU(a,"coords")," = idx;\n          val += getX(").concat(aU(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return I(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.index&&(t.index=n.getUniformLocation(r,"index")),n.gl.uniform1f(t.index,e)}}}]),e}();function aU(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function iU(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var oU={kernelName:Jd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length,c=Zk([i],u),l=a;null!=c&&(l=fV({inputs:{x:a},backend:n,attrs:{perm:c}}));var h=Qk(1,u)[0];if(h!==u-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(a.shape.length-1," but got axis=").concat(i));for(var p=l.shape[h],f=BB({inputs:{x:l},backend:n}),d=0;d<=Math.ceil(Math.log2(p))-1;d++){var v=new rU(l.shape,!1,s),m=v.getCustomSetupFunc(d),g=f;f=n.runWebGLProgram(v,[f],f.dtype,m),n.disposeIntermediateTensorInfo(g)}if(o){var y=new rU(l.shape,o,s),b=f;f=n.runWebGLProgram(y,[f],f.dtype),n.disposeIntermediateTensorInfo(b)}if(null!=c){var k=fV({inputs:{x:f},backend:n,attrs:{perm:Jk(c)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(l),k}return f}},sU={kernelName:$d,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=Kz(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var h=n.bufferSync(a),p=n.bufferSync(i),f=Xz(h,p,o,s);return n.makeTensorInfo(f.shape,i.dtype,f.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},uU=function(){function e(t,n,r){x(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return I(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}(),cU={kernelName:ev,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Df(i>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(i)});var s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),h=new uU("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(h,[a],a.dtype)}},lU=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];x(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,p=t.dilationHeight,f=t.dilationWidth,d=t.filterHeight,v=t.filterWidth,m=t.outChannels/t.inChannels,g="",y="";r&&(g=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),y="result = activation(result);");var b=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(g,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(p,";\n\n          if (xR < 0 || xR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC++) {\n            int xC = xCCorner + wC * ").concat(f,";\n\n            if (xC < 0 || xC >= ").concat(s,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(b,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")},hU=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];x(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,p=t.dilationHeight,f=t.dilationWidth,d=t.filterHeight,v=t.filterWidth,m=v,g="int xR; int xC; int xCOffset;",y=0;y<d;y++)for(var b=0;b<v;b++)g+="\n          vec4 xTexelR".concat(y,"C").concat(2*b," = vec4(0.);\n          vec4 wR").concat(y,"C").concat(b," = vec4(0.);\n          vec4 xR").concat(y,"C").concat(b," = vec4(0.);");for(var k=0;k<d;k++)for(var w=0;w<m;w++){var I=2*w;if(g+="\n          xR = xRCorner + ".concat(k*p,";\n          xC = xCCorner + ").concat(I*f,";\n        "),1===h){if(I<v&&(g+=c%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(I," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(k,"C").concat(I,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(k,"C").concat(I," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(k,"C").concat(I," = vec4(previous.zw, xTexelR").concat(k,"C").concat(I,".xy);\n                } else {\n                  xR").concat(k,"C").concat(I," = vec4(0, 0, xTexelR").concat(k,"C").concat(I,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(o," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(I," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(I," = vec4(0.);\n                }\n\n                xR").concat(k,"C").concat(I," = xTexelR").concat(k,"C").concat(I,";\n              "),I+1<v)){var N=c%2==0?Af(f):f;f%2==0&&c%2==1||f%2!=0&&c%2!=1?(g+="\n                  xCOffset = xC + ".concat(c%2," + ").concat(N,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(k,"C").concat(I+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),f>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(o," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(k,"C").concat(I," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(k,"C").concat(I," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(k,"C").concat(I+1," = vec4(\n                    xTexelR").concat(k,"C").concat(I,".zw, xTexelR").concat(k,"C").concat(I+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(N,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(k,"C").concat(I+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(k,"C").concat(I+1," = xTexelR").concat(k,"C").concat(I+2,";\n                ")}}else I<v&&(g+="\n              if(xR >= 0 && xR < ".concat(o,") {\n            "),c%2==1?(g+="\n                xCOffset = xC + 1 - ".concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(I," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(I," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(I+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(I+2," = vec4(0.);\n                }\n\n                xR").concat(k,"C").concat(I," = vec4(\n                  xTexelR").concat(k,"C").concat(I,".zw, xTexelR").concat(k,"C").concat(I+2,".zw);\n              "),I+1<v&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(h,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(k,"C").concat(I+1," = vec4(xTexelR").concat(k,"C").concat(I+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(k,"C").concat(I," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(I," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(I+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(I+2," = vec4(0.);\n                }\n\n                xR").concat(k,"C").concat(I," = vec4(\n                  xTexelR").concat(k,"C").concat(I,".xy, xTexelR").concat(k,"C").concat(I+2,".xy);\n              "),I+1<v&&(g+="\n                  xR".concat(k,"C").concat(I+1," = vec4(\n                    xTexelR").concat(k,"C").concat(I,".zw, xTexelR").concat(k,"C").concat(I+2,".zw);\n                "))),g+="}");I<v&&(g+="\n            vec4 wTexelR".concat(k,"C").concat(I," = getW(").concat(k,", ").concat(I,", d1, q);\n            wR").concat(k,"C").concat(I," = vec4(wTexelR").concat(k,"C").concat(I,".xz, wTexelR").concat(k,"C").concat(I,".xz);\n          "),I+1<v&&(g+="\n              vec4 wTexelR".concat(k,"C").concat(I+1," = getW(").concat(k,", ").concat(I+1,", d1, q);\n              wR").concat(k,"C").concat(I+1," =\n                vec4(wTexelR").concat(k,"C").concat(I+1,".xz, wTexelR").concat(k,"C").concat(I+1,".xz);")))}for(var S=0;S<d;S++)for(var C=0;C<v;C++)g+="dotProd += xR".concat(S,"C").concat(C," * wR").concat(S,"C").concat(C,";");var T="",E="";r&&(T=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),E="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(T,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(_,"\n        ").concat(E,"\n        setOutput(result);\n      }\n    ")},pU={kernelName:tv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),Df(Kb(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")});var h,p=Bb(a.shape,i.shape,o,l,s,c,!0);return h=fd().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels==1?new hU(p):new lU(p),n.runWebGLProgram(h,[a,i],"float32")}},fU=function e(t){x(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(t.outChannels/t.inChannels," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},dU=function e(t){x(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(a,"; dm++) {\n              int d2 = d1 * ").concat(a," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},vU={kernelName:nv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,h=Bb(a.shape,l,o,s,u,c,!0),p=new fU(h);return n.runWebGLProgram(p,[a,i],"float32")}},mU={kernelName:rv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=Bb(r.inputShape,i.shape,o,s,u,c,!0),h=new dU(l);return n.runWebGLProgram(h,[a,i],"float32")}},gU=function e(t){x(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},yU={kernelName:"Diag",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(i(r.shape),i(r.shape)),o=Lf(r.shape),s=rV({inputs:{x:r},backend:n,attrs:{shape:[o]}}),u=new gU(o),c=n.runWebGLProgram(u,[s],s.dtype),l=rV({inputs:{x:c},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),l}},bU=function e(t){x(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,h=a.top,p=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(p,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")},kU={kernelName:av,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Lb(i.shape,o.shape,s,u,"NHWC",c),h=new bU(l),p=rV({inputs:{x:t=r.runWebGLProgram(h,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),p}},xU=YB({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),wU={kernelName:uv,backendName:"webgl",kernelFunc:xU},IU={kernelName:cv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=fd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zB("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new PB("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},NU=ZB({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"}),SU={kernelName:hv,backendName:"webgl",kernelFunc:NU},CU=YB({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(bI,";\n  float a1 = ").concat(kI,";\n  float a2 = ").concat(xI,";\n  float a3 = ").concat(wI,";\n  float a4 = ").concat(II,";\n  float a5 = ").concat(NI,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),TU={kernelName:lv,backendName:"webgl",kernelFunc:CU},EU="return exp(x);",_U=YB({opSnippet:EU,packedOpSnippet:EU,cpuKernelImpl:Jz}),RU={kernelName:pv,backendName:"webgl",kernelFunc:_U};function AU(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(Df(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),rV({inputs:{x:i},backend:r,attrs:{shape:s}})}var DU={kernelName:fv,backendName:"webgl",kernelFunc:AU},FU="return exp(x) - 1.0;",OU=YB({opSnippet:FU,packedOpSnippet:FU,cpuKernelImpl:Qz}),MU={kernelName:dv,backendName:"webgl",kernelFunc:OU},LU=function e(t,n,r){x(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function PU(e,t,n){var r=n.texData.get(e.dataId),a=Lf(e.shape),i=e.shape[e.shape.length-1],o=rV({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new LU("real",s,t),c=new LU("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,l,"float32"),p=n.runWebGLProgram(c,l,"float32"),f=WB({inputs:{real:h,imag:p},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p);var d=rV({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(f),d}var zU={kernelName:"FFT",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return PU(t.input,!1,n)}},BU=function(){function e(t,n){x(this,e),this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return I(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}();function VU(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Qf(a))){var o=qf(i,Lf(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new BU(r,a),u=s.getCustomSetupFunc(a);return t.runWebGLProgram(s,[],i,u)}var WU,UU={kernelName:vv,backendName:"webgl",kernelFunc:VU},HU=function e(t){x(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},jU={kernelName:mv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new HU(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},GU="return floor(x);",qU=YB({opSnippet:GU,packedOpSnippet:GU,cpuKernelImpl:$z}),KU={kernelName:gv,backendName:"webgl",kernelFunc:qU},XU=ZB({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),YU={kernelName:yv,backendName:"webgl",kernelFunc:XU},ZU=function e(t){x(this,e),this.variableNames=["A"];var r=vz(),a=n(t,2),i=a[0],o=a[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(o,".0, ").concat(i,".0);\n\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},JU=function e(t){x(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=vz(),a=n(t,2),i=a[0],o=a[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(o,".0, ").concat(i,".0);\n            vec4 values = ").concat(r.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},QU={kernelName:ng,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.pixels,o=a.numChannels,s="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,c=n(s?[i.videoWidth,i.videoHeight]:[i.width,i.height],2),l=c[0],h=c[1],p=[h,l],f=[h,l,o];(u||s)&&(null==WU&&(WU=document.createElement("canvas").getContext("2d")),WU.canvas.width=l,WU.canvas.height=h,WU.drawImage(i,0,0,l,h),i=WU.canvas);var d=r.makeTensorInfo(p,"int32");r.texData.get(d.dataId).usage=WP.PIXELS,r.gpgpu.uploadPixelDataToTexture(r.getTexture(d.dataId),i);var v=fd().getBool("WEBGL_PACK")?new JU(f):new ZU(f),m=r.runWebGLProgram(v,[d],"int32");return r.disposeData(d.dataId),m}},$U={kernelName:ig,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,h=a.dataFormat,p=a.dilations,f=a.dimRoundingMode,d=a.activation,v=a.leakyreluAlpha,m=Xb(h),g=Bb(i.shape,o.shape,c,p,l,f,!1,m),y=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(fd().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=VW({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:d,preluActivationWeights:u,leakyreluAlpha:v});else{var b=null!=s,k=null!=u,x="leakyrelu"===d,w=d?JB(d,!1):null,I=new LW(g,b,w,k,x),N=[i,o];if(s&&N.push(s),u&&N.push(u),x){var S=r.makeTensorInfo([],"float32",vg(v,"float32"));N.push(S),y.push(S)}t=r.runWebGLProgram(I,N,"float32")}else t=BW({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:d,preluActivationWeights:u,leakyreluAlpha:v});var C=rV({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach(function(e){return r.disposeIntermediateTensorInfo(e)}),C}},eH={kernelName:og,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,h=r.dimRoundingMode,p=r.activation,f=r.leakyreluAlpha,d=[],v=l;null==v&&(v=[1,1]),Df(Kb(u,v),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(v,"'")});var m,g=Bb(a.shape,i.shape,u,v,c,h,!0),y=fd().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,b=p?JB(p,y):null,k=[a,i],x=null!=o,w=null!=s,I="leakyrelu"===p;if(x&&k.push(o),w&&k.push(s),I){var N=n.makeTensorInfo([],"float32",vg(f,"float32"));k.push(N),d.push(N)}m=y?new hU(g,x,b,w,I):new lU(g,x,b,w,I);var S=n.runWebGLProgram(m,k,"float32");return d.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),S}},tH=function e(t,n,r){x(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=Uz(n.length),i=Uz(r.length);this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(this.sliceDim>1?"strides[j]":"strides",";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")},nH={kernelName:xv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=t.params,i=t.indices,o=i.shape,s=o[o.length-1],u=n(fI(a,i),4),c=u[0],l=u[1],h=u[2],p=u[3],f=rV({inputs:{x:i},backend:r,attrs:{shape:[l,s]}}),d=rV({inputs:{x:a},backend:r,attrs:{shape:[Lf(a.shape)/h,h]}}),v=new tH(s,p,[l,h]),m=r.runWebGLProgram(v,[d,f],d.dtype),g=rV({inputs:{x:m},backend:r,attrs:{shape:c}});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),g}},rH=function e(t,n){x(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=Uz(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)r.push(2===a?"int(getIndices(resRC.x, resRC.z))":"".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")},aH={kernelName:kv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=zI(a,i,Hf(o,a.shape)[0],s),c=Lf(i.shape),l=[],h=rV({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=rV({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});l.push(h),l.push(p);var f=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var d=n.bufferSync(p),v=n.bufferSync(h),m=eB(v,d,f);return l.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),n.makeTensorInfo(u.outputShape,m.dtype,m.values)}var g=new rH(h.shape,f),y=n.runWebGLProgram(g,[h,p],h.dtype);l.push(y);var b=rV({inputs:{x:y},backend:n,attrs:{shape:u.outputShape}});return l.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),b}},iH=ZB({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:tB,dtype:"bool"}),oH={kernelName:wv,backendName:"webgl",kernelFunc:iH},sH=ZB({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"}),uH={kernelName:Iv,backendName:"webgl",kernelFunc:sH},cH={kernelName:Sv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return PU(t.input,!0,n)}},lH=YB({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),hH={kernelName:Tv,backendName:"webgl",kernelFunc:lH},pH=YB({opSnippet:"return float(isinf(x));",dtype:"bool"}),fH={kernelName:Ev,backendName:"webgl",kernelFunc:pH},dH=YB({opSnippet:"return float(isnan(x));",dtype:"bool"}),vH={kernelName:_v,backendName:"webgl",kernelFunc:dH},mH=ZB({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:nB,dtype:"bool"}),gH={kernelName:Av,backendName:"webgl",kernelFunc:mH},yH=ZB({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"}),bH={kernelName:Dv,backendName:"webgl",kernelFunc:yH},kH={kernelName:Fv,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=rB(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},xH=YB({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:aB}),wH={kernelName:Ov,backendName:"webgl",kernelFunc:xH},IH=YB({opSnippet:"return log(1.0 + x);"}),NH={kernelName:Mv,backendName:"webgl",kernelFunc:IH},SH=ZB({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),CH={kernelName:Lv,backendName:"webgl",kernelFunc:SH},TH=YB({opSnippet:"return float(!(x >= 1.0));"}),EH={kernelName:Pv,backendName:"webgl",kernelFunc:TH},_H=ZB({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),RH={kernelName:zv,backendName:"webgl",kernelFunc:_H},AH=function e(t,n,r,a,i){x(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")},DH=function e(t,n,r,a,i){x(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")},FH={kernelName:Bv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=fd().getBool("WEBGL_PACK_NORMALIZATION")?new DH(a.shape,i,o,s,u):new AH(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},OH=function e(t,n,r,a,i){x(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},MH={kernelName:Vv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,h=new OH(a.shape,s,u,c,l);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function LH(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.reductionIndices,s=a.keepDims,u=i.shape.length,c=Hf(o,i.shape),l=c,h=Zk(l,u),p=null!=h,f=r.shouldExecuteOnCPU([i]),d=i;if(p){if(f){for(var v=r.texData.get(d.dataId).values,m=new Array(u),g=0;g<m.length;g++)m[g]=i.shape[h[g]];var y=bB(v,i.shape,i.dtype,h,m);d=r.makeTensorInfo(m,i.dtype),r.texData.get(d.dataId).values=y}else d=lV(i,h,r);l=Qk(l.length,u)}Yk("max",l,u);var b,k=n(Kk(d.shape,l),2),x=k[0],w=k[1],I=x;if(s&&(I=Xk(x,c)),f){var N=r.texData.get(d.dataId).values,S=iB(N,Lf(w),I,i.dtype);b=r.makeTensorInfo(I,i.dtype),r.texData.get(b.dataId).values=S}else b=function(e,t,n,r){var a=Lf(t),i=rV({inputs:{x:e},attrs:{shape:[Lf(e.shape)/a,a]},backend:r}),o=sV(i,e.dtype,"max",r),s=rV({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(d,w,I,r);return p&&r.disposeIntermediateTensorInfo(d),b}var PH={kernelName:Wv,backendName:"webgl",kernelFunc:LH},zH=ZB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:oB}),BH={kernelName:Uv,backendName:"webgl",kernelFunc:zH},VH={kernelName:Hv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;fz(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Df(Kb(o,1),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '1'")});var c=Pb(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Pf(c.inShape,c.outShape))return BB({inputs:{x:a},backend:n});var l=new XV(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}},WH={kernelName:Gv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=zb(a.shape,i,o,[1,1,1],s,c,u),h=new YV(l,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},UH=function e(t){x(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n          wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(n*r-1," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(r," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},HH=function e(t){x(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n           wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(n*r*a-1," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(r," * ").concat(a," +\n                  wR * ").concat(a," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},jH={kernelName:qv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=zb(i.shape,o,s,[1,1,1],u,c),h=new YV(l,"max",!0),p=n.runWebGLProgram(h,[i],i.dtype),f=new HH(l),d=n.runWebGLProgram(f,[a,p],i.dtype);return n.disposeIntermediateTensorInfo(p),d}},GH={kernelName:jv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;fz([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=Pb(o.shape,s,u,1,c,l),p=new XV(h,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),d=new UH(h),v=n.runWebGLProgram(d,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),v}},qH={kernelName:Kv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.attrs,a=e.backend,i=t.x,o=r.filterSize,s=r.strides,u=r.pad,c=r.includeBatchInIndex,l=a;Df(4===i.shape.length,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(i.shape.length,".")});var h=[1,1];Df(Kb(s,h),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(h,"'")});var p=Pb(i.shape,o,s,h,u),f=n(function(e,t,n,r){var a=new XV(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new XV(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(i,c,p,l),2);return[f[0],f[1]]}},KH={kernelName:Xv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.attrs,a=e.backend,i=t.x,o=r.keepDims,s=r.axis,u=a,c=i.shape.length,l=Hf(s,i.shape),h=l,p=Zk(h,c),f=null!=p,d=u.shouldExecuteOnCPU([i]),v=[],m=i;if(f){if(d){for(var g=u.texData.get(m.dataId).values,y=new Array(c),b=0;b<y.length;b++)y[b]=i.shape[p[b]];var k=bB(g,i.shape,i.dtype,p,y);m=u.makeTensorInfo(y,i.dtype),u.texData.get(m.dataId).values=k}else m=lV(i,p,u);v.push(m),h=Qk(h.length,c)}Yk("sum",h,c);var x=n(Kk(m.shape,h),2),w=x[0],I=x[1],N=w;o&&(N=Xk(w,l));for(var S=function(e,t,n,r){var a=Lf(t),i=rV({inputs:{x:e},attrs:{shape:[Lf(e.shape)/a,a]},backend:r}),o=sV(i,"float32","mean",r),s=rV({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,I,N,u),C=0,T=v;C<T.length;C++){var E=T[C];u.disposeIntermediateTensorInfo(E)}return S}},XH={kernelName:Yv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=Hf(o,i.shape),l=c,h=Zk(l,u),p=i;null!=h&&(p=fV({inputs:{x:i},backend:r,attrs:{perm:h}}),l=Qk(l.length,i.shape.length)),Yk("min",l,u);var f,d=n(Kk(p.shape,l),2),v=d[0],m=rV({inputs:{x:p},backend:r,attrs:{shape:[-1,Lf(d[1])]}}),g=sV(m,m.dtype,"min",r);return f=rV(s?{inputs:{x:g},backend:r,attrs:{shape:Xk(v,c)}}:{inputs:{x:g},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),null!=h&&r.disposeIntermediateTensorInfo(p),f}},YH=ZB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:sB}),ZH={kernelName:Zv,backendName:"webgl",kernelFunc:YH},JH=function e(t,n,r){x(this,e),this.variableNames=["x"],this.outputShape=n.map(function(e,n){return e[0]+t[n]+e[1]});var a=t.length,i=Uz(a),o=n.map(function(e){return e[0]}).join(","),s=n.map(function(e,n){return e[0]+t[n]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},QH=function e(t,n,r){x(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(e,n){return e[0]+t[n]+e[1]});var a=t.length,i=Uz(a),o=n.map(function(e){return e[0]}).join(","),s=n.map(function(e,n){return e[0]+t[n]}).join(","),u=wB("rc",a),c=wB("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p="reflect"===r?0:1,f="";if(1===a){var d="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(p,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(p,";\n        }\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(d,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(d,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var v="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(p,") +\n                gte * ((end - 1) * 2 - source + ").concat(p,");\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(v,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(v,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(v,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(v,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")},$H={kernelName:Jv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=fd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new QH(a.shape,i,o):new JH(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},ej=ZB({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),tj={kernelName:Qv,backendName:"webgl",kernelFunc:ej},nj=function(){function e(t,n,r){x(this,e),this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")}return I(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}}}]),e}(),rj=ZB({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),aj={kernelName:sv,backendName:"webgl",kernelFunc:rj},ij="return a - b;",oj=ZB({opSnippet:ij,packedOpSnippet:ij,supportsComplex:!0,cpuKernelImpl:mB}),sj={kernelName:Um,backendName:"webgl",kernelFunc:oj};function uj(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=Hf([r.dim],a.shape),o=LH({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=Xk(o.shape,i),u=rV({inputs:{x:o},backend:n,attrs:{shape:s}}),c=oj({inputs:{a:a,b:u},backend:n}),l=_U({inputs:{x:c},backend:n}),h=hV({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),p=rV({inputs:{x:h},backend:n,attrs:{shape:s}}),f=rj({inputs:{a:l,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),f}var cj={kernelName:Bm,backendName:"webgl",kernelFunc:uj},lj={kernelName:$v,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:uj({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=new nj(u.shape[0],u.shape[1],i),l=c.getCustomSetupFunc(o),h=n.runWebGLProgram(c,[u],"int32",l);return s||n.disposeIntermediateTensorInfo(u),h}},hj="return -x;",pj={kernelName:tm,backendName:"webgl",kernelFunc:function(e){var t,r=e.inputs,a=e.backend,i=r.x;if(a.shouldExecuteOnCPU([i])){var o=a.texData.get(i.dataId),s=n(cB(o.values,i.shape,i.dtype),2),u=s[0],c=s[1];return a.makeTensorInfo(c,i.dtype,u)}return t=fd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new DB(i.shape,hj):new _B(i.shape,hj),a.runWebGLProgram(t,[i],i.dtype)}},fj=vw,dj={kernelName:rm,backendName:"webgl",kernelFunc:function(e){SI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),h=fj(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},vj=mw,mj={kernelName:am,backendName:"webgl",kernelFunc:function(e){SI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),h=n.readSync(i.dataId),p=vj(l,h,o,s,u,c),f=p.selectedIndices,d=p.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}},gj=gw,yj={kernelName:im,backendName:"webgl",kernelFunc:function(e){SI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),h=n.readSync(i.dataId),p=gj(l,h,o,s,u,c),f=p.selectedIndices,d=p.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([d.length],"float32",new Float32Array(d))]}},bj=function e(t,n,r,a){x(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")},kj={kernelName:sm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,u=r.offValue,c=Lf(a.shape),l=new bj(c,o,s,u),h=rV({inputs:{x:a},backend:n,attrs:{shape:[c]}}),p=n.runWebGLProgram(l,[h],a.dtype);n.disposeIntermediateTensorInfo(h);var f=rV({inputs:{x:p},backend:n,attrs:{shape:[].concat(i(a.shape),[o])}});return n.disposeIntermediateTensorInfo(p),f}};function xj(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=vW({inputs:{input:r},backend:n}),i=xj({inputs:{x:a},backend:n}),o=RW({inputs:{input:r},backend:n}),s=xj({inputs:{x:o},backend:n}),u=WB({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return VU({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var wj={kernelName:eg,backendName:"webgl",kernelFunc:xj},Ij={kernelName:om,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=vW({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=RW({inputs:{input:a},backend:r}),u=xj({inputs:{x:s},backend:r}),c=WB({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return VU({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},Nj={kernelName:um,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return AU({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach(function(e){Ff(a,e.shape,"All tensors passed to stack must have matching shapes"),Df(i===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=[],s=OW({inputs:t.map(function(e){var t=AU({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t}),backend:n,attrs:{axis:r}});return o.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),s}},Sj=function(){function e(t,n,r){x(this,e),this.variableNames=["x"],this.outputShape=n.map(function(e,n){return e[0]+t[n]+e[1]});var a=t.length,i=Uz(a),o=n.map(function(e){return e[0]}).join(","),s=n.map(function(e,n){return e[0]+t[n]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n      uniform float value;\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n        uniform float value;\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}return I(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}(),Cj=function(){function e(t,n,r){x(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(e,n){return e[0]+t[n]+e[1]});for(var a=t.length,i=Uz(a),o=n.map(function(e){return e[0]}).join(","),s=n.map(function(e,n){return e[0]+t[n]}).join(","),u=wB("rc",a),c=wB("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",v=0,m=1===a?2:4;v<m;v++)d+="\n        ".concat(p[v],"\n        if (").concat(f,") {\n          result[").concat(v,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");d+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n      uniform float value;\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}return I(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}(),Tj=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue,s=fd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Cj(a.shape,i,o):new Sj(a.shape,i,o),u=s.getCustomSetupFunc(o);return n.runWebGLProgram(s,[a],a.dtype,u)},Ej={kernelName:cm,backendName:"webgl",kernelFunc:Tj},_j=ZB({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),Rj={kernelName:lm,backendName:"webgl",kernelFunc:_j},Aj={kernelName:pm,backendName:"webgl",kernelFunc:function(e){var t,r=e.inputs,a=e.backend,i=e.attrs,o=r.x,s=i.axis,u=i.keepDims,c=o.shape.length,l=[],h=Hf(s,o.shape),p=h,f=Zk(p,c),d=o;if(null!=f&&(d=fV({inputs:{x:o},backend:a,attrs:{perm:f}}),p=Qk(p.length,c),l.push(d)),Yk("prod",p,c),a.shouldExecuteOnCPU([d])){var v=a.texData.get(d.dataId).values,m=lB(d.shape,d.dtype,v,p),g=m.outVals,y=m.outShape,b=m.outDtype;t=a.makeTensorInfo(y,b,g)}else{var k=n(Kk(d.shape,p),2),x=k[0],w=Lf(k[1]),I=rV({inputs:{x:d},backend:a,attrs:{shape:[-1,w]}}),N=sV(I,Bg(o.dtype),"prod",a);t=rV({inputs:{x:N},backend:a,attrs:{shape:x}}),l.push(I),l.push(N)}if(u){l.push(t);var S=Xk(t.shape,h);t=rV({inputs:{x:t},backend:a,attrs:{shape:S}})}return l.forEach(function(e){return a.disposeIntermediateTensorInfo(e)}),t}},Dj=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=hB(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},Fj={kernelName:fm,backendName:"webgl",kernelFunc:Dj},Oj=YB({opSnippet:"return 1.0 / x;"}),Mj={kernelName:vm,backendName:"webgl",kernelFunc:Oj},Lj=YB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Pj={kernelName:mm,backendName:"webgl",kernelFunc:Lj},zj=YB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Bj={kernelName:wm,backendName:"webgl",kernelFunc:zj},Vj=function e(t,r,a,i,o){x(this,e),this.variableNames=["A"],this.outputShape=[];var s=n(t,4),u=s[0],c=s[1],l=s[2],h=s[3];this.outputShape=[u,r,a,h];var p,f=[i&&r>1?c-1:c,i&&a>1?l-1:l],d=[i&&r>1?r-1:r,i&&a>1?a-1:a];p=o?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/d[0],",\n          ").concat(f[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},Wj=function e(t,r,a,i,o){x(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=n(t,4),u=s[0],c=s[1],l=s[2],h=s[3];this.outputShape=[u,r,a,h];var p,f=[i&&r>1?c-1:c,i&&a>1?l-1:l],d=[i&&r>1?r-1:r,i&&a>1?a-1:a];p=o?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/d[0],",\n          ").concat(f[1]/d[1],",\n          ").concat(f[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(h-1,";\n        bool hasNextRow = coords.z < ").concat(a-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")},Uj={kernelName:km,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.images,o=a.alignCorners,s=a.halfPixelCenters,u=n(a.size,2),c=u[0],l=u[1],h=fd().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Wj(i.shape,c,l,o,s):new Vj(i.shape,c,l,o,s);return r.runWebGLProgram(h,[i],"float32")}},Hj=function e(t,r,a){x(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;var i=n(r,3),o=i[1],s=i[2],u=n(t,3),c=u[1],l=u[2],h=[a&&c>1?o-1:o,a&&l>1?s-1:s],p=[a&&c>1?c-1:c,a&&l>1?l-1:l],f=h[0]/p[0],d=h[1]/p[1],v=1/f,m=1/d,g=2*Math.ceil(v)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(o-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(s-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},jj={kernelName:xm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new Hj(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},Gj=function e(t,r,a,i,o){x(this,e),this.variableNames=["A"],this.outputShape=[];var s=n(t,4),u=s[0],c=s[1],l=s[2],h=s[3];this.outputShape=[u,r,a,h];var p,f=[i&&r>1?c-1:c,i&&a>1?l-1:l],d=[i&&r>1?r-1:r,i&&a>1?a-1:a];p=o?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/d[0],",\n          ").concat(f[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(i?"0.5":"0.0",")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},qj={kernelName:ym,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.images,o=a.alignCorners,s=a.halfPixelCenters,u=n(a.size,2),c=u[0],l=u[1],h=new Gj(i.shape,c,l,o,s);return r.runWebGLProgram(h,[i],i.dtype)}},Kj=function e(t,r,a){x(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;var i=n(r,3),o=i[1],s=i[2],u=n(t,3),c=u[1],l=u[2],h=[a&&c>1?o-1:o,a&&l>1?s-1:s],p=[a&&c>1?c-1:c,a&&l>1?l-1:l],f=h[0]/p[0],d=h[1]/p[1],v=1/f,m=1/d,g=2*Math.ceil(v)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(h[0],") *\n                (float(dyR) / float(").concat(p[0],"));\n\n            float sourceFracCol =\n                float(").concat(h[1],") *\n                  (float(dyC) / float(").concat(p[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(a," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(s,") - 1),\n                ").concat(a," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},Xj={kernelName:bm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new Kj(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},Yj=function e(t,n){x(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map(function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)}).join(","),i=Uz(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")},Zj=function e(t,n){x(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a,i=wB("rc",r),o="".concat(i[r-1]," + 1 < ").concat(this.outputShape[r-1]),s="".concat(i[r-2]," + 1 < ").concat(this.outputShape[r-2]),u=Uz(r);function c(e){var r=t.map(function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)});return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(u," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat((a=i.slice(),c(a)),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",c(e)}(i.slice()),";\n          }\n          if(").concat(s,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")},Jj={kernelName:Im,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Hf(i,a.shape);if(0===o)return BB({inputs:{x:a},backend:n});var u=fd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zj(a.shape,s):new Yj(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},Qj=function(){function e(t,n){x(this,e),this.variableNames=["Image"],this.outputShape=[];var r=t[1],a=t[2];this.outputShape=t;var i;i="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        uniform vec4 params;\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}return I(e,[{key:"getCustomSetupFunc",value:function(e,t,n,r){var a=this;return function(i,o){null==a.paramsLoc&&(a.paramsLoc=i.getUniformLocationNoThrow(o,"params")),i.gl.uniform4f(a.paramsLoc,e,t,n,r)}}}]),e}(),$j={kernelName:rg,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.attrs,a=e.backend,i=t.image,o=r.radians,s=r.fillValue,u=r.center,c=a,l=new Qj(i.shape,s),h=n(sI(u,i.shape[1],i.shape[2]),2),p=h[0],f=h[1],d=l.getCustomSetupFunc(p,f,Math.sin(o),Math.cos(o));return c.runWebGLProgram(l,[i],i.dtype,d)}},eG=YB({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),tG={kernelName:Nm,backendName:"webgl",kernelFunc:eG},nG=YB({opSnippet:"return inversesqrt(x);",cpuKernelImpl:pB}),rG={kernelName:Sm,backendName:"webgl",kernelFunc:nG},aG=function e(t,n,r,a,i,o){x(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Uz(i.length),u=Uz(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="";1===a?l="i":2===a&&(l="i, coords[1]"),this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(getIndices(").concat(c,"));\n              flattenedIndex += index * ").concat(n>1?"strides[j]":"strides",";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates(").concat(l,");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")},iG={kernelName:Cm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=mI(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,f=[p/l,l];if(0===p)return n.makeTensorInfo(o,a.dtype);var d=rV({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=rV({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new aG(c,u,d.shape.length,v.shape.length,h,f),y=n.runWebGLProgram(g,[v,d,m],v.dtype),b=rV({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}},oG=function e(t,n,r){var a,i;if(x(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Uz(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")},sG={kernelName:Tm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new oG(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],zg(a.dtype,i.dtype))}},uG=YB({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(gI,";\n  float scale = ").concat(yI,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),cG={kernelName:Em,backendName:"webgl",kernelFunc:uG},lG=YB({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"}),hG={kernelName:Fm,backendName:"webgl",kernelFunc:lG},pG=YB({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),fG={kernelName:Dm,backendName:"webgl",kernelFunc:pG},dG=YB({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),vG={kernelName:Rm,backendName:"webgl",kernelFunc:dG},mG=YB({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),gG={kernelName:Am,backendName:"webgl",kernelFunc:mG},yG=YB({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),bG={kernelName:Om,backendName:"webgl",kernelFunc:yG},kG={kernelName:Pm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.paddings;Df(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var u=o.reduce(function(e,t){return e*t}),c=[[0,0]];c.push.apply(c,i(s));for(var l=1+o.length;l<a.shape.length;++l)c.push([0,0]);var h=[],p=Tj({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),f=uI(p.shape,o,u,!1),d=cI(f.length,o.length,!1),v=lI(p.shape,o,u,!1),m=rV({inputs:{x:p},backend:n,attrs:{shape:f}}),g=fV({inputs:{x:m},backend:n,attrs:{perm:d}}),y=rV({inputs:{x:g},backend:n,attrs:{shape:v}});return h.push(p),h.push(m),h.push(g),h.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),y}},xG={kernelName:Hm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=mI(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.strides,p=u.outputSize,f=new aG(l,c,a.shape.length,i.shape.length,h,[p,1],!1),d=n.runWebGLProgram(f,[i,a,o],i.dtype),v=rV({inputs:{x:d},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(d),v}},wG={kernelName:zm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.numOrSizeSplits,s=Hf(r.axis,a.shape)[0],u=MI(a,o,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(e){var t=i(l);t[s]=e;var r=cW({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r})}},IG=YB({opSnippet:"return sqrt(x);"}),NG={kernelName:Mm,backendName:"webgl",kernelFunc:IG},SG={kernelName:Wm,backendName:"webgl",kernelFunc:YB({opSnippet:"return x * x;"})},CG="return (a - b) * (a - b);",TG=ZB({opSnippet:CG,packedOpSnippet:CG}),EG={kernelName:Vm,backendName:"webgl",kernelFunc:TG},_G={kernelName:tg,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=new _B(a.shape,"if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "));return r.runWebGLProgram(i,[a],a.dtype)}},RG=function e(t,n,r){x(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=Uz(r.length),o=Uz(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map(function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")}).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")},AG={kernelName:jm,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,h=a.ellipsisMask,p=a.newAxisMask,f=a.shrinkAxisMask,d=gb(i.shape,o,s,u,c,l,h,p,f),v=d.nonStrided,m=d.$begin,g=d.$strides,y=d.size,b=d.newShape,k=d.outShape,x=rV({inputs:{x:i},backend:r,attrs:{shape:b}});if(v){var w=cW({inputs:{x:x},backend:r,attrs:{begin:m,size:y}});t=rV({inputs:{x:w},backend:r,attrs:{shape:k}}),r.disposeIntermediateTensorInfo(w)}else if(k.some(function(e){return 0===e}))t=r.makeTensorInfo(k,i.dtype,[]);else if(r.shouldExecuteOnCPU([x])){var I=r.texData.get(x.dataId).values,N=Wy(x.shape,x.dtype,I),S=vB(k,N,g,m);t=r.makeTensorInfo(k,x.dtype,S.values)}else{var C=new RG(m,g,k);t=r.runWebGLProgram(C,[x],x.dtype)}var T=rV({inputs:{x:t},backend:r,attrs:{shape:k}});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(t),T}},DG=YB({opSnippet:"return tan(x);"}),FG={kernelName:Gm,backendName:"webgl",kernelFunc:DG},OG=YB({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),MG=function e(t,n){x(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=Uz(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")};function LG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype){var o=n.readSync(a.dataId).map(function(e){return bg(e)}),s=Wy(a.shape,a.dtype,o),u=gB(s,i);return n.makeTensorInfo(u.shape,u.dtype,u.values)}var c=new MG(a.shape,i);return n.runWebGLProgram(c,[a],a.dtype)}for(var PG=function e(t,n,r,a,i,o){x(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4;break;default:s=1}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")},zG=function e(t,n){x(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(p,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},BG=0,VG=[FH,MH,mV,yV,kV,wV,SV,EV,_V,RV,LV,PV,BV,WV,GV,HV,KV,JV,ZV,eW,tW,nW,iW,hW,pW,gW,kW,IW,CW,UB,MW,qW,KW,WW,YW,ZW,XW,QW,eU,nU,oU,sU,cU,vU,mU,pU,yU,kU,wU,IU,SU,TU,RU,DU,MU,zU,UU,jU,KU,YU,QU,$U,eH,nH,aH,oH,uH,VB,cH,AW,hH,fH,vH,GB,gH,bH,kH,NH,wH,CH,EH,RH,PH,WH,VH,jH,GH,qH,BH,KH,XH,ZH,$H,tj,lj,nV,pj,dj,mj,yj,dW,kj,Ij,Nj,Ej,Rj,XB,Aj,Fj,mW,aj,Mj,Bj,Pj,aV,Uj,jj,qj,Xj,Jj,$j,tG,rG,iG,sG,cG,hG,fG,vG,gG,lW,cj,bG,kG,xG,wG,NG,SG,EG,_G,AG,sj,pV,FG,{kernelName:qm,backendName:"webgl",kernelFunc:OG},{kernelName:Km,backendName:"webgl",kernelFunc:LG},{kernelName:Xm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.x,o=a.k,s=a.sorted,u=r.readSync(i.dataId),c=n(yB(u,i.shape,i.dtype,o,s),2),l=c[0],h=c[1];return[r.makeTensorInfo(l.shape,l.dtype,l.values),r.makeTensorInfo(h.shape,h.dtype,h.values)]}},{kernelName:Ym,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,r=e.backend,a=e.attrs,i=t.image,o=t.transforms,s=a.interpolation,u=a.fillMode,c=a.fillValue,l=a.outputShape,h=n(i.shape,4),p=h[0],f=h[1],d=h[2],v=h[3],m=n(null!=l?l:[f,d],2),g=m[0],y=m[1],b=new PG(f,d,s,u,c,[p,g,y,v]);return r.runWebGLProgram(b,[i,o],"float32")}},dV,{kernelName:Jm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;fz(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=kB(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:Qm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,h=0;h<s;h++)h!==i&&(c[l++]=o.shape[h]);var p=[],f=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var v=new Array(u),m=0;m<v.length;m++){f[i]=m;var g=cW({inputs:{x:o},backend:n,attrs:{begin:f,size:d}}),y=rV({inputs:{x:g},backend:n,attrs:{shape:c}});v[m]=y,p.push(g)}return p.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),v}},{kernelName:$m,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=Zk([c],s),h=a;null!=l&&(h=fV({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(h),c=Qk(1,s)[0]);var p=PI(h.shape,c,o),f=Lf([h.shape[c]]),d=rV({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}});u.push(d);var v=rV({inputs:{x:function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=LI(c,o),h=new zG({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),p=n.compileAndRun(h,[t,a],i);if(u.push(p),p.shape[1]===o)return p;var f=Dj({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),d=LG({inputs:{x:f},backend:n,attrs:{reps:[c/l]}});return u.push(f),u.push(d),e(p,r,d,i,o)}(d,"unsortedSegmentSum",i,Bg(a.dtype),o)},backend:n,attrs:{shape:p}}),m=v;if(null!=l){u.push(v);var g=Jk(l);m=fV({inputs:{x:m},backend:n,attrs:{perm:g}})}return u.forEach(function(e){return n.disposeIntermediateTensorInfo(e)}),m}},wj];BG<VG.length;BG++){pg(VG[BG])}var WG={flipHorizontal:!1,outputStride:16,imageScaleFactor:1,maxNumBoxes:20,iouThreshold:.2,scoreThreshold:.6,modelType:"ssd320fpnlite",modelSize:"small",bboxLineWidth:"2",fontSize:17,basePath:"https://cdn.jsdelivr.net/npm/handtrackjs@latest/models/webmodel/",labelMap:{1:"open",2:"closed",3:"pinch",4:"point",5:"face",6:"pointtip",7:"pinchtip"},renderThresholds:null},UG={large:"base",medium:"fp16",small:"int8"},HG={open:"#374151",closed:"#B91C1C",pinch:"#F59E0B",point:"#10B981",face:"#3B82F6",pointtip:"#6366F1",pinchtip:"#EC4899"},jG={ssd320fpnlite:["StatefulPartitionedCall/Postprocessor/Slice","StatefulPartitionedCall/Postprocessor/ExpandDims_1"],ssd640fpnlite:["StatefulPartitionedCall/Postprocessor/Slice","StatefulPartitionedCall/Postprocessor/ExpandDims_1"],centernet512fpn:["Identity_4:0","Identity:0","Identity_2:0"]};function GG(){return(GG=Sf(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.assign({},WG,t),r=new KG(n),e.next=4,r.load();case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function qG(){return(qG=Sf(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.localStream){e.next=2;break}return e.abrupt("return",!1);case 2:window.localStream.getTracks().forEach(function(e){return e.stop(),!0});case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}var KG=function(){function e(t){x(this,e),this.modelPath=t.basePath+t.modelType+"/"+(UG[t.modelSize]||"base")+"/model.json ",this.modelParams=t}return I(e,[{key:"load",value:function(){var e=this;return Sf(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.fps=0,t.next=3,function(e){return nD.apply(this,arguments)}(e.modelPath);case 3:return e.model=t.sent,n=ax([1,300,300,3],"int32"),t.next=7,e.model.executeAsync(n,jG[e.modelParams.modelType]);case 7:(r=t.sent).map(function(){var e=Sf(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.data();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),r.map(function(){var e=Sf(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.dispose());case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Nb(n);case 9:case"end":return t.stop()}},t)}))()}},{key:"detect",value:function(e){var t=this;return Sf(regeneratorRuntime.mark(function r(){var a,i,o,s,u,c,l,h,p;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=Date.now(),i=function(e){return e instanceof Rg?[e.shape[0],e.shape[1]]:[e.height,e.width]}(e),o=n(i,2),s=o[0],u=o[1],c=XG(t.modelParams.imageScaleFactor,s,t.modelParams.outputStride),l=XG(t.modelParams.imageScaleFactor,u,t.modelParams.outputStride),h=Ib(function(){var n=tb(e);return t.modelParams.flipHorizontal?n.reverse(1).resizeBilinear([c,l]).expandDims(0).toInt():n.resizeBilinear([c,l]).expandDims(0).toInt()}),p=t,r.abrupt("return",t.model.executeAsync(h,jG[t.modelParams.modelType]).then(function(e){h.dispose();var t=[];if("centernet512fpn"===p.modelParams.modelType){var r=e[0].dataSync(),i=e[1].arraySync(),o=e[2].dataSync();Nb(e),t=p.buildDetectObjectsCenternet(u,s,i[0],r,o),console.log(t)}else{var c=e[0].dataSync(),l=e[1].dataSync();Nb(e);var f=n(function(e,t,n){for(var r=[],a=[],i=0;i<t;i++){for(var o=Number.MIN_VALUE,s=-1,u=0;u<n;u++)e[i*n+u]>o&&(o=e[i*n+u],s=u);r[i]=o,a[i]=s}return[r,a]}(c,e[0].shape[1],e[0].shape[2]),2),d=f[0],v=f[1],m=Kg.backendName;Cb("cpu");var g=Ib(function(){var t=Dx(l,[e[1].shape[1],e[1].shape[3]]);return jw.nonMaxSuppression(t,d,p.modelParams.maxNumBoxes,p.modelParams.iouThreshold,p.modelParams.scoreThreshold)}),y=g.dataSync();g.dispose(),Cb(m),t=p.buildDetectedObjects(u,s,l,d,y,v)}var b=Date.now();return p.fps=Math.round(1e3/(b-a)),t}));case 3:case"end":return r.stop()}},r)}))()}},{key:"buildDetectedObjects",value:function(e,t,n,r,a,i){for(var o=a.length,s=[],u=0;u<o;u++){for(var c=[],l=0;l<4;l++)c[l]=n[4*a[u]+l];var h=c[0]*t,p=c[1]*e,f=c[2]*t,d=c[3]*e;c[0]=p,c[1]=h,c[2]=d-p,c[3]=f-h;var v=Math.round(i[a[u]])+1;s.push({bbox:c,class:v,label:this.modelParams.labelMap[v],score:r[a[u]].toFixed(2)})}return s}},{key:"buildDetectObjectsCenternet",value:function(e,t,n,r,a){for(var i=[],o=0;o<r.length;o++){var s=n[o],u=s[0]*t,c=s[1]*e,l=s[2]*t,h=s[3]*e;s[0]=c,s[1]=u,s[2]=h-c,s[3]=l-u;var p=Math.round(a[o])+1;i.push({bbox:s,class:p,label:this.modelParams.labelMap[p],score:r[o].toFixed(2)})}return i.slice(0,10)}},{key:"getFPS",value:function(){return this.fps}},{key:"setModelParameters",value:function(e){this.modelParams=Object.assign({},this.modelParams,e)}},{key:"getModelParameters",value:function(){return this.modelParams}},{key:"roundRect",value:function(e,t,n,r,a,i,o,s){if(void 0===s&&(s=!0),void 0===i&&(i=5),"number"==typeof i)i={tl:i,tr:i,br:i,bl:i};else{var u={tl:0,tr:0,br:0,bl:0};for(var c in u)i[c]=i[c]||u[c]}e.beginPath(),e.moveTo(t+i.tl,n),e.lineTo(t+r-i.tr,n),e.quadraticCurveTo(t+r,n,t+r,n+i.tr),e.lineTo(t+r,n+a-i.br),e.quadraticCurveTo(t+r,n+a,t+r-i.br,n+a),e.lineTo(t+i.bl,n+a),e.quadraticCurveTo(t,n+a,t,n+a-i.bl),e.lineTo(t,n+i.tl),e.quadraticCurveTo(t,n,t+i.tl,n),e.closePath(),o&&e.fill(),s&&e.stroke()}},{key:"renderPredictions",value:function(e,t,n,r){n.clearRect(0,0,t.width,t.height),t.width=r.width,t.height=r.height,t.style.height=parseInt(t.style.width)*(r.height/r.width).toFixed(2)+"px",n.save(),this.modelParams.flipHorizontal&&(n.scale(-1,1),n.translate(-r.width,0)),n.drawImage(r,0,0,r.width,r.height),n.restore(),n.font="bold "+this.modelParams.fontSize+"px Arial";for(var a=this.modelParams.renderThresholds,i=0;i<e.length;i++){var o=e[i];(!a||o.score>a[o.label])&&(n.beginPath(),n.fillStyle="rgba(255, 255, 255, 0.6)",n.fillRect(o.bbox[0]+1,o.bbox[1]+1,o.bbox[2]-1,1.5*this.modelParams.fontSize),n.lineWidth=this.modelParams.bboxLineWidth,this.roundRect(n,o.bbox[0],o.bbox[1],o.bbox[2],o.bbox[3],5,!1,!0),n.strokeStyle=HG[o.label],n.fillStyle=HG[o.label],n.stroke(),n.beginPath(),n.arc(o.bbox[0]+o.bbox[2]/2,o.bbox[1]+o.bbox[3]/2,2,0,2*Math.PI),n.fill(),n.stroke(),n.fillText(o.score+" | "+o.label,o.bbox[0]+5,o.bbox[1]+1.1*this.modelParams.fontSize))}n.fillStyle="rgba(255, 255, 255, 0.6)",this.roundRect(n,10,10,4.6*this.modelParams.fontSize,this.modelParams.fontSize+8,5,!0,!1),n.strokeStyle="#374151",n.fillStyle="#374151",n.font="bold "+this.modelParams.fontSize+"px Arial",n.fillText("FPS: "+this.fps,18,this.modelParams.fontSize+12)}},{key:"dispose",value:function(){this.model&&this.model.dispose()}}]),e}();function XG(e,t,n){var r=t*e-1;return r-r%n+1}var YG=function(){function e(t){x(this,e),this.prediction="None",this.prediction=t}return I(e,[{key:"getPrediction",value:function(){return this.prediction}}]),e}(),ZG=["htvideo"],JG=function(){var e=function(){function e(){x(this,e),this.onPrediction=new xs,this.SAMPLERATE=500,this.detectedGesture="None",this.width="400",this.height="400",this.model=null,this.runInterval=null,this.modelParams={flipHorizontal:!0,maxNumBoxes:20,iouThreshold:.5,scoreThreshold:.6}}return I(e,[{key:"ngOnInit",value:function(){var e=this;(function(e){return GG.apply(this,arguments)})(this.modelParams).then(function(t){e.model=t,console.log("loaded")})}},{key:"ngOnDestroy",value:function(){this.model.dispose()}},{key:"startVideo",value:function(){return function(e){return new Promise(function(t,n){e||t({status:!1,msg:"please provide a valid video element"}),e.width=e.width||640,e.height=e.width*(e.videoHeight/e.videoWidth),e.style.height="20px",navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}}).then(function(n){window.localStream=n,e.srcObject=n,e.onloadedmetadata=function(){e.height=e.width*(e.videoHeight/e.videoWidth),e.style.height=parseInt(e.style.width)*(e.videoHeight/e.videoWidth).toFixed(2)+"px",e.play(),t({status:!0,msg:"webcam successfully initiated."})}}).catch(function(e){t({status:!1,msg:e})})})}(this.video.nativeElement).then(function(e){return e},function(e){return e})}},{key:"startDetection",value:function(){var e=this;this.startVideo().then(function(){e.video.nativeElement.style.height="200px",console.log("starting predictions"),e.runInterval=setInterval(function(){e.runDetection()},e.SAMPLERATE)},function(e){console.log(e)})}},{key:"stopDetection",value:function(){console.log("stopping predictions"),clearInterval(this.runInterval),function(){qG.apply(this,arguments)}(this.video.nativeElement)}},{key:"runDetection",value:function(){var e=this;null!=this.model?this.model.detect(this.video.nativeElement).then(function(t){if(!(t.length<=0)){var n,r=0,a=0,i=0,o=0,u=s(t);try{for(u.s();!(n=u.n()).done;){var c=n.value;console.log(c.label+" at X: "+c.bbox[0]+", Y: "+c.bbox[1]+" at X: "+c.bbox[2]+", Y: "+c.bbox[3]),"open"==c.label&&r++,"closed"==c.label&&a++,"point"==c.label&&i++,"pinch"==c.label&&o++}}catch(l){u.e(l)}finally{u.f()}r>1?e.detectedGesture="Two Open Hands":1==r&&(e.detectedGesture="Open Hand"),a>1?e.detectedGesture="Two Closed Hands":1==a&&(e.detectedGesture="Closed Hand"),i>1?e.detectedGesture="Two Hands Pointing":1==i&&(e.detectedGesture="Hand Pointing"),o>1?e.detectedGesture="Two Hands Pinching":1==o&&(e.detectedGesture="Hand Pinching"),0==r&&0==a&&0==i&&0==o&&(e.detectedGesture="None"),e.onPrediction.emit(new YG(e.detectedGesture))}},function(e){console.log("ERROR"),console.log(e)}):console.log("no model")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=kt({type:e,selectors:[["app-handtracker"]],viewQuery:function(e,t){var n;(1&e&&function(e,t,n){var r=an();r.firstCreatePass&&(function(e,t,n){null===e.queries&&(e.queries=new Ts),e.queries.track(new Es(t,-1))}(r,new Cs(e,t,n)),2==(2&t)&&(r.staticViewQueries=!0)),function(e,t,n){var r=new Is(4==(4&n));ci(e,t,r,r.destroy),null===t[19]&&(t[19]=new Ss),t[19].queries.push(new Ns(r))}(r,rn(),t)}(ZG,5),2&e)&&(Fs(n=function(e,t){return e[19].queries[t].queryList}(rn(),dn()))&&(t.video=n.first))},outputs:{onPrediction:"onPrediction"},decls:7,vars:0,consts:[["id","htvideo","name","htvideo","autoplay","autoplay",1,"videobox"],["htvideo",""],[3,"click"]],template:function(e,t){1&e&&(io(0,"video",0,1),ro(2,"div"),ro(3,"button",2),uo("click",function(){return t.startDetection()}),ho(4,"Start"),ao(),ro(5,"button",2),uo("click",function(){return t.stopDetection()}),ho(6,"Stop"),ao(),ao())},styles:[".videobox[_ngcontent-%COMP%]{border:3px solid #0063FF;border-color:#0063ff;width:200px;height:200px}"]}),e}(),QG=[{path:"",component:function(){var e=function(){function e(){x(this,e),this.gesture=""}return I(e,[{key:"ngOnInit",value:function(){}},{key:"prediction",value:function(e){this.gesture=e.getPrediction()}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=kt({type:e,selectors:[["app-home-page"]],decls:2,vars:1,consts:[[3,"onPrediction"],[3,"innerHTML"]],template:function(e,t){1&e&&(ro(0,"app-handtracker",0),uo("onPrediction",function(e){return t.prediction(e)}),ao(),io(1,"div",1)),2&e&&(Qa(an(),rn(),Nn()+1,ln()),to("innerHTML",t.gesture,oa))},directives:[JG],styles:[""]}),e}()}],$G=function(){var e=function e(){x(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Nt({type:e}),e.\u0275inj=Ge({imports:[[vf.forRoot(QG)],vf]}),e}(),eq=function(){var e=function e(){x(this,e),this.title="at-alternative-interaction-solution"};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=kt({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(e,t){1&e&&io(0,"router-outlet")},directives:[af],styles:[""]}),e}(),tq=function(){var e=function e(){x(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Nt({type:e,bootstrap:[eq]}),e.\u0275inj=Ge({providers:[],imports:[[Fc,$G]]}),e}();(function(){if(du)throw new Error("Cannot enable prod mode after platform setup.");fu=!1})(),Ac().bootstrapModule(tq).catch(function(e){return console.error(e)})},5410:function(){},8628:function(){},1601:function(){},7792:function(){},5042:function(){}},function(e){e(e.s=4066)}])}();